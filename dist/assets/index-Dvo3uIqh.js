function tC(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in t)){const o=Object.getOwnPropertyDescriptor(s,r);o&&Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();var xi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jx(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function YB(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var r=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:function(){return t[s]}})}),n}var gR={exports:{}},Gx={},yR={exports:{}},Ot={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Of=Symbol.for("react.element"),QB=Symbol.for("react.portal"),JB=Symbol.for("react.fragment"),ZB=Symbol.for("react.strict_mode"),e4=Symbol.for("react.profiler"),t4=Symbol.for("react.provider"),n4=Symbol.for("react.context"),s4=Symbol.for("react.forward_ref"),r4=Symbol.for("react.suspense"),o4=Symbol.for("react.memo"),i4=Symbol.for("react.lazy"),FI=Symbol.iterator;function a4(t){return t===null||typeof t!="object"?null:(t=FI&&t[FI]||t["@@iterator"],typeof t=="function"?t:null)}var xR={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},wR=Object.assign,vR={};function _d(t,e,n){this.props=t,this.context=e,this.refs=vR,this.updater=n||xR}_d.prototype.isReactComponent={};_d.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};_d.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function bR(){}bR.prototype=_d.prototype;function nC(t,e,n){this.props=t,this.context=e,this.refs=vR,this.updater=n||xR}var sC=nC.prototype=new bR;sC.constructor=nC;wR(sC,_d.prototype);sC.isPureReactComponent=!0;var PI=Array.isArray,SR=Object.prototype.hasOwnProperty,rC={current:null},CR={key:!0,ref:!0,__self:!0,__source:!0};function kR(t,e,n){var s,r={},o=null,i=null;if(e!=null)for(s in e.ref!==void 0&&(i=e.ref),e.key!==void 0&&(o=""+e.key),e)SR.call(e,s)&&!CR.hasOwnProperty(s)&&(r[s]=e[s]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];r.children=l}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)r[s]===void 0&&(r[s]=a[s]);return{$$typeof:Of,type:t,key:o,ref:i,props:r,_owner:rC.current}}function l4(t,e){return{$$typeof:Of,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function oC(t){return typeof t=="object"&&t!==null&&t.$$typeof===Of}function u4(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var OI=/\/+/g;function B1(t,e){return typeof t=="object"&&t!==null&&t.key!=null?u4(""+t.key):e.toString(36)}function iy(t,e,n,s,r){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var i=!1;if(t===null)i=!0;else switch(o){case"string":case"number":i=!0;break;case"object":switch(t.$$typeof){case Of:case QB:i=!0}}if(i)return i=t,r=r(i),t=s===""?"."+B1(i,0):s,PI(r)?(n="",t!=null&&(n=t.replace(OI,"$&/")+"/"),iy(r,e,n,"",function(u){return u})):r!=null&&(oC(r)&&(r=l4(r,n+(!r.key||i&&i.key===r.key?"":(""+r.key).replace(OI,"$&/")+"/")+t)),e.push(r)),1;if(i=0,s=s===""?".":s+":",PI(t))for(var a=0;a<t.length;a++){o=t[a];var l=s+B1(o,a);i+=iy(o,e,n,l,r)}else if(l=a4(t),typeof l=="function")for(t=l.call(t),a=0;!(o=t.next()).done;)o=o.value,l=s+B1(o,a++),i+=iy(o,e,n,l,r);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return i}function Ng(t,e,n){if(t==null)return t;var s=[],r=0;return iy(t,s,"","",function(o){return e.call(n,o,r++)}),s}function c4(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Nr={current:null},ay={transition:null},d4={ReactCurrentDispatcher:Nr,ReactCurrentBatchConfig:ay,ReactCurrentOwner:rC};function IR(){throw Error("act(...) is not supported in production builds of React.")}Ot.Children={map:Ng,forEach:function(t,e,n){Ng(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Ng(t,function(){e++}),e},toArray:function(t){return Ng(t,function(e){return e})||[]},only:function(t){if(!oC(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ot.Component=_d;Ot.Fragment=JB;Ot.Profiler=e4;Ot.PureComponent=nC;Ot.StrictMode=ZB;Ot.Suspense=r4;Ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=d4;Ot.act=IR;Ot.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=wR({},t.props),r=t.key,o=t.ref,i=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,i=rC.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)SR.call(e,l)&&!CR.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];s.children=a}return{$$typeof:Of,type:t.type,key:r,ref:o,props:s,_owner:i}};Ot.createContext=function(t){return t={$$typeof:n4,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:t4,_context:t},t.Consumer=t};Ot.createElement=kR;Ot.createFactory=function(t){var e=kR.bind(null,t);return e.type=t,e};Ot.createRef=function(){return{current:null}};Ot.forwardRef=function(t){return{$$typeof:s4,render:t}};Ot.isValidElement=oC;Ot.lazy=function(t){return{$$typeof:i4,_payload:{_status:-1,_result:t},_init:c4}};Ot.memo=function(t,e){return{$$typeof:o4,type:t,compare:e===void 0?null:e}};Ot.startTransition=function(t){var e=ay.transition;ay.transition={};try{t()}finally{ay.transition=e}};Ot.unstable_act=IR;Ot.useCallback=function(t,e){return Nr.current.useCallback(t,e)};Ot.useContext=function(t){return Nr.current.useContext(t)};Ot.useDebugValue=function(){};Ot.useDeferredValue=function(t){return Nr.current.useDeferredValue(t)};Ot.useEffect=function(t,e){return Nr.current.useEffect(t,e)};Ot.useId=function(){return Nr.current.useId()};Ot.useImperativeHandle=function(t,e,n){return Nr.current.useImperativeHandle(t,e,n)};Ot.useInsertionEffect=function(t,e){return Nr.current.useInsertionEffect(t,e)};Ot.useLayoutEffect=function(t,e){return Nr.current.useLayoutEffect(t,e)};Ot.useMemo=function(t,e){return Nr.current.useMemo(t,e)};Ot.useReducer=function(t,e,n){return Nr.current.useReducer(t,e,n)};Ot.useRef=function(t){return Nr.current.useRef(t)};Ot.useState=function(t){return Nr.current.useState(t)};Ot.useSyncExternalStore=function(t,e,n){return Nr.current.useSyncExternalStore(t,e,n)};Ot.useTransition=function(){return Nr.current.useTransition()};Ot.version="18.3.1";yR.exports=Ot;var X=yR.exports;const no=jx(X),h4=tC({__proto__:null,default:no},[X]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p4=X,f4=Symbol.for("react.element"),m4=Symbol.for("react.fragment"),g4=Object.prototype.hasOwnProperty,y4=p4.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,x4={key:!0,ref:!0,__self:!0,__source:!0};function $R(t,e,n){var s,r={},o=null,i=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(i=e.ref);for(s in e)g4.call(e,s)&&!x4.hasOwnProperty(s)&&(r[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:f4,type:t,key:o,ref:i,props:r,_owner:y4.current}}Gx.Fragment=m4;Gx.jsx=$R;Gx.jsxs=$R;gR.exports=Gx;var E=gR.exports,NR={exports:{}},mo={},TR={exports:{}},ER={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(j,ee){var ie=j.length;j.push(ee);e:for(;0<ie;){var le=ie-1>>>1,fe=j[le];if(0<r(fe,ee))j[le]=ee,j[ie]=fe,ie=le;else break e}}function n(j){return j.length===0?null:j[0]}function s(j){if(j.length===0)return null;var ee=j[0],ie=j.pop();if(ie!==ee){j[0]=ie;e:for(var le=0,fe=j.length,ge=fe>>>1;le<ge;){var xe=2*(le+1)-1,we=j[xe],Ie=xe+1,_e=j[Ie];if(0>r(we,ie))Ie<fe&&0>r(_e,we)?(j[le]=_e,j[Ie]=ie,le=Ie):(j[le]=we,j[xe]=ie,le=xe);else if(Ie<fe&&0>r(_e,ie))j[le]=_e,j[Ie]=ie,le=Ie;else break e}}return ee}function r(j,ee){var ie=j.sortIndex-ee.sortIndex;return ie!==0?ie:j.id-ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var i=Date,a=i.now();t.unstable_now=function(){return i.now()-a}}var l=[],u=[],c=1,d=null,h=3,p=!1,f=!1,m=!1,g=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(j){for(var ee=n(u);ee!==null;){if(ee.callback===null)s(u);else if(ee.startTime<=j)s(u),ee.sortIndex=ee.expirationTime,e(l,ee);else break;ee=n(u)}}function b(j){if(m=!1,v(j),!f)if(n(l)!==null)f=!0,Q(S);else{var ee=n(u);ee!==null&&oe(b,ee.startTime-j)}}function S(j,ee){f=!1,m&&(m=!1,y(T),T=-1),p=!0;var ie=h;try{for(v(ee),d=n(l);d!==null&&(!(d.expirationTime>ee)||j&&!P());){var le=d.callback;if(typeof le=="function"){d.callback=null,h=d.priorityLevel;var fe=le(d.expirationTime<=ee);ee=t.unstable_now(),typeof fe=="function"?d.callback=fe:d===n(l)&&s(l),v(ee)}else s(l);d=n(l)}if(d!==null)var ge=!0;else{var xe=n(u);xe!==null&&oe(b,xe.startTime-ee),ge=!1}return ge}finally{d=null,h=ie,p=!1}}var C=!1,I=null,T=-1,R=5,_=-1;function P(){return!(t.unstable_now()-_<R)}function z(){if(I!==null){var j=t.unstable_now();_=j;var ee=!0;try{ee=I(!0,j)}finally{ee?O():(C=!1,I=null)}}else C=!1}var O;if(typeof x=="function")O=function(){x(z)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,H=V.port2;V.port1.onmessage=z,O=function(){H.postMessage(null)}}else O=function(){g(z,0)};function Q(j){I=j,C||(C=!0,O())}function oe(j,ee){T=g(function(){j(t.unstable_now())},ee)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(j){j.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,Q(S))},t.unstable_forceFrameRate=function(j){0>j||125<j?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<j?Math.floor(1e3/j):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(j){switch(h){case 1:case 2:case 3:var ee=3;break;default:ee=h}var ie=h;h=ee;try{return j()}finally{h=ie}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(j,ee){switch(j){case 1:case 2:case 3:case 4:case 5:break;default:j=3}var ie=h;h=j;try{return ee()}finally{h=ie}},t.unstable_scheduleCallback=function(j,ee,ie){var le=t.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?le+ie:le):ie=le,j){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=ie+fe,j={id:c++,callback:ee,priorityLevel:j,startTime:ie,expirationTime:fe,sortIndex:-1},ie>le?(j.sortIndex=ie,e(u,j),n(l)===null&&j===n(u)&&(m?(y(T),T=-1):m=!0,oe(b,ie-le))):(j.sortIndex=fe,e(l,j),f||p||(f=!0,Q(S))),j},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(j){var ee=h;return function(){var ie=h;h=ee;try{return j.apply(this,arguments)}finally{h=ie}}}})(ER);TR.exports=ER;var w4=TR.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v4=X,ho=w4;function $e(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var RR=new Set,Kp={};function sc(t,e){dd(t,e),dd(t+"Capture",e)}function dd(t,e){for(Kp[t]=e,t=0;t<e.length;t++)RR.add(e[t])}var Pa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qv=Object.prototype.hasOwnProperty,b4=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,LI={},zI={};function S4(t){return Qv.call(zI,t)?!0:Qv.call(LI,t)?!1:b4.test(t)?zI[t]=!0:(LI[t]=!0,!1)}function C4(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function k4(t,e,n,s){if(e===null||typeof e>"u"||C4(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Tr(t,e,n,s,r,o,i){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=i}var Ks={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ks[t]=new Tr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ks[e]=new Tr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ks[t]=new Tr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ks[t]=new Tr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ks[t]=new Tr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ks[t]=new Tr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ks[t]=new Tr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ks[t]=new Tr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ks[t]=new Tr(t,5,!1,t.toLowerCase(),null,!1,!1)});var iC=/[\-:]([a-z])/g;function aC(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(iC,aC);Ks[e]=new Tr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(iC,aC);Ks[e]=new Tr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(iC,aC);Ks[e]=new Tr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ks[t]=new Tr(t,1,!1,t.toLowerCase(),null,!1,!1)});Ks.xlinkHref=new Tr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ks[t]=new Tr(t,1,!1,t.toLowerCase(),null,!0,!0)});function lC(t,e,n,s){var r=Ks.hasOwnProperty(e)?Ks[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(k4(e,n,r,s)&&(n=null),s||r===null?S4(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,s=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var Ua=v4.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Tg=Symbol.for("react.element"),Bc=Symbol.for("react.portal"),Vc=Symbol.for("react.fragment"),uC=Symbol.for("react.strict_mode"),Jv=Symbol.for("react.profiler"),DR=Symbol.for("react.provider"),AR=Symbol.for("react.context"),cC=Symbol.for("react.forward_ref"),Zv=Symbol.for("react.suspense"),eb=Symbol.for("react.suspense_list"),dC=Symbol.for("react.memo"),Za=Symbol.for("react.lazy"),_R=Symbol.for("react.offscreen"),MI=Symbol.iterator;function rp(t){return t===null||typeof t!="object"?null:(t=MI&&t[MI]||t["@@iterator"],typeof t=="function"?t:null)}var Vn=Object.assign,V1;function Cp(t){if(V1===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);V1=e&&e[1]||""}return`
`+V1+t}var U1=!1;function W1(t,e){if(!t||U1)return"";U1=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var s=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){s=u}t.call(e.prototype)}else{try{throw Error()}catch(u){s=u}t()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),o=s.stack.split(`
`),i=r.length-1,a=o.length-1;1<=i&&0<=a&&r[i]!==o[a];)a--;for(;1<=i&&0<=a;i--,a--)if(r[i]!==o[a]){if(i!==1||a!==1)do if(i--,a--,0>a||r[i]!==o[a]){var l=`
`+r[i].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=i&&0<=a);break}}}finally{U1=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Cp(t):""}function I4(t){switch(t.tag){case 5:return Cp(t.type);case 16:return Cp("Lazy");case 13:return Cp("Suspense");case 19:return Cp("SuspenseList");case 0:case 2:case 15:return t=W1(t.type,!1),t;case 11:return t=W1(t.type.render,!1),t;case 1:return t=W1(t.type,!0),t;default:return""}}function tb(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Vc:return"Fragment";case Bc:return"Portal";case Jv:return"Profiler";case uC:return"StrictMode";case Zv:return"Suspense";case eb:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case AR:return(t.displayName||"Context")+".Consumer";case DR:return(t._context.displayName||"Context")+".Provider";case cC:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case dC:return e=t.displayName||null,e!==null?e:tb(t.type)||"Memo";case Za:e=t._payload,t=t._init;try{return tb(t(e))}catch{}}return null}function $4(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return tb(e);case 8:return e===uC?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Cl(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function FR(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function N4(t){var e=FR(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(i){s=""+i,o.call(this,i)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(i){s=""+i},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Eg(t){t._valueTracker||(t._valueTracker=N4(t))}function PR(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=FR(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function Ry(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function nb(t,e){var n=e.checked;return Vn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function BI(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=Cl(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function OR(t,e){e=e.checked,e!=null&&lC(t,"checked",e,!1)}function sb(t,e){OR(t,e);var n=Cl(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?rb(t,e.type,n):e.hasOwnProperty("defaultValue")&&rb(t,e.type,Cl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function VI(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function rb(t,e,n){(e!=="number"||Ry(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var kp=Array.isArray;function Zc(t,e,n,s){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&s&&(t[n].defaultSelected=!0)}else{for(n=""+Cl(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,s&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function ob(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error($e(91));return Vn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function UI(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error($e(92));if(kp(n)){if(1<n.length)throw Error($e(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Cl(n)}}function LR(t,e){var n=Cl(e.value),s=Cl(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function WI(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function zR(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ib(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?zR(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Rg,MR=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Rg=Rg||document.createElement("div"),Rg.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Rg.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function qp(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Pp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},T4=["Webkit","ms","Moz","O"];Object.keys(Pp).forEach(function(t){T4.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Pp[e]=Pp[t]})});function BR(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Pp.hasOwnProperty(t)&&Pp[t]?(""+e).trim():e+"px"}function VR(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=BR(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,r):t[n]=r}}var E4=Vn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ab(t,e){if(e){if(E4[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error($e(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error($e(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error($e(61))}if(e.style!=null&&typeof e.style!="object")throw Error($e(62))}}function lb(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ub=null;function hC(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var cb=null,ed=null,td=null;function jI(t){if(t=Mf(t)){if(typeof cb!="function")throw Error($e(280));var e=t.stateNode;e&&(e=Yx(e),cb(t.stateNode,t.type,e))}}function UR(t){ed?td?td.push(t):td=[t]:ed=t}function WR(){if(ed){var t=ed,e=td;if(td=ed=null,jI(t),e)for(t=0;t<e.length;t++)jI(e[t])}}function jR(t,e){return t(e)}function GR(){}var j1=!1;function HR(t,e,n){if(j1)return t(e,n);j1=!0;try{return jR(t,e,n)}finally{j1=!1,(ed!==null||td!==null)&&(GR(),WR())}}function Xp(t,e){var n=t.stateNode;if(n===null)return null;var s=Yx(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error($e(231,e,typeof n));return n}var db=!1;if(Pa)try{var op={};Object.defineProperty(op,"passive",{get:function(){db=!0}}),window.addEventListener("test",op,op),window.removeEventListener("test",op,op)}catch{db=!1}function R4(t,e,n,s,r,o,i,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(c){this.onError(c)}}var Op=!1,Dy=null,Ay=!1,hb=null,D4={onError:function(t){Op=!0,Dy=t}};function A4(t,e,n,s,r,o,i,a,l){Op=!1,Dy=null,R4.apply(D4,arguments)}function _4(t,e,n,s,r,o,i,a,l){if(A4.apply(this,arguments),Op){if(Op){var u=Dy;Op=!1,Dy=null}else throw Error($e(198));Ay||(Ay=!0,hb=u)}}function rc(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function KR(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function GI(t){if(rc(t)!==t)throw Error($e(188))}function F4(t){var e=t.alternate;if(!e){if(e=rc(t),e===null)throw Error($e(188));return e!==t?null:t}for(var n=t,s=e;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return GI(r),t;if(o===s)return GI(r),e;o=o.sibling}throw Error($e(188))}if(n.return!==s.return)n=r,s=o;else{for(var i=!1,a=r.child;a;){if(a===n){i=!0,n=r,s=o;break}if(a===s){i=!0,s=r,n=o;break}a=a.sibling}if(!i){for(a=o.child;a;){if(a===n){i=!0,n=o,s=r;break}if(a===s){i=!0,s=o,n=r;break}a=a.sibling}if(!i)throw Error($e(189))}}if(n.alternate!==s)throw Error($e(190))}if(n.tag!==3)throw Error($e(188));return n.stateNode.current===n?t:e}function qR(t){return t=F4(t),t!==null?XR(t):null}function XR(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=XR(t);if(e!==null)return e;t=t.sibling}return null}var YR=ho.unstable_scheduleCallback,HI=ho.unstable_cancelCallback,P4=ho.unstable_shouldYield,O4=ho.unstable_requestPaint,Jn=ho.unstable_now,L4=ho.unstable_getCurrentPriorityLevel,pC=ho.unstable_ImmediatePriority,QR=ho.unstable_UserBlockingPriority,_y=ho.unstable_NormalPriority,z4=ho.unstable_LowPriority,JR=ho.unstable_IdlePriority,Hx=null,ta=null;function M4(t){if(ta&&typeof ta.onCommitFiberRoot=="function")try{ta.onCommitFiberRoot(Hx,t,void 0,(t.current.flags&128)===128)}catch{}}var wi=Math.clz32?Math.clz32:U4,B4=Math.log,V4=Math.LN2;function U4(t){return t>>>=0,t===0?32:31-(B4(t)/V4|0)|0}var Dg=64,Ag=4194304;function Ip(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Fy(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,r=t.suspendedLanes,o=t.pingedLanes,i=n&268435455;if(i!==0){var a=i&~r;a!==0?s=Ip(a):(o&=i,o!==0&&(s=Ip(o)))}else i=n&~r,i!==0?s=Ip(i):o!==0&&(s=Ip(o));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,o=e&-e,r>=o||r===16&&(o&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-wi(e),r=1<<n,s|=t[n],e&=~r;return s}function W4(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function j4(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,r=t.expirationTimes,o=t.pendingLanes;0<o;){var i=31-wi(o),a=1<<i,l=r[i];l===-1?(!(a&n)||a&s)&&(r[i]=W4(a,e)):l<=e&&(t.expiredLanes|=a),o&=~a}}function pb(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function ZR(){var t=Dg;return Dg<<=1,!(Dg&4194240)&&(Dg=64),t}function G1(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Lf(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-wi(e),t[e]=n}function G4(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-wi(n),o=1<<r;e[r]=0,s[r]=-1,t[r]=-1,n&=~o}}function fC(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-wi(n),r=1<<s;r&e|t[s]&e&&(t[s]|=e),n&=~r}}var rn=0;function eD(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var tD,mC,nD,sD,rD,fb=!1,_g=[],hl=null,pl=null,fl=null,Yp=new Map,Qp=new Map,nl=[],H4="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function KI(t,e){switch(t){case"focusin":case"focusout":hl=null;break;case"dragenter":case"dragleave":pl=null;break;case"mouseover":case"mouseout":fl=null;break;case"pointerover":case"pointerout":Yp.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Qp.delete(e.pointerId)}}function ip(t,e,n,s,r,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:o,targetContainers:[r]},e!==null&&(e=Mf(e),e!==null&&mC(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function K4(t,e,n,s,r){switch(e){case"focusin":return hl=ip(hl,t,e,n,s,r),!0;case"dragenter":return pl=ip(pl,t,e,n,s,r),!0;case"mouseover":return fl=ip(fl,t,e,n,s,r),!0;case"pointerover":var o=r.pointerId;return Yp.set(o,ip(Yp.get(o)||null,t,e,n,s,r)),!0;case"gotpointercapture":return o=r.pointerId,Qp.set(o,ip(Qp.get(o)||null,t,e,n,s,r)),!0}return!1}function oD(t){var e=yu(t.target);if(e!==null){var n=rc(e);if(n!==null){if(e=n.tag,e===13){if(e=KR(n),e!==null){t.blockedOn=e,rD(t.priority,function(){nD(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ly(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=mb(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);ub=s,n.target.dispatchEvent(s),ub=null}else return e=Mf(n),e!==null&&mC(e),t.blockedOn=n,!1;e.shift()}return!0}function qI(t,e,n){ly(t)&&n.delete(e)}function q4(){fb=!1,hl!==null&&ly(hl)&&(hl=null),pl!==null&&ly(pl)&&(pl=null),fl!==null&&ly(fl)&&(fl=null),Yp.forEach(qI),Qp.forEach(qI)}function ap(t,e){t.blockedOn===e&&(t.blockedOn=null,fb||(fb=!0,ho.unstable_scheduleCallback(ho.unstable_NormalPriority,q4)))}function Jp(t){function e(r){return ap(r,t)}if(0<_g.length){ap(_g[0],t);for(var n=1;n<_g.length;n++){var s=_g[n];s.blockedOn===t&&(s.blockedOn=null)}}for(hl!==null&&ap(hl,t),pl!==null&&ap(pl,t),fl!==null&&ap(fl,t),Yp.forEach(e),Qp.forEach(e),n=0;n<nl.length;n++)s=nl[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<nl.length&&(n=nl[0],n.blockedOn===null);)oD(n),n.blockedOn===null&&nl.shift()}var nd=Ua.ReactCurrentBatchConfig,Py=!0;function X4(t,e,n,s){var r=rn,o=nd.transition;nd.transition=null;try{rn=1,gC(t,e,n,s)}finally{rn=r,nd.transition=o}}function Y4(t,e,n,s){var r=rn,o=nd.transition;nd.transition=null;try{rn=4,gC(t,e,n,s)}finally{rn=r,nd.transition=o}}function gC(t,e,n,s){if(Py){var r=mb(t,e,n,s);if(r===null)tv(t,e,s,Oy,n),KI(t,s);else if(K4(r,t,e,n,s))s.stopPropagation();else if(KI(t,s),e&4&&-1<H4.indexOf(t)){for(;r!==null;){var o=Mf(r);if(o!==null&&tD(o),o=mb(t,e,n,s),o===null&&tv(t,e,s,Oy,n),o===r)break;r=o}r!==null&&s.stopPropagation()}else tv(t,e,s,null,n)}}var Oy=null;function mb(t,e,n,s){if(Oy=null,t=hC(s),t=yu(t),t!==null)if(e=rc(t),e===null)t=null;else if(n=e.tag,n===13){if(t=KR(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Oy=t,null}function iD(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(L4()){case pC:return 1;case QR:return 4;case _y:case z4:return 16;case JR:return 536870912;default:return 16}default:return 16}}var ol=null,yC=null,uy=null;function aD(){if(uy)return uy;var t,e=yC,n=e.length,s,r="value"in ol?ol.value:ol.textContent,o=r.length;for(t=0;t<n&&e[t]===r[t];t++);var i=n-t;for(s=1;s<=i&&e[n-s]===r[o-s];s++);return uy=r.slice(t,1<s?1-s:void 0)}function cy(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Fg(){return!0}function XI(){return!1}function go(t){function e(n,s,r,o,i){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=o,this.target=i,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Fg:XI,this.isPropagationStopped=XI,this}return Vn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Fg)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Fg)},persist:function(){},isPersistent:Fg}),e}var Fd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xC=go(Fd),zf=Vn({},Fd,{view:0,detail:0}),Q4=go(zf),H1,K1,lp,Kx=Vn({},zf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wC,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==lp&&(lp&&t.type==="mousemove"?(H1=t.screenX-lp.screenX,K1=t.screenY-lp.screenY):K1=H1=0,lp=t),H1)},movementY:function(t){return"movementY"in t?t.movementY:K1}}),YI=go(Kx),J4=Vn({},Kx,{dataTransfer:0}),Z4=go(J4),eV=Vn({},zf,{relatedTarget:0}),q1=go(eV),tV=Vn({},Fd,{animationName:0,elapsedTime:0,pseudoElement:0}),nV=go(tV),sV=Vn({},Fd,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),rV=go(sV),oV=Vn({},Fd,{data:0}),QI=go(oV),iV={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},aV={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},lV={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function uV(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=lV[t])?!!e[t]:!1}function wC(){return uV}var cV=Vn({},zf,{key:function(t){if(t.key){var e=iV[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=cy(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?aV[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wC,charCode:function(t){return t.type==="keypress"?cy(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?cy(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),dV=go(cV),hV=Vn({},Kx,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),JI=go(hV),pV=Vn({},zf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wC}),fV=go(pV),mV=Vn({},Fd,{propertyName:0,elapsedTime:0,pseudoElement:0}),gV=go(mV),yV=Vn({},Kx,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),xV=go(yV),wV=[9,13,27,32],vC=Pa&&"CompositionEvent"in window,Lp=null;Pa&&"documentMode"in document&&(Lp=document.documentMode);var vV=Pa&&"TextEvent"in window&&!Lp,lD=Pa&&(!vC||Lp&&8<Lp&&11>=Lp),ZI=" ",e$=!1;function uD(t,e){switch(t){case"keyup":return wV.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cD(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Uc=!1;function bV(t,e){switch(t){case"compositionend":return cD(e);case"keypress":return e.which!==32?null:(e$=!0,ZI);case"textInput":return t=e.data,t===ZI&&e$?null:t;default:return null}}function SV(t,e){if(Uc)return t==="compositionend"||!vC&&uD(t,e)?(t=aD(),uy=yC=ol=null,Uc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return lD&&e.locale!=="ko"?null:e.data;default:return null}}var CV={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function t$(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!CV[t.type]:e==="textarea"}function dD(t,e,n,s){UR(s),e=Ly(e,"onChange"),0<e.length&&(n=new xC("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var zp=null,Zp=null;function kV(t){SD(t,0)}function qx(t){var e=Gc(t);if(PR(e))return t}function IV(t,e){if(t==="change")return e}var hD=!1;if(Pa){var X1;if(Pa){var Y1="oninput"in document;if(!Y1){var n$=document.createElement("div");n$.setAttribute("oninput","return;"),Y1=typeof n$.oninput=="function"}X1=Y1}else X1=!1;hD=X1&&(!document.documentMode||9<document.documentMode)}function s$(){zp&&(zp.detachEvent("onpropertychange",pD),Zp=zp=null)}function pD(t){if(t.propertyName==="value"&&qx(Zp)){var e=[];dD(e,Zp,t,hC(t)),HR(kV,e)}}function $V(t,e,n){t==="focusin"?(s$(),zp=e,Zp=n,zp.attachEvent("onpropertychange",pD)):t==="focusout"&&s$()}function NV(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return qx(Zp)}function TV(t,e){if(t==="click")return qx(e)}function EV(t,e){if(t==="input"||t==="change")return qx(e)}function RV(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ci=typeof Object.is=="function"?Object.is:RV;function ef(t,e){if(Ci(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!Qv.call(e,r)||!Ci(t[r],e[r]))return!1}return!0}function r$(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function o$(t,e){var n=r$(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=r$(n)}}function fD(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?fD(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function mD(){for(var t=window,e=Ry();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ry(t.document)}return e}function bC(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function DV(t){var e=mD(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&fD(n.ownerDocument.documentElement,n)){if(s!==null&&bC(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,o=Math.min(s.start,r);s=s.end===void 0?o:Math.min(s.end,r),!t.extend&&o>s&&(r=s,s=o,o=r),r=o$(n,o);var i=o$(n,s);r&&i&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==i.node||t.focusOffset!==i.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),o>s?(t.addRange(e),t.extend(i.node,i.offset)):(e.setEnd(i.node,i.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var AV=Pa&&"documentMode"in document&&11>=document.documentMode,Wc=null,gb=null,Mp=null,yb=!1;function i$(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;yb||Wc==null||Wc!==Ry(s)||(s=Wc,"selectionStart"in s&&bC(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Mp&&ef(Mp,s)||(Mp=s,s=Ly(gb,"onSelect"),0<s.length&&(e=new xC("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=Wc)))}function Pg(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var jc={animationend:Pg("Animation","AnimationEnd"),animationiteration:Pg("Animation","AnimationIteration"),animationstart:Pg("Animation","AnimationStart"),transitionend:Pg("Transition","TransitionEnd")},Q1={},gD={};Pa&&(gD=document.createElement("div").style,"AnimationEvent"in window||(delete jc.animationend.animation,delete jc.animationiteration.animation,delete jc.animationstart.animation),"TransitionEvent"in window||delete jc.transitionend.transition);function Xx(t){if(Q1[t])return Q1[t];if(!jc[t])return t;var e=jc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in gD)return Q1[t]=e[n];return t}var yD=Xx("animationend"),xD=Xx("animationiteration"),wD=Xx("animationstart"),vD=Xx("transitionend"),bD=new Map,a$="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ol(t,e){bD.set(t,e),sc(e,[t])}for(var J1=0;J1<a$.length;J1++){var Z1=a$[J1],_V=Z1.toLowerCase(),FV=Z1[0].toUpperCase()+Z1.slice(1);Ol(_V,"on"+FV)}Ol(yD,"onAnimationEnd");Ol(xD,"onAnimationIteration");Ol(wD,"onAnimationStart");Ol("dblclick","onDoubleClick");Ol("focusin","onFocus");Ol("focusout","onBlur");Ol(vD,"onTransitionEnd");dd("onMouseEnter",["mouseout","mouseover"]);dd("onMouseLeave",["mouseout","mouseover"]);dd("onPointerEnter",["pointerout","pointerover"]);dd("onPointerLeave",["pointerout","pointerover"]);sc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));sc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));sc("onBeforeInput",["compositionend","keypress","textInput","paste"]);sc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));sc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));sc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $p="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),PV=new Set("cancel close invalid load scroll toggle".split(" ").concat($p));function l$(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,_4(s,e,void 0,t),t.currentTarget=null}function SD(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],r=s.event;s=s.listeners;e:{var o=void 0;if(e)for(var i=s.length-1;0<=i;i--){var a=s[i],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==o&&r.isPropagationStopped())break e;l$(r,a,u),o=l}else for(i=0;i<s.length;i++){if(a=s[i],l=a.instance,u=a.currentTarget,a=a.listener,l!==o&&r.isPropagationStopped())break e;l$(r,a,u),o=l}}}if(Ay)throw t=hb,Ay=!1,hb=null,t}function In(t,e){var n=e[Sb];n===void 0&&(n=e[Sb]=new Set);var s=t+"__bubble";n.has(s)||(CD(e,t,2,!1),n.add(s))}function ev(t,e,n){var s=0;e&&(s|=4),CD(n,t,s,e)}var Og="_reactListening"+Math.random().toString(36).slice(2);function tf(t){if(!t[Og]){t[Og]=!0,RR.forEach(function(n){n!=="selectionchange"&&(PV.has(n)||ev(n,!1,t),ev(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Og]||(e[Og]=!0,ev("selectionchange",!1,e))}}function CD(t,e,n,s){switch(iD(e)){case 1:var r=X4;break;case 4:r=Y4;break;default:r=gC}n=r.bind(null,e,n,t),r=void 0,!db||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function tv(t,e,n,s,r){var o=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var i=s.tag;if(i===3||i===4){var a=s.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(i===4)for(i=s.return;i!==null;){var l=i.tag;if((l===3||l===4)&&(l=i.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;i=i.return}for(;a!==null;){if(i=yu(a),i===null)return;if(l=i.tag,l===5||l===6){s=o=i;continue e}a=a.parentNode}}s=s.return}HR(function(){var u=o,c=hC(n),d=[];e:{var h=bD.get(t);if(h!==void 0){var p=xC,f=t;switch(t){case"keypress":if(cy(n)===0)break e;case"keydown":case"keyup":p=dV;break;case"focusin":f="focus",p=q1;break;case"focusout":f="blur",p=q1;break;case"beforeblur":case"afterblur":p=q1;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=YI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Z4;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=fV;break;case yD:case xD:case wD:p=nV;break;case vD:p=gV;break;case"scroll":p=Q4;break;case"wheel":p=xV;break;case"copy":case"cut":case"paste":p=rV;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=JI}var m=(e&4)!==0,g=!m&&t==="scroll",y=m?h!==null?h+"Capture":null:h;m=[];for(var x=u,v;x!==null;){v=x;var b=v.stateNode;if(v.tag===5&&b!==null&&(v=b,y!==null&&(b=Xp(x,y),b!=null&&m.push(nf(x,b,v)))),g)break;x=x.return}0<m.length&&(h=new p(h,f,null,n,c),d.push({event:h,listeners:m}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",h&&n!==ub&&(f=n.relatedTarget||n.fromElement)&&(yu(f)||f[Oa]))break e;if((p||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,p?(f=n.relatedTarget||n.toElement,p=u,f=f?yu(f):null,f!==null&&(g=rc(f),f!==g||f.tag!==5&&f.tag!==6)&&(f=null)):(p=null,f=u),p!==f)){if(m=YI,b="onMouseLeave",y="onMouseEnter",x="mouse",(t==="pointerout"||t==="pointerover")&&(m=JI,b="onPointerLeave",y="onPointerEnter",x="pointer"),g=p==null?h:Gc(p),v=f==null?h:Gc(f),h=new m(b,x+"leave",p,n,c),h.target=g,h.relatedTarget=v,b=null,yu(c)===u&&(m=new m(y,x+"enter",f,n,c),m.target=v,m.relatedTarget=g,b=m),g=b,p&&f)t:{for(m=p,y=f,x=0,v=m;v;v=$c(v))x++;for(v=0,b=y;b;b=$c(b))v++;for(;0<x-v;)m=$c(m),x--;for(;0<v-x;)y=$c(y),v--;for(;x--;){if(m===y||y!==null&&m===y.alternate)break t;m=$c(m),y=$c(y)}m=null}else m=null;p!==null&&u$(d,h,p,m,!1),f!==null&&g!==null&&u$(d,g,f,m,!0)}}e:{if(h=u?Gc(u):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var S=IV;else if(t$(h))if(hD)S=EV;else{S=NV;var C=$V}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(S=TV);if(S&&(S=S(t,u))){dD(d,S,n,c);break e}C&&C(t,h,u),t==="focusout"&&(C=h._wrapperState)&&C.controlled&&h.type==="number"&&rb(h,"number",h.value)}switch(C=u?Gc(u):window,t){case"focusin":(t$(C)||C.contentEditable==="true")&&(Wc=C,gb=u,Mp=null);break;case"focusout":Mp=gb=Wc=null;break;case"mousedown":yb=!0;break;case"contextmenu":case"mouseup":case"dragend":yb=!1,i$(d,n,c);break;case"selectionchange":if(AV)break;case"keydown":case"keyup":i$(d,n,c)}var I;if(vC)e:{switch(t){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else Uc?uD(t,n)&&(T="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(T="onCompositionStart");T&&(lD&&n.locale!=="ko"&&(Uc||T!=="onCompositionStart"?T==="onCompositionEnd"&&Uc&&(I=aD()):(ol=c,yC="value"in ol?ol.value:ol.textContent,Uc=!0)),C=Ly(u,T),0<C.length&&(T=new QI(T,t,null,n,c),d.push({event:T,listeners:C}),I?T.data=I:(I=cD(n),I!==null&&(T.data=I)))),(I=vV?bV(t,n):SV(t,n))&&(u=Ly(u,"onBeforeInput"),0<u.length&&(c=new QI("onBeforeInput","beforeinput",null,n,c),d.push({event:c,listeners:u}),c.data=I))}SD(d,e)})}function nf(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ly(t,e){for(var n=e+"Capture",s=[];t!==null;){var r=t,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=Xp(t,n),o!=null&&s.unshift(nf(t,o,r)),o=Xp(t,e),o!=null&&s.push(nf(t,o,r))),t=t.return}return s}function $c(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function u$(t,e,n,s,r){for(var o=e._reactName,i=[];n!==null&&n!==s;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===s)break;a.tag===5&&u!==null&&(a=u,r?(l=Xp(n,o),l!=null&&i.unshift(nf(n,l,a))):r||(l=Xp(n,o),l!=null&&i.push(nf(n,l,a)))),n=n.return}i.length!==0&&t.push({event:e,listeners:i})}var OV=/\r\n?/g,LV=/\u0000|\uFFFD/g;function c$(t){return(typeof t=="string"?t:""+t).replace(OV,`
`).replace(LV,"")}function Lg(t,e,n){if(e=c$(e),c$(t)!==e&&n)throw Error($e(425))}function zy(){}var xb=null,wb=null;function vb(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var bb=typeof setTimeout=="function"?setTimeout:void 0,zV=typeof clearTimeout=="function"?clearTimeout:void 0,d$=typeof Promise=="function"?Promise:void 0,MV=typeof queueMicrotask=="function"?queueMicrotask:typeof d$<"u"?function(t){return d$.resolve(null).then(t).catch(BV)}:bb;function BV(t){setTimeout(function(){throw t})}function nv(t,e){var n=e,s=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){t.removeChild(r),Jp(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);Jp(e)}function ml(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function h$(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Pd=Math.random().toString(36).slice(2),Qi="__reactFiber$"+Pd,sf="__reactProps$"+Pd,Oa="__reactContainer$"+Pd,Sb="__reactEvents$"+Pd,VV="__reactListeners$"+Pd,UV="__reactHandles$"+Pd;function yu(t){var e=t[Qi];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Oa]||n[Qi]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=h$(t);t!==null;){if(n=t[Qi])return n;t=h$(t)}return e}t=n,n=t.parentNode}return null}function Mf(t){return t=t[Qi]||t[Oa],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Gc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error($e(33))}function Yx(t){return t[sf]||null}var Cb=[],Hc=-1;function Ll(t){return{current:t}}function Nn(t){0>Hc||(t.current=Cb[Hc],Cb[Hc]=null,Hc--)}function wn(t,e){Hc++,Cb[Hc]=t.current,t.current=e}var kl={},dr=Ll(kl),Wr=Ll(!1),Pu=kl;function hd(t,e){var n=t.type.contextTypes;if(!n)return kl;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=e[o];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function jr(t){return t=t.childContextTypes,t!=null}function My(){Nn(Wr),Nn(dr)}function p$(t,e,n){if(dr.current!==kl)throw Error($e(168));wn(dr,e),wn(Wr,n)}function kD(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error($e(108,$4(t)||"Unknown",r));return Vn({},n,s)}function By(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||kl,Pu=dr.current,wn(dr,t),wn(Wr,Wr.current),!0}function f$(t,e,n){var s=t.stateNode;if(!s)throw Error($e(169));n?(t=kD(t,e,Pu),s.__reactInternalMemoizedMergedChildContext=t,Nn(Wr),Nn(dr),wn(dr,t)):Nn(Wr),wn(Wr,n)}var Sa=null,Qx=!1,sv=!1;function ID(t){Sa===null?Sa=[t]:Sa.push(t)}function WV(t){Qx=!0,ID(t)}function zl(){if(!sv&&Sa!==null){sv=!0;var t=0,e=rn;try{var n=Sa;for(rn=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}Sa=null,Qx=!1}catch(r){throw Sa!==null&&(Sa=Sa.slice(t+1)),YR(pC,zl),r}finally{rn=e,sv=!1}}return null}var Kc=[],qc=0,Vy=null,Uy=0,_o=[],Fo=0,Ou=null,Na=1,Ta="";function iu(t,e){Kc[qc++]=Uy,Kc[qc++]=Vy,Vy=t,Uy=e}function $D(t,e,n){_o[Fo++]=Na,_o[Fo++]=Ta,_o[Fo++]=Ou,Ou=t;var s=Na;t=Ta;var r=32-wi(s)-1;s&=~(1<<r),n+=1;var o=32-wi(e)+r;if(30<o){var i=r-r%5;o=(s&(1<<i)-1).toString(32),s>>=i,r-=i,Na=1<<32-wi(e)+r|n<<r|s,Ta=o+t}else Na=1<<o|n<<r|s,Ta=t}function SC(t){t.return!==null&&(iu(t,1),$D(t,1,0))}function CC(t){for(;t===Vy;)Vy=Kc[--qc],Kc[qc]=null,Uy=Kc[--qc],Kc[qc]=null;for(;t===Ou;)Ou=_o[--Fo],_o[Fo]=null,Ta=_o[--Fo],_o[Fo]=null,Na=_o[--Fo],_o[Fo]=null}var lo=null,io=null,_n=!1,fi=null;function ND(t,e){var n=Oo(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function m$(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,lo=t,io=ml(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,lo=t,io=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ou!==null?{id:Na,overflow:Ta}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Oo(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,lo=t,io=null,!0):!1;default:return!1}}function kb(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Ib(t){if(_n){var e=io;if(e){var n=e;if(!m$(t,e)){if(kb(t))throw Error($e(418));e=ml(n.nextSibling);var s=lo;e&&m$(t,e)?ND(s,n):(t.flags=t.flags&-4097|2,_n=!1,lo=t)}}else{if(kb(t))throw Error($e(418));t.flags=t.flags&-4097|2,_n=!1,lo=t}}}function g$(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;lo=t}function zg(t){if(t!==lo)return!1;if(!_n)return g$(t),_n=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!vb(t.type,t.memoizedProps)),e&&(e=io)){if(kb(t))throw TD(),Error($e(418));for(;e;)ND(t,e),e=ml(e.nextSibling)}if(g$(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error($e(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){io=ml(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}io=null}}else io=lo?ml(t.stateNode.nextSibling):null;return!0}function TD(){for(var t=io;t;)t=ml(t.nextSibling)}function pd(){io=lo=null,_n=!1}function kC(t){fi===null?fi=[t]:fi.push(t)}var jV=Ua.ReactCurrentBatchConfig;function up(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error($e(309));var s=n.stateNode}if(!s)throw Error($e(147,t));var r=s,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(i){var a=r.refs;i===null?delete a[o]:a[o]=i},e._stringRef=o,e)}if(typeof t!="string")throw Error($e(284));if(!n._owner)throw Error($e(290,t))}return t}function Mg(t,e){throw t=Object.prototype.toString.call(e),Error($e(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function y$(t){var e=t._init;return e(t._payload)}function ED(t){function e(y,x){if(t){var v=y.deletions;v===null?(y.deletions=[x],y.flags|=16):v.push(x)}}function n(y,x){if(!t)return null;for(;x!==null;)e(y,x),x=x.sibling;return null}function s(y,x){for(y=new Map;x!==null;)x.key!==null?y.set(x.key,x):y.set(x.index,x),x=x.sibling;return y}function r(y,x){return y=wl(y,x),y.index=0,y.sibling=null,y}function o(y,x,v){return y.index=v,t?(v=y.alternate,v!==null?(v=v.index,v<x?(y.flags|=2,x):v):(y.flags|=2,x)):(y.flags|=1048576,x)}function i(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,x,v,b){return x===null||x.tag!==6?(x=cv(v,y.mode,b),x.return=y,x):(x=r(x,v),x.return=y,x)}function l(y,x,v,b){var S=v.type;return S===Vc?c(y,x,v.props.children,b,v.key):x!==null&&(x.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Za&&y$(S)===x.type)?(b=r(x,v.props),b.ref=up(y,x,v),b.return=y,b):(b=yy(v.type,v.key,v.props,null,y.mode,b),b.ref=up(y,x,v),b.return=y,b)}function u(y,x,v,b){return x===null||x.tag!==4||x.stateNode.containerInfo!==v.containerInfo||x.stateNode.implementation!==v.implementation?(x=dv(v,y.mode,b),x.return=y,x):(x=r(x,v.children||[]),x.return=y,x)}function c(y,x,v,b,S){return x===null||x.tag!==7?(x=Tu(v,y.mode,b,S),x.return=y,x):(x=r(x,v),x.return=y,x)}function d(y,x,v){if(typeof x=="string"&&x!==""||typeof x=="number")return x=cv(""+x,y.mode,v),x.return=y,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Tg:return v=yy(x.type,x.key,x.props,null,y.mode,v),v.ref=up(y,null,x),v.return=y,v;case Bc:return x=dv(x,y.mode,v),x.return=y,x;case Za:var b=x._init;return d(y,b(x._payload),v)}if(kp(x)||rp(x))return x=Tu(x,y.mode,v,null),x.return=y,x;Mg(y,x)}return null}function h(y,x,v,b){var S=x!==null?x.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return S!==null?null:a(y,x,""+v,b);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Tg:return v.key===S?l(y,x,v,b):null;case Bc:return v.key===S?u(y,x,v,b):null;case Za:return S=v._init,h(y,x,S(v._payload),b)}if(kp(v)||rp(v))return S!==null?null:c(y,x,v,b,null);Mg(y,v)}return null}function p(y,x,v,b,S){if(typeof b=="string"&&b!==""||typeof b=="number")return y=y.get(v)||null,a(x,y,""+b,S);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Tg:return y=y.get(b.key===null?v:b.key)||null,l(x,y,b,S);case Bc:return y=y.get(b.key===null?v:b.key)||null,u(x,y,b,S);case Za:var C=b._init;return p(y,x,v,C(b._payload),S)}if(kp(b)||rp(b))return y=y.get(v)||null,c(x,y,b,S,null);Mg(x,b)}return null}function f(y,x,v,b){for(var S=null,C=null,I=x,T=x=0,R=null;I!==null&&T<v.length;T++){I.index>T?(R=I,I=null):R=I.sibling;var _=h(y,I,v[T],b);if(_===null){I===null&&(I=R);break}t&&I&&_.alternate===null&&e(y,I),x=o(_,x,T),C===null?S=_:C.sibling=_,C=_,I=R}if(T===v.length)return n(y,I),_n&&iu(y,T),S;if(I===null){for(;T<v.length;T++)I=d(y,v[T],b),I!==null&&(x=o(I,x,T),C===null?S=I:C.sibling=I,C=I);return _n&&iu(y,T),S}for(I=s(y,I);T<v.length;T++)R=p(I,y,T,v[T],b),R!==null&&(t&&R.alternate!==null&&I.delete(R.key===null?T:R.key),x=o(R,x,T),C===null?S=R:C.sibling=R,C=R);return t&&I.forEach(function(P){return e(y,P)}),_n&&iu(y,T),S}function m(y,x,v,b){var S=rp(v);if(typeof S!="function")throw Error($e(150));if(v=S.call(v),v==null)throw Error($e(151));for(var C=S=null,I=x,T=x=0,R=null,_=v.next();I!==null&&!_.done;T++,_=v.next()){I.index>T?(R=I,I=null):R=I.sibling;var P=h(y,I,_.value,b);if(P===null){I===null&&(I=R);break}t&&I&&P.alternate===null&&e(y,I),x=o(P,x,T),C===null?S=P:C.sibling=P,C=P,I=R}if(_.done)return n(y,I),_n&&iu(y,T),S;if(I===null){for(;!_.done;T++,_=v.next())_=d(y,_.value,b),_!==null&&(x=o(_,x,T),C===null?S=_:C.sibling=_,C=_);return _n&&iu(y,T),S}for(I=s(y,I);!_.done;T++,_=v.next())_=p(I,y,T,_.value,b),_!==null&&(t&&_.alternate!==null&&I.delete(_.key===null?T:_.key),x=o(_,x,T),C===null?S=_:C.sibling=_,C=_);return t&&I.forEach(function(z){return e(y,z)}),_n&&iu(y,T),S}function g(y,x,v,b){if(typeof v=="object"&&v!==null&&v.type===Vc&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Tg:e:{for(var S=v.key,C=x;C!==null;){if(C.key===S){if(S=v.type,S===Vc){if(C.tag===7){n(y,C.sibling),x=r(C,v.props.children),x.return=y,y=x;break e}}else if(C.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Za&&y$(S)===C.type){n(y,C.sibling),x=r(C,v.props),x.ref=up(y,C,v),x.return=y,y=x;break e}n(y,C);break}else e(y,C);C=C.sibling}v.type===Vc?(x=Tu(v.props.children,y.mode,b,v.key),x.return=y,y=x):(b=yy(v.type,v.key,v.props,null,y.mode,b),b.ref=up(y,x,v),b.return=y,y=b)}return i(y);case Bc:e:{for(C=v.key;x!==null;){if(x.key===C)if(x.tag===4&&x.stateNode.containerInfo===v.containerInfo&&x.stateNode.implementation===v.implementation){n(y,x.sibling),x=r(x,v.children||[]),x.return=y,y=x;break e}else{n(y,x);break}else e(y,x);x=x.sibling}x=dv(v,y.mode,b),x.return=y,y=x}return i(y);case Za:return C=v._init,g(y,x,C(v._payload),b)}if(kp(v))return f(y,x,v,b);if(rp(v))return m(y,x,v,b);Mg(y,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,x!==null&&x.tag===6?(n(y,x.sibling),x=r(x,v),x.return=y,y=x):(n(y,x),x=cv(v,y.mode,b),x.return=y,y=x),i(y)):n(y,x)}return g}var fd=ED(!0),RD=ED(!1),Wy=Ll(null),jy=null,Xc=null,IC=null;function $C(){IC=Xc=jy=null}function NC(t){var e=Wy.current;Nn(Wy),t._currentValue=e}function $b(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function sd(t,e){jy=t,IC=Xc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Br=!0),t.firstContext=null)}function Ko(t){var e=t._currentValue;if(IC!==t)if(t={context:t,memoizedValue:e,next:null},Xc===null){if(jy===null)throw Error($e(308));Xc=t,jy.dependencies={lanes:0,firstContext:t}}else Xc=Xc.next=t;return e}var xu=null;function TC(t){xu===null?xu=[t]:xu.push(t)}function DD(t,e,n,s){var r=e.interleaved;return r===null?(n.next=n,TC(e)):(n.next=r.next,r.next=n),e.interleaved=n,La(t,s)}function La(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var el=!1;function EC(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function AD(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ea(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function gl(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,Kt&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,La(t,n)}return r=s.interleaved,r===null?(e.next=e,TC(s)):(e.next=r.next,r.next=e),s.interleaved=e,La(t,n)}function dy(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,fC(t,n)}}function x$(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=i:o=o.next=i,n=n.next}while(n!==null);o===null?r=o=e:o=o.next=e}else r=o=e;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Gy(t,e,n,s){var r=t.updateQueue;el=!1;var o=r.firstBaseUpdate,i=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,u=l.next;l.next=null,i===null?o=u:i.next=u,i=l;var c=t.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==i&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(o!==null){var d=r.baseState;i=0,c=u=l=null,a=o;do{var h=a.lane,p=a.eventTime;if((s&h)===h){c!==null&&(c=c.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=t,m=a;switch(h=e,p=n,m.tag){case 1:if(f=m.payload,typeof f=="function"){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=m.payload,h=typeof f=="function"?f.call(p,d,h):f,h==null)break e;d=Vn({},d,h);break e;case 2:el=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=p,l=d):c=c.next=p,i|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(!0);if(c===null&&(l=d),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,e=r.shared.interleaved,e!==null){r=e;do i|=r.lane,r=r.next;while(r!==e)}else o===null&&(r.shared.lanes=0);zu|=i,t.lanes=i,t.memoizedState=d}}function w$(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error($e(191,r));r.call(s)}}}var Bf={},na=Ll(Bf),rf=Ll(Bf),of=Ll(Bf);function wu(t){if(t===Bf)throw Error($e(174));return t}function RC(t,e){switch(wn(of,e),wn(rf,t),wn(na,Bf),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ib(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ib(e,t)}Nn(na),wn(na,e)}function md(){Nn(na),Nn(rf),Nn(of)}function _D(t){wu(of.current);var e=wu(na.current),n=ib(e,t.type);e!==n&&(wn(rf,t),wn(na,n))}function DC(t){rf.current===t&&(Nn(na),Nn(rf))}var Ln=Ll(0);function Hy(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var rv=[];function AC(){for(var t=0;t<rv.length;t++)rv[t]._workInProgressVersionPrimary=null;rv.length=0}var hy=Ua.ReactCurrentDispatcher,ov=Ua.ReactCurrentBatchConfig,Lu=0,Bn=null,bs=null,_s=null,Ky=!1,Bp=!1,af=0,GV=0;function tr(){throw Error($e(321))}function _C(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ci(t[n],e[n]))return!1;return!0}function FC(t,e,n,s,r,o){if(Lu=o,Bn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,hy.current=t===null||t.memoizedState===null?XV:YV,t=n(s,r),Bp){o=0;do{if(Bp=!1,af=0,25<=o)throw Error($e(301));o+=1,_s=bs=null,e.updateQueue=null,hy.current=QV,t=n(s,r)}while(Bp)}if(hy.current=qy,e=bs!==null&&bs.next!==null,Lu=0,_s=bs=Bn=null,Ky=!1,e)throw Error($e(300));return t}function PC(){var t=af!==0;return af=0,t}function Gi(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return _s===null?Bn.memoizedState=_s=t:_s=_s.next=t,_s}function qo(){if(bs===null){var t=Bn.alternate;t=t!==null?t.memoizedState:null}else t=bs.next;var e=_s===null?Bn.memoizedState:_s.next;if(e!==null)_s=e,bs=t;else{if(t===null)throw Error($e(310));bs=t,t={memoizedState:bs.memoizedState,baseState:bs.baseState,baseQueue:bs.baseQueue,queue:bs.queue,next:null},_s===null?Bn.memoizedState=_s=t:_s=_s.next=t}return _s}function lf(t,e){return typeof e=="function"?e(t):e}function iv(t){var e=qo(),n=e.queue;if(n===null)throw Error($e(311));n.lastRenderedReducer=t;var s=bs,r=s.baseQueue,o=n.pending;if(o!==null){if(r!==null){var i=r.next;r.next=o.next,o.next=i}s.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,s=s.baseState;var a=i=null,l=null,u=o;do{var c=u.lane;if((Lu&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:t(s,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=d,i=s):l=l.next=d,Bn.lanes|=c,zu|=c}u=u.next}while(u!==null&&u!==o);l===null?i=s:l.next=a,Ci(s,e.memoizedState)||(Br=!0),e.memoizedState=s,e.baseState=i,e.baseQueue=l,n.lastRenderedState=s}if(t=n.interleaved,t!==null){r=t;do o=r.lane,Bn.lanes|=o,zu|=o,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function av(t){var e=qo(),n=e.queue;if(n===null)throw Error($e(311));n.lastRenderedReducer=t;var s=n.dispatch,r=n.pending,o=e.memoizedState;if(r!==null){n.pending=null;var i=r=r.next;do o=t(o,i.action),i=i.next;while(i!==r);Ci(o,e.memoizedState)||(Br=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,s]}function FD(){}function PD(t,e){var n=Bn,s=qo(),r=e(),o=!Ci(s.memoizedState,r);if(o&&(s.memoizedState=r,Br=!0),s=s.queue,OC(zD.bind(null,n,s,t),[t]),s.getSnapshot!==e||o||_s!==null&&_s.memoizedState.tag&1){if(n.flags|=2048,uf(9,LD.bind(null,n,s,r,e),void 0,null),Os===null)throw Error($e(349));Lu&30||OD(n,e,r)}return r}function OD(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Bn.updateQueue,e===null?(e={lastEffect:null,stores:null},Bn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function LD(t,e,n,s){e.value=n,e.getSnapshot=s,MD(e)&&BD(t)}function zD(t,e,n){return n(function(){MD(e)&&BD(t)})}function MD(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ci(t,n)}catch{return!0}}function BD(t){var e=La(t,1);e!==null&&vi(e,t,1,-1)}function v$(t){var e=Gi();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:lf,lastRenderedState:t},e.queue=t,t=t.dispatch=qV.bind(null,Bn,t),[e.memoizedState,t]}function uf(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=Bn.updateQueue,e===null?(e={lastEffect:null,stores:null},Bn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function VD(){return qo().memoizedState}function py(t,e,n,s){var r=Gi();Bn.flags|=t,r.memoizedState=uf(1|e,n,void 0,s===void 0?null:s)}function Jx(t,e,n,s){var r=qo();s=s===void 0?null:s;var o=void 0;if(bs!==null){var i=bs.memoizedState;if(o=i.destroy,s!==null&&_C(s,i.deps)){r.memoizedState=uf(e,n,o,s);return}}Bn.flags|=t,r.memoizedState=uf(1|e,n,o,s)}function b$(t,e){return py(8390656,8,t,e)}function OC(t,e){return Jx(2048,8,t,e)}function UD(t,e){return Jx(4,2,t,e)}function WD(t,e){return Jx(4,4,t,e)}function jD(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function GD(t,e,n){return n=n!=null?n.concat([t]):null,Jx(4,4,jD.bind(null,e,t),n)}function LC(){}function HD(t,e){var n=qo();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&_C(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function KD(t,e){var n=qo();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&_C(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function qD(t,e,n){return Lu&21?(Ci(n,e)||(n=ZR(),Bn.lanes|=n,zu|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Br=!0),t.memoizedState=n)}function HV(t,e){var n=rn;rn=n!==0&&4>n?n:4,t(!0);var s=ov.transition;ov.transition={};try{t(!1),e()}finally{rn=n,ov.transition=s}}function XD(){return qo().memoizedState}function KV(t,e,n){var s=xl(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},YD(t))QD(e,n);else if(n=DD(t,e,n,s),n!==null){var r=br();vi(n,t,s,r),JD(n,e,s)}}function qV(t,e,n){var s=xl(t),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(YD(t))QD(e,r);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var i=e.lastRenderedState,a=o(i,n);if(r.hasEagerState=!0,r.eagerState=a,Ci(a,i)){var l=e.interleaved;l===null?(r.next=r,TC(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=DD(t,e,r,s),n!==null&&(r=br(),vi(n,t,s,r),JD(n,e,s))}}function YD(t){var e=t.alternate;return t===Bn||e!==null&&e===Bn}function QD(t,e){Bp=Ky=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function JD(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,fC(t,n)}}var qy={readContext:Ko,useCallback:tr,useContext:tr,useEffect:tr,useImperativeHandle:tr,useInsertionEffect:tr,useLayoutEffect:tr,useMemo:tr,useReducer:tr,useRef:tr,useState:tr,useDebugValue:tr,useDeferredValue:tr,useTransition:tr,useMutableSource:tr,useSyncExternalStore:tr,useId:tr,unstable_isNewReconciler:!1},XV={readContext:Ko,useCallback:function(t,e){return Gi().memoizedState=[t,e===void 0?null:e],t},useContext:Ko,useEffect:b$,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,py(4194308,4,jD.bind(null,e,t),n)},useLayoutEffect:function(t,e){return py(4194308,4,t,e)},useInsertionEffect:function(t,e){return py(4,2,t,e)},useMemo:function(t,e){var n=Gi();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=Gi();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=KV.bind(null,Bn,t),[s.memoizedState,t]},useRef:function(t){var e=Gi();return t={current:t},e.memoizedState=t},useState:v$,useDebugValue:LC,useDeferredValue:function(t){return Gi().memoizedState=t},useTransition:function(){var t=v$(!1),e=t[0];return t=HV.bind(null,t[1]),Gi().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=Bn,r=Gi();if(_n){if(n===void 0)throw Error($e(407));n=n()}else{if(n=e(),Os===null)throw Error($e(349));Lu&30||OD(s,e,n)}r.memoizedState=n;var o={value:n,getSnapshot:e};return r.queue=o,b$(zD.bind(null,s,o,t),[t]),s.flags|=2048,uf(9,LD.bind(null,s,o,n,e),void 0,null),n},useId:function(){var t=Gi(),e=Os.identifierPrefix;if(_n){var n=Ta,s=Na;n=(s&~(1<<32-wi(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=af++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=GV++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},YV={readContext:Ko,useCallback:HD,useContext:Ko,useEffect:OC,useImperativeHandle:GD,useInsertionEffect:UD,useLayoutEffect:WD,useMemo:KD,useReducer:iv,useRef:VD,useState:function(){return iv(lf)},useDebugValue:LC,useDeferredValue:function(t){var e=qo();return qD(e,bs.memoizedState,t)},useTransition:function(){var t=iv(lf)[0],e=qo().memoizedState;return[t,e]},useMutableSource:FD,useSyncExternalStore:PD,useId:XD,unstable_isNewReconciler:!1},QV={readContext:Ko,useCallback:HD,useContext:Ko,useEffect:OC,useImperativeHandle:GD,useInsertionEffect:UD,useLayoutEffect:WD,useMemo:KD,useReducer:av,useRef:VD,useState:function(){return av(lf)},useDebugValue:LC,useDeferredValue:function(t){var e=qo();return bs===null?e.memoizedState=t:qD(e,bs.memoizedState,t)},useTransition:function(){var t=av(lf)[0],e=qo().memoizedState;return[t,e]},useMutableSource:FD,useSyncExternalStore:PD,useId:XD,unstable_isNewReconciler:!1};function di(t,e){if(t&&t.defaultProps){e=Vn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Nb(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:Vn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Zx={isMounted:function(t){return(t=t._reactInternals)?rc(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=br(),r=xl(t),o=Ea(s,r);o.payload=e,n!=null&&(o.callback=n),e=gl(t,o,r),e!==null&&(vi(e,t,r,s),dy(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=br(),r=xl(t),o=Ea(s,r);o.tag=1,o.payload=e,n!=null&&(o.callback=n),e=gl(t,o,r),e!==null&&(vi(e,t,r,s),dy(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=br(),s=xl(t),r=Ea(n,s);r.tag=2,e!=null&&(r.callback=e),e=gl(t,r,s),e!==null&&(vi(e,t,s,n),dy(e,t,s))}};function S$(t,e,n,s,r,o,i){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,o,i):e.prototype&&e.prototype.isPureReactComponent?!ef(n,s)||!ef(r,o):!0}function ZD(t,e,n){var s=!1,r=kl,o=e.contextType;return typeof o=="object"&&o!==null?o=Ko(o):(r=jr(e)?Pu:dr.current,s=e.contextTypes,o=(s=s!=null)?hd(t,r):kl),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Zx,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=o),e}function C$(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&Zx.enqueueReplaceState(e,e.state,null)}function Tb(t,e,n,s){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},EC(t);var o=e.contextType;typeof o=="object"&&o!==null?r.context=Ko(o):(o=jr(e)?Pu:dr.current,r.context=hd(t,o)),r.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(Nb(t,e,o,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Zx.enqueueReplaceState(r,r.state,null),Gy(t,n,r,s),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function gd(t,e){try{var n="",s=e;do n+=I4(s),s=s.return;while(s);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:r,digest:null}}function lv(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Eb(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var JV=typeof WeakMap=="function"?WeakMap:Map;function eA(t,e,n){n=Ea(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){Yy||(Yy=!0,Mb=s),Eb(t,e)},n}function tA(t,e,n){n=Ea(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;n.payload=function(){return s(r)},n.callback=function(){Eb(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Eb(t,e),typeof s!="function"&&(yl===null?yl=new Set([this]):yl.add(this));var i=e.stack;this.componentDidCatch(e.value,{componentStack:i!==null?i:""})}),n}function k$(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new JV;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(n)||(r.add(n),t=hU.bind(null,t,e,n),e.then(t,t))}function I$(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function $$(t,e,n,s,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Ea(-1,1),e.tag=2,gl(n,e,1))),n.lanes|=1),t)}var ZV=Ua.ReactCurrentOwner,Br=!1;function gr(t,e,n,s){e.child=t===null?RD(e,null,n,s):fd(e,t.child,n,s)}function N$(t,e,n,s,r){n=n.render;var o=e.ref;return sd(e,r),s=FC(t,e,n,s,o,r),n=PC(),t!==null&&!Br?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,za(t,e,r)):(_n&&n&&SC(e),e.flags|=1,gr(t,e,s,r),e.child)}function T$(t,e,n,s,r){if(t===null){var o=n.type;return typeof o=="function"&&!GC(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,nA(t,e,o,s,r)):(t=yy(n.type,null,s,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&r)){var i=o.memoizedProps;if(n=n.compare,n=n!==null?n:ef,n(i,s)&&t.ref===e.ref)return za(t,e,r)}return e.flags|=1,t=wl(o,s),t.ref=e.ref,t.return=e,e.child=t}function nA(t,e,n,s,r){if(t!==null){var o=t.memoizedProps;if(ef(o,s)&&t.ref===e.ref)if(Br=!1,e.pendingProps=s=o,(t.lanes&r)!==0)t.flags&131072&&(Br=!0);else return e.lanes=t.lanes,za(t,e,r)}return Rb(t,e,n,s,r)}function sA(t,e,n){var s=e.pendingProps,r=s.children,o=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},wn(Qc,so),so|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,wn(Qc,so),so|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=o!==null?o.baseLanes:n,wn(Qc,so),so|=s}else o!==null?(s=o.baseLanes|n,e.memoizedState=null):s=n,wn(Qc,so),so|=s;return gr(t,e,r,n),e.child}function rA(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Rb(t,e,n,s,r){var o=jr(n)?Pu:dr.current;return o=hd(e,o),sd(e,r),n=FC(t,e,n,s,o,r),s=PC(),t!==null&&!Br?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,za(t,e,r)):(_n&&s&&SC(e),e.flags|=1,gr(t,e,n,r),e.child)}function E$(t,e,n,s,r){if(jr(n)){var o=!0;By(e)}else o=!1;if(sd(e,r),e.stateNode===null)fy(t,e),ZD(e,n,s),Tb(e,n,s,r),s=!0;else if(t===null){var i=e.stateNode,a=e.memoizedProps;i.props=a;var l=i.context,u=n.contextType;typeof u=="object"&&u!==null?u=Ko(u):(u=jr(n)?Pu:dr.current,u=hd(e,u));var c=n.getDerivedStateFromProps,d=typeof c=="function"||typeof i.getSnapshotBeforeUpdate=="function";d||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==s||l!==u)&&C$(e,i,s,u),el=!1;var h=e.memoizedState;i.state=h,Gy(e,s,i,r),l=e.memoizedState,a!==s||h!==l||Wr.current||el?(typeof c=="function"&&(Nb(e,n,c,s),l=e.memoizedState),(a=el||S$(e,n,a,s,h,l,u))?(d||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(e.flags|=4194308)):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),i.props=s,i.state=l,i.context=u,s=a):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{i=e.stateNode,AD(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:di(e.type,a),i.props=u,d=e.pendingProps,h=i.context,l=n.contextType,typeof l=="object"&&l!==null?l=Ko(l):(l=jr(n)?Pu:dr.current,l=hd(e,l));var p=n.getDerivedStateFromProps;(c=typeof p=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==d||h!==l)&&C$(e,i,s,l),el=!1,h=e.memoizedState,i.state=h,Gy(e,s,i,r);var f=e.memoizedState;a!==d||h!==f||Wr.current||el?(typeof p=="function"&&(Nb(e,n,p,s),f=e.memoizedState),(u=el||S$(e,n,u,s,h,f,l)||!1)?(c||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(s,f,l),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(s,f,l)),typeof i.componentDidUpdate=="function"&&(e.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof i.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=f),i.props=s,i.state=f,i.context=l,s=u):(typeof i.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),s=!1)}return Db(t,e,n,s,o,r)}function Db(t,e,n,s,r,o){rA(t,e);var i=(e.flags&128)!==0;if(!s&&!i)return r&&f$(e,n,!1),za(t,e,o);s=e.stateNode,ZV.current=e;var a=i&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&i?(e.child=fd(e,t.child,null,o),e.child=fd(e,null,a,o)):gr(t,e,a,o),e.memoizedState=s.state,r&&f$(e,n,!0),e.child}function oA(t){var e=t.stateNode;e.pendingContext?p$(t,e.pendingContext,e.pendingContext!==e.context):e.context&&p$(t,e.context,!1),RC(t,e.containerInfo)}function R$(t,e,n,s,r){return pd(),kC(r),e.flags|=256,gr(t,e,n,s),e.child}var Ab={dehydrated:null,treeContext:null,retryLane:0};function _b(t){return{baseLanes:t,cachePool:null,transitions:null}}function iA(t,e,n){var s=e.pendingProps,r=Ln.current,o=!1,i=(e.flags&128)!==0,a;if((a=i)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),wn(Ln,r&1),t===null)return Ib(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(i=s.children,t=s.fallback,o?(s=e.mode,o=e.child,i={mode:"hidden",children:i},!(s&1)&&o!==null?(o.childLanes=0,o.pendingProps=i):o=n0(i,s,0,null),t=Tu(t,s,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=_b(n),e.memoizedState=Ab,t):zC(e,i));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return eU(t,e,i,s,a,r,n);if(o){o=s.fallback,i=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:s.children};return!(i&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=wl(r,l),s.subtreeFlags=r.subtreeFlags&14680064),a!==null?o=wl(a,o):(o=Tu(o,i,n,null),o.flags|=2),o.return=e,s.return=e,s.sibling=o,e.child=s,s=o,o=e.child,i=t.child.memoizedState,i=i===null?_b(n):{baseLanes:i.baseLanes|n,cachePool:null,transitions:i.transitions},o.memoizedState=i,o.childLanes=t.childLanes&~n,e.memoizedState=Ab,s}return o=t.child,t=o.sibling,s=wl(o,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function zC(t,e){return e=n0({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Bg(t,e,n,s){return s!==null&&kC(s),fd(e,t.child,null,n),t=zC(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function eU(t,e,n,s,r,o,i){if(n)return e.flags&256?(e.flags&=-257,s=lv(Error($e(422))),Bg(t,e,i,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=s.fallback,r=e.mode,s=n0({mode:"visible",children:s.children},r,0,null),o=Tu(o,r,i,null),o.flags|=2,s.return=e,o.return=e,s.sibling=o,e.child=s,e.mode&1&&fd(e,t.child,null,i),e.child.memoizedState=_b(i),e.memoizedState=Ab,o);if(!(e.mode&1))return Bg(t,e,i,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var a=s.dgst;return s=a,o=Error($e(419)),s=lv(o,s,void 0),Bg(t,e,i,s)}if(a=(i&t.childLanes)!==0,Br||a){if(s=Os,s!==null){switch(i&-i){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|i)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,La(t,r),vi(s,t,r,-1))}return jC(),s=lv(Error($e(421))),Bg(t,e,i,s)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=pU.bind(null,t),r._reactRetry=e,null):(t=o.treeContext,io=ml(r.nextSibling),lo=e,_n=!0,fi=null,t!==null&&(_o[Fo++]=Na,_o[Fo++]=Ta,_o[Fo++]=Ou,Na=t.id,Ta=t.overflow,Ou=e),e=zC(e,s.children),e.flags|=4096,e)}function D$(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),$b(t.return,e,n)}function uv(t,e,n,s,r){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=s,o.tail=n,o.tailMode=r)}function aA(t,e,n){var s=e.pendingProps,r=s.revealOrder,o=s.tail;if(gr(t,e,s.children,n),s=Ln.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&D$(t,n,e);else if(t.tag===19)D$(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(wn(Ln,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Hy(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),uv(e,!1,r,n,o);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Hy(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}uv(e,!0,n,null,o);break;case"together":uv(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function fy(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function za(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),zu|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error($e(153));if(e.child!==null){for(t=e.child,n=wl(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=wl(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function tU(t,e,n){switch(e.tag){case 3:oA(e),pd();break;case 5:_D(e);break;case 1:jr(e.type)&&By(e);break;case 4:RC(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;wn(Wy,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(wn(Ln,Ln.current&1),e.flags|=128,null):n&e.child.childLanes?iA(t,e,n):(wn(Ln,Ln.current&1),t=za(t,e,n),t!==null?t.sibling:null);wn(Ln,Ln.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return aA(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),wn(Ln,Ln.current),s)break;return null;case 22:case 23:return e.lanes=0,sA(t,e,n)}return za(t,e,n)}var lA,Fb,uA,cA;lA=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Fb=function(){};uA=function(t,e,n,s){var r=t.memoizedProps;if(r!==s){t=e.stateNode,wu(na.current);var o=null;switch(n){case"input":r=nb(t,r),s=nb(t,s),o=[];break;case"select":r=Vn({},r,{value:void 0}),s=Vn({},s,{value:void 0}),o=[];break;case"textarea":r=ob(t,r),s=ob(t,s),o=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=zy)}ab(n,s);var i;n=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var a=r[u];for(i in a)a.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Kp.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in s){var l=s[u];if(a=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(i in a)!a.hasOwnProperty(i)||l&&l.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in l)l.hasOwnProperty(i)&&a[i]!==l[i]&&(n||(n={}),n[i]=l[i])}else n||(o||(o=[]),o.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(o=o||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Kp.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&In("scroll",t),o||a===l||(o=[])):(o=o||[]).push(u,l))}n&&(o=o||[]).push("style",n);var u=o;(e.updateQueue=u)&&(e.flags|=4)}};cA=function(t,e,n,s){n!==s&&(e.flags|=4)};function cp(t,e){if(!_n)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function nr(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function nU(t,e,n){var s=e.pendingProps;switch(CC(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nr(e),null;case 1:return jr(e.type)&&My(),nr(e),null;case 3:return s=e.stateNode,md(),Nn(Wr),Nn(dr),AC(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(zg(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,fi!==null&&(Ub(fi),fi=null))),Fb(t,e),nr(e),null;case 5:DC(e);var r=wu(of.current);if(n=e.type,t!==null&&e.stateNode!=null)uA(t,e,n,s,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error($e(166));return nr(e),null}if(t=wu(na.current),zg(e)){s=e.stateNode,n=e.type;var o=e.memoizedProps;switch(s[Qi]=e,s[sf]=o,t=(e.mode&1)!==0,n){case"dialog":In("cancel",s),In("close",s);break;case"iframe":case"object":case"embed":In("load",s);break;case"video":case"audio":for(r=0;r<$p.length;r++)In($p[r],s);break;case"source":In("error",s);break;case"img":case"image":case"link":In("error",s),In("load",s);break;case"details":In("toggle",s);break;case"input":BI(s,o),In("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!o.multiple},In("invalid",s);break;case"textarea":UI(s,o),In("invalid",s)}ab(n,o),r=null;for(var i in o)if(o.hasOwnProperty(i)){var a=o[i];i==="children"?typeof a=="string"?s.textContent!==a&&(o.suppressHydrationWarning!==!0&&Lg(s.textContent,a,t),r=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&Lg(s.textContent,a,t),r=["children",""+a]):Kp.hasOwnProperty(i)&&a!=null&&i==="onScroll"&&In("scroll",s)}switch(n){case"input":Eg(s),VI(s,o,!0);break;case"textarea":Eg(s),WI(s);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(s.onclick=zy)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{i=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=zR(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=i.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=i.createElement(n,{is:s.is}):(t=i.createElement(n),n==="select"&&(i=t,s.multiple?i.multiple=!0:s.size&&(i.size=s.size))):t=i.createElementNS(t,n),t[Qi]=e,t[sf]=s,lA(t,e,!1,!1),e.stateNode=t;e:{switch(i=lb(n,s),n){case"dialog":In("cancel",t),In("close",t),r=s;break;case"iframe":case"object":case"embed":In("load",t),r=s;break;case"video":case"audio":for(r=0;r<$p.length;r++)In($p[r],t);r=s;break;case"source":In("error",t),r=s;break;case"img":case"image":case"link":In("error",t),In("load",t),r=s;break;case"details":In("toggle",t),r=s;break;case"input":BI(t,s),r=nb(t,s),In("invalid",t);break;case"option":r=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},r=Vn({},s,{value:void 0}),In("invalid",t);break;case"textarea":UI(t,s),r=ob(t,s),In("invalid",t);break;default:r=s}ab(n,r),a=r;for(o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="style"?VR(t,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&MR(t,l)):o==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&qp(t,l):typeof l=="number"&&qp(t,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Kp.hasOwnProperty(o)?l!=null&&o==="onScroll"&&In("scroll",t):l!=null&&lC(t,o,l,i))}switch(n){case"input":Eg(t),VI(t,s,!1);break;case"textarea":Eg(t),WI(t);break;case"option":s.value!=null&&t.setAttribute("value",""+Cl(s.value));break;case"select":t.multiple=!!s.multiple,o=s.value,o!=null?Zc(t,!!s.multiple,o,!1):s.defaultValue!=null&&Zc(t,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=zy)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return nr(e),null;case 6:if(t&&e.stateNode!=null)cA(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error($e(166));if(n=wu(of.current),wu(na.current),zg(e)){if(s=e.stateNode,n=e.memoizedProps,s[Qi]=e,(o=s.nodeValue!==n)&&(t=lo,t!==null))switch(t.tag){case 3:Lg(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Lg(s.nodeValue,n,(t.mode&1)!==0)}o&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[Qi]=e,e.stateNode=s}return nr(e),null;case 13:if(Nn(Ln),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(_n&&io!==null&&e.mode&1&&!(e.flags&128))TD(),pd(),e.flags|=98560,o=!1;else if(o=zg(e),s!==null&&s.dehydrated!==null){if(t===null){if(!o)throw Error($e(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error($e(317));o[Qi]=e}else pd(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;nr(e),o=!1}else fi!==null&&(Ub(fi),fi=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||Ln.current&1?Cs===0&&(Cs=3):jC())),e.updateQueue!==null&&(e.flags|=4),nr(e),null);case 4:return md(),Fb(t,e),t===null&&tf(e.stateNode.containerInfo),nr(e),null;case 10:return NC(e.type._context),nr(e),null;case 17:return jr(e.type)&&My(),nr(e),null;case 19:if(Nn(Ln),o=e.memoizedState,o===null)return nr(e),null;if(s=(e.flags&128)!==0,i=o.rendering,i===null)if(s)cp(o,!1);else{if(Cs!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(i=Hy(t),i!==null){for(e.flags|=128,cp(o,!1),s=i.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)o=n,t=s,o.flags&=14680066,i=o.alternate,i===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,o.type=i.type,t=i.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return wn(Ln,Ln.current&1|2),e.child}t=t.sibling}o.tail!==null&&Jn()>yd&&(e.flags|=128,s=!0,cp(o,!1),e.lanes=4194304)}else{if(!s)if(t=Hy(i),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),cp(o,!0),o.tail===null&&o.tailMode==="hidden"&&!i.alternate&&!_n)return nr(e),null}else 2*Jn()-o.renderingStartTime>yd&&n!==1073741824&&(e.flags|=128,s=!0,cp(o,!1),e.lanes=4194304);o.isBackwards?(i.sibling=e.child,e.child=i):(n=o.last,n!==null?n.sibling=i:e.child=i,o.last=i)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Jn(),e.sibling=null,n=Ln.current,wn(Ln,s?n&1|2:n&1),e):(nr(e),null);case 22:case 23:return WC(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?so&1073741824&&(nr(e),e.subtreeFlags&6&&(e.flags|=8192)):nr(e),null;case 24:return null;case 25:return null}throw Error($e(156,e.tag))}function sU(t,e){switch(CC(e),e.tag){case 1:return jr(e.type)&&My(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return md(),Nn(Wr),Nn(dr),AC(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return DC(e),null;case 13:if(Nn(Ln),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error($e(340));pd()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Nn(Ln),null;case 4:return md(),null;case 10:return NC(e.type._context),null;case 22:case 23:return WC(),null;case 24:return null;default:return null}}var Vg=!1,ir=!1,rU=typeof WeakSet=="function"?WeakSet:Set,Xe=null;function Yc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){jn(t,e,s)}else n.current=null}function Pb(t,e,n){try{n()}catch(s){jn(t,e,s)}}var A$=!1;function oU(t,e){if(xb=Py,t=mD(),bC(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,o=s.focusNode;s=s.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var i=0,a=-1,l=-1,u=0,c=0,d=t,h=null;t:for(;;){for(var p;d!==n||r!==0&&d.nodeType!==3||(a=i+r),d!==o||s!==0&&d.nodeType!==3||(l=i+s),d.nodeType===3&&(i+=d.nodeValue.length),(p=d.firstChild)!==null;)h=d,d=p;for(;;){if(d===t)break t;if(h===n&&++u===r&&(a=i),h===o&&++c===s&&(l=i),(p=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(wb={focusedElem:t,selectionRange:n},Py=!1,Xe=e;Xe!==null;)if(e=Xe,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Xe=t;else for(;Xe!==null;){e=Xe;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var m=f.memoizedProps,g=f.memoizedState,y=e.stateNode,x=y.getSnapshotBeforeUpdate(e.elementType===e.type?m:di(e.type,m),g);y.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error($e(163))}}catch(b){jn(e,e.return,b)}if(t=e.sibling,t!==null){t.return=e.return,Xe=t;break}Xe=e.return}return f=A$,A$=!1,f}function Vp(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&t)===t){var o=r.destroy;r.destroy=void 0,o!==void 0&&Pb(e,n,o)}r=r.next}while(r!==s)}}function e0(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function Ob(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function dA(t){var e=t.alternate;e!==null&&(t.alternate=null,dA(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Qi],delete e[sf],delete e[Sb],delete e[VV],delete e[UV])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function hA(t){return t.tag===5||t.tag===3||t.tag===4}function _$(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||hA(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Lb(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=zy));else if(s!==4&&(t=t.child,t!==null))for(Lb(t,e,n),t=t.sibling;t!==null;)Lb(t,e,n),t=t.sibling}function zb(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(zb(t,e,n),t=t.sibling;t!==null;)zb(t,e,n),t=t.sibling}var js=null,hi=!1;function Qa(t,e,n){for(n=n.child;n!==null;)pA(t,e,n),n=n.sibling}function pA(t,e,n){if(ta&&typeof ta.onCommitFiberUnmount=="function")try{ta.onCommitFiberUnmount(Hx,n)}catch{}switch(n.tag){case 5:ir||Yc(n,e);case 6:var s=js,r=hi;js=null,Qa(t,e,n),js=s,hi=r,js!==null&&(hi?(t=js,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):js.removeChild(n.stateNode));break;case 18:js!==null&&(hi?(t=js,n=n.stateNode,t.nodeType===8?nv(t.parentNode,n):t.nodeType===1&&nv(t,n),Jp(t)):nv(js,n.stateNode));break;case 4:s=js,r=hi,js=n.stateNode.containerInfo,hi=!0,Qa(t,e,n),js=s,hi=r;break;case 0:case 11:case 14:case 15:if(!ir&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var o=r,i=o.destroy;o=o.tag,i!==void 0&&(o&2||o&4)&&Pb(n,e,i),r=r.next}while(r!==s)}Qa(t,e,n);break;case 1:if(!ir&&(Yc(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(a){jn(n,e,a)}Qa(t,e,n);break;case 21:Qa(t,e,n);break;case 22:n.mode&1?(ir=(s=ir)||n.memoizedState!==null,Qa(t,e,n),ir=s):Qa(t,e,n);break;default:Qa(t,e,n)}}function F$(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new rU),e.forEach(function(s){var r=fU.bind(null,t,s);n.has(s)||(n.add(s),s.then(r,r))})}}function li(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var o=t,i=e,a=i;e:for(;a!==null;){switch(a.tag){case 5:js=a.stateNode,hi=!1;break e;case 3:js=a.stateNode.containerInfo,hi=!0;break e;case 4:js=a.stateNode.containerInfo,hi=!0;break e}a=a.return}if(js===null)throw Error($e(160));pA(o,i,r),js=null,hi=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){jn(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)fA(e,t),e=e.sibling}function fA(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(li(e,t),Wi(t),s&4){try{Vp(3,t,t.return),e0(3,t)}catch(m){jn(t,t.return,m)}try{Vp(5,t,t.return)}catch(m){jn(t,t.return,m)}}break;case 1:li(e,t),Wi(t),s&512&&n!==null&&Yc(n,n.return);break;case 5:if(li(e,t),Wi(t),s&512&&n!==null&&Yc(n,n.return),t.flags&32){var r=t.stateNode;try{qp(r,"")}catch(m){jn(t,t.return,m)}}if(s&4&&(r=t.stateNode,r!=null)){var o=t.memoizedProps,i=n!==null?n.memoizedProps:o,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&OR(r,o),lb(a,i);var u=lb(a,o);for(i=0;i<l.length;i+=2){var c=l[i],d=l[i+1];c==="style"?VR(r,d):c==="dangerouslySetInnerHTML"?MR(r,d):c==="children"?qp(r,d):lC(r,c,d,u)}switch(a){case"input":sb(r,o);break;case"textarea":LR(r,o);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var p=o.value;p!=null?Zc(r,!!o.multiple,p,!1):h!==!!o.multiple&&(o.defaultValue!=null?Zc(r,!!o.multiple,o.defaultValue,!0):Zc(r,!!o.multiple,o.multiple?[]:"",!1))}r[sf]=o}catch(m){jn(t,t.return,m)}}break;case 6:if(li(e,t),Wi(t),s&4){if(t.stateNode===null)throw Error($e(162));r=t.stateNode,o=t.memoizedProps;try{r.nodeValue=o}catch(m){jn(t,t.return,m)}}break;case 3:if(li(e,t),Wi(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{Jp(e.containerInfo)}catch(m){jn(t,t.return,m)}break;case 4:li(e,t),Wi(t);break;case 13:li(e,t),Wi(t),r=t.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(VC=Jn())),s&4&&F$(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(ir=(u=ir)||c,li(e,t),ir=u):li(e,t),Wi(t),s&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&t.mode&1)for(Xe=t,c=t.child;c!==null;){for(d=Xe=c;Xe!==null;){switch(h=Xe,p=h.child,h.tag){case 0:case 11:case 14:case 15:Vp(4,h,h.return);break;case 1:Yc(h,h.return);var f=h.stateNode;if(typeof f.componentWillUnmount=="function"){s=h,n=h.return;try{e=s,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(m){jn(s,n,m)}}break;case 5:Yc(h,h.return);break;case 22:if(h.memoizedState!==null){O$(d);continue}}p!==null?(p.return=h,Xe=p):O$(d)}c=c.sibling}e:for(c=null,d=t;;){if(d.tag===5){if(c===null){c=d;try{r=d.stateNode,u?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=d.stateNode,l=d.memoizedProps.style,i=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=BR("display",i))}catch(m){jn(t,t.return,m)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(m){jn(t,t.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:li(e,t),Wi(t),s&4&&F$(t);break;case 21:break;default:li(e,t),Wi(t)}}function Wi(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(hA(n)){var s=n;break e}n=n.return}throw Error($e(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(qp(r,""),s.flags&=-33);var o=_$(t);zb(t,o,r);break;case 3:case 4:var i=s.stateNode.containerInfo,a=_$(t);Lb(t,a,i);break;default:throw Error($e(161))}}catch(l){jn(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function iU(t,e,n){Xe=t,mA(t)}function mA(t,e,n){for(var s=(t.mode&1)!==0;Xe!==null;){var r=Xe,o=r.child;if(r.tag===22&&s){var i=r.memoizedState!==null||Vg;if(!i){var a=r.alternate,l=a!==null&&a.memoizedState!==null||ir;a=Vg;var u=ir;if(Vg=i,(ir=l)&&!u)for(Xe=r;Xe!==null;)i=Xe,l=i.child,i.tag===22&&i.memoizedState!==null?L$(r):l!==null?(l.return=i,Xe=l):L$(r);for(;o!==null;)Xe=o,mA(o),o=o.sibling;Xe=r,Vg=a,ir=u}P$(t)}else r.subtreeFlags&8772&&o!==null?(o.return=r,Xe=o):P$(t)}}function P$(t){for(;Xe!==null;){var e=Xe;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ir||e0(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!ir)if(n===null)s.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:di(e.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&w$(e,o,s);break;case 3:var i=e.updateQueue;if(i!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}w$(e,i,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Jp(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error($e(163))}ir||e.flags&512&&Ob(e)}catch(h){jn(e,e.return,h)}}if(e===t){Xe=null;break}if(n=e.sibling,n!==null){n.return=e.return,Xe=n;break}Xe=e.return}}function O$(t){for(;Xe!==null;){var e=Xe;if(e===t){Xe=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Xe=n;break}Xe=e.return}}function L$(t){for(;Xe!==null;){var e=Xe;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{e0(4,e)}catch(l){jn(e,n,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(l){jn(e,r,l)}}var o=e.return;try{Ob(e)}catch(l){jn(e,o,l)}break;case 5:var i=e.return;try{Ob(e)}catch(l){jn(e,i,l)}}}catch(l){jn(e,e.return,l)}if(e===t){Xe=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Xe=a;break}Xe=e.return}}var aU=Math.ceil,Xy=Ua.ReactCurrentDispatcher,MC=Ua.ReactCurrentOwner,Wo=Ua.ReactCurrentBatchConfig,Kt=0,Os=null,as=null,Gs=0,so=0,Qc=Ll(0),Cs=0,cf=null,zu=0,t0=0,BC=0,Up=null,zr=null,VC=0,yd=1/0,ba=null,Yy=!1,Mb=null,yl=null,Ug=!1,il=null,Qy=0,Wp=0,Bb=null,my=-1,gy=0;function br(){return Kt&6?Jn():my!==-1?my:my=Jn()}function xl(t){return t.mode&1?Kt&2&&Gs!==0?Gs&-Gs:jV.transition!==null?(gy===0&&(gy=ZR()),gy):(t=rn,t!==0||(t=window.event,t=t===void 0?16:iD(t.type)),t):1}function vi(t,e,n,s){if(50<Wp)throw Wp=0,Bb=null,Error($e(185));Lf(t,n,s),(!(Kt&2)||t!==Os)&&(t===Os&&(!(Kt&2)&&(t0|=n),Cs===4&&sl(t,Gs)),Gr(t,s),n===1&&Kt===0&&!(e.mode&1)&&(yd=Jn()+500,Qx&&zl()))}function Gr(t,e){var n=t.callbackNode;j4(t,e);var s=Fy(t,t===Os?Gs:0);if(s===0)n!==null&&HI(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&HI(n),e===1)t.tag===0?WV(z$.bind(null,t)):ID(z$.bind(null,t)),MV(function(){!(Kt&6)&&zl()}),n=null;else{switch(eD(s)){case 1:n=pC;break;case 4:n=QR;break;case 16:n=_y;break;case 536870912:n=JR;break;default:n=_y}n=CA(n,gA.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function gA(t,e){if(my=-1,gy=0,Kt&6)throw Error($e(327));var n=t.callbackNode;if(rd()&&t.callbackNode!==n)return null;var s=Fy(t,t===Os?Gs:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=Jy(t,s);else{e=s;var r=Kt;Kt|=2;var o=xA();(Os!==t||Gs!==e)&&(ba=null,yd=Jn()+500,Nu(t,e));do try{cU();break}catch(a){yA(t,a)}while(!0);$C(),Xy.current=o,Kt=r,as!==null?e=0:(Os=null,Gs=0,e=Cs)}if(e!==0){if(e===2&&(r=pb(t),r!==0&&(s=r,e=Vb(t,r))),e===1)throw n=cf,Nu(t,0),sl(t,s),Gr(t,Jn()),n;if(e===6)sl(t,s);else{if(r=t.current.alternate,!(s&30)&&!lU(r)&&(e=Jy(t,s),e===2&&(o=pb(t),o!==0&&(s=o,e=Vb(t,o))),e===1))throw n=cf,Nu(t,0),sl(t,s),Gr(t,Jn()),n;switch(t.finishedWork=r,t.finishedLanes=s,e){case 0:case 1:throw Error($e(345));case 2:au(t,zr,ba);break;case 3:if(sl(t,s),(s&130023424)===s&&(e=VC+500-Jn(),10<e)){if(Fy(t,0)!==0)break;if(r=t.suspendedLanes,(r&s)!==s){br(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=bb(au.bind(null,t,zr,ba),e);break}au(t,zr,ba);break;case 4:if(sl(t,s),(s&4194240)===s)break;for(e=t.eventTimes,r=-1;0<s;){var i=31-wi(s);o=1<<i,i=e[i],i>r&&(r=i),s&=~o}if(s=r,s=Jn()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*aU(s/1960))-s,10<s){t.timeoutHandle=bb(au.bind(null,t,zr,ba),s);break}au(t,zr,ba);break;case 5:au(t,zr,ba);break;default:throw Error($e(329))}}}return Gr(t,Jn()),t.callbackNode===n?gA.bind(null,t):null}function Vb(t,e){var n=Up;return t.current.memoizedState.isDehydrated&&(Nu(t,e).flags|=256),t=Jy(t,e),t!==2&&(e=zr,zr=n,e!==null&&Ub(e)),t}function Ub(t){zr===null?zr=t:zr.push.apply(zr,t)}function lU(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],o=r.getSnapshot;r=r.value;try{if(!Ci(o(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function sl(t,e){for(e&=~BC,e&=~t0,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-wi(e),s=1<<n;t[n]=-1,e&=~s}}function z$(t){if(Kt&6)throw Error($e(327));rd();var e=Fy(t,0);if(!(e&1))return Gr(t,Jn()),null;var n=Jy(t,e);if(t.tag!==0&&n===2){var s=pb(t);s!==0&&(e=s,n=Vb(t,s))}if(n===1)throw n=cf,Nu(t,0),sl(t,e),Gr(t,Jn()),n;if(n===6)throw Error($e(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,au(t,zr,ba),Gr(t,Jn()),null}function UC(t,e){var n=Kt;Kt|=1;try{return t(e)}finally{Kt=n,Kt===0&&(yd=Jn()+500,Qx&&zl())}}function Mu(t){il!==null&&il.tag===0&&!(Kt&6)&&rd();var e=Kt;Kt|=1;var n=Wo.transition,s=rn;try{if(Wo.transition=null,rn=1,t)return t()}finally{rn=s,Wo.transition=n,Kt=e,!(Kt&6)&&zl()}}function WC(){so=Qc.current,Nn(Qc)}function Nu(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,zV(n)),as!==null)for(n=as.return;n!==null;){var s=n;switch(CC(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&My();break;case 3:md(),Nn(Wr),Nn(dr),AC();break;case 5:DC(s);break;case 4:md();break;case 13:Nn(Ln);break;case 19:Nn(Ln);break;case 10:NC(s.type._context);break;case 22:case 23:WC()}n=n.return}if(Os=t,as=t=wl(t.current,null),Gs=so=e,Cs=0,cf=null,BC=t0=zu=0,zr=Up=null,xu!==null){for(e=0;e<xu.length;e++)if(n=xu[e],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,o=n.pending;if(o!==null){var i=o.next;o.next=r,s.next=i}n.pending=s}xu=null}return t}function yA(t,e){do{var n=as;try{if($C(),hy.current=qy,Ky){for(var s=Bn.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}Ky=!1}if(Lu=0,_s=bs=Bn=null,Bp=!1,af=0,MC.current=null,n===null||n.return===null){Cs=1,cf=e,as=null;break}e:{var o=t,i=n.return,a=n,l=e;if(e=Gs,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var p=I$(i);if(p!==null){p.flags&=-257,$$(p,i,a,o,e),p.mode&1&&k$(o,u,e),e=p,l=u;var f=e.updateQueue;if(f===null){var m=new Set;m.add(l),e.updateQueue=m}else f.add(l);break e}else{if(!(e&1)){k$(o,u,e),jC();break e}l=Error($e(426))}}else if(_n&&a.mode&1){var g=I$(i);if(g!==null){!(g.flags&65536)&&(g.flags|=256),$$(g,i,a,o,e),kC(gd(l,a));break e}}o=l=gd(l,a),Cs!==4&&(Cs=2),Up===null?Up=[o]:Up.push(o),o=i;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var y=eA(o,l,e);x$(o,y);break e;case 1:a=l;var x=o.type,v=o.stateNode;if(!(o.flags&128)&&(typeof x.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(yl===null||!yl.has(v)))){o.flags|=65536,e&=-e,o.lanes|=e;var b=tA(o,a,e);x$(o,b);break e}}o=o.return}while(o!==null)}vA(n)}catch(S){e=S,as===n&&n!==null&&(as=n=n.return);continue}break}while(!0)}function xA(){var t=Xy.current;return Xy.current=qy,t===null?qy:t}function jC(){(Cs===0||Cs===3||Cs===2)&&(Cs=4),Os===null||!(zu&268435455)&&!(t0&268435455)||sl(Os,Gs)}function Jy(t,e){var n=Kt;Kt|=2;var s=xA();(Os!==t||Gs!==e)&&(ba=null,Nu(t,e));do try{uU();break}catch(r){yA(t,r)}while(!0);if($C(),Kt=n,Xy.current=s,as!==null)throw Error($e(261));return Os=null,Gs=0,Cs}function uU(){for(;as!==null;)wA(as)}function cU(){for(;as!==null&&!P4();)wA(as)}function wA(t){var e=SA(t.alternate,t,so);t.memoizedProps=t.pendingProps,e===null?vA(t):as=e,MC.current=null}function vA(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=sU(n,e),n!==null){n.flags&=32767,as=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Cs=6,as=null;return}}else if(n=nU(n,e,so),n!==null){as=n;return}if(e=e.sibling,e!==null){as=e;return}as=e=t}while(e!==null);Cs===0&&(Cs=5)}function au(t,e,n){var s=rn,r=Wo.transition;try{Wo.transition=null,rn=1,dU(t,e,n,s)}finally{Wo.transition=r,rn=s}return null}function dU(t,e,n,s){do rd();while(il!==null);if(Kt&6)throw Error($e(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error($e(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(G4(t,o),t===Os&&(as=Os=null,Gs=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ug||(Ug=!0,CA(_y,function(){return rd(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=Wo.transition,Wo.transition=null;var i=rn;rn=1;var a=Kt;Kt|=4,MC.current=null,oU(t,n),fA(n,t),DV(wb),Py=!!xb,wb=xb=null,t.current=n,iU(n),O4(),Kt=a,rn=i,Wo.transition=o}else t.current=n;if(Ug&&(Ug=!1,il=t,Qy=r),o=t.pendingLanes,o===0&&(yl=null),M4(n.stateNode),Gr(t,Jn()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(Yy)throw Yy=!1,t=Mb,Mb=null,t;return Qy&1&&t.tag!==0&&rd(),o=t.pendingLanes,o&1?t===Bb?Wp++:(Wp=0,Bb=t):Wp=0,zl(),null}function rd(){if(il!==null){var t=eD(Qy),e=Wo.transition,n=rn;try{if(Wo.transition=null,rn=16>t?16:t,il===null)var s=!1;else{if(t=il,il=null,Qy=0,Kt&6)throw Error($e(331));var r=Kt;for(Kt|=4,Xe=t.current;Xe!==null;){var o=Xe,i=o.child;if(Xe.flags&16){var a=o.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(Xe=u;Xe!==null;){var c=Xe;switch(c.tag){case 0:case 11:case 15:Vp(8,c,o)}var d=c.child;if(d!==null)d.return=c,Xe=d;else for(;Xe!==null;){c=Xe;var h=c.sibling,p=c.return;if(dA(c),c===u){Xe=null;break}if(h!==null){h.return=p,Xe=h;break}Xe=p}}}var f=o.alternate;if(f!==null){var m=f.child;if(m!==null){f.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(m!==null)}}Xe=o}}if(o.subtreeFlags&2064&&i!==null)i.return=o,Xe=i;else e:for(;Xe!==null;){if(o=Xe,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Vp(9,o,o.return)}var y=o.sibling;if(y!==null){y.return=o.return,Xe=y;break e}Xe=o.return}}var x=t.current;for(Xe=x;Xe!==null;){i=Xe;var v=i.child;if(i.subtreeFlags&2064&&v!==null)v.return=i,Xe=v;else e:for(i=x;Xe!==null;){if(a=Xe,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:e0(9,a)}}catch(S){jn(a,a.return,S)}if(a===i){Xe=null;break e}var b=a.sibling;if(b!==null){b.return=a.return,Xe=b;break e}Xe=a.return}}if(Kt=r,zl(),ta&&typeof ta.onPostCommitFiberRoot=="function")try{ta.onPostCommitFiberRoot(Hx,t)}catch{}s=!0}return s}finally{rn=n,Wo.transition=e}}return!1}function M$(t,e,n){e=gd(n,e),e=eA(t,e,1),t=gl(t,e,1),e=br(),t!==null&&(Lf(t,1,e),Gr(t,e))}function jn(t,e,n){if(t.tag===3)M$(t,t,n);else for(;e!==null;){if(e.tag===3){M$(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(yl===null||!yl.has(s))){t=gd(n,t),t=tA(e,t,1),e=gl(e,t,1),t=br(),e!==null&&(Lf(e,1,t),Gr(e,t));break}}e=e.return}}function hU(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=br(),t.pingedLanes|=t.suspendedLanes&n,Os===t&&(Gs&n)===n&&(Cs===4||Cs===3&&(Gs&130023424)===Gs&&500>Jn()-VC?Nu(t,0):BC|=n),Gr(t,e)}function bA(t,e){e===0&&(t.mode&1?(e=Ag,Ag<<=1,!(Ag&130023424)&&(Ag=4194304)):e=1);var n=br();t=La(t,e),t!==null&&(Lf(t,e,n),Gr(t,n))}function pU(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),bA(t,n)}function fU(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=t.stateNode;break;default:throw Error($e(314))}s!==null&&s.delete(e),bA(t,n)}var SA;SA=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Wr.current)Br=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Br=!1,tU(t,e,n);Br=!!(t.flags&131072)}else Br=!1,_n&&e.flags&1048576&&$D(e,Uy,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;fy(t,e),t=e.pendingProps;var r=hd(e,dr.current);sd(e,n),r=FC(null,e,s,t,r,n);var o=PC();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,jr(s)?(o=!0,By(e)):o=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,EC(e),r.updater=Zx,e.stateNode=r,r._reactInternals=e,Tb(e,s,t,n),e=Db(null,e,s,!0,o,n)):(e.tag=0,_n&&o&&SC(e),gr(null,e,r,n),e=e.child),e;case 16:s=e.elementType;e:{switch(fy(t,e),t=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=gU(s),t=di(s,t),r){case 0:e=Rb(null,e,s,t,n);break e;case 1:e=E$(null,e,s,t,n);break e;case 11:e=N$(null,e,s,t,n);break e;case 14:e=T$(null,e,s,di(s.type,t),n);break e}throw Error($e(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:di(s,r),Rb(t,e,s,r,n);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:di(s,r),E$(t,e,s,r,n);case 3:e:{if(oA(e),t===null)throw Error($e(387));s=e.pendingProps,o=e.memoizedState,r=o.element,AD(t,e),Gy(e,s,null,n);var i=e.memoizedState;if(s=i.element,o.isDehydrated)if(o={element:s,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){r=gd(Error($e(423)),e),e=R$(t,e,s,n,r);break e}else if(s!==r){r=gd(Error($e(424)),e),e=R$(t,e,s,n,r);break e}else for(io=ml(e.stateNode.containerInfo.firstChild),lo=e,_n=!0,fi=null,n=RD(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(pd(),s===r){e=za(t,e,n);break e}gr(t,e,s,n)}e=e.child}return e;case 5:return _D(e),t===null&&Ib(e),s=e.type,r=e.pendingProps,o=t!==null?t.memoizedProps:null,i=r.children,vb(s,r)?i=null:o!==null&&vb(s,o)&&(e.flags|=32),rA(t,e),gr(t,e,i,n),e.child;case 6:return t===null&&Ib(e),null;case 13:return iA(t,e,n);case 4:return RC(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=fd(e,null,s,n):gr(t,e,s,n),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:di(s,r),N$(t,e,s,r,n);case 7:return gr(t,e,e.pendingProps,n),e.child;case 8:return gr(t,e,e.pendingProps.children,n),e.child;case 12:return gr(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,o=e.memoizedProps,i=r.value,wn(Wy,s._currentValue),s._currentValue=i,o!==null)if(Ci(o.value,i)){if(o.children===r.children&&!Wr.current){e=za(t,e,n);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){i=o.child;for(var l=a.firstContext;l!==null;){if(l.context===s){if(o.tag===1){l=Ea(-1,n&-n),l.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),$b(o.return,n,e),a.lanes|=n;break}l=l.next}}else if(o.tag===10)i=o.type===e.type?null:o.child;else if(o.tag===18){if(i=o.return,i===null)throw Error($e(341));i.lanes|=n,a=i.alternate,a!==null&&(a.lanes|=n),$b(i,n,e),i=o.sibling}else i=o.child;if(i!==null)i.return=o;else for(i=o;i!==null;){if(i===e){i=null;break}if(o=i.sibling,o!==null){o.return=i.return,i=o;break}i=i.return}o=i}gr(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,sd(e,n),r=Ko(r),s=s(r),e.flags|=1,gr(t,e,s,n),e.child;case 14:return s=e.type,r=di(s,e.pendingProps),r=di(s.type,r),T$(t,e,s,r,n);case 15:return nA(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:di(s,r),fy(t,e),e.tag=1,jr(s)?(t=!0,By(e)):t=!1,sd(e,n),ZD(e,s,r),Tb(e,s,r,n),Db(null,e,s,!0,t,n);case 19:return aA(t,e,n);case 22:return sA(t,e,n)}throw Error($e(156,e.tag))};function CA(t,e){return YR(t,e)}function mU(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oo(t,e,n,s){return new mU(t,e,n,s)}function GC(t){return t=t.prototype,!(!t||!t.isReactComponent)}function gU(t){if(typeof t=="function")return GC(t)?1:0;if(t!=null){if(t=t.$$typeof,t===cC)return 11;if(t===dC)return 14}return 2}function wl(t,e){var n=t.alternate;return n===null?(n=Oo(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function yy(t,e,n,s,r,o){var i=2;if(s=t,typeof t=="function")GC(t)&&(i=1);else if(typeof t=="string")i=5;else e:switch(t){case Vc:return Tu(n.children,r,o,e);case uC:i=8,r|=8;break;case Jv:return t=Oo(12,n,e,r|2),t.elementType=Jv,t.lanes=o,t;case Zv:return t=Oo(13,n,e,r),t.elementType=Zv,t.lanes=o,t;case eb:return t=Oo(19,n,e,r),t.elementType=eb,t.lanes=o,t;case _R:return n0(n,r,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case DR:i=10;break e;case AR:i=9;break e;case cC:i=11;break e;case dC:i=14;break e;case Za:i=16,s=null;break e}throw Error($e(130,t==null?t:typeof t,""))}return e=Oo(i,n,e,r),e.elementType=t,e.type=s,e.lanes=o,e}function Tu(t,e,n,s){return t=Oo(7,t,s,e),t.lanes=n,t}function n0(t,e,n,s){return t=Oo(22,t,s,e),t.elementType=_R,t.lanes=n,t.stateNode={isHidden:!1},t}function cv(t,e,n){return t=Oo(6,t,null,e),t.lanes=n,t}function dv(t,e,n){return e=Oo(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function yU(t,e,n,s,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=G1(0),this.expirationTimes=G1(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=G1(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function HC(t,e,n,s,r,o,i,a,l){return t=new yU(t,e,n,a,l),e===1?(e=1,o===!0&&(e|=8)):e=0,o=Oo(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},EC(o),t}function xU(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Bc,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function kA(t){if(!t)return kl;t=t._reactInternals;e:{if(rc(t)!==t||t.tag!==1)throw Error($e(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(jr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error($e(171))}if(t.tag===1){var n=t.type;if(jr(n))return kD(t,n,e)}return e}function IA(t,e,n,s,r,o,i,a,l){return t=HC(n,s,!0,t,r,o,i,a,l),t.context=kA(null),n=t.current,s=br(),r=xl(n),o=Ea(s,r),o.callback=e??null,gl(n,o,r),t.current.lanes=r,Lf(t,r,s),Gr(t,s),t}function s0(t,e,n,s){var r=e.current,o=br(),i=xl(r);return n=kA(n),e.context===null?e.context=n:e.pendingContext=n,e=Ea(o,i),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=gl(r,e,i),t!==null&&(vi(t,r,i,o),dy(t,r,i)),i}function Zy(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function B$(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function KC(t,e){B$(t,e),(t=t.alternate)&&B$(t,e)}function wU(){return null}var $A=typeof reportError=="function"?reportError:function(t){console.error(t)};function qC(t){this._internalRoot=t}r0.prototype.render=qC.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error($e(409));s0(t,e,null,null)};r0.prototype.unmount=qC.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Mu(function(){s0(null,t,null,null)}),e[Oa]=null}};function r0(t){this._internalRoot=t}r0.prototype.unstable_scheduleHydration=function(t){if(t){var e=sD();t={blockedOn:null,target:t,priority:e};for(var n=0;n<nl.length&&e!==0&&e<nl[n].priority;n++);nl.splice(n,0,t),n===0&&oD(t)}};function XC(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function o0(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function V$(){}function vU(t,e,n,s,r){if(r){if(typeof s=="function"){var o=s;s=function(){var u=Zy(i);o.call(u)}}var i=IA(e,s,t,0,null,!1,!1,"",V$);return t._reactRootContainer=i,t[Oa]=i.current,tf(t.nodeType===8?t.parentNode:t),Mu(),i}for(;r=t.lastChild;)t.removeChild(r);if(typeof s=="function"){var a=s;s=function(){var u=Zy(l);a.call(u)}}var l=HC(t,0,!1,null,null,!1,!1,"",V$);return t._reactRootContainer=l,t[Oa]=l.current,tf(t.nodeType===8?t.parentNode:t),Mu(function(){s0(e,l,n,s)}),l}function i0(t,e,n,s,r){var o=n._reactRootContainer;if(o){var i=o;if(typeof r=="function"){var a=r;r=function(){var l=Zy(i);a.call(l)}}s0(e,i,t,r)}else i=vU(n,e,t,r,s);return Zy(i)}tD=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ip(e.pendingLanes);n!==0&&(fC(e,n|1),Gr(e,Jn()),!(Kt&6)&&(yd=Jn()+500,zl()))}break;case 13:Mu(function(){var s=La(t,1);if(s!==null){var r=br();vi(s,t,1,r)}}),KC(t,1)}};mC=function(t){if(t.tag===13){var e=La(t,134217728);if(e!==null){var n=br();vi(e,t,134217728,n)}KC(t,134217728)}};nD=function(t){if(t.tag===13){var e=xl(t),n=La(t,e);if(n!==null){var s=br();vi(n,t,e,s)}KC(t,e)}};sD=function(){return rn};rD=function(t,e){var n=rn;try{return rn=t,e()}finally{rn=n}};cb=function(t,e,n){switch(e){case"input":if(sb(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var r=Yx(s);if(!r)throw Error($e(90));PR(s),sb(s,r)}}}break;case"textarea":LR(t,n);break;case"select":e=n.value,e!=null&&Zc(t,!!n.multiple,e,!1)}};jR=UC;GR=Mu;var bU={usingClientEntryPoint:!1,Events:[Mf,Gc,Yx,UR,WR,UC]},dp={findFiberByHostInstance:yu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},SU={bundleType:dp.bundleType,version:dp.version,rendererPackageName:dp.rendererPackageName,rendererConfig:dp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=qR(t),t===null?null:t.stateNode},findFiberByHostInstance:dp.findFiberByHostInstance||wU,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wg.isDisabled&&Wg.supportsFiber)try{Hx=Wg.inject(SU),ta=Wg}catch{}}mo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bU;mo.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!XC(e))throw Error($e(200));return xU(t,e,null,n)};mo.createRoot=function(t,e){if(!XC(t))throw Error($e(299));var n=!1,s="",r=$A;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=HC(t,1,!1,null,null,n,!1,s,r),t[Oa]=e.current,tf(t.nodeType===8?t.parentNode:t),new qC(e)};mo.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error($e(188)):(t=Object.keys(t).join(","),Error($e(268,t)));return t=qR(e),t=t===null?null:t.stateNode,t};mo.flushSync=function(t){return Mu(t)};mo.hydrate=function(t,e,n){if(!o0(e))throw Error($e(200));return i0(null,t,e,!0,n)};mo.hydrateRoot=function(t,e,n){if(!XC(t))throw Error($e(405));var s=n!=null&&n.hydratedSources||null,r=!1,o="",i=$A;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(i=n.onRecoverableError)),e=IA(e,null,t,1,n??null,r,!1,o,i),t[Oa]=e.current,tf(t),s)for(t=0;t<s.length;t++)n=s[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new r0(e)};mo.render=function(t,e,n){if(!o0(e))throw Error($e(200));return i0(null,t,e,!1,n)};mo.unmountComponentAtNode=function(t){if(!o0(t))throw Error($e(40));return t._reactRootContainer?(Mu(function(){i0(null,null,t,!1,function(){t._reactRootContainer=null,t[Oa]=null})}),!0):!1};mo.unstable_batchedUpdates=UC;mo.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!o0(n))throw Error($e(200));if(t==null||t._reactInternals===void 0)throw Error($e(38));return i0(t,e,n,!1,s)};mo.version="18.3.1-next-f1338f8080-20240426";function NA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(NA)}catch(t){console.error(t)}}NA(),NR.exports=mo;var YC=NR.exports;const CU=jx(YC),kU=tC({__proto__:null,default:CU},[YC]);var TA,U$=YC;TA=U$.createRoot,U$.hydrateRoot;/**
 * @remix-run/router v1.21.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Dn(){return Dn=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Dn.apply(this,arguments)}var os;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(os||(os={}));const W$="popstate";function IU(t){t===void 0&&(t={});function e(s,r){let{pathname:o,search:i,hash:a}=s.location;return df("",{pathname:o,search:i,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(s,r){return typeof r=="string"?r:Bu(r)}return NU(e,n,null,t)}function Pt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function xd(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function $U(){return Math.random().toString(36).substr(2,8)}function j$(t,e){return{usr:t.state,key:t.key,idx:e}}function df(t,e,n,s){return n===void 0&&(n=null),Dn({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Ml(e):e,{state:n,key:e&&e.key||s||$U()})}function Bu(t){let{pathname:e="/",search:n="",hash:s=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function Ml(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let s=t.indexOf("?");s>=0&&(e.search=t.substr(s),t=t.substr(0,s)),t&&(e.pathname=t)}return e}function NU(t,e,n,s){s===void 0&&(s={});let{window:r=document.defaultView,v5Compat:o=!1}=s,i=r.history,a=os.Pop,l=null,u=c();u==null&&(u=0,i.replaceState(Dn({},i.state,{idx:u}),""));function c(){return(i.state||{idx:null}).idx}function d(){a=os.Pop;let g=c(),y=g==null?null:g-u;u=g,l&&l({action:a,location:m.location,delta:y})}function h(g,y){a=os.Push;let x=df(m.location,g,y);u=c()+1;let v=j$(x,u),b=m.createHref(x);try{i.pushState(v,"",b)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;r.location.assign(b)}o&&l&&l({action:a,location:m.location,delta:1})}function p(g,y){a=os.Replace;let x=df(m.location,g,y);u=c();let v=j$(x,u),b=m.createHref(x);i.replaceState(v,"",b),o&&l&&l({action:a,location:m.location,delta:0})}function f(g){let y=r.location.origin!=="null"?r.location.origin:r.location.href,x=typeof g=="string"?g:Bu(g);return x=x.replace(/ $/,"%20"),Pt(y,"No window.location.(origin|href) available to create URL for href: "+x),new URL(x,y)}let m={get action(){return a},get location(){return t(r,i)},listen(g){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(W$,d),l=g,()=>{r.removeEventListener(W$,d),l=null}},createHref(g){return e(r,g)},createURL:f,encodeLocation(g){let y=f(g);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:h,replace:p,go(g){return i.go(g)}};return m}var un;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(un||(un={}));const TU=new Set(["lazy","caseSensitive","path","id","index","children"]);function EU(t){return t.index===!0}function ex(t,e,n,s){return n===void 0&&(n=[]),s===void 0&&(s={}),t.map((r,o)=>{let i=[...n,String(o)],a=typeof r.id=="string"?r.id:i.join("-");if(Pt(r.index!==!0||!r.children,"Cannot specify children on an index route"),Pt(!s[a],'Found a route id collision on id "'+a+`".  Route id's must be globally unique within Data Router usages`),EU(r)){let l=Dn({},r,e(r),{id:a});return s[a]=l,l}else{let l=Dn({},r,e(r),{id:a,children:void 0});return s[a]=l,r.children&&(l.children=ex(r.children,e,i,s)),l}})}function cu(t,e,n){return n===void 0&&(n="/"),xy(t,e,n,!1)}function xy(t,e,n,s){let r=typeof e=="string"?Ml(e):e,o=Od(r.pathname||"/",n);if(o==null)return null;let i=EA(t);DU(i);let a=null;for(let l=0;a==null&&l<i.length;++l){let u=UU(o);a=BU(i[l],u,s)}return a}function RU(t,e){let{route:n,pathname:s,params:r}=t;return{id:n.id,pathname:s,params:r,data:e[n.id],handle:n.handle}}function EA(t,e,n,s){e===void 0&&(e=[]),n===void 0&&(n=[]),s===void 0&&(s="");let r=(o,i,a)=>{let l={relativePath:a===void 0?o.path||"":a,caseSensitive:o.caseSensitive===!0,childrenIndex:i,route:o};l.relativePath.startsWith("/")&&(Pt(l.relativePath.startsWith(s),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(s.length));let u=Ra([s,l.relativePath]),c=n.concat(l);o.children&&o.children.length>0&&(Pt(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),EA(o.children,e,c,u)),!(o.path==null&&!o.index)&&e.push({path:u,score:zU(u,o.index),routesMeta:c})};return t.forEach((o,i)=>{var a;if(o.path===""||!((a=o.path)!=null&&a.includes("?")))r(o,i);else for(let l of RA(o.path))r(o,i,l)}),e}function RA(t){let e=t.split("/");if(e.length===0)return[];let[n,...s]=e,r=n.endsWith("?"),o=n.replace(/\?$/,"");if(s.length===0)return r?[o,""]:[o];let i=RA(s.join("/")),a=[];return a.push(...i.map(l=>l===""?o:[o,l].join("/"))),r&&a.push(...i),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function DU(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:MU(e.routesMeta.map(s=>s.childrenIndex),n.routesMeta.map(s=>s.childrenIndex)))}const AU=/^:[\w-]+$/,_U=3,FU=2,PU=1,OU=10,LU=-2,G$=t=>t==="*";function zU(t,e){let n=t.split("/"),s=n.length;return n.some(G$)&&(s+=LU),e&&(s+=FU),n.filter(r=>!G$(r)).reduce((r,o)=>r+(AU.test(o)?_U:o===""?PU:OU),s)}function MU(t,e){return t.length===e.length&&t.slice(0,-1).every((s,r)=>s===e[r])?t[t.length-1]-e[e.length-1]:0}function BU(t,e,n){n===void 0&&(n=!1);let{routesMeta:s}=t,r={},o="/",i=[];for(let a=0;a<s.length;++a){let l=s[a],u=a===s.length-1,c=o==="/"?e:e.slice(o.length)||"/",d=H$({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),h=l.route;if(!d&&u&&n&&!s[s.length-1].route.index&&(d=H$({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},c)),!d)return null;Object.assign(r,d.params),i.push({params:r,pathname:Ra([o,d.pathname]),pathnameBase:GU(Ra([o,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(o=Ra([o,d.pathnameBase]))}return i}function H$(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,s]=VU(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let o=r[0],i=o.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:s.reduce((u,c,d)=>{let{paramName:h,isOptional:p}=c;if(h==="*"){let m=a[d]||"";i=o.slice(0,o.length-m.length).replace(/(.)\/+$/,"$1")}const f=a[d];return p&&!f?u[h]=void 0:u[h]=(f||"").replace(/%2F/g,"/"),u},{}),pathname:o,pathnameBase:i,pattern:t}}function VU(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),xd(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let s=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(i,a,l)=>(s.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(s.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),s]}function UU(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return xd(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Od(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,s=t.charAt(n);return s&&s!=="/"?null:t.slice(n)||"/"}function WU(t,e){e===void 0&&(e="/");let{pathname:n,search:s="",hash:r=""}=typeof t=="string"?Ml(t):t;return{pathname:n?n.startsWith("/")?n:jU(n,e):e,search:HU(s),hash:KU(r)}}function jU(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function hv(t,e,n,s){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function DA(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function a0(t,e){let n=DA(t);return e?n.map((s,r)=>r===n.length-1?s.pathname:s.pathnameBase):n.map(s=>s.pathnameBase)}function l0(t,e,n,s){s===void 0&&(s=!1);let r;typeof t=="string"?r=Ml(t):(r=Dn({},t),Pt(!r.pathname||!r.pathname.includes("?"),hv("?","pathname","search",r)),Pt(!r.pathname||!r.pathname.includes("#"),hv("#","pathname","hash",r)),Pt(!r.search||!r.search.includes("#"),hv("#","search","hash",r)));let o=t===""||r.pathname==="",i=o?"/":r.pathname,a;if(i==null)a=n;else{let d=e.length-1;if(!s&&i.startsWith("..")){let h=i.split("/");for(;h[0]==="..";)h.shift(),d-=1;r.pathname=h.join("/")}a=d>=0?e[d]:"/"}let l=WU(r,a),u=i&&i!=="/"&&i.endsWith("/"),c=(o||i===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}const Ra=t=>t.join("/").replace(/\/\/+/g,"/"),GU=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),HU=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,KU=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;class tx{constructor(e,n,s,r){r===void 0&&(r=!1),this.status=e,this.statusText=n||"",this.internal=r,s instanceof Error?(this.data=s.toString(),this.error=s):this.data=s}}function u0(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const AA=["post","put","patch","delete"],qU=new Set(AA),XU=["get",...AA],YU=new Set(XU),QU=new Set([301,302,303,307,308]),JU=new Set([307,308]),pv={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},ZU={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},hp={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},QC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,eW=t=>({hasErrorBoundary:!!t.hasErrorBoundary}),_A="remix-router-transitions";function tW(t){const e=t.window?t.window:typeof window<"u"?window:void 0,n=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u",s=!n;Pt(t.routes.length>0,"You must provide a non-empty routes array to createRouter");let r;if(t.mapRouteProperties)r=t.mapRouteProperties;else if(t.detectErrorBoundary){let Y=t.detectErrorBoundary;r=se=>({hasErrorBoundary:Y(se)})}else r=eW;let o={},i=ex(t.routes,r,void 0,o),a,l=t.basename||"/",u=t.dataStrategy||oW,c=t.patchRoutesOnNavigation,d=Dn({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1,v7_skipActionErrorRevalidation:!1},t.future),h=null,p=new Set,f=null,m=null,g=null,y=t.hydrationData!=null,x=cu(i,t.history.location,l),v=null;if(x==null&&!c){let Y=Pr(404,{pathname:t.history.location.pathname}),{matches:se,route:de}=sN(i);x=se,v={[de.id]:Y}}x&&!t.hydrationData&&ni(x,i,t.history.location.pathname).active&&(x=null);let b;if(x)if(x.some(Y=>Y.route.lazy))b=!1;else if(!x.some(Y=>Y.route.loader))b=!0;else if(d.v7_partialHydration){let Y=t.hydrationData?t.hydrationData.loaderData:null,se=t.hydrationData?t.hydrationData.errors:null;if(se){let de=x.findIndex(ye=>se[ye.route.id]!==void 0);b=x.slice(0,de+1).every(ye=>!jb(ye.route,Y,se))}else b=x.every(de=>!jb(de.route,Y,se))}else b=t.hydrationData!=null;else if(b=!1,x=[],d.v7_partialHydration){let Y=ni(null,i,t.history.location.pathname);Y.active&&Y.matches&&(x=Y.matches)}let S,C={historyAction:t.history.action,location:t.history.location,matches:x,initialized:b,navigation:pv,restoreScrollPosition:t.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:t.hydrationData&&t.hydrationData.loaderData||{},actionData:t.hydrationData&&t.hydrationData.actionData||null,errors:t.hydrationData&&t.hydrationData.errors||v,fetchers:new Map,blockers:new Map},I=os.Pop,T=!1,R,_=!1,P=new Map,z=null,O=!1,V=!1,H=[],Q=new Set,oe=new Map,j=0,ee=-1,ie=new Map,le=new Set,fe=new Map,ge=new Map,xe=new Set,we=new Map,Ie=new Map,_e;function qe(){if(h=t.history.listen(Y=>{let{action:se,location:de,delta:ye}=Y;if(_e){_e(),_e=void 0;return}xd(Ie.size===0||ye!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let ze=So({currentLocation:C.location,nextLocation:de,historyAction:se});if(ze&&ye!=null){let rt=new Promise(He=>{_e=He});t.history.go(ye*-1),Mi(ze,{state:"blocked",location:de,proceed(){Mi(ze,{state:"proceeding",proceed:void 0,reset:void 0,location:de}),rt.then(()=>t.history.go(ye))},reset(){let He=new Map(C.blockers);He.set(ze,hp),Ge({blockers:He})}});return}return Nt(se,de)}),n){wW(e,P);let Y=()=>vW(e,P);e.addEventListener("pagehide",Y),z=()=>e.removeEventListener("pagehide",Y)}return C.initialized||Nt(os.Pop,C.location,{initialHydration:!0}),S}function Ze(){h&&h(),z&&z(),p.clear(),R&&R.abort(),C.fetchers.forEach((Y,se)=>Ts(se)),C.blockers.forEach((Y,se)=>ga(se))}function dt(Y){return p.add(Y),()=>p.delete(Y)}function Ge(Y,se){se===void 0&&(se={}),C=Dn({},C,Y);let de=[],ye=[];d.v7_fetcherPersist&&C.fetchers.forEach((ze,rt)=>{ze.state==="idle"&&(xe.has(rt)?ye.push(rt):de.push(rt))}),[...p].forEach(ze=>ze(C,{deletedFetchers:ye,viewTransitionOpts:se.viewTransitionOpts,flushSync:se.flushSync===!0})),d.v7_fetcherPersist&&(de.forEach(ze=>C.fetchers.delete(ze)),ye.forEach(ze=>Ts(ze)))}function bt(Y,se,de){var ye,ze;let{flushSync:rt}=de===void 0?{}:de,He=C.actionData!=null&&C.navigation.formMethod!=null&&pi(C.navigation.formMethod)&&C.navigation.state==="loading"&&((ye=Y.state)==null?void 0:ye._isRedirect)!==!0,Le;se.actionData?Object.keys(se.actionData).length>0?Le=se.actionData:Le=null:He?Le=C.actionData:Le=null;let Ke=se.loaderData?tN(C.loaderData,se.loaderData,se.matches||[],se.errors):C.loaderData,je=C.blockers;je.size>0&&(je=new Map(je),je.forEach((Et,hn)=>je.set(hn,hp)));let nt=T===!0||C.navigation.formMethod!=null&&pi(C.navigation.formMethod)&&((ze=Y.state)==null?void 0:ze._isRedirect)!==!0;a&&(i=a,a=void 0),O||I===os.Pop||(I===os.Push?t.history.push(Y,Y.state):I===os.Replace&&t.history.replace(Y,Y.state));let St;if(I===os.Pop){let Et=P.get(C.location.pathname);Et&&Et.has(Y.pathname)?St={currentLocation:C.location,nextLocation:Y}:P.has(Y.pathname)&&(St={currentLocation:Y,nextLocation:C.location})}else if(_){let Et=P.get(C.location.pathname);Et?Et.add(Y.pathname):(Et=new Set([Y.pathname]),P.set(C.location.pathname,Et)),St={currentLocation:C.location,nextLocation:Y}}Ge(Dn({},se,{actionData:Le,loaderData:Ke,historyAction:I,location:Y,initialized:!0,navigation:pv,revalidation:"idle",restoreScrollPosition:Dr(Y,se.matches||C.matches),preventScrollReset:nt,blockers:je}),{viewTransitionOpts:St,flushSync:rt===!0}),I=os.Pop,T=!1,_=!1,O=!1,V=!1,H=[]}async function ut(Y,se){if(typeof Y=="number"){t.history.go(Y);return}let de=Wb(C.location,C.matches,l,d.v7_prependBasename,Y,d.v7_relativeSplatPath,se==null?void 0:se.fromRouteId,se==null?void 0:se.relative),{path:ye,submission:ze,error:rt}=K$(d.v7_normalizeFormMethod,!1,de,se),He=C.location,Le=df(C.location,ye,se&&se.state);Le=Dn({},Le,t.history.encodeLocation(Le));let Ke=se&&se.replace!=null?se.replace:void 0,je=os.Push;Ke===!0?je=os.Replace:Ke===!1||ze!=null&&pi(ze.formMethod)&&ze.formAction===C.location.pathname+C.location.search&&(je=os.Replace);let nt=se&&"preventScrollReset"in se?se.preventScrollReset===!0:void 0,St=(se&&se.flushSync)===!0,Et=So({currentLocation:He,nextLocation:Le,historyAction:je});if(Et){Mi(Et,{state:"blocked",location:Le,proceed(){Mi(Et,{state:"proceeding",proceed:void 0,reset:void 0,location:Le}),ut(Y,se)},reset(){let hn=new Map(C.blockers);hn.set(Et,hp),Ge({blockers:hn})}});return}return await Nt(je,Le,{submission:ze,pendingError:rt,preventScrollReset:nt,replace:se&&se.replace,enableViewTransition:se&&se.viewTransition,flushSync:St})}function wt(){if(Tt(),Ge({revalidation:"loading"}),C.navigation.state!=="submitting"){if(C.navigation.state==="idle"){Nt(C.historyAction,C.location,{startUninterruptedRevalidation:!0});return}Nt(I||C.historyAction,C.navigation.location,{overrideNavigation:C.navigation,enableViewTransition:_===!0})}}async function Nt(Y,se,de){R&&R.abort(),R=null,I=Y,O=(de&&de.startUninterruptedRevalidation)===!0,Zl(C.location,C.matches),T=(de&&de.preventScrollReset)===!0,_=(de&&de.enableViewTransition)===!0;let ye=a||i,ze=de&&de.overrideNavigation,rt=cu(ye,se,l),He=(de&&de.flushSync)===!0,Le=ni(rt,ye,se.pathname);if(Le.active&&Le.matches&&(rt=Le.matches),!rt){let{error:Xt,notFoundMatches:_t,route:ln}=ei(se.pathname);bt(se,{matches:_t,loaderData:{},errors:{[ln.id]:Xt}},{flushSync:He});return}if(C.initialized&&!V&&dW(C.location,se)&&!(de&&de.submission&&pi(de.submission.formMethod))){bt(se,{matches:rt},{flushSync:He});return}R=new AbortController;let Ke=Nc(t.history,se,R.signal,de&&de.submission),je;if(de&&de.pendingError)je=[du(rt).route.id,{type:un.error,error:de.pendingError}];else if(de&&de.submission&&pi(de.submission.formMethod)){let Xt=await Lt(Ke,se,de.submission,rt,Le.active,{replace:de.replace,flushSync:He});if(Xt.shortCircuited)return;if(Xt.pendingActionResult){let[_t,ln]=Xt.pendingActionResult;if(ro(ln)&&u0(ln.error)&&ln.error.status===404){R=null,bt(se,{matches:Xt.matches,loaderData:{},errors:{[_t]:ln.error}});return}}rt=Xt.matches||rt,je=Xt.pendingActionResult,ze=fv(se,de.submission),He=!1,Le.active=!1,Ke=Nc(t.history,Ke.url,Ke.signal)}let{shortCircuited:nt,matches:St,loaderData:Et,errors:hn}=await qt(Ke,se,rt,Le.active,ze,de&&de.submission,de&&de.fetcherSubmission,de&&de.replace,de&&de.initialHydration===!0,He,je);nt||(R=null,bt(se,Dn({matches:St||rt},nN(je),{loaderData:Et,errors:hn})))}async function Lt(Y,se,de,ye,ze,rt){rt===void 0&&(rt={}),Tt();let He=yW(se,de);if(Ge({navigation:He},{flushSync:rt.flushSync===!0}),ze){let je=await si(ye,se.pathname,Y.signal);if(je.type==="aborted")return{shortCircuited:!0};if(je.type==="error"){let nt=du(je.partialMatches).route.id;return{matches:je.partialMatches,pendingActionResult:[nt,{type:un.error,error:je.error}]}}else if(je.matches)ye=je.matches;else{let{notFoundMatches:nt,error:St,route:Et}=ei(se.pathname);return{matches:nt,pendingActionResult:[Et.id,{type:un.error,error:St}]}}}let Le,Ke=Np(ye,se);if(!Ke.route.action&&!Ke.route.lazy)Le={type:un.error,error:Pr(405,{method:Y.method,pathname:se.pathname,routeId:Ke.route.id})};else if(Le=(await Oe("action",C,Y,[Ke],ye,null))[Ke.route.id],Y.signal.aborted)return{shortCircuited:!0};if(vu(Le)){let je;return rt&&rt.replace!=null?je=rt.replace:je=J$(Le.response.headers.get("Location"),new URL(Y.url),l)===C.location.pathname+C.location.search,await be(Y,Le,!0,{submission:de,replace:je}),{shortCircuited:!0}}if(al(Le))throw Pr(400,{type:"defer-action"});if(ro(Le)){let je=du(ye,Ke.route.id);return(rt&&rt.replace)!==!0&&(I=os.Push),{matches:ye,pendingActionResult:[je.route.id,Le]}}return{matches:ye,pendingActionResult:[Ke.route.id,Le]}}async function qt(Y,se,de,ye,ze,rt,He,Le,Ke,je,nt){let St=ze||fv(se,rt),Et=rt||He||oN(St),hn=!O&&(!d.v7_partialHydration||!Ke);if(ye){if(hn){let nn=W(nt);Ge(Dn({navigation:St},nn!==void 0?{actionData:nn}:{}),{flushSync:je})}let Ft=await si(de,se.pathname,Y.signal);if(Ft.type==="aborted")return{shortCircuited:!0};if(Ft.type==="error"){let nn=du(Ft.partialMatches).route.id;return{matches:Ft.partialMatches,loaderData:{},errors:{[nn]:Ft.error}}}else if(Ft.matches)de=Ft.matches;else{let{error:nn,notFoundMatches:xs,route:Io}=ei(se.pathname);return{matches:xs,loaderData:{},errors:{[Io.id]:nn}}}}let Xt=a||i,[_t,ln]=X$(t.history,C,de,Et,se,d.v7_partialHydration&&Ke===!0,d.v7_skipActionErrorRevalidation,V,H,Q,xe,fe,le,Xt,l,nt);if(ti(Ft=>!(de&&de.some(nn=>nn.route.id===Ft))||_t&&_t.some(nn=>nn.route.id===Ft)),ee=++j,_t.length===0&&ln.length===0){let Ft=to();return bt(se,Dn({matches:de,loaderData:{},errors:nt&&ro(nt[1])?{[nt[0]]:nt[1].error}:null},nN(nt),Ft?{fetchers:new Map(C.fetchers)}:{}),{flushSync:je}),{shortCircuited:!0}}if(hn){let Ft={};if(!ye){Ft.navigation=St;let nn=W(nt);nn!==void 0&&(Ft.actionData=nn)}ln.length>0&&(Ft.fetchers=ae(ln)),Ge(Ft,{flushSync:je})}ln.forEach(Ft=>{Zs(Ft.key),Ft.controller&&oe.set(Ft.key,Ft.controller)});let Co=()=>ln.forEach(Ft=>Zs(Ft.key));R&&R.signal.addEventListener("abort",Co);let{loaderResults:ys,fetcherResults:On}=await at(C,de,_t,ln,Y);if(Y.signal.aborted)return{shortCircuited:!0};R&&R.signal.removeEventListener("abort",Co),ln.forEach(Ft=>oe.delete(Ft.key));let Rs=jg(ys);if(Rs)return await be(Y,Rs.result,!0,{replace:Le}),{shortCircuited:!0};if(Rs=jg(On),Rs)return le.add(Rs.key),await be(Y,Rs.result,!0,{replace:Le}),{shortCircuited:!0};let{loaderData:xa,errors:ri}=eN(C,de,ys,nt,ln,On,we);we.forEach((Ft,nn)=>{Ft.subscribe(xs=>{(xs||Ft.done)&&we.delete(nn)})}),d.v7_partialHydration&&Ke&&C.errors&&(ri=Dn({},C.errors,ri));let ko=to(),Ui=bo(ee),Vs=ko||Ui||ln.length>0;return Dn({matches:de,loaderData:xa,errors:ri},Vs?{fetchers:new Map(C.fetchers)}:{})}function W(Y){if(Y&&!ro(Y[1]))return{[Y[0]]:Y[1].data};if(C.actionData)return Object.keys(C.actionData).length===0?null:C.actionData}function ae(Y){return Y.forEach(se=>{let de=C.fetchers.get(se.key),ye=pp(void 0,de?de.data:void 0);C.fetchers.set(se.key,ye)}),new Map(C.fetchers)}function ue(Y,se,de,ye){if(s)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");Zs(Y);let ze=(ye&&ye.flushSync)===!0,rt=a||i,He=Wb(C.location,C.matches,l,d.v7_prependBasename,de,d.v7_relativeSplatPath,se,ye==null?void 0:ye.relative),Le=cu(rt,He,l),Ke=ni(Le,rt,He);if(Ke.active&&Ke.matches&&(Le=Ke.matches),!Le){Jt(Y,se,Pr(404,{pathname:He}),{flushSync:ze});return}let{path:je,submission:nt,error:St}=K$(d.v7_normalizeFormMethod,!0,He,ye);if(St){Jt(Y,se,St,{flushSync:ze});return}let Et=Np(Le,je),hn=(ye&&ye.preventScrollReset)===!0;if(nt&&pi(nt.formMethod)){ve(Y,se,je,Et,Le,Ke.active,ze,hn,nt);return}fe.set(Y,{routeId:se,path:je}),Ce(Y,se,je,Et,Le,Ke.active,ze,hn,nt)}async function ve(Y,se,de,ye,ze,rt,He,Le,Ke){Tt(),fe.delete(Y);function je(Rn){if(!Rn.route.action&&!Rn.route.lazy){let oi=Pr(405,{method:Ke.formMethod,pathname:de,routeId:se});return Jt(Y,se,oi,{flushSync:He}),!0}return!1}if(!rt&&je(ye))return;let nt=C.fetchers.get(Y);vt(Y,xW(Ke,nt),{flushSync:He});let St=new AbortController,Et=Nc(t.history,de,St.signal,Ke);if(rt){let Rn=await si(ze,de,Et.signal);if(Rn.type==="aborted")return;if(Rn.type==="error"){Jt(Y,se,Rn.error,{flushSync:He});return}else if(Rn.matches){if(ze=Rn.matches,ye=Np(ze,de),je(ye))return}else{Jt(Y,se,Pr(404,{pathname:de}),{flushSync:He});return}}oe.set(Y,St);let hn=j,_t=(await Oe("action",C,Et,[ye],ze,Y))[ye.route.id];if(Et.signal.aborted){oe.get(Y)===St&&oe.delete(Y);return}if(d.v7_fetcherPersist&&xe.has(Y)){if(vu(_t)||ro(_t)){vt(Y,Ja(void 0));return}}else{if(vu(_t))if(oe.delete(Y),ee>hn){vt(Y,Ja(void 0));return}else return le.add(Y),vt(Y,pp(Ke)),be(Et,_t,!1,{fetcherSubmission:Ke,preventScrollReset:Le});if(ro(_t)){Jt(Y,se,_t.error);return}}if(al(_t))throw Pr(400,{type:"defer-action"});let ln=C.navigation.location||C.location,Co=Nc(t.history,ln,St.signal),ys=a||i,On=C.navigation.state!=="idle"?cu(ys,C.navigation.location,l):C.matches;Pt(On,"Didn't find any matches after fetcher action");let Rs=++j;ie.set(Y,Rs);let xa=pp(Ke,_t.data);C.fetchers.set(Y,xa);let[ri,ko]=X$(t.history,C,On,Ke,ln,!1,d.v7_skipActionErrorRevalidation,V,H,Q,xe,fe,le,ys,l,[ye.route.id,_t]);ko.filter(Rn=>Rn.key!==Y).forEach(Rn=>{let oi=Rn.key,qa=C.fetchers.get(oi),tp=pp(void 0,qa?qa.data:void 0);C.fetchers.set(oi,tp),Zs(oi),Rn.controller&&oe.set(oi,Rn.controller)}),Ge({fetchers:new Map(C.fetchers)});let Ui=()=>ko.forEach(Rn=>Zs(Rn.key));St.signal.addEventListener("abort",Ui);let{loaderResults:Vs,fetcherResults:Ft}=await at(C,On,ri,ko,Co);if(St.signal.aborted)return;St.signal.removeEventListener("abort",Ui),ie.delete(Y),oe.delete(Y),ko.forEach(Rn=>oe.delete(Rn.key));let nn=jg(Vs);if(nn)return be(Co,nn.result,!1,{preventScrollReset:Le});if(nn=jg(Ft),nn)return le.add(nn.key),be(Co,nn.result,!1,{preventScrollReset:Le});let{loaderData:xs,errors:Io}=eN(C,On,Vs,void 0,ko,Ft,we);if(C.fetchers.has(Y)){let Rn=Ja(_t.data);C.fetchers.set(Y,Rn)}bo(Rs),C.navigation.state==="loading"&&Rs>ee?(Pt(I,"Expected pending action"),R&&R.abort(),bt(C.navigation.location,{matches:On,loaderData:xs,errors:Io,fetchers:new Map(C.fetchers)})):(Ge({errors:Io,loaderData:tN(C.loaderData,xs,On,Io),fetchers:new Map(C.fetchers)}),V=!1)}async function Ce(Y,se,de,ye,ze,rt,He,Le,Ke){let je=C.fetchers.get(Y);vt(Y,pp(Ke,je?je.data:void 0),{flushSync:He});let nt=new AbortController,St=Nc(t.history,de,nt.signal);if(rt){let _t=await si(ze,de,St.signal);if(_t.type==="aborted")return;if(_t.type==="error"){Jt(Y,se,_t.error,{flushSync:He});return}else if(_t.matches)ze=_t.matches,ye=Np(ze,de);else{Jt(Y,se,Pr(404,{pathname:de}),{flushSync:He});return}}oe.set(Y,nt);let Et=j,Xt=(await Oe("loader",C,St,[ye],ze,Y))[ye.route.id];if(al(Xt)&&(Xt=await JC(Xt,St.signal,!0)||Xt),oe.get(Y)===nt&&oe.delete(Y),!St.signal.aborted){if(xe.has(Y)){vt(Y,Ja(void 0));return}if(vu(Xt))if(ee>Et){vt(Y,Ja(void 0));return}else{le.add(Y),await be(St,Xt,!1,{preventScrollReset:Le});return}if(ro(Xt)){Jt(Y,se,Xt.error);return}Pt(!al(Xt),"Unhandled fetcher deferred data"),vt(Y,Ja(Xt.data))}}async function be(Y,se,de,ye){let{submission:ze,fetcherSubmission:rt,preventScrollReset:He,replace:Le}=ye===void 0?{}:ye;se.response.headers.has("X-Remix-Revalidate")&&(V=!0);let Ke=se.response.headers.get("Location");Pt(Ke,"Expected a Location header on the redirect Response"),Ke=J$(Ke,new URL(Y.url),l);let je=df(C.location,Ke,{_isRedirect:!0});if(n){let _t=!1;if(se.response.headers.has("X-Remix-Reload-Document"))_t=!0;else if(QC.test(Ke)){const ln=t.history.createURL(Ke);_t=ln.origin!==e.location.origin||Od(ln.pathname,l)==null}if(_t){Le?e.location.replace(Ke):e.location.assign(Ke);return}}R=null;let nt=Le===!0||se.response.headers.has("X-Remix-Replace")?os.Replace:os.Push,{formMethod:St,formAction:Et,formEncType:hn}=C.navigation;!ze&&!rt&&St&&Et&&hn&&(ze=oN(C.navigation));let Xt=ze||rt;if(JU.has(se.response.status)&&Xt&&pi(Xt.formMethod))await Nt(nt,je,{submission:Dn({},Xt,{formAction:Ke}),preventScrollReset:He||T,enableViewTransition:de?_:void 0});else{let _t=fv(je,ze);await Nt(nt,je,{overrideNavigation:_t,fetcherSubmission:rt,preventScrollReset:He||T,enableViewTransition:de?_:void 0})}}async function Oe(Y,se,de,ye,ze,rt){let He,Le={};try{He=await iW(u,Y,se,de,ye,ze,rt,o,r)}catch(Ke){return ye.forEach(je=>{Le[je.route.id]={type:un.error,error:Ke}}),Le}for(let[Ke,je]of Object.entries(He))if(hW(je)){let nt=je.result;Le[Ke]={type:un.redirect,response:uW(nt,de,Ke,ze,l,d.v7_relativeSplatPath)}}else Le[Ke]=await lW(je);return Le}async function at(Y,se,de,ye,ze){let rt=Y.matches,He=Oe("loader",Y,ze,de,se,null),Le=Promise.all(ye.map(async nt=>{if(nt.matches&&nt.match&&nt.controller){let Et=(await Oe("loader",Y,Nc(t.history,nt.path,nt.controller.signal),[nt.match],nt.matches,nt.key))[nt.match.route.id];return{[nt.key]:Et}}else return Promise.resolve({[nt.key]:{type:un.error,error:Pr(404,{pathname:nt.path})}})})),Ke=await He,je=(await Le).reduce((nt,St)=>Object.assign(nt,St),{});return await Promise.all([mW(se,Ke,ze.signal,rt,Y.loaderData),gW(se,je,ye)]),{loaderResults:Ke,fetcherResults:je}}function Tt(){V=!0,H.push(...ti()),fe.forEach((Y,se)=>{oe.has(se)&&Q.add(se),Zs(se)})}function vt(Y,se,de){de===void 0&&(de={}),C.fetchers.set(Y,se),Ge({fetchers:new Map(C.fetchers)},{flushSync:(de&&de.flushSync)===!0})}function Jt(Y,se,de,ye){ye===void 0&&(ye={});let ze=du(C.matches,se);Ts(Y),Ge({errors:{[ze.route.id]:de},fetchers:new Map(C.fetchers)},{flushSync:(ye&&ye.flushSync)===!0})}function Qs(Y){return d.v7_fetcherPersist&&(ge.set(Y,(ge.get(Y)||0)+1),xe.has(Y)&&xe.delete(Y)),C.fetchers.get(Y)||ZU}function Ts(Y){let se=C.fetchers.get(Y);oe.has(Y)&&!(se&&se.state==="loading"&&ie.has(Y))&&Zs(Y),fe.delete(Y),ie.delete(Y),le.delete(Y),xe.delete(Y),Q.delete(Y),C.fetchers.delete(Y)}function Js(Y){if(d.v7_fetcherPersist){let se=(ge.get(Y)||0)-1;se<=0?(ge.delete(Y),xe.add(Y)):ge.set(Y,se)}else Ts(Y);Ge({fetchers:new Map(C.fetchers)})}function Zs(Y){let se=oe.get(Y);se&&(se.abort(),oe.delete(Y))}function Es(Y){for(let se of Y){let de=Qs(se),ye=Ja(de.data);C.fetchers.set(se,ye)}}function to(){let Y=[],se=!1;for(let de of le){let ye=C.fetchers.get(de);Pt(ye,"Expected fetcher: "+de),ye.state==="loading"&&(le.delete(de),Y.push(de),se=!0)}return Es(Y),se}function bo(Y){let se=[];for(let[de,ye]of ie)if(ye<Y){let ze=C.fetchers.get(de);Pt(ze,"Expected fetcher: "+de),ze.state==="loading"&&(Zs(de),ie.delete(de),se.push(de))}return Es(se),se.length>0}function Rr(Y,se){let de=C.blockers.get(Y)||hp;return Ie.get(Y)!==se&&Ie.set(Y,se),de}function ga(Y){C.blockers.delete(Y),Ie.delete(Y)}function Mi(Y,se){let de=C.blockers.get(Y)||hp;Pt(de.state==="unblocked"&&se.state==="blocked"||de.state==="blocked"&&se.state==="blocked"||de.state==="blocked"&&se.state==="proceeding"||de.state==="blocked"&&se.state==="unblocked"||de.state==="proceeding"&&se.state==="unblocked","Invalid blocker state transition: "+de.state+" -> "+se.state);let ye=new Map(C.blockers);ye.set(Y,se),Ge({blockers:ye})}function So(Y){let{currentLocation:se,nextLocation:de,historyAction:ye}=Y;if(Ie.size===0)return;Ie.size>1&&xd(!1,"A router only supports one blocker at a time");let ze=Array.from(Ie.entries()),[rt,He]=ze[ze.length-1],Le=C.blockers.get(rt);if(!(Le&&Le.state==="proceeding")&&He({currentLocation:se,nextLocation:de,historyAction:ye}))return rt}function ei(Y){let se=Pr(404,{pathname:Y}),de=a||i,{matches:ye,route:ze}=sN(de);return ti(),{notFoundMatches:ye,route:ze,error:se}}function ti(Y){let se=[];return we.forEach((de,ye)=>{(!Y||Y(ye))&&(de.cancel(),se.push(ye),we.delete(ye))}),se}function Jl(Y,se,de){if(f=Y,g=se,m=de||null,!y&&C.navigation===pv){y=!0;let ye=Dr(C.location,C.matches);ye!=null&&Ge({restoreScrollPosition:ye})}return()=>{f=null,g=null,m=null}}function Bi(Y,se){return m&&m(Y,se.map(ye=>RU(ye,C.loaderData)))||Y.key}function Zl(Y,se){if(f&&g){let de=Bi(Y,se);f[de]=g()}}function Dr(Y,se){if(f){let de=Bi(Y,se),ye=f[de];if(typeof ye=="number")return ye}return null}function ni(Y,se,de){if(c)if(Y){if(Object.keys(Y[0].params).length>0)return{active:!0,matches:xy(se,de,l,!0)}}else return{active:!0,matches:xy(se,de,l,!0)||[]};return{active:!1,matches:null}}async function si(Y,se,de){if(!c)return{type:"success",matches:Y};let ye=Y;for(;;){let ze=a==null,rt=a||i,He=o;try{await c({path:se,matches:ye,patch:(je,nt)=>{de.aborted||Q$(je,nt,rt,He,r)}})}catch(je){return{type:"error",error:je,partialMatches:ye}}finally{ze&&!de.aborted&&(i=[...i])}if(de.aborted)return{type:"aborted"};let Le=cu(rt,se,l);if(Le)return{type:"success",matches:Le};let Ke=xy(rt,se,l,!0);if(!Ke||ye.length===Ke.length&&ye.every((je,nt)=>je.route.id===Ke[nt].route.id))return{type:"success",matches:null};ye=Ke}}function ya(Y){o={},a=ex(Y,r,void 0,o)}function Vi(Y,se){let de=a==null;Q$(Y,se,a||i,o,r),de&&(i=[...i],Ge({}))}return S={get basename(){return l},get future(){return d},get state(){return C},get routes(){return i},get window(){return e},initialize:qe,subscribe:dt,enableScrollRestoration:Jl,navigate:ut,fetch:ue,revalidate:wt,createHref:Y=>t.history.createHref(Y),encodeLocation:Y=>t.history.encodeLocation(Y),getFetcher:Qs,deleteFetcher:Js,dispose:Ze,getBlocker:Rr,deleteBlocker:ga,patchRoutes:Vi,_internalFetchControllers:oe,_internalActiveDeferreds:we,_internalSetRoutes:ya},S}function nW(t){return t!=null&&("formData"in t&&t.formData!=null||"body"in t&&t.body!==void 0)}function Wb(t,e,n,s,r,o,i,a){let l,u;if(i){l=[];for(let d of e)if(l.push(d),d.route.id===i){u=d;break}}else l=e,u=e[e.length-1];let c=l0(r||".",a0(l,o),Od(t.pathname,n)||t.pathname,a==="path");if(r==null&&(c.search=t.search,c.hash=t.hash),(r==null||r===""||r===".")&&u){let d=ZC(c.search);if(u.route.index&&!d)c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index";else if(!u.route.index&&d){let h=new URLSearchParams(c.search),p=h.getAll("index");h.delete("index"),p.filter(m=>m).forEach(m=>h.append("index",m));let f=h.toString();c.search=f?"?"+f:""}}return s&&n!=="/"&&(c.pathname=c.pathname==="/"?n:Ra([n,c.pathname])),Bu(c)}function K$(t,e,n,s){if(!s||!nW(s))return{path:n};if(s.formMethod&&!fW(s.formMethod))return{path:n,error:Pr(405,{method:s.formMethod})};let r=()=>({path:n,error:Pr(400,{type:"invalid-body"})}),o=s.formMethod||"get",i=t?o.toUpperCase():o.toLowerCase(),a=OA(n);if(s.body!==void 0){if(s.formEncType==="text/plain"){if(!pi(i))return r();let h=typeof s.body=="string"?s.body:s.body instanceof FormData||s.body instanceof URLSearchParams?Array.from(s.body.entries()).reduce((p,f)=>{let[m,g]=f;return""+p+m+"="+g+`
`},""):String(s.body);return{path:n,submission:{formMethod:i,formAction:a,formEncType:s.formEncType,formData:void 0,json:void 0,text:h}}}else if(s.formEncType==="application/json"){if(!pi(i))return r();try{let h=typeof s.body=="string"?JSON.parse(s.body):s.body;return{path:n,submission:{formMethod:i,formAction:a,formEncType:s.formEncType,formData:void 0,json:h,text:void 0}}}catch{return r()}}}Pt(typeof FormData=="function","FormData is not available in this environment");let l,u;if(s.formData)l=Gb(s.formData),u=s.formData;else if(s.body instanceof FormData)l=Gb(s.body),u=s.body;else if(s.body instanceof URLSearchParams)l=s.body,u=Z$(l);else if(s.body==null)l=new URLSearchParams,u=new FormData;else try{l=new URLSearchParams(s.body),u=Z$(l)}catch{return r()}let c={formMethod:i,formAction:a,formEncType:s&&s.formEncType||"application/x-www-form-urlencoded",formData:u,json:void 0,text:void 0};if(pi(c.formMethod))return{path:n,submission:c};let d=Ml(n);return e&&d.search&&ZC(d.search)&&l.append("index",""),d.search="?"+l,{path:Bu(d),submission:c}}function q$(t,e,n){n===void 0&&(n=!1);let s=t.findIndex(r=>r.route.id===e);return s>=0?t.slice(0,n?s+1:s):t}function X$(t,e,n,s,r,o,i,a,l,u,c,d,h,p,f,m){let g=m?ro(m[1])?m[1].error:m[1].data:void 0,y=t.createURL(e.location),x=t.createURL(r),v=n;o&&e.errors?v=q$(n,Object.keys(e.errors)[0],!0):m&&ro(m[1])&&(v=q$(n,m[0]));let b=m?m[1].statusCode:void 0,S=i&&b&&b>=400,C=v.filter((T,R)=>{let{route:_}=T;if(_.lazy)return!0;if(_.loader==null)return!1;if(o)return jb(_,e.loaderData,e.errors);if(sW(e.loaderData,e.matches[R],T)||l.some(O=>O===T.route.id))return!0;let P=e.matches[R],z=T;return Y$(T,Dn({currentUrl:y,currentParams:P.params,nextUrl:x,nextParams:z.params},s,{actionResult:g,actionStatus:b,defaultShouldRevalidate:S?!1:a||y.pathname+y.search===x.pathname+x.search||y.search!==x.search||FA(P,z)}))}),I=[];return d.forEach((T,R)=>{if(o||!n.some(V=>V.route.id===T.routeId)||c.has(R))return;let _=cu(p,T.path,f);if(!_){I.push({key:R,routeId:T.routeId,path:T.path,matches:null,match:null,controller:null});return}let P=e.fetchers.get(R),z=Np(_,T.path),O=!1;h.has(R)?O=!1:u.has(R)?(u.delete(R),O=!0):P&&P.state!=="idle"&&P.data===void 0?O=a:O=Y$(z,Dn({currentUrl:y,currentParams:e.matches[e.matches.length-1].params,nextUrl:x,nextParams:n[n.length-1].params},s,{actionResult:g,actionStatus:b,defaultShouldRevalidate:S?!1:a})),O&&I.push({key:R,routeId:T.routeId,path:T.path,matches:_,match:z,controller:new AbortController})}),[C,I]}function jb(t,e,n){if(t.lazy)return!0;if(!t.loader)return!1;let s=e!=null&&e[t.id]!==void 0,r=n!=null&&n[t.id]!==void 0;return!s&&r?!1:typeof t.loader=="function"&&t.loader.hydrate===!0?!0:!s&&!r}function sW(t,e,n){let s=!e||n.route.id!==e.route.id,r=t[n.route.id]===void 0;return s||r}function FA(t,e){let n=t.route.path;return t.pathname!==e.pathname||n!=null&&n.endsWith("*")&&t.params["*"]!==e.params["*"]}function Y$(t,e){if(t.route.shouldRevalidate){let n=t.route.shouldRevalidate(e);if(typeof n=="boolean")return n}return e.defaultShouldRevalidate}function Q$(t,e,n,s,r){var o;let i;if(t){let u=s[t];Pt(u,"No route found to patch children into: routeId = "+t),u.children||(u.children=[]),i=u.children}else i=n;let a=e.filter(u=>!i.some(c=>PA(u,c))),l=ex(a,r,[t||"_","patch",String(((o=i)==null?void 0:o.length)||"0")],s);i.push(...l)}function PA(t,e){return"id"in t&&"id"in e&&t.id===e.id?!0:t.index===e.index&&t.path===e.path&&t.caseSensitive===e.caseSensitive?(!t.children||t.children.length===0)&&(!e.children||e.children.length===0)?!0:t.children.every((n,s)=>{var r;return(r=e.children)==null?void 0:r.some(o=>PA(n,o))}):!1}async function rW(t,e,n){if(!t.lazy)return;let s=await t.lazy();if(!t.lazy)return;let r=n[t.id];Pt(r,"No route found in manifest");let o={};for(let i in s){let l=r[i]!==void 0&&i!=="hasErrorBoundary";xd(!l,'Route "'+r.id+'" has a static property "'+i+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+i+'" will be ignored.')),!l&&!TU.has(i)&&(o[i]=s[i])}Object.assign(r,o),Object.assign(r,Dn({},e(r),{lazy:void 0}))}async function oW(t){let{matches:e}=t,n=e.filter(r=>r.shouldLoad);return(await Promise.all(n.map(r=>r.resolve()))).reduce((r,o,i)=>Object.assign(r,{[n[i].route.id]:o}),{})}async function iW(t,e,n,s,r,o,i,a,l,u){let c=o.map(p=>p.route.lazy?rW(p.route,l,a):void 0),d=o.map((p,f)=>{let m=c[f],g=r.some(x=>x.route.id===p.route.id);return Dn({},p,{shouldLoad:g,resolve:async x=>(x&&s.method==="GET"&&(p.route.lazy||p.route.loader)&&(g=!0),g?aW(e,s,p,m,x,u):Promise.resolve({type:un.data,result:void 0}))})}),h=await t({matches:d,request:s,params:o[0].params,fetcherKey:i,context:u});try{await Promise.all(c)}catch{}return h}async function aW(t,e,n,s,r,o){let i,a,l=u=>{let c,d=new Promise((f,m)=>c=m);a=()=>c(),e.signal.addEventListener("abort",a);let h=f=>typeof u!="function"?Promise.reject(new Error("You cannot call the handler for a route which defines a boolean "+('"'+t+'" [routeId: '+n.route.id+"]"))):u({request:e,params:n.params,context:o},...f!==void 0?[f]:[]),p=(async()=>{try{return{type:"data",result:await(r?r(m=>h(m)):h())}}catch(f){return{type:"error",result:f}}})();return Promise.race([p,d])};try{let u=n.route[t];if(s)if(u){let c,[d]=await Promise.all([l(u).catch(h=>{c=h}),s]);if(c!==void 0)throw c;i=d}else if(await s,u=n.route[t],u)i=await l(u);else if(t==="action"){let c=new URL(e.url),d=c.pathname+c.search;throw Pr(405,{method:e.method,pathname:d,routeId:n.route.id})}else return{type:un.data,result:void 0};else if(u)i=await l(u);else{let c=new URL(e.url),d=c.pathname+c.search;throw Pr(404,{pathname:d})}Pt(i.result!==void 0,"You defined "+(t==="action"?"an action":"a loader")+" for route "+('"'+n.route.id+"\" but didn't return anything from your `"+t+"` ")+"function. Please return a value or `null`.")}catch(u){return{type:un.error,result:u}}finally{a&&e.signal.removeEventListener("abort",a)}return i}async function lW(t){let{result:e,type:n}=t;if(LA(e)){let u;try{let c=e.headers.get("Content-Type");c&&/\bapplication\/json\b/.test(c)?e.body==null?u=null:u=await e.json():u=await e.text()}catch(c){return{type:un.error,error:c}}return n===un.error?{type:un.error,error:new tx(e.status,e.statusText,u),statusCode:e.status,headers:e.headers}:{type:un.data,data:u,statusCode:e.status,headers:e.headers}}if(n===un.error){if(rN(e)){var s;if(e.data instanceof Error){var r;return{type:un.error,error:e.data,statusCode:(r=e.init)==null?void 0:r.status}}e=new tx(((s=e.init)==null?void 0:s.status)||500,void 0,e.data)}return{type:un.error,error:e,statusCode:u0(e)?e.status:void 0}}if(pW(e)){var o,i;return{type:un.deferred,deferredData:e,statusCode:(o=e.init)==null?void 0:o.status,headers:((i=e.init)==null?void 0:i.headers)&&new Headers(e.init.headers)}}if(rN(e)){var a,l;return{type:un.data,data:e.data,statusCode:(a=e.init)==null?void 0:a.status,headers:(l=e.init)!=null&&l.headers?new Headers(e.init.headers):void 0}}return{type:un.data,data:e}}function uW(t,e,n,s,r,o){let i=t.headers.get("Location");if(Pt(i,"Redirects returned/thrown from loaders/actions must have a Location header"),!QC.test(i)){let a=s.slice(0,s.findIndex(l=>l.route.id===n)+1);i=Wb(new URL(e.url),a,r,!0,i,o),t.headers.set("Location",i)}return t}function J$(t,e,n){if(QC.test(t)){let s=t,r=s.startsWith("//")?new URL(e.protocol+s):new URL(s),o=Od(r.pathname,n)!=null;if(r.origin===e.origin&&o)return r.pathname+r.search+r.hash}return t}function Nc(t,e,n,s){let r=t.createURL(OA(e)).toString(),o={signal:n};if(s&&pi(s.formMethod)){let{formMethod:i,formEncType:a}=s;o.method=i.toUpperCase(),a==="application/json"?(o.headers=new Headers({"Content-Type":a}),o.body=JSON.stringify(s.json)):a==="text/plain"?o.body=s.text:a==="application/x-www-form-urlencoded"&&s.formData?o.body=Gb(s.formData):o.body=s.formData}return new Request(r,o)}function Gb(t){let e=new URLSearchParams;for(let[n,s]of t.entries())e.append(n,typeof s=="string"?s:s.name);return e}function Z$(t){let e=new FormData;for(let[n,s]of t.entries())e.append(n,s);return e}function cW(t,e,n,s,r){let o={},i=null,a,l=!1,u={},c=n&&ro(n[1])?n[1].error:void 0;return t.forEach(d=>{if(!(d.route.id in e))return;let h=d.route.id,p=e[h];if(Pt(!vu(p),"Cannot handle redirect results in processLoaderData"),ro(p)){let f=p.error;c!==void 0&&(f=c,c=void 0),i=i||{};{let m=du(t,h);i[m.route.id]==null&&(i[m.route.id]=f)}o[h]=void 0,l||(l=!0,a=u0(p.error)?p.error.status:500),p.headers&&(u[h]=p.headers)}else al(p)?(s.set(h,p.deferredData),o[h]=p.deferredData.data,p.statusCode!=null&&p.statusCode!==200&&!l&&(a=p.statusCode),p.headers&&(u[h]=p.headers)):(o[h]=p.data,p.statusCode&&p.statusCode!==200&&!l&&(a=p.statusCode),p.headers&&(u[h]=p.headers))}),c!==void 0&&n&&(i={[n[0]]:c},o[n[0]]=void 0),{loaderData:o,errors:i,statusCode:a||200,loaderHeaders:u}}function eN(t,e,n,s,r,o,i){let{loaderData:a,errors:l}=cW(e,n,s,i);return r.forEach(u=>{let{key:c,match:d,controller:h}=u,p=o[c];if(Pt(p,"Did not find corresponding fetcher result"),!(h&&h.signal.aborted))if(ro(p)){let f=du(t.matches,d==null?void 0:d.route.id);l&&l[f.route.id]||(l=Dn({},l,{[f.route.id]:p.error})),t.fetchers.delete(c)}else if(vu(p))Pt(!1,"Unhandled fetcher revalidation redirect");else if(al(p))Pt(!1,"Unhandled fetcher deferred data");else{let f=Ja(p.data);t.fetchers.set(c,f)}}),{loaderData:a,errors:l}}function tN(t,e,n,s){let r=Dn({},e);for(let o of n){let i=o.route.id;if(e.hasOwnProperty(i)?e[i]!==void 0&&(r[i]=e[i]):t[i]!==void 0&&o.route.loader&&(r[i]=t[i]),s&&s.hasOwnProperty(i))break}return r}function nN(t){return t?ro(t[1])?{actionData:{}}:{actionData:{[t[0]]:t[1].data}}:{}}function du(t,e){return(e?t.slice(0,t.findIndex(s=>s.route.id===e)+1):[...t]).reverse().find(s=>s.route.hasErrorBoundary===!0)||t[0]}function sN(t){let e=t.length===1?t[0]:t.find(n=>n.index||!n.path||n.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function Pr(t,e){let{pathname:n,routeId:s,method:r,type:o,message:i}=e===void 0?{}:e,a="Unknown Server Error",l="Unknown @remix-run/router error";return t===400?(a="Bad Request",r&&n&&s?l="You made a "+r+' request to "'+n+'" but '+('did not provide a `loader` for route "'+s+'", ')+"so there is no way to handle the request.":o==="defer-action"?l="defer() is not supported in actions":o==="invalid-body"&&(l="Unable to encode submission body")):t===403?(a="Forbidden",l='Route "'+s+'" does not match URL "'+n+'"'):t===404?(a="Not Found",l='No route matches URL "'+n+'"'):t===405&&(a="Method Not Allowed",r&&n&&s?l="You made a "+r.toUpperCase()+' request to "'+n+'" but '+('did not provide an `action` for route "'+s+'", ')+"so there is no way to handle the request.":r&&(l='Invalid request method "'+r.toUpperCase()+'"')),new tx(t||500,a,new Error(l),!0)}function jg(t){let e=Object.entries(t);for(let n=e.length-1;n>=0;n--){let[s,r]=e[n];if(vu(r))return{key:s,result:r}}}function OA(t){let e=typeof t=="string"?Ml(t):t;return Bu(Dn({},e,{hash:""}))}function dW(t,e){return t.pathname!==e.pathname||t.search!==e.search?!1:t.hash===""?e.hash!=="":t.hash===e.hash?!0:e.hash!==""}function hW(t){return LA(t.result)&&QU.has(t.result.status)}function al(t){return t.type===un.deferred}function ro(t){return t.type===un.error}function vu(t){return(t&&t.type)===un.redirect}function rN(t){return typeof t=="object"&&t!=null&&"type"in t&&"data"in t&&"init"in t&&t.type==="DataWithResponseInit"}function pW(t){let e=t;return e&&typeof e=="object"&&typeof e.data=="object"&&typeof e.subscribe=="function"&&typeof e.cancel=="function"&&typeof e.resolveData=="function"}function LA(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.headers=="object"&&typeof t.body<"u"}function fW(t){return YU.has(t.toLowerCase())}function pi(t){return qU.has(t.toLowerCase())}async function mW(t,e,n,s,r){let o=Object.entries(e);for(let i=0;i<o.length;i++){let[a,l]=o[i],u=t.find(h=>(h==null?void 0:h.route.id)===a);if(!u)continue;let c=s.find(h=>h.route.id===u.route.id),d=c!=null&&!FA(c,u)&&(r&&r[u.route.id])!==void 0;al(l)&&d&&await JC(l,n,!1).then(h=>{h&&(e[a]=h)})}}async function gW(t,e,n){for(let s=0;s<n.length;s++){let{key:r,routeId:o,controller:i}=n[s],a=e[r];t.find(u=>(u==null?void 0:u.route.id)===o)&&al(a)&&(Pt(i,"Expected an AbortController for revalidating fetcher deferred result"),await JC(a,i.signal,!0).then(u=>{u&&(e[r]=u)}))}}async function JC(t,e,n){if(n===void 0&&(n=!1),!await t.deferredData.resolveData(e)){if(n)try{return{type:un.data,data:t.deferredData.unwrappedData}}catch(r){return{type:un.error,error:r}}return{type:un.data,data:t.deferredData.data}}}function ZC(t){return new URLSearchParams(t).getAll("index").some(e=>e==="")}function Np(t,e){let n=typeof e=="string"?Ml(e).search:e.search;if(t[t.length-1].route.index&&ZC(n||""))return t[t.length-1];let s=DA(t);return s[s.length-1]}function oN(t){let{formMethod:e,formAction:n,formEncType:s,text:r,formData:o,json:i}=t;if(!(!e||!n||!s)){if(r!=null)return{formMethod:e,formAction:n,formEncType:s,formData:void 0,json:void 0,text:r};if(o!=null)return{formMethod:e,formAction:n,formEncType:s,formData:o,json:void 0,text:void 0};if(i!==void 0)return{formMethod:e,formAction:n,formEncType:s,formData:void 0,json:i,text:void 0}}}function fv(t,e){return e?{state:"loading",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:t,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function yW(t,e){return{state:"submitting",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function pp(t,e){return t?{state:"loading",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function xW(t,e){return{state:"submitting",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e?e.data:void 0}}function Ja(t){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function wW(t,e){try{let n=t.sessionStorage.getItem(_A);if(n){let s=JSON.parse(n);for(let[r,o]of Object.entries(s||{}))o&&Array.isArray(o)&&e.set(r,new Set(o||[]))}}catch{}}function vW(t,e){if(e.size>0){let n={};for(let[s,r]of e)n[s]=[...r];try{t.sessionStorage.setItem(_A,JSON.stringify(n))}catch(s){xd(!1,"Failed to save applied view transitions in sessionStorage ("+s+").")}}}/**
 * React Router v6.28.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function nx(){return nx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},nx.apply(this,arguments)}const c0=X.createContext(null),zA=X.createContext(null),Bl=X.createContext(null),e2=X.createContext(null),Wa=X.createContext({outlet:null,matches:[],isDataRoute:!1}),MA=X.createContext(null);function bW(t,e){let{relative:n}=e===void 0?{}:e;Ld()||Pt(!1);let{basename:s,navigator:r}=X.useContext(Bl),{hash:o,pathname:i,search:a}=VA(t,{relative:n}),l=i;return s!=="/"&&(l=i==="/"?s:Ra([s,i])),r.createHref({pathname:l,search:a,hash:o})}function Ld(){return X.useContext(e2)!=null}function Vf(){return Ld()||Pt(!1),X.useContext(e2).location}function BA(t){X.useContext(Bl).static||X.useLayoutEffect(t)}function ns(){let{isDataRoute:t}=X.useContext(Wa);return t?FW():SW()}function SW(){Ld()||Pt(!1);let t=X.useContext(c0),{basename:e,future:n,navigator:s}=X.useContext(Bl),{matches:r}=X.useContext(Wa),{pathname:o}=Vf(),i=JSON.stringify(a0(r,n.v7_relativeSplatPath)),a=X.useRef(!1);return BA(()=>{a.current=!0}),X.useCallback(function(u,c){if(c===void 0&&(c={}),!a.current)return;if(typeof u=="number"){s.go(u);return}let d=l0(u,JSON.parse(i),o,c.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Ra([e,d.pathname])),(c.replace?s.replace:s.push)(d,c.state,c)},[e,s,i,o,t])}function CW(){let{matches:t}=X.useContext(Wa),e=t[t.length-1];return e?e.params:{}}function VA(t,e){let{relative:n}=e===void 0?{}:e,{future:s}=X.useContext(Bl),{matches:r}=X.useContext(Wa),{pathname:o}=Vf(),i=JSON.stringify(a0(r,s.v7_relativeSplatPath));return X.useMemo(()=>l0(t,JSON.parse(i),o,n==="path"),[t,i,o,n])}function kW(t,e,n,s){Ld()||Pt(!1);let{navigator:r}=X.useContext(Bl),{matches:o}=X.useContext(Wa),i=o[o.length-1],a=i?i.params:{};i&&i.pathname;let l=i?i.pathnameBase:"/";i&&i.route;let u=Vf(),c;c=u;let d=c.pathname||"/",h=d;if(l!=="/"){let m=l.replace(/^\//,"").split("/");h="/"+d.replace(/^\//,"").split("/").slice(m.length).join("/")}let p=cu(t,{pathname:h});return EW(p&&p.map(m=>Object.assign({},m,{params:Object.assign({},a,m.params),pathname:Ra([l,r.encodeLocation?r.encodeLocation(m.pathname).pathname:m.pathname]),pathnameBase:m.pathnameBase==="/"?l:Ra([l,r.encodeLocation?r.encodeLocation(m.pathnameBase).pathname:m.pathnameBase])})),o,n,s)}function IW(){let t=_W(),e=u0(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return X.createElement(X.Fragment,null,X.createElement("h2",null,"Unexpected Application Error!"),X.createElement("h3",{style:{fontStyle:"italic"}},e),n?X.createElement("pre",{style:r},n):null,null)}const $W=X.createElement(IW,null);class NW extends X.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?X.createElement(Wa.Provider,{value:this.props.routeContext},X.createElement(MA.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function TW(t){let{routeContext:e,match:n,children:s}=t,r=X.useContext(c0);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),X.createElement(Wa.Provider,{value:e},s)}function EW(t,e,n,s){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),s===void 0&&(s=null),t==null){var o;if(!n)return null;if(n.errors)t=n.matches;else if((o=s)!=null&&o.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,a=(r=n)==null?void 0:r.errors;if(a!=null){let c=i.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);c>=0||Pt(!1),i=i.slice(0,Math.min(i.length,c+1))}let l=!1,u=-1;if(n&&s&&s.v7_partialHydration)for(let c=0;c<i.length;c++){let d=i[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(u=c),d.route.id){let{loaderData:h,errors:p}=n,f=d.route.loader&&h[d.route.id]===void 0&&(!p||p[d.route.id]===void 0);if(d.route.lazy||f){l=!0,u>=0?i=i.slice(0,u+1):i=[i[0]];break}}}return i.reduceRight((c,d,h)=>{let p,f=!1,m=null,g=null;n&&(p=a&&d.route.id?a[d.route.id]:void 0,m=d.route.errorElement||$W,l&&(u<0&&h===0?(f=!0,g=null):u===h&&(f=!0,g=d.route.hydrateFallbackElement||null)));let y=e.concat(i.slice(0,h+1)),x=()=>{let v;return p?v=m:f?v=g:d.route.Component?v=X.createElement(d.route.Component,null):d.route.element?v=d.route.element:v=c,X.createElement(TW,{match:d,routeContext:{outlet:c,matches:y,isDataRoute:n!=null},children:v})};return n&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?X.createElement(NW,{location:n.location,revalidation:n.revalidation,component:m,error:p,children:x(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):x()},null)}var UA=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(UA||{}),sx=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(sx||{});function RW(t){let e=X.useContext(c0);return e||Pt(!1),e}function DW(t){let e=X.useContext(zA);return e||Pt(!1),e}function AW(t){let e=X.useContext(Wa);return e||Pt(!1),e}function WA(t){let e=AW(),n=e.matches[e.matches.length-1];return n.route.id||Pt(!1),n.route.id}function _W(){var t;let e=X.useContext(MA),n=DW(sx.UseRouteError),s=WA(sx.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[s]}function FW(){let{router:t}=RW(UA.UseNavigateStable),e=WA(sx.UseNavigateStable),n=X.useRef(!1);return BA(()=>{n.current=!0}),X.useCallback(function(r,o){o===void 0&&(o={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,nx({fromRouteId:e},o)))},[t,e])}const iN={};function PW(t,e){iN[e]||(iN[e]=!0,console.warn(e))}const Tc=(t,e,n)=>PW(t,"⚠️ React Router Future Flag Warning: "+e+". "+("You can use the `"+t+"` future flag to opt-in early. ")+("For more information, see "+n+"."));function OW(t,e){t!=null&&t.v7_startTransition||Tc("v7_startTransition","React Router will begin wrapping state updates in `React.startTransition` in v7","https://reactrouter.com/v6/upgrading/future#v7_starttransition"),!(t!=null&&t.v7_relativeSplatPath)&&(!e||!e.v7_relativeSplatPath)&&Tc("v7_relativeSplatPath","Relative route resolution within Splat routes is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_relativesplatpath"),e&&(e.v7_fetcherPersist||Tc("v7_fetcherPersist","The persistence behavior of fetchers is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_fetcherpersist"),e.v7_normalizeFormMethod||Tc("v7_normalizeFormMethod","Casing of `formMethod` fields is being normalized to uppercase in v7","https://reactrouter.com/v6/upgrading/future#v7_normalizeformmethod"),e.v7_partialHydration||Tc("v7_partialHydration","`RouterProvider` hydration behavior is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_partialhydration"),e.v7_skipActionErrorRevalidation||Tc("v7_skipActionErrorRevalidation","The revalidation behavior after 4xx/5xx `action` responses is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_skipactionerrorrevalidation"))}function LW(t){let{to:e,replace:n,state:s,relative:r}=t;Ld()||Pt(!1);let{future:o,static:i}=X.useContext(Bl),{matches:a}=X.useContext(Wa),{pathname:l}=Vf(),u=ns(),c=l0(e,a0(a,o.v7_relativeSplatPath),l,r==="path"),d=JSON.stringify(c);return X.useEffect(()=>u(JSON.parse(d),{replace:n,state:s,relative:r}),[u,d,r,n,s]),null}function zW(t){let{basename:e="/",children:n=null,location:s,navigationType:r=os.Pop,navigator:o,static:i=!1,future:a}=t;Ld()&&Pt(!1);let l=e.replace(/^\/*/,"/"),u=X.useMemo(()=>({basename:l,navigator:o,static:i,future:nx({v7_relativeSplatPath:!1},a)}),[l,a,o,i]);typeof s=="string"&&(s=Ml(s));let{pathname:c="/",search:d="",hash:h="",state:p=null,key:f="default"}=s,m=X.useMemo(()=>{let g=Od(c,l);return g==null?null:{location:{pathname:g,search:d,hash:h,state:p,key:f},navigationType:r}},[l,c,d,h,p,f,r]);return m==null?null:X.createElement(Bl.Provider,{value:u},X.createElement(e2.Provider,{children:n,value:m}))}new Promise(()=>{});function MW(t){let e={hasErrorBoundary:t.ErrorBoundary!=null||t.errorElement!=null};return t.Component&&Object.assign(e,{element:X.createElement(t.Component),Component:void 0}),t.HydrateFallback&&Object.assign(e,{hydrateFallbackElement:X.createElement(t.HydrateFallback),HydrateFallback:void 0}),t.ErrorBoundary&&Object.assign(e,{errorElement:X.createElement(t.ErrorBoundary),ErrorBoundary:void 0}),e}/**
 * React Router DOM v6.28.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function hf(){return hf=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},hf.apply(this,arguments)}function BW(t,e){if(t==null)return{};var n={},s=Object.keys(t),r,o;for(o=0;o<s.length;o++)r=s[o],!(e.indexOf(r)>=0)&&(n[r]=t[r]);return n}function VW(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function UW(t,e){return t.button===0&&(!e||e==="_self")&&!VW(t)}const WW=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],jW="6";try{window.__reactRouterVersion=jW}catch{}function GW(t,e){return tW({basename:e==null?void 0:e.basename,future:hf({},e==null?void 0:e.future,{v7_prependBasename:!0}),history:IU({window:e==null?void 0:e.window}),hydrationData:(e==null?void 0:e.hydrationData)||HW(),routes:t,mapRouteProperties:MW,dataStrategy:e==null?void 0:e.dataStrategy,patchRoutesOnNavigation:e==null?void 0:e.patchRoutesOnNavigation,window:e==null?void 0:e.window}).initialize()}function HW(){var t;let e=(t=window)==null?void 0:t.__staticRouterHydrationData;return e&&e.errors&&(e=hf({},e,{errors:KW(e.errors)})),e}function KW(t){if(!t)return null;let e=Object.entries(t),n={};for(let[s,r]of e)if(r&&r.__type==="RouteErrorResponse")n[s]=new tx(r.status,r.statusText,r.data,r.internal===!0);else if(r&&r.__type==="Error"){if(r.__subType){let o=window[r.__subType];if(typeof o=="function")try{let i=new o(r.message);i.stack="",n[s]=i}catch{}}if(n[s]==null){let o=new Error(r.message);o.stack="",n[s]=o}}else n[s]=r;return n}const qW=X.createContext({isTransitioning:!1}),XW=X.createContext(new Map),YW="startTransition",aN=h4[YW],QW="flushSync",lN=kU[QW];function JW(t){aN?aN(t):t()}function fp(t){lN?lN(t):t()}class ZW{constructor(){this.status="pending",this.promise=new Promise((e,n)=>{this.resolve=s=>{this.status==="pending"&&(this.status="resolved",e(s))},this.reject=s=>{this.status==="pending"&&(this.status="rejected",n(s))}})}}function ej(t){let{fallbackElement:e,router:n,future:s}=t,[r,o]=X.useState(n.state),[i,a]=X.useState(),[l,u]=X.useState({isTransitioning:!1}),[c,d]=X.useState(),[h,p]=X.useState(),[f,m]=X.useState(),g=X.useRef(new Map),{v7_startTransition:y}=s||{},x=X.useCallback(T=>{y?JW(T):T()},[y]),v=X.useCallback((T,R)=>{let{deletedFetchers:_,flushSync:P,viewTransitionOpts:z}=R;_.forEach(V=>g.current.delete(V)),T.fetchers.forEach((V,H)=>{V.data!==void 0&&g.current.set(H,V.data)});let O=n.window==null||n.window.document==null||typeof n.window.document.startViewTransition!="function";if(!z||O){P?fp(()=>o(T)):x(()=>o(T));return}if(P){fp(()=>{h&&(c&&c.resolve(),h.skipTransition()),u({isTransitioning:!0,flushSync:!0,currentLocation:z.currentLocation,nextLocation:z.nextLocation})});let V=n.window.document.startViewTransition(()=>{fp(()=>o(T))});V.finished.finally(()=>{fp(()=>{d(void 0),p(void 0),a(void 0),u({isTransitioning:!1})})}),fp(()=>p(V));return}h?(c&&c.resolve(),h.skipTransition(),m({state:T,currentLocation:z.currentLocation,nextLocation:z.nextLocation})):(a(T),u({isTransitioning:!0,flushSync:!1,currentLocation:z.currentLocation,nextLocation:z.nextLocation}))},[n.window,h,c,g,x]);X.useLayoutEffect(()=>n.subscribe(v),[n,v]),X.useEffect(()=>{l.isTransitioning&&!l.flushSync&&d(new ZW)},[l]),X.useEffect(()=>{if(c&&i&&n.window){let T=i,R=c.promise,_=n.window.document.startViewTransition(async()=>{x(()=>o(T)),await R});_.finished.finally(()=>{d(void 0),p(void 0),a(void 0),u({isTransitioning:!1})}),p(_)}},[x,i,c,n.window]),X.useEffect(()=>{c&&i&&r.location.key===i.location.key&&c.resolve()},[c,h,r.location,i]),X.useEffect(()=>{!l.isTransitioning&&f&&(a(f.state),u({isTransitioning:!0,flushSync:!1,currentLocation:f.currentLocation,nextLocation:f.nextLocation}),m(void 0))},[l.isTransitioning,f]),X.useEffect(()=>{},[]);let b=X.useMemo(()=>({createHref:n.createHref,encodeLocation:n.encodeLocation,go:T=>n.navigate(T),push:(T,R,_)=>n.navigate(T,{state:R,preventScrollReset:_==null?void 0:_.preventScrollReset}),replace:(T,R,_)=>n.navigate(T,{replace:!0,state:R,preventScrollReset:_==null?void 0:_.preventScrollReset})}),[n]),S=n.basename||"/",C=X.useMemo(()=>({router:n,navigator:b,static:!1,basename:S}),[n,b,S]),I=X.useMemo(()=>({v7_relativeSplatPath:n.future.v7_relativeSplatPath}),[n.future.v7_relativeSplatPath]);return X.useEffect(()=>OW(s,n.future),[s,n.future]),X.createElement(X.Fragment,null,X.createElement(c0.Provider,{value:C},X.createElement(zA.Provider,{value:r},X.createElement(XW.Provider,{value:g.current},X.createElement(qW.Provider,{value:l},X.createElement(zW,{basename:S,location:r.location,navigationType:r.historyAction,navigator:b,future:I},r.initialized||n.future.v7_partialHydration?X.createElement(tj,{routes:n.routes,future:n.future,state:r}):e))))),null)}const tj=X.memo(nj);function nj(t){let{routes:e,future:n,state:s}=t;return kW(e,void 0,s,n)}const sj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",rj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,oj=X.forwardRef(function(e,n){let{onClick:s,relative:r,reloadDocument:o,replace:i,state:a,target:l,to:u,preventScrollReset:c,viewTransition:d}=e,h=BW(e,WW),{basename:p}=X.useContext(Bl),f,m=!1;if(typeof u=="string"&&rj.test(u)&&(f=u,sj))try{let v=new URL(window.location.href),b=u.startsWith("//")?new URL(v.protocol+u):new URL(u),S=Od(b.pathname,p);b.origin===v.origin&&S!=null?u=S+b.search+b.hash:m=!0}catch{}let g=bW(u,{relative:r}),y=ij(u,{replace:i,state:a,target:l,preventScrollReset:c,relative:r,viewTransition:d});function x(v){s&&s(v),v.defaultPrevented||y(v)}return X.createElement("a",hf({},h,{href:f||g,onClick:m||o?s:x,ref:n,target:l}))});var uN;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(uN||(uN={}));var cN;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(cN||(cN={}));function ij(t,e){let{target:n,replace:s,state:r,preventScrollReset:o,relative:i,viewTransition:a}=e===void 0?{}:e,l=ns(),u=Vf(),c=VA(t,{relative:i});return X.useCallback(d=>{if(UW(d,n)){d.preventDefault();let h=s!==void 0?s:Bu(u)===Bu(c);l(t,{replace:h,state:r,preventScrollReset:o,relative:i,viewTransition:a})}},[u,l,c,s,r,n,t,o,i,a])}const t2=()=>{const t=ns(),[e,n]=X.useState(!1);return E.jsxs("nav",{className:"w-full h-16 bg-[#1f0729] flex items-center max-md:hidden",children:[e&&E.jsx("div",{className:"fixed inset-0 z-30 bg-black bg-opacity-50 backdrop-blur-sm flex justify-center items-center",children:E.jsxs("div",{className:"w-auto max-w-md bg-white rounded-lg text-[#1f0729] font-bold relative p-6 shadow-lg border border-gray-300",children:[E.jsx("div",{id:"text",className:"text-center text-lg"}),E.jsx("div",{className:"bg-red-600 mt-6 px-6 py-2 flex items-center justify-center text-[17px] text-white rounded-full cursor-pointer hover:bg-red-500 mx-auto w-24",onClick:()=>{n(!1)},children:"Close"})]})}),E.jsxs("ul",{className:"text-white font-dm-sans flex w-screen justify-around rounded-full",children:[E.jsx("li",{className:"hover:cursor-pointer hover:text-yellow-400",onClick:()=>t("/"),children:"Home"}),E.jsx("li",{className:"hover:cursor-pointer hover:text-yellow-400",onClick:()=>{n(!0),setTimeout(()=>{document.querySelector("#text").innerHTML="<p>Email: <span class='font-normal'><br>romani2181.be22@chitkara.edu.in<br>ananya1258.be22@chitkara.edu.in<br>aditya67.be22@chitkara.edu.in<br>ruhani2194.be22@chitkara.edu.in</span></p>"},0)},children:"Contact"}),E.jsx("li",{className:"hover:cursor-pointer hover:text-yellow-400",onClick:()=>{n(!0),setTimeout(()=>{document.querySelector("#text").innerHTML="<p class='font-normal text-base text-center'>We are a team of full-stack developers building user-friendly and scalable web applications. This project showcases our collaboration, technical skills, and commitment to delivering high-quality solutions.</p>"},0)},children:"About us"}),E.jsx("li",{className:"hover:cursor-pointer hover:text-yellow-400",onClick:()=>{n(!0),setTimeout(()=>{document.querySelector("#text").innerHTML="<p class='font-normal text-base text-center'>This app has all the essential micro and macronutients data available for you to track your fitness needs. Whether you want to gain or loss the weight this app will guide you throughout achieving your fitness goals</p>"},0)},children:"Guide"})]})]})};function n2(){const t=ns(),[e,n]=X.useState(!1);return E.jsxs("div",{className:"h-screen w-[12vw] bg-[#1f0729] top-0 left-0 md:hidden flex flex-col items-center",children:[E.jsx("i",{className:"fa-solid fa-house text-white text-lg my-8 cursor-pointer m-4",onClick:()=>t("/activity")}),E.jsx("i",{className:"fa-solid fa-phone text-white text-lg my-8 cursor-pointer m-4",onClick:()=>{n(!0),setTimeout(()=>{document.querySelector("#text").innerHTML="<p>Email: <span class='font-normal'><br>romani2181.be22@chitkara.edu.in<br>ananya1258.be22@chitkara.edu.in<br>aditya67.be22@chitkara.edu.in<br>ruhani2194.be22@chitkara.edu.in</span></p>"},0)}}),E.jsx("i",{className:"fa-solid fa-child text-white text-lg my-8 cursor-pointer m-4 ",onClick:()=>{n(!0),setTimeout(()=>{document.querySelector("#text").innerHTML="<p class='font-normal text-base text-center'>We are a team of full-stack developers building user-friendly and scalable web applications. This project showcases our collaboration, technical skills, and commitment to delivering high-quality solutions.</p>"},0)}}),E.jsx("i",{className:"fa-solid fa-book-open text-white text-lg my-8 cursor-pointer m-4 ",onClick:()=>{n(!0),setTimeout(()=>{document.querySelector("#text").innerHTML="<p class='font-normal text-base text-center'>This app has all the essential micro and macronutients data available for you to track your fitness needs. Whether you want to gain or loss the weight this app will guide you throughout achieving your fitness goals</p>"},0)}}),e&&E.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-10 flex justify-center items-center",children:E.jsxs("div",{className:"w-auto max-w-md bg-white rounded-lg text-[#1f0729] font-bold relative p-6 shadow-lg border border-gray-300",children:[E.jsx("div",{id:"text",className:"text-center text-lg"}),E.jsx("div",{className:"bg-red-600 mt-6 px-6 py-2 flex items-center justify-center text-[17px] text-white rounded-full cursor-pointer hover:bg-red-500 mx-auto w-24",onClick:()=>{n(!1)},children:"Close"})]})})]})}function aj(){const t=ns();return E.jsx(E.Fragment,{children:E.jsxs("div",{className:"h-screen bg-[#30093f] p-0 m-0",children:[E.jsx(t2,{}),E.jsxs("div",{className:"md:w-full",children:[E.jsx(n2,{}),E.jsxs("div",{className:"relative",children:[E.jsx("div",{className:"absolute w-full h-full",children:E.jsxs("video",{className:"absolute top-0 left-0 w-full h-full object-cover z-0 blur-[8px]",autoPlay:!0,loop:!0,muted:!0,children:[E.jsx("source",{src:"src/5319438-uhd_3840_2160_25fps.mp4",type:"video/mp4"}),"Your browser does not support the video tag."]})}),E.jsxs("div",{className:"flex flex-col items-center justify-center h-screen text-center relative z-20",children:[E.jsx("p",{className:"text-5xl font-bold text-[#FFFFFF] ",children:"Start Your Fitness Journey Today"}),E.jsx("p",{className:"text-lg text-[#FFFFFF] pt-5 opacity-80 max-w-[700px] mx-auto",children:"Transform your life with personalized workout plans, expert advice, and tools to track your progress. Our platform supports every step of your fitness journey!"}),E.jsx("button",{onClick:()=>{t("/signin")},className:"mt-6 px-8 py-4 bg-[#1f0729] text-white rounded-full font-semibold text-lg transition-all hover:bg-yellow-400 hover:text-[#1f0729]",children:"Join Now"})]})]})]}),E.jsxs("div",{className:"bg-[#30093f] text-center py-20",children:[E.jsx("h2",{className:"text-4xl font-semibold text-white mb-6 max-w-4xl mx-auto",children:"Our Fitness Story"}),E.jsx("p",{className:"text-lg text-[#D0A7D3] max-w-4xl mx-auto leading-relaxed px-4 md:px-0",children:"At Fitness Journey, our mission is to help individuals transform their lives through physical fitness. Whether you're just starting or have been working out for years, we are here to guide you towards better health and a stronger body. With customized fitness programs and expert advice, our team of professionals is committed to empowering you to take control of your health. Join our community and become the best version of yourself today!"})]}),E.jsxs("div",{className:"text-center bg-[#30093f]",children:[E.jsx("h2",{className:"text-4xl font-semibold text-white mb-8 animate__animated animate__fadeIn animate__delay-3s",children:"Explore Our Fitness Programs"}),E.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 ml-3 mr-3",children:[E.jsxs("div",{className:"bg-[#1f0729] p-6 rounded-lg shadow-md flex flex-col justify-between min-h-[300px] animate__animated animate__fadeIn animate__delay-3s",children:[E.jsx("h3",{className:"text-2xl font-semibold text-white",children:"Strength Training"}),E.jsx("p",{className:"text-lg text-[#D0A7D3] mt-4",children:"Build muscle and boost your metabolism with a structured strength training routine. Start with bodyweight exercises and progress to weight training."}),E.jsx("div",{className:"mt-6 text-6xl text-yellow-400",children:E.jsx("i",{className:"fas fa-dumbbell"})})]}),E.jsxs("div",{className:"bg-[#1f0729] p-6 rounded-lg shadow-md flex flex-col justify-between min-h-[300px] animate__animated animate__fadeIn animate__delay-3.5s",children:[E.jsx("h3",{className:"text-2xl font-semibold text-white",children:"Cardio Workouts"}),E.jsx("p",{className:"text-lg text-[#D0A7D3] mt-4",children:"Improve heart health and burn fat with high-intensity interval training (HIIT) or low-intensity steady-state cardio workouts."}),E.jsx("div",{className:"mt-6 text-6xl text-yellow-400",children:E.jsx("i",{className:"fas fa-running"})})]}),E.jsxs("div",{className:"bg-[#1f0729] p-6 rounded-lg shadow-md flex flex-col justify-between min-h-[300px] animate__animated animate__fadeIn animate__delay-4s",children:[E.jsx("h3",{className:"text-2xl font-semibold text-white",children:"Yoga & Flexibility"}),E.jsx("p",{className:"text-lg text-[#D0A7D3] mt-4",children:"Increase flexibility, reduce stress, and enhance your range of motion with guided yoga sessions."}),E.jsx("div",{className:"mt-6 text-6xl text-yellow-400",children:E.jsx("i",{className:"fas fa-spa"})})]})]})]}),E.jsxs("div",{className:"bg-[#30093f] py-16 w-full",children:[E.jsx("h2",{className:"text-4xl font-semibold text-white text-center mb-8",children:"What Our Users Say"}),E.jsx("div",{className:"w-full mx-auto overflow-x-auto",children:E.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[E.jsxs("div",{className:"bg-[#1f0729] p-6 rounded-xl shadow-md w-80 h-auto flex flex-col justify-between",children:[E.jsxs("div",{className:"flex items-center space-x-2",children:[E.jsx("div",{className:"text-yellow-400",children:"⭐⭐⭐⭐⭐"}),E.jsx("p",{className:"text-sm text-[#D0A7D3] mt-1",children:"- Sarah L."})]}),E.jsx("p",{className:"text-lg text-white mt-4",children:'"Fitness Journey has truly changed my life! The workouts are easy to follow, and the community is so supportive."'})]}),E.jsxs("div",{className:"bg-[#1f0729] p-6 rounded-xl shadow-md w-80 h-auto flex flex-col justify-between",children:[E.jsxs("div",{className:"flex items-center space-x-2",children:[E.jsx("div",{className:"text-yellow-400",children:"⭐⭐⭐⭐"}),E.jsx("p",{className:"text-sm text-[#D0A7D3] mt-1",children:"- John D."})]}),E.jsx("p",{className:"text-lg text-white mt-4",children:'"I love the personalized fitness plans. It helped me stay on track and finally reach my goals!"'})]}),E.jsxs("div",{className:"bg-[#1f0729] p-6 rounded-xl shadow-md w-80 h-auto flex flex-col justify-between",children:[E.jsxs("div",{className:"flex items-center space-x-2",children:[E.jsx("div",{className:"text-yellow-400",children:"⭐⭐⭐⭐⭐"}),E.jsx("p",{className:"text-sm text-[#D0A7D3] mt-1",children:"- Emily G."})]}),E.jsx("p",{className:"text-lg text-white mt-4",children:'"The strength training program is amazing! I feel stronger and more confident every day."'})]}),E.jsxs("div",{className:"bg-[#1f0729] p-6 rounded-xl shadow-md w-80 h-auto flex flex-col justify-between",children:[E.jsxs("div",{className:"flex items-center space-x-2",children:[E.jsx("div",{className:"text-yellow-400",children:"⭐⭐⭐⭐⭐"}),E.jsx("p",{className:"text-sm text-[#D0A7D3] mt-1",children:"- Mark T."})]}),E.jsx("p",{className:"text-lg text-white mt-4",children:'"Yoga & Flexibility sessions are fantastic. They helped me reduce stress and improve my flexibility."'})]})]})})]}),E.jsx("hr",{}),E.jsxs("footer",{className:"bg-[#1f0729] text-white py-8 text-center",children:[E.jsx("p",{className:"text-xl",children:"© 2025 Fitness Journey | All Rights Reserved"}),E.jsx("p",{className:"text-lg opacity-70",children:"Privacy Policy | Terms of Service"})]})]})})}var Uf=t=>t.type==="checkbox",bu=t=>t instanceof Date,yr=t=>t==null;const jA=t=>typeof t=="object";var ts=t=>!yr(t)&&!Array.isArray(t)&&jA(t)&&!bu(t),lj=t=>ts(t)&&t.target?Uf(t.target)?t.target.checked:t.target.value:t,uj=t=>t.substring(0,t.search(/\.\d+(\.|$)/))||t,cj=(t,e)=>t.has(uj(e)),dj=t=>{const e=t.constructor&&t.constructor.prototype;return ts(e)&&e.hasOwnProperty("isPrototypeOf")},s2=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ro(t){let e;const n=Array.isArray(t);if(t instanceof Date)e=new Date(t);else if(t instanceof Set)e=new Set(t);else if(!(s2&&(t instanceof Blob||t instanceof FileList))&&(n||ts(t)))if(e=n?[]:{},!n&&!dj(t))e=t;else for(const s in t)t.hasOwnProperty(s)&&(e[s]=Ro(t[s]));else return t;return e}var d0=t=>Array.isArray(t)?t.filter(Boolean):[],Qn=t=>t===void 0,et=(t,e,n)=>{if(!e||!ts(t))return n;const s=d0(e.split(/[,[\].]+?/)).reduce((r,o)=>yr(r)?r:r[o],t);return Qn(s)||s===t?Qn(t[e])?n:t[e]:s},Ki=t=>typeof t=="boolean",r2=t=>/^\w*$/.test(t),GA=t=>d0(t.replace(/["|']|\]/g,"").split(/\.|\[/)),$n=(t,e,n)=>{let s=-1;const r=r2(e)?[e]:GA(e),o=r.length,i=o-1;for(;++s<o;){const a=r[s];let l=n;if(s!==i){const u=t[a];l=ts(u)||Array.isArray(u)?u:isNaN(+r[s+1])?{}:[]}if(a==="__proto__")return;t[a]=l,t=t[a]}return t};const dN={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},yi={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},wa={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};no.createContext(null);var hj=(t,e,n,s=!0)=>{const r={defaultValues:e._defaultValues};for(const o in t)Object.defineProperty(r,o,{get:()=>{const i=o;return e._proxyFormState[i]!==yi.all&&(e._proxyFormState[i]=!s||yi.all),t[i]}});return r},Or=t=>ts(t)&&!Object.keys(t).length,pj=(t,e,n,s)=>{n(t);const{name:r,...o}=t;return Or(o)||Object.keys(o).length>=Object.keys(e).length||Object.keys(o).find(i=>e[i]===yi.all)},wy=t=>Array.isArray(t)?t:[t];function fj(t){const e=no.useRef(t);e.current=t,no.useEffect(()=>{const n=!t.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{n&&n.unsubscribe()}},[t.disabled])}var Zi=t=>typeof t=="string",mj=(t,e,n,s,r)=>Zi(t)?(s&&e.watch.add(t),et(n,t,r)):Array.isArray(t)?t.map(o=>(s&&e.watch.add(o),et(n,o))):(s&&(e.watchAll=!0),n),gj=(t,e,n,s,r)=>e?{...n[t],types:{...n[t]&&n[t].types?n[t].types:{},[s]:r||!0}}:{},hN=t=>({isOnSubmit:!t||t===yi.onSubmit,isOnBlur:t===yi.onBlur,isOnChange:t===yi.onChange,isOnAll:t===yi.all,isOnTouch:t===yi.onTouched}),pN=(t,e,n)=>!n&&(e.watchAll||e.watch.has(t)||[...e.watch].some(s=>t.startsWith(s)&&/^\.\w+/.test(t.slice(s.length))));const jp=(t,e,n,s)=>{for(const r of n||Object.keys(t)){const o=et(t,r);if(o){const{_f:i,...a}=o;if(i){if(i.refs&&i.refs[0]&&e(i.refs[0],r)&&!s)return!0;if(i.ref&&e(i.ref,i.name)&&!s)return!0;if(jp(a,e))break}else if(ts(a)&&jp(a,e))break}}};var yj=(t,e,n)=>{const s=wy(et(t,n));return $n(s,"root",e[n]),$n(t,n,s),t},o2=t=>t.type==="file",Ji=t=>typeof t=="function",rx=t=>{if(!s2)return!1;const e=t?t.ownerDocument:0;return t instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},vy=t=>Zi(t),i2=t=>t.type==="radio",ox=t=>t instanceof RegExp;const fN={value:!1,isValid:!1},mN={value:!0,isValid:!0};var HA=t=>{if(Array.isArray(t)){if(t.length>1){const e=t.filter(n=>n&&n.checked&&!n.disabled).map(n=>n.value);return{value:e,isValid:!!e.length}}return t[0].checked&&!t[0].disabled?t[0].attributes&&!Qn(t[0].attributes.value)?Qn(t[0].value)||t[0].value===""?mN:{value:t[0].value,isValid:!0}:mN:fN}return fN};const gN={isValid:!1,value:null};var KA=t=>Array.isArray(t)?t.reduce((e,n)=>n&&n.checked&&!n.disabled?{isValid:!0,value:n.value}:e,gN):gN;function yN(t,e,n="validate"){if(vy(t)||Array.isArray(t)&&t.every(vy)||Ki(t)&&!t)return{type:n,message:vy(t)?t:"",ref:e}}var Ec=t=>ts(t)&&!ox(t)?t:{value:t,message:""},xN=async(t,e,n,s,r)=>{const{ref:o,refs:i,required:a,maxLength:l,minLength:u,min:c,max:d,pattern:h,validate:p,name:f,valueAsNumber:m,mount:g,disabled:y}=t._f,x=et(e,f);if(!g||y)return{};const v=i?i[0]:o,b=z=>{s&&v.reportValidity&&(v.setCustomValidity(Ki(z)?"":z||""),v.reportValidity())},S={},C=i2(o),I=Uf(o),T=C||I,R=(m||o2(o))&&Qn(o.value)&&Qn(x)||rx(o)&&o.value===""||x===""||Array.isArray(x)&&!x.length,_=gj.bind(null,f,n,S),P=(z,O,V,H=wa.maxLength,Q=wa.minLength)=>{const oe=z?O:V;S[f]={type:z?H:Q,message:oe,ref:o,..._(z?H:Q,oe)}};if(r?!Array.isArray(x)||!x.length:a&&(!T&&(R||yr(x))||Ki(x)&&!x||I&&!HA(i).isValid||C&&!KA(i).isValid)){const{value:z,message:O}=vy(a)?{value:!!a,message:a}:Ec(a);if(z&&(S[f]={type:wa.required,message:O,ref:v,..._(wa.required,O)},!n))return b(O),S}if(!R&&(!yr(c)||!yr(d))){let z,O;const V=Ec(d),H=Ec(c);if(!yr(x)&&!isNaN(x)){const Q=o.valueAsNumber||x&&+x;yr(V.value)||(z=Q>V.value),yr(H.value)||(O=Q<H.value)}else{const Q=o.valueAsDate||new Date(x),oe=ie=>new Date(new Date().toDateString()+" "+ie),j=o.type=="time",ee=o.type=="week";Zi(V.value)&&x&&(z=j?oe(x)>oe(V.value):ee?x>V.value:Q>new Date(V.value)),Zi(H.value)&&x&&(O=j?oe(x)<oe(H.value):ee?x<H.value:Q<new Date(H.value))}if((z||O)&&(P(!!z,V.message,H.message,wa.max,wa.min),!n))return b(S[f].message),S}if((l||u)&&!R&&(Zi(x)||r&&Array.isArray(x))){const z=Ec(l),O=Ec(u),V=!yr(z.value)&&x.length>+z.value,H=!yr(O.value)&&x.length<+O.value;if((V||H)&&(P(V,z.message,O.message),!n))return b(S[f].message),S}if(h&&!R&&Zi(x)){const{value:z,message:O}=Ec(h);if(ox(z)&&!x.match(z)&&(S[f]={type:wa.pattern,message:O,ref:o,..._(wa.pattern,O)},!n))return b(O),S}if(p){if(Ji(p)){const z=await p(x,e),O=yN(z,v);if(O&&(S[f]={...O,..._(wa.validate,O.message)},!n))return b(O.message),S}else if(ts(p)){let z={};for(const O in p){if(!Or(z)&&!n)break;const V=yN(await p[O](x,e),v,O);V&&(z={...V,..._(O,V.message)},b(V.message),n&&(S[f]=z))}if(!Or(z)&&(S[f]={ref:v,...z},!n))return S}}return b(!0),S};function xj(t,e){const n=e.slice(0,-1).length;let s=0;for(;s<n;)t=Qn(t)?s++:t[e[s++]];return t}function wj(t){for(const e in t)if(t.hasOwnProperty(e)&&!Qn(t[e]))return!1;return!0}function vs(t,e){const n=Array.isArray(e)?e:r2(e)?[e]:GA(e),s=n.length===1?t:xj(t,n),r=n.length-1,o=n[r];return s&&delete s[o],r!==0&&(ts(s)&&Or(s)||Array.isArray(s)&&wj(s))&&vs(t,n.slice(0,-1)),t}var mv=()=>{let t=[];return{get observers(){return t},next:r=>{for(const o of t)o.next&&o.next(r)},subscribe:r=>(t.push(r),{unsubscribe:()=>{t=t.filter(o=>o!==r)}}),unsubscribe:()=>{t=[]}}},Hb=t=>yr(t)||!jA(t);function rl(t,e){if(Hb(t)||Hb(e))return t===e;if(bu(t)&&bu(e))return t.getTime()===e.getTime();const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(const r of n){const o=t[r];if(!s.includes(r))return!1;if(r!=="ref"){const i=e[r];if(bu(o)&&bu(i)||ts(o)&&ts(i)||Array.isArray(o)&&Array.isArray(i)?!rl(o,i):o!==i)return!1}}return!0}var qA=t=>t.type==="select-multiple",vj=t=>i2(t)||Uf(t),gv=t=>rx(t)&&t.isConnected,XA=t=>{for(const e in t)if(Ji(t[e]))return!0;return!1};function ix(t,e={}){const n=Array.isArray(t);if(ts(t)||n)for(const s in t)Array.isArray(t[s])||ts(t[s])&&!XA(t[s])?(e[s]=Array.isArray(t[s])?[]:{},ix(t[s],e[s])):yr(t[s])||(e[s]=!0);return e}function YA(t,e,n){const s=Array.isArray(t);if(ts(t)||s)for(const r in t)Array.isArray(t[r])||ts(t[r])&&!XA(t[r])?Qn(e)||Hb(n[r])?n[r]=Array.isArray(t[r])?ix(t[r],[]):{...ix(t[r])}:YA(t[r],yr(e)?{}:e[r],n[r]):n[r]=!rl(t[r],e[r]);return n}var mp=(t,e)=>YA(t,e,ix(e)),QA=(t,{valueAsNumber:e,valueAsDate:n,setValueAs:s})=>Qn(t)?t:e?t===""?NaN:t&&+t:n&&Zi(t)?new Date(t):s?s(t):t;function yv(t){const e=t.ref;if(!(t.refs?t.refs.every(n=>n.disabled):e.disabled))return o2(e)?e.files:i2(e)?KA(t.refs).value:qA(e)?[...e.selectedOptions].map(({value:n})=>n):Uf(e)?HA(t.refs).value:QA(Qn(e.value)?t.ref.value:e.value,t)}var bj=(t,e,n,s)=>{const r={};for(const o of t){const i=et(e,o);i&&$n(r,o,i._f)}return{criteriaMode:n,names:[...t],fields:r,shouldUseNativeValidation:s}},gp=t=>Qn(t)?t:ox(t)?t.source:ts(t)?ox(t.value)?t.value.source:t.value:t;const wN="AsyncFunction";var Sj=t=>(!t||!t.validate)&&!!(Ji(t.validate)&&t.validate.constructor.name===wN||ts(t.validate)&&Object.values(t.validate).find(e=>e.constructor.name===wN)),Cj=t=>t.mount&&(t.required||t.min||t.max||t.maxLength||t.minLength||t.pattern||t.validate);function vN(t,e,n){const s=et(t,n);if(s||r2(n))return{error:s,name:n};const r=n.split(".");for(;r.length;){const o=r.join("."),i=et(e,o),a=et(t,o);if(i&&!Array.isArray(i)&&n!==o)return{name:n};if(a&&a.type)return{name:o,error:a};r.pop()}return{name:n}}var kj=(t,e,n,s,r)=>r.isOnAll?!1:!n&&r.isOnTouch?!(e||t):(n?s.isOnBlur:r.isOnBlur)?!t:(n?s.isOnChange:r.isOnChange)?t:!0,Ij=(t,e)=>!d0(et(t,e)).length&&vs(t,e);const $j={mode:yi.onSubmit,reValidateMode:yi.onChange,shouldFocusError:!0};function Nj(t={}){let e={...$j,...t},n={submitCount:0,isDirty:!1,isLoading:Ji(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},s={},r=ts(e.defaultValues)||ts(e.values)?Ro(e.defaultValues||e.values)||{}:{},o=e.shouldUnregister?{}:Ro(r),i={action:!1,mount:!1,watch:!1},a={mount:new Set,unMount:new Set,array:new Set,watch:new Set},l,u=0;const c={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},d={values:mv(),array:mv(),state:mv()},h=hN(e.mode),p=hN(e.reValidateMode),f=e.criteriaMode===yi.all,m=W=>ae=>{clearTimeout(u),u=setTimeout(W,ae)},g=async W=>{if(!e.disabled&&(c.isValid||W)){const ae=e.resolver?Or((await T()).errors):await _(s,!0);ae!==n.isValid&&d.state.next({isValid:ae})}},y=(W,ae)=>{!e.disabled&&(c.isValidating||c.validatingFields)&&((W||Array.from(a.mount)).forEach(ue=>{ue&&(ae?$n(n.validatingFields,ue,ae):vs(n.validatingFields,ue))}),d.state.next({validatingFields:n.validatingFields,isValidating:!Or(n.validatingFields)}))},x=(W,ae=[],ue,ve,Ce=!0,be=!0)=>{if(ve&&ue&&!e.disabled){if(i.action=!0,be&&Array.isArray(et(s,W))){const Oe=ue(et(s,W),ve.argA,ve.argB);Ce&&$n(s,W,Oe)}if(be&&Array.isArray(et(n.errors,W))){const Oe=ue(et(n.errors,W),ve.argA,ve.argB);Ce&&$n(n.errors,W,Oe),Ij(n.errors,W)}if(c.touchedFields&&be&&Array.isArray(et(n.touchedFields,W))){const Oe=ue(et(n.touchedFields,W),ve.argA,ve.argB);Ce&&$n(n.touchedFields,W,Oe)}c.dirtyFields&&(n.dirtyFields=mp(r,o)),d.state.next({name:W,isDirty:z(W,ae),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else $n(o,W,ae)},v=(W,ae)=>{$n(n.errors,W,ae),d.state.next({errors:n.errors})},b=W=>{n.errors=W,d.state.next({errors:n.errors,isValid:!1})},S=(W,ae,ue,ve)=>{const Ce=et(s,W);if(Ce){const be=et(o,W,Qn(ue)?et(r,W):ue);Qn(be)||ve&&ve.defaultChecked||ae?$n(o,W,ae?be:yv(Ce._f)):H(W,be),i.mount&&g()}},C=(W,ae,ue,ve,Ce)=>{let be=!1,Oe=!1;const at={name:W};if(!e.disabled){const Tt=!!(et(s,W)&&et(s,W)._f&&et(s,W)._f.disabled);if(!ue||ve){c.isDirty&&(Oe=n.isDirty,n.isDirty=at.isDirty=z(),be=Oe!==at.isDirty);const vt=Tt||rl(et(r,W),ae);Oe=!!(!Tt&&et(n.dirtyFields,W)),vt||Tt?vs(n.dirtyFields,W):$n(n.dirtyFields,W,!0),at.dirtyFields=n.dirtyFields,be=be||c.dirtyFields&&Oe!==!vt}if(ue){const vt=et(n.touchedFields,W);vt||($n(n.touchedFields,W,ue),at.touchedFields=n.touchedFields,be=be||c.touchedFields&&vt!==ue)}be&&Ce&&d.state.next(at)}return be?at:{}},I=(W,ae,ue,ve)=>{const Ce=et(n.errors,W),be=c.isValid&&Ki(ae)&&n.isValid!==ae;if(t.delayError&&ue?(l=m(()=>v(W,ue)),l(t.delayError)):(clearTimeout(u),l=null,ue?$n(n.errors,W,ue):vs(n.errors,W)),(ue?!rl(Ce,ue):Ce)||!Or(ve)||be){const Oe={...ve,...be&&Ki(ae)?{isValid:ae}:{},errors:n.errors,name:W};n={...n,...Oe},d.state.next(Oe)}},T=async W=>{y(W,!0);const ae=await e.resolver(o,e.context,bj(W||a.mount,s,e.criteriaMode,e.shouldUseNativeValidation));return y(W),ae},R=async W=>{const{errors:ae}=await T(W);if(W)for(const ue of W){const ve=et(ae,ue);ve?$n(n.errors,ue,ve):vs(n.errors,ue)}else n.errors=ae;return ae},_=async(W,ae,ue={valid:!0})=>{for(const ve in W){const Ce=W[ve];if(Ce){const{_f:be,...Oe}=Ce;if(be){const at=a.array.has(be.name),Tt=Ce._f&&Sj(Ce._f);Tt&&c.validatingFields&&y([ve],!0);const vt=await xN(Ce,o,f,e.shouldUseNativeValidation&&!ae,at);if(Tt&&c.validatingFields&&y([ve]),vt[be.name]&&(ue.valid=!1,ae))break;!ae&&(et(vt,be.name)?at?yj(n.errors,vt,be.name):$n(n.errors,be.name,vt[be.name]):vs(n.errors,be.name))}!Or(Oe)&&await _(Oe,ae,ue)}}return ue.valid},P=()=>{for(const W of a.unMount){const ae=et(s,W);ae&&(ae._f.refs?ae._f.refs.every(ue=>!gv(ue)):!gv(ae._f.ref))&&Ie(W)}a.unMount=new Set},z=(W,ae)=>!e.disabled&&(W&&ae&&$n(o,W,ae),!rl(le(),r)),O=(W,ae,ue)=>mj(W,a,{...i.mount?o:Qn(ae)?r:Zi(W)?{[W]:ae}:ae},ue,ae),V=W=>d0(et(i.mount?o:r,W,t.shouldUnregister?et(r,W,[]):[])),H=(W,ae,ue={})=>{const ve=et(s,W);let Ce=ae;if(ve){const be=ve._f;be&&(!be.disabled&&$n(o,W,QA(ae,be)),Ce=rx(be.ref)&&yr(ae)?"":ae,qA(be.ref)?[...be.ref.options].forEach(Oe=>Oe.selected=Ce.includes(Oe.value)):be.refs?Uf(be.ref)?be.refs.length>1?be.refs.forEach(Oe=>(!Oe.defaultChecked||!Oe.disabled)&&(Oe.checked=Array.isArray(Ce)?!!Ce.find(at=>at===Oe.value):Ce===Oe.value)):be.refs[0]&&(be.refs[0].checked=!!Ce):be.refs.forEach(Oe=>Oe.checked=Oe.value===Ce):o2(be.ref)?be.ref.value="":(be.ref.value=Ce,be.ref.type||d.values.next({name:W,values:{...o}})))}(ue.shouldDirty||ue.shouldTouch)&&C(W,Ce,ue.shouldTouch,ue.shouldDirty,!0),ue.shouldValidate&&ie(W)},Q=(W,ae,ue)=>{for(const ve in ae){const Ce=ae[ve],be=`${W}.${ve}`,Oe=et(s,be);(a.array.has(W)||ts(Ce)||Oe&&!Oe._f)&&!bu(Ce)?Q(be,Ce,ue):H(be,Ce,ue)}},oe=(W,ae,ue={})=>{const ve=et(s,W),Ce=a.array.has(W),be=Ro(ae);$n(o,W,be),Ce?(d.array.next({name:W,values:{...o}}),(c.isDirty||c.dirtyFields)&&ue.shouldDirty&&d.state.next({name:W,dirtyFields:mp(r,o),isDirty:z(W,be)})):ve&&!ve._f&&!yr(be)?Q(W,be,ue):H(W,be,ue),pN(W,a)&&d.state.next({...n}),d.values.next({name:i.mount?W:void 0,values:{...o}})},j=async W=>{i.mount=!0;const ae=W.target;let ue=ae.name,ve=!0;const Ce=et(s,ue),be=()=>ae.type?yv(Ce._f):lj(W),Oe=at=>{ve=Number.isNaN(at)||bu(at)&&isNaN(at.getTime())||rl(at,et(o,ue,at))};if(Ce){let at,Tt;const vt=be(),Jt=W.type===dN.BLUR||W.type===dN.FOCUS_OUT,Qs=!Cj(Ce._f)&&!e.resolver&&!et(n.errors,ue)&&!Ce._f.deps||kj(Jt,et(n.touchedFields,ue),n.isSubmitted,p,h),Ts=pN(ue,a,Jt);$n(o,ue,vt),Jt?(Ce._f.onBlur&&Ce._f.onBlur(W),l&&l(0)):Ce._f.onChange&&Ce._f.onChange(W);const Js=C(ue,vt,Jt,!1),Zs=!Or(Js)||Ts;if(!Jt&&d.values.next({name:ue,type:W.type,values:{...o}}),Qs)return c.isValid&&(t.mode==="onBlur"?Jt&&g():g()),Zs&&d.state.next({name:ue,...Ts?{}:Js});if(!Jt&&Ts&&d.state.next({...n}),e.resolver){const{errors:Es}=await T([ue]);if(Oe(vt),ve){const to=vN(n.errors,s,ue),bo=vN(Es,s,to.name||ue);at=bo.error,ue=bo.name,Tt=Or(Es)}}else y([ue],!0),at=(await xN(Ce,o,f,e.shouldUseNativeValidation))[ue],y([ue]),Oe(vt),ve&&(at?Tt=!1:c.isValid&&(Tt=await _(s,!0)));ve&&(Ce._f.deps&&ie(Ce._f.deps),I(ue,Tt,at,Js))}},ee=(W,ae)=>{if(et(n.errors,ae)&&W.focus)return W.focus(),1},ie=async(W,ae={})=>{let ue,ve;const Ce=wy(W);if(e.resolver){const be=await R(Qn(W)?W:Ce);ue=Or(be),ve=W?!Ce.some(Oe=>et(be,Oe)):ue}else W?(ve=(await Promise.all(Ce.map(async be=>{const Oe=et(s,be);return await _(Oe&&Oe._f?{[be]:Oe}:Oe)}))).every(Boolean),!(!ve&&!n.isValid)&&g()):ve=ue=await _(s);return d.state.next({...!Zi(W)||c.isValid&&ue!==n.isValid?{}:{name:W},...e.resolver||!W?{isValid:ue}:{},errors:n.errors}),ae.shouldFocus&&!ve&&jp(s,ee,W?Ce:a.mount),ve},le=W=>{const ae={...i.mount?o:r};return Qn(W)?ae:Zi(W)?et(ae,W):W.map(ue=>et(ae,ue))},fe=(W,ae)=>({invalid:!!et((ae||n).errors,W),isDirty:!!et((ae||n).dirtyFields,W),error:et((ae||n).errors,W),isValidating:!!et(n.validatingFields,W),isTouched:!!et((ae||n).touchedFields,W)}),ge=W=>{W&&wy(W).forEach(ae=>vs(n.errors,ae)),d.state.next({errors:W?n.errors:{}})},xe=(W,ae,ue)=>{const ve=(et(s,W,{_f:{}})._f||{}).ref,Ce=et(n.errors,W)||{},{ref:be,message:Oe,type:at,...Tt}=Ce;$n(n.errors,W,{...Tt,...ae,ref:ve}),d.state.next({name:W,errors:n.errors,isValid:!1}),ue&&ue.shouldFocus&&ve&&ve.focus&&ve.focus()},we=(W,ae)=>Ji(W)?d.values.subscribe({next:ue=>W(O(void 0,ae),ue)}):O(W,ae,!0),Ie=(W,ae={})=>{for(const ue of W?wy(W):a.mount)a.mount.delete(ue),a.array.delete(ue),ae.keepValue||(vs(s,ue),vs(o,ue)),!ae.keepError&&vs(n.errors,ue),!ae.keepDirty&&vs(n.dirtyFields,ue),!ae.keepTouched&&vs(n.touchedFields,ue),!ae.keepIsValidating&&vs(n.validatingFields,ue),!e.shouldUnregister&&!ae.keepDefaultValue&&vs(r,ue);d.values.next({values:{...o}}),d.state.next({...n,...ae.keepDirty?{isDirty:z()}:{}}),!ae.keepIsValid&&g()},_e=({disabled:W,name:ae,field:ue,fields:ve,value:Ce})=>{if(Ki(W)&&i.mount||W){const be=W?void 0:Qn(Ce)?yv(ue?ue._f:et(ve,ae)._f):Ce;$n(o,ae,be),C(ae,be,!1,!1,!0)}},qe=(W,ae={})=>{let ue=et(s,W);const ve=Ki(ae.disabled)||Ki(e.disabled);return $n(s,W,{...ue||{},_f:{...ue&&ue._f?ue._f:{ref:{name:W}},name:W,mount:!0,...ae}}),a.mount.add(W),ue?_e({field:ue,disabled:Ki(ae.disabled)?ae.disabled:e.disabled,name:W,value:ae.value}):S(W,!0,ae.value),{...ve?{disabled:ae.disabled||e.disabled}:{},...e.progressive?{required:!!ae.required,min:gp(ae.min),max:gp(ae.max),minLength:gp(ae.minLength),maxLength:gp(ae.maxLength),pattern:gp(ae.pattern)}:{},name:W,onChange:j,onBlur:j,ref:Ce=>{if(Ce){qe(W,ae),ue=et(s,W);const be=Qn(Ce.value)&&Ce.querySelectorAll&&Ce.querySelectorAll("input,select,textarea")[0]||Ce,Oe=vj(be),at=ue._f.refs||[];if(Oe?at.find(Tt=>Tt===be):be===ue._f.ref)return;$n(s,W,{_f:{...ue._f,...Oe?{refs:[...at.filter(gv),be,...Array.isArray(et(r,W))?[{}]:[]],ref:{type:be.type,name:W}}:{ref:be}}}),S(W,!1,void 0,be)}else ue=et(s,W,{}),ue._f&&(ue._f.mount=!1),(e.shouldUnregister||ae.shouldUnregister)&&!(cj(a.array,W)&&i.action)&&a.unMount.add(W)}}},Ze=()=>e.shouldFocusError&&jp(s,ee,a.mount),dt=W=>{Ki(W)&&(d.state.next({disabled:W}),jp(s,(ae,ue)=>{const ve=et(s,ue);ve&&(ae.disabled=ve._f.disabled||W,Array.isArray(ve._f.refs)&&ve._f.refs.forEach(Ce=>{Ce.disabled=ve._f.disabled||W}))},0,!1))},Ge=(W,ae)=>async ue=>{let ve;if(ue&&(ue.preventDefault&&ue.preventDefault(),ue.persist&&ue.persist()),e.disabled){ae&&await ae({...n.errors},ue);return}let Ce=Ro(o);if(d.state.next({isSubmitting:!0}),e.resolver){const{errors:be,values:Oe}=await T();n.errors=be,Ce=Oe}else await _(s);if(vs(n.errors,"root"),Or(n.errors)){d.state.next({errors:{}});try{await W(Ce,ue)}catch(be){ve=be}}else ae&&await ae({...n.errors},ue),Ze(),setTimeout(Ze);if(d.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Or(n.errors)&&!ve,submitCount:n.submitCount+1,errors:n.errors}),ve)throw ve},bt=(W,ae={})=>{et(s,W)&&(Qn(ae.defaultValue)?oe(W,Ro(et(r,W))):(oe(W,ae.defaultValue),$n(r,W,Ro(ae.defaultValue))),ae.keepTouched||vs(n.touchedFields,W),ae.keepDirty||(vs(n.dirtyFields,W),n.isDirty=ae.defaultValue?z(W,Ro(et(r,W))):z()),ae.keepError||(vs(n.errors,W),c.isValid&&g()),d.state.next({...n}))},ut=(W,ae={})=>{const ue=W?Ro(W):r,ve=Ro(ue),Ce=Or(W),be=Ce?r:ve;if(ae.keepDefaultValues||(r=ue),!ae.keepValues){if(ae.keepDirtyValues){const Oe=new Set([...a.mount,...Object.keys(mp(r,o))]);for(const at of Array.from(Oe))et(n.dirtyFields,at)?$n(be,at,et(o,at)):oe(at,et(be,at))}else{if(s2&&Qn(W))for(const Oe of a.mount){const at=et(s,Oe);if(at&&at._f){const Tt=Array.isArray(at._f.refs)?at._f.refs[0]:at._f.ref;if(rx(Tt)){const vt=Tt.closest("form");if(vt){vt.reset();break}}}}s={}}o=t.shouldUnregister?ae.keepDefaultValues?Ro(r):{}:Ro(be),d.array.next({values:{...be}}),d.values.next({values:{...be}})}a={mount:ae.keepDirtyValues?a.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},i.mount=!c.isValid||!!ae.keepIsValid||!!ae.keepDirtyValues,i.watch=!!t.shouldUnregister,d.state.next({submitCount:ae.keepSubmitCount?n.submitCount:0,isDirty:Ce?!1:ae.keepDirty?n.isDirty:!!(ae.keepDefaultValues&&!rl(W,r)),isSubmitted:ae.keepIsSubmitted?n.isSubmitted:!1,dirtyFields:Ce?{}:ae.keepDirtyValues?ae.keepDefaultValues&&o?mp(r,o):n.dirtyFields:ae.keepDefaultValues&&W?mp(r,W):ae.keepDirty?n.dirtyFields:{},touchedFields:ae.keepTouched?n.touchedFields:{},errors:ae.keepErrors?n.errors:{},isSubmitSuccessful:ae.keepIsSubmitSuccessful?n.isSubmitSuccessful:!1,isSubmitting:!1})},wt=(W,ae)=>ut(Ji(W)?W(o):W,ae);return{control:{register:qe,unregister:Ie,getFieldState:fe,handleSubmit:Ge,setError:xe,_executeSchema:T,_getWatch:O,_getDirty:z,_updateValid:g,_removeUnmounted:P,_updateFieldArray:x,_updateDisabledField:_e,_getFieldArray:V,_reset:ut,_resetDefaultValues:()=>Ji(e.defaultValues)&&e.defaultValues().then(W=>{wt(W,e.resetOptions),d.state.next({isLoading:!1})}),_updateFormState:W=>{n={...n,...W}},_disableForm:dt,_subjects:d,_proxyFormState:c,_setErrors:b,get _fields(){return s},get _formValues(){return o},get _state(){return i},set _state(W){i=W},get _defaultValues(){return r},get _names(){return a},set _names(W){a=W},get _formState(){return n},set _formState(W){n=W},get _options(){return e},set _options(W){e={...e,...W}}},trigger:ie,register:qe,handleSubmit:Ge,watch:we,setValue:oe,getValues:le,reset:wt,resetField:bt,clearErrors:ge,unregister:Ie,setError:xe,setFocus:(W,ae={})=>{const ue=et(s,W),ve=ue&&ue._f;if(ve){const Ce=ve.refs?ve.refs[0]:ve.ref;Ce.focus&&(Ce.focus(),ae.shouldSelect&&Ji(Ce.select)&&Ce.select())}},getFieldState:fe}}function h0(t={}){const e=no.useRef(),n=no.useRef(),[s,r]=no.useState({isDirty:!1,isValidating:!1,isLoading:Ji(t.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1,defaultValues:Ji(t.defaultValues)?void 0:t.defaultValues});e.current||(e.current={...Nj(t),formState:s});const o=e.current.control;return o._options=t,fj({subject:o._subjects.state,next:i=>{pj(i,o._proxyFormState,o._updateFormState)&&r({...o._formState})}}),no.useEffect(()=>o._disableForm(t.disabled),[o,t.disabled]),no.useEffect(()=>{if(o._proxyFormState.isDirty){const i=o._getDirty();i!==s.isDirty&&o._subjects.state.next({isDirty:i})}},[o,s.isDirty]),no.useEffect(()=>{t.values&&!rl(t.values,n.current)?(o._reset(t.values,o._options.resetOptions),n.current=t.values,r(i=>({...i}))):o._resetDefaultValues()},[t.values,o]),no.useEffect(()=>{t.errors&&o._setErrors(t.errors)},[t.errors,o]),no.useEffect(()=>{o._state.mount||(o._updateValid(),o._state.mount=!0),o._state.watch&&(o._state.watch=!1,o._subjects.state.next({...o._formState})),o._removeUnmounted()}),no.useEffect(()=>{t.shouldUnregister&&o._subjects.values.next({values:o._getWatch()})},[t.shouldUnregister,o]),e.current.formState=hj(s,o),e.current}function Tj(){var a,l;const t=ns(),{register:e,handleSubmit:n,watch:s,setError:r,formState:{errors:o}}=h0(),i=async u=>{try{const c=await fetch("http://localhost:3000/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(c.status===302){alert("Incomplete profile, redirecting...");const d=await c.json(),h=d.email;localStorage.setItem("token",d.data.token),t("/signup/userdata",{state:{email:h}});return}if(c.ok){const d=await c.json();localStorage.setItem("token",d.data.token),localStorage.setItem("refreshtoken",d.data.refresh),console.log(`${localStorage.getItem("refreshtoken")}`),t("/activity")}else{const d=await c.json();r("email",{type:"server",message:d.message||"You provided wrong data"}),r("password",{type:"server",message:d.message||"You provided wrong data"})}}catch(c){alert("An error occurred. Please try again."),console.error(c)}};return E.jsx(E.Fragment,{children:E.jsxs("div",{className:"h-screen bg-[#30093f] p-0 m-0 flex flex-col items-center font-dm-sans",children:[E.jsx(t2,{}),E.jsxs("div",{className:"flex w-screen ",children:[E.jsx(n2,{}),E.jsxs("div",{className:"w-screen flex flex-col items-center",children:[E.jsx("div",{className:"text-2xl text-center mt-[5vh] text-yellow-400",children:"Login"}),E.jsx("div",{className:"w-[50vw] h-96 bg-[#1f0729] mt-8 rounded-3xl max-md:w-[80vw]",children:E.jsxs("form",{onSubmit:n(i),className:"flex flex-col  items-center justify-center text-sm h-[100%]",children:[E.jsxs("div",{className:"relative max-md:h-11",children:[E.jsx("input",{type:"email",placeholder:"Email",className:`w-80 max-md:text-[9px] h-10 text-[20px] max-md:w-44 max-md:h-5 outline-none rounded-md text-center border-[2px] m-5 max-lg:w-60 max-lg:text-[10px] ${o.email?"border-red-600":"border-transparent"}`,...e("email",{required:{value:!0,message:"This field is required"}})}),o.email&&E.jsx("div",{className:"text-red-600  absolute top-10 text-[8px] left-[50%] text-xs -translate-x-1/2",children:(a=o.email)==null?void 0:a.message})]}),E.jsxs("div",{className:"relative",children:[E.jsx("input",{type:"password",placeholder:"Password",className:`w-80 h-10 text-[20px] outline-none max-md:text-[8px] max-md:w-44 max-md:h-5 rounded-md text-center border-[2px] m-5 max-lg:w-60 max-lg:text-[10px] ${o.password?"border-red-600":"border-transparent"}`,...e("password",{required:{value:!0,message:"This field is required"}})}),o.password&&E.jsx("div",{className:"text-red-600 absolute top-10 text-[8px] left-[50%] text-xs -translate-x-1/2",children:(l=o.password)==null?void 0:l.message})]}),E.jsx("button",{type:"submit",className:`flex justify-center items-center text-[16px] md:text-[20px] w-24 md:w-28 h-8 md:h-10 \r
                          bg-yellow-400 text-black font-semibold rounded-2xl m-2 md:m-5 \r
                          hover:bg-white hover:text-black transition-all duration-200`,children:"Login"}),E.jsx(oj,{to:"/signup",children:E.jsx("button",{className:"text-white text-lg hover:underline max-md:text-[8px] max-lg:text-[10px]",children:"Create a new Account"})})]})})]})]})]})})}function Ai(){const t=ns(),e=()=>{localStorage.removeItem("token"),t("/signin")},[n,s]=X.useState(!1),[r,o]=X.useState(!1),i=()=>{o(!r)};return E.jsxs("div",{className:"relative max-md:hidden",children:[n&&E.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-10 flex justify-center items-center",children:E.jsxs("div",{className:"w-auto max-w-md bg-white rounded-lg text-[#1f0729] font-bold relative p-6 shadow-lg border border-gray-300",children:[E.jsx("div",{id:"text",className:"text-center text-lg"}),E.jsx("div",{className:"bg-red-600 mt-6 px-6 py-2 flex items-center justify-center text-[17px] text-white rounded-full cursor-pointer hover:bg-red-500 mx-auto w-24",onClick:()=>{s(!1)},children:"Close"})]})}),E.jsx("nav",{className:"w-full h-16 bg-[#1f0729] flex items-center",children:E.jsxs("ul",{className:"text-white font-dm-sans flex w-screen justify-around items-center rounded-full",children:[E.jsx("li",{className:"hover:cursor-pointer hover:text-yellow-400",onClick:()=>t("/activity"),children:"Home"}),E.jsx("li",{className:"hover:cursor-pointer hover:text-yellow-400",onClick:()=>{s(!0),setTimeout(()=>{document.querySelector("#text").innerHTML="<p>Email: <span class='font-normal'><br>romani2181.be22@chitkara.edu.in<br>ananya1258.be22@chitkara.edu.in<br>aditya67.be22@chitkara.edu.in<br>ruhani2194.be22@chitkara.edu.in</span></p>"},0)},children:"Contact"}),E.jsx("li",{className:"hover:cursor-pointer hover:text-yellow-400",onClick:()=>{s(!0),setTimeout(()=>{document.querySelector("#text").innerHTML="<p class='font-normal text-base text-center'>We are a team of full-stack developers building user-friendly and scalable web applications. This project showcases our collaboration, technical skills, and commitment to delivering high-quality solutions.</p>"},0)},children:"About us"}),E.jsx("li",{className:"hover:cursor-pointer hover:text-yellow-400",onClick:()=>t("/leaderboard"),children:"Leaderboard"}),E.jsx("li",{className:"hover:cursor-pointer hover:text-yellow-400",onClick:()=>t("/goals"),children:"Goals"}),E.jsx("li",{className:"hover:cursor-pointer hover:text-yellow-400",onClick:()=>t("/profile"),children:"Profile"}),E.jsx("div",{className:" h-1 bg-purple-950 p-6 m-3 rounded-full flex justify-center items-center cursor-pointer hover:bg-purple-900",onClick:i,children:"Logout"})]})}),r&&E.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-10"}),E.jsxs("div",{className:`w-96 h-32 bg-purple-900 rounded-md absolute top-[50vh] left-[50vw] z-10 -translate-x-1/2 p-4 ${r?"block":"hidden"}`,children:[E.jsx("p",{className:"text-white font-dm-sans text-lg",children:"Are you sure you want to logout?"}),E.jsx("div",{className:"bg-purple-700 text-center rounded-md mt-2 cursor-pointer hover:bg-purple-950 text-white",onClick:e,children:"Yes"}),E.jsx("div",{className:"bg-purple-700 text-center rounded-md mt-2 cursor-pointer hover:bg-purple-950 text-white",onClick:i,children:"No"})]})]})}function Ej(){const{register:t,handleSubmit:e,formState:{errors:n}}=h0(),s=ns(),r=async o=>{try{let i=await fetch("http://localhost:3000/data",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(o)});if(console.log("COnnected"),i.ok)alert("Your data submitted"),s("/activity");else if(i.status!==403)throw new Error("Failed to submit data")}catch(i){console.error("Error:",i),alert("Oops! There occurred a problem")}};return E.jsx("div",{className:"w-[50vw] h-96 bg-[#1f0729] mt-8 rounded-3xl max-md:w-[80vw]",children:E.jsxs("form",{onSubmit:e(r),className:"flex flex-col items-center justify-center h-[100%] text-xs",children:[E.jsxs("div",{className:"relative",children:[E.jsx("input",{type:"text",placeholder:"Enter your name",className:`w-96 h-6 outline-none rounded-md text-center m-5 border-[2px] max-lg:w-72 max-md:w-56 max-lg:text-[10px] ${n.name?"border-red-600":"border-transparent"}`,...t("name",{required:{value:!0,message:"This field is required"}})}),n.name&&E.jsx("div",{className:"absolute top-12 text-[10px] left-[50%] text-red-600 -translate-x-1/2 max-md:text-[9px] max-md:top-11",children:n.name.message})]}),E.jsxs("div",{className:"relative",children:[E.jsx("input",{type:"date",className:`w-96 h-6 outline-none rounded-md text-center m-5 border-[2px] max-lg:w-72 max-md:w-56 max-lg:text-[10px] ${n.date?"border-red-600":"border-transparent"}`,...t("date",{required:{value:!0,message:"This field is required"}})}),n.date&&E.jsx("div",{className:"absolute top-12 left-[50%] text-red-600 -translate-x-1/2 max-lg:text-[10px] max-md:text-[9px] max-md:top-11",children:n.date.message})]}),E.jsxs("div",{className:"flex",children:[E.jsx("p",{className:"text-white flex items-center text-xs max-lg:text-[10px]",children:"Select your gender"}),E.jsxs("select",{className:"w-28 h-5 outline-none rounded-md text-center m-5 p-0 max-lg:w-24 max-lg:text-[10px]",...t("gender"),children:[E.jsx("option",{value:"male",children:"Male"}),E.jsx("option",{value:"female",children:"Female"})]})]}),E.jsxs("div",{className:"flex",children:[E.jsxs("div",{className:"relative",children:[E.jsx("input",{type:"number",step:"0.1",placeholder:"Enter your weight",className:`w-48 h-5 outline-none rounded-md text-center border-[2px] m-5 max-lg:w-40 max-md:w-32 max-md:text-[10px]  ${n.weight?"border-red-600":"border-transparent"}`,...t("weight",{required:{value:!0,message:"This field is required"}})}),n.weight&&E.jsx("div",{className:"absolute top-11 left-[50%] text-red-600 -translate-x-1/2 max-lg:text-[10px] max-md:w-24 max-md:text-[9px] max-md:top-10",children:n.weight.message})]}),E.jsxs("select",{className:"w-28 h-5 outline-none rounded-md text-center m-5 p-0 max-lg:text-[10px]",...t("weightScale"),children:[E.jsx("option",{children:"LBs"}),E.jsx("option",{children:"Kgs"})]})]}),E.jsxs("div",{className:"flex",children:[E.jsxs("div",{className:"relative",children:[E.jsx("input",{type:"number",step:"any",placeholder:"Enter your height",className:`w-48 h-5 outline-none rounded-md text-center border-[2px] m-5 max-lg:w-40 max-md:w-32 max-md:text-[10px]  ${n.height?"border-red-600":"border-transparent"}`,...t("height",{required:{value:!0,message:"This field is required"}})}),n.height&&E.jsx("div",{className:"absolute top-11 left-[50%] text-red-600 -translate-x-1/2 max-lg:text-[10px] max-md:w-24 max-md:text-[9px] max-md:top-10",children:n.height.message})]}),E.jsxs("select",{className:"w-28 h-5 outline-none rounded-md text-center m-5 p-0 max-lg:text-[10px]",...t("lengthScale"),children:[E.jsx("option",{children:"ft"}),E.jsx("option",{children:"cm"})]})]}),E.jsx("button",{type:"submit",className:"bg-yellow-400 w-24 font-semibold h-4 rounded-2xl m-2 hover:bg-white",children:"Submit"})]})})}function _i(){const[t,e]=X.useState(!1),[n,s]=X.useState(!1),r=ns(),o=()=>{localStorage.removeItem("token"),r("/signin")},i=()=>{s(!n)};return E.jsxs("div",{className:"min-h-screen w-[12vw] bg-[#1f0729] top-0 left-0 md:hidden flex flex-col items-center",children:[E.jsx("i",{className:"fa-solid fa-home text-white text-lg my-8 cursor-pointer m-4 ",onClick:()=>{r("/activity")}}),E.jsx("i",{className:"fa-solid fa-book-open text-white text-lg my-8 cursor-pointer m-4 ",onClick:()=>{r("/leaderboard")}}),E.jsx("i",{className:"fa-solid fa-bullseye text-white text-lg my-8 cursor-pointer m-4 ",onClick:()=>{r("/goals")}}),E.jsx("i",{className:"fa-solid fa-power-off text-white text-lg my-8 cursor-pointer m-4",onClick:i}),E.jsx("i",{className:"fa-solid fa-user text-white text-lg my-8 cursor-pointer m-4",onClick:()=>{r("/profile")}}),t&&E.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-10 flex justify-center items-center",children:E.jsxs("div",{className:"w-96 h-96 bg-white rounded-md text-[#1f0729] flex justify-center items-center  font-bold relative p-4",children:[E.jsx("div",{id:"text"}),E.jsx("div",{className:"bg-red-600 absolute bottom-1 px-4 text-white rounded-full cursor-pointer hover:bg-red-500",onClick:()=>{e(!1)},children:"Close"})]})}),n&&E.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-10"}),E.jsxs("div",{className:`w-96 h-32 bg-purple-900 rounded-md absolute top-[50vh] left-[50vw] z-10 -translate-x-1/2 p-4 ${n?"block":"hidden"}`,children:[E.jsx("p",{className:"text-white font-dm-sans text-lg",children:"Are you sure you want to logout?"}),E.jsx("div",{className:"bg-purple-700 text-center rounded-md mt-2 cursor-pointer hover:bg-purple-950 text-white",onClick:o,children:"Yes"}),E.jsx("div",{className:"bg-purple-700 text-center rounded-md mt-2 cursor-pointer hover:bg-purple-950 text-white",onClick:i,children:"No"})]})]})}function Rj(){return E.jsxs("div",{className:"h-screen bg-[#30093f] p-0 m-0 flex flex-col items-center font-dm-sans",children:[E.jsx(Ai,{}),E.jsxs("div",{className:"flex w-full",children:[E.jsx(_i,{}),E.jsxs("div",{className:"flex flex-col items-center w-screen",children:[E.jsx("div",{className:"text-2xl text-center mt-[5vh] text-yellow-400 font-dm-sans",children:"Your Data"}),E.jsx(Ej,{})]})]})]})}function Dj(){const{register:t,handleSubmit:e,watch:n,setError:s,formState:{errors:r}}=h0(),o=n("password"),i=ns(),a=async l=>{try{let u=await fetch("http://localhost:3000/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});u.ok?(alert("Registeration Successful"),i("/signin")):u.status===503&&s("email",{type:"server",message:"This email already exists"})}catch{alert("Oops! There occured an problem")}};return E.jsxs("div",{className:"h-screen bg-[#30093f] p-0 m-0 flex flex-col items-center font-dm-sans",children:[E.jsx(t2,{}),E.jsxs("div",{className:"flex max-md:w-screen",children:[E.jsx(n2,{}),E.jsxs("div",{className:"w-screen flex flex-col items-center",children:[E.jsx("div",{className:"text-3xl text-center mt-[5vh] text-yellow-400 font-dm-sans",children:"Register Yourself"}),E.jsx("div",{className:"w-[50vw] h-full bg-[#1f0729] mt-8 rounded-3xl max-md:w-[80vw]",children:E.jsxs("form",{onSubmit:e(a),className:"flex flex-col items-center justify-center text-sm h-[100%]",children:[E.jsxs("div",{className:"relative",children:[E.jsx("input",{type:"email",placeholder:"Enter your email",className:`w-80 max-md:text-[9px] h-10 text-[20px] max-md:w-44 max-md:h-5 outline-none rounded-md text-center border-[2px] m-5 max-lg:w-60 max-lg:text-[10px] ${r.email?"border-red-600":"border-transparent"}`,...t("email",{required:{value:!0,message:"This field is required"}})}),r.email&&E.jsx("div",{className:"text-red-600  absolute top-12 max-md:top-10 max-md:text-[8px] left-[50%] text-xs -translate-x-1/2",children:r.email.message})]}),E.jsxs("div",{className:"relative",children:[E.jsx("input",{type:"password",placeholder:"Enter your password",className:`w-80 max-md:text-[9px] h-10 text-[20px] max-md:w-44 max-md:h-5 outline-none rounded-md text-center border-[2px] m-5 max-lg:w-60 max-lg:text-[10px] ${r.password?"border-red-600":"border-transparent"}`,...t("password",{required:{value:!0,message:"This field is required"},minLength:{value:8,message:"At least 8 characters are required"}})}),r.password&&E.jsx("div",{className:"text-red-600  absolute top-12 max-md:top-10 max-md:text-[8px] left-[50%] text-xs -translate-x-1/2",children:r.password.message})]}),E.jsxs("div",{className:"relative",children:[E.jsx("input",{type:"password",placeholder:"Re-enter your password",className:`w-80 max-md:text-[9px] h-10 text-[20px] max-md:w-44 max-md:h-5 outline-none rounded-md text-center border-[2px] m-5 max-lg:w-60 max-lg:text-[10px]${r.repassword?"border-red-600":"border-transparent"}`,...t("repassword",{required:{value:!0,message:"This field is required"},validate:l=>l===o||"The passwords do not match"})}),r.repassword&&E.jsx("div",{className:"text-red-600  absolute top-12 max-md:top-10 max-md:text-[8px] left-[50%] text-xs -translate-x-1/2",children:r.repassword.message})]}),E.jsx("button",{type:"submit",className:`flex justify-center items-center text-[16px] md:text-[20px] w-24 md:w-28 h-8 md:h-10 \r
                          bg-yellow-400 text-black font-semibold rounded-2xl m-2 md:m-5 \r
                          hover:bg-white hover:text-black transition-all duration-200`,children:"Next"})]})})]})]})]})}function Aj(){const{register:t,handleSubmit:e,watch:n,formState:{errors:s}}=h0(),r=n("goal"),o=ns(),[i,a]=X.useState("");X.useEffect(()=>{r&&a(r)},[r]),console.log(`goal: ${i}`);const l=()=>{i=="musclegain"?o("/musclegain"):o("/fatloss")},u=async c=>{try{let d=await fetch("http://localhost:3000/goals",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(c)});d.ok&&l(),d.ok||alert("An error occured from server. Login Again")}catch{alert("Problem while connecting with server")}};return E.jsxs("div",{className:"h-screen bg-[#30093f] p-0 m-0 flex flex-col items-center font-dm-sans",children:[E.jsx(Ai,{}),E.jsxs("div",{className:"flex w-screen",children:[E.jsx(_i,{}),E.jsxs("div",{className:"flex w-screen flex-col items-center",children:[E.jsx("div",{className:"text-3xl text-center mt-[5vh] text-yellow-400 font-dm-sans",children:"Select your goal"}),E.jsx("div",{className:"w-[50vw] h-96 bg-[#1f0729] mt-8 rounded-3xl max-md:w-[80vw]",children:E.jsxs("form",{onSubmit:e(u),className:"w-full h-full flex flex-col justify-evenly items-center ",children:[E.jsxs("label",{htmlFor:"musclegain",className:"relative",children:[E.jsx("input",{type:"radio",name:"goal",id:"musclegain",value:"musclegain",className:"appearance-none w-56 h-20 rounded-md bg-[#09020c] cursor-pointer checked:bg-purple-950",...t("goal",{required:!0})}),E.jsx("span",{className:"absolute top-[50%] left-[50%] -translate-x-1/2 -translate-y-1/2 text-white text-[20px] cursor-pointer",children:"Muscle gain"})]}),E.jsxs("label",{htmlFor:"fatloss",className:"relative",children:[E.jsx("input",{type:"radio",name:"goal",id:"fatloss",value:"fatloss",className:"appearance-none w-56 h-20 rounded-md bg-[#09020c] cursor-pointer checked:bg-purple-950",...t("goal",{required:!0})}),E.jsx("span",{className:"absolute top-[50%] left-[50%] -translate-x-1/2 -translate-y-1/2 text-white text-[20px] cursor-pointer",children:"Fat Loss"}),s.goal&&E.jsx("div",{className:"absolute w-full top-50% left-[50%] text-red-600 text-md text-center -translate-x-1/2",children:"Please select a goal"})]}),E.jsx("button",{type:"submit",className:"bg-yellow-400 w-28 font-[600px] h-10 text-[20px] text-bold rounded-2xl m-2 hover:bg-white max-md:text-[18px] max-md:h-6 max-md:w-24",children:"Next"})]})})]})]})]})}function _j(){const[t,e]=X.useState("");let n=ns();const s=async()=>{try{(await fetch("http://localhost:3000/mode",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({mode:t})})).ok&&n("/select")}catch{alert("A problem occured")}};return X.useEffect(()=>{t&&s()},[t]),console.log(t),E.jsxs(E.Fragment,{children:[E.jsx(Ai,{}),E.jsxs("div",{className:"flex w-full",children:[E.jsx(_i,{}),E.jsx("div",{className:"h-screen w-full bg-[#30093f] flex flex-col items-center font-dm-sans",children:E.jsxs("div",{className:"mt-[50vh] -translate-y-1/2 flex flex-col items-center justify-center",children:[E.jsx("div",{className:"w-80 h-20 max-md:w-56 max-md:text-[16px]  bg-white rounded-full flex justify-center items-center text-2xl hover:bg-yellow-400 hover:text-[#30093f]  cursor-pointer m-10 max-md:m-5 font-bold",onClick:()=>{e("Moderate Musclegain")},children:"Moderate Musclegain"}),E.jsx("div",{className:"w-80 h-20 max-md:w-56 max-md:text-[16px] bg-white rounded-full flex justify-center items-center text-2xl hover:bg-yellow-400 hover:text-[#30093f] cursor-pointer m-10 max-md:m-5 font-bold",onClick:()=>{e("Fast Musclegain")},children:"Fast Musclegain"}),E.jsx("p",{className:"text-white text-[14px] pt-5 font-dm-sans opacity-50 w-[50vw] text-center max-md:text-[10px]",children:"Note: Moderate speed musclegain is always preferable as it maximizes the musclegain with minimum amout of fatgain"})]})})]})]})}function Fj(){const[t,e]=X.useState("");let n=ns();const s=async o=>{try{(await fetch("http://localhost:3000/mode",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({mode:t})})).ok&&n("/select")}catch{alert("A problem occured")}};X.useEffect(()=>{t&&s()},[t]);const r=o=>{e(o)};return E.jsxs(E.Fragment,{children:[E.jsx(Ai,{}),E.jsxs("div",{className:"flex w-full",children:[E.jsx(_i,{}),E.jsx("div",{className:"h-screen w-full bg-[#30093f] p-0 m-0 flex flex-col items-center font-dm-sans",children:E.jsxs("div",{className:"mt-[50vh] -translate-y-1/2 flex flex-col items-center justify-center",children:[E.jsx("div",{className:"w-80 h-20 max-md:w-56 max-md:text-[16px]  bg-white rounded-full flex justify-center items-center text-2xl hover:bg-yellow-400 hover:text-[#30093f]  cursor-pointer m-10 max-md:m-5 font-bold",onClick:()=>{r("Moderate fatloss")},children:"Moderate Fatloss"}),E.jsx("div",{className:"w-80 h-20 max-md:w-56 max-md:text-[16px]  bg-white rounded-full flex justify-center items-center text-2xl hover:bg-yellow-400 hover:text-[#30093f]  cursor-pointer m-10 max-md:m-5 font-bold",onClick:()=>{r("Fast fatloss")},children:"Fast Fatloss"}),E.jsx("p",{className:"text-white text-[14px] pt-5 font-dm-sans opacity-50 w-[50vw] text-center max-md:text-[10px]",children:"Note: Moderate speed fatloss is always preferable"})]})})]})]})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pj=1e-7,Oj=1e-4;class a2{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class p0{refCount(e){return _r("refCount")}incRef(e){return _r("incRef")}timerAvailable(){return!0}time(e){return _r("time")}read(e){return _r("read")}readSync(e){return _r("readSync")}readToGPU(e,n){return _r("readToGPU")}numDataIds(){return _r("numDataIds")}disposeData(e,n){return _r("disposeData")}write(e,n,s){return _r("write")}move(e,n,s,r,o){return _r("move")}createTensorFromGPUData(e,n,s){return _r("createTensorFromGPUData")}memory(){return _r("memory")}floatPrecision(){return _r("floatPrecision")}epsilon(){return this.floatPrecision()===32?Pj:Oj}dispose(){return _r("dispose")}}function _r(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lj(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,Oc(t,e,n)}function Vu(t,e,n){return Math.max(t,Math.min(e,n))}function l2(t){return t%2===0?t:t+1}function Oc(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function JA(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function A(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function Er(t,e,n=""){A(Ct(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function zd(t){A(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function te(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function bN(t){return t.length===0}function zj(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==null&&e[n]!==null&&t[n]!==e[n])return!1;return!0}function Ct(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function wd(t){return t%1===0}function Kb(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function od(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function SN(t,e=r=>0,n,s){return new Promise((r,o)=>{let i=0;const a=()=>{if(t()){r();return}i++;const l=e(i);if(n!=null&&i>=n){o();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function u2(t,e){let n=1,s=-1;for(let o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(t[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(t[o]<0)throw Error(`Shapes can not be < 0. Found ${t[o]} at dim ${o}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const r=t.slice();return r[s]=e/n,r}function xt(t,e){const n=e.length;return t=t==null?e.map((s,r)=>r):[].concat(t),A(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),A(t.every(s=>wd(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function Vl(t,e){const n=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||r?null:xt(e,t).sort();let i=0;for(let a=0;a<t.length;++a){if(o!=null){if(o[i]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(o[i]==null||o[i]>a)&&t[a]===1&&(n.push(t[a]),s.push(a)),o[i]<=a&&i++}t[a]!==1&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function ps(t,e){return Mn(t,e)}function Mn(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function Mj(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function Bj(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function c2(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function ax(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function Vj(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function Md(t){return typeof t=="string"||t instanceof String}function Uj(t){return typeof t=="boolean"}function qb(t){return typeof t=="number"}function oc(t){return Array.isArray(t)?oc(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":qb(t)?"float32":Md(t)?"string":Uj(t)?"bool":"float32"}function Xb(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Yb(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function st(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function ZA(t,e,n,s=!1){const r=new Array;if(e.length===1){const o=e[0]*(s?2:1);for(let i=0;i<o;i++)r[i]=n[t+i]}else{const o=e[0],i=e.slice(1),a=i.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<o;l++)r[l]=ZA(t+l*a,i,n,s)}return r}function jo(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((r,o)=>r*o)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return ZA(0,t,e,n)}function by(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function d2(t,e){const n=Ls(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function Ls(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function e3(t,e){const n=t.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return jo(t,new Float32Array(n));if(e==="int32")return jo(t,new Int32Array(n));if(e==="bool")return jo(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function yo(t){t.forEach(e=>{A(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function sa(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let r=0;r<t.length-1;++r)s+=n[r]*t[r];return s}function Bd(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(t/n[r]),t-=s[r]*n[r];return s[s.length-1]=t,s}function Uu(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CN="tfjsflags";class Wj{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=jj,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(re().getBool("IS_TEST")||re().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];re().getBool("IS_TEST")||re().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(Uu(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);CN in e&&e[CN].split(",").forEach(s=>{const[r,o]=s.split(":");this.urlFlags[r]=Hj(r,o)})}}function jj(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(Gj(e,s[0],s[1]),s.join("="))),e}function Gj(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function Hj(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function re(){return t3}let t3=null;function Kj(t){t3=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let xv;function n3(){if(xv==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");xv=t}return xv}function qj(){const t=n3();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function h2(t,e){const n=qj();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const Wf="Abs",Vd="Acos",Ud="Acosh",ic="Add",jf="AddN",f0="All",m0="Any",Gf="ArgMax",Hf="ArgMin",Wd="Asin",jd="Asinh",Gd="Atan",Hd="Atanh",Kd="Atan2",Kf="AvgPool",g0="AvgPoolGrad",qf="AvgPool3D",y0="AvgPool3DGrad",Xf="BatchMatMul",Yf="BatchToSpaceND",x0="Bincount",w0="BitwiseAnd",Xj="BroadcastTo",v0="BroadcastArgs",qd="Cast",Xd="Ceil",Yd="ClipByValue",b0="Complex",Qf="ComplexAbs",Jf="Concat",Zf="Conv2D",S0="Conv2DBackpropFilter",em="Conv2DBackpropInput",tm="Conv3D",C0="Conv3DBackpropFilterV2",k0="Conv3DBackpropInputV2",Qd="Cos",Jd="Cosh",I0="Cumprod",nm="Cumsum",$0="CropAndResize",N0="DenseBincount",T0="DepthToSpace",sm="DepthwiseConv2dNative",E0="DepthwiseConv2dNativeBackpropFilter",R0="DepthwiseConv2dNativeBackpropInput",D0="Diag",rm="Dilation2D",lx="Dilation2DBackpropInput",ux="Dilation2DBackpropFilter",p2="Draw",Zd="RealDiv",A0="Einsum",eh="Elu",_0="EluGrad",th="Erf",om="Equal",nh="Exp",im="ExpandDims",sh="Expm1",F0="FFT",P0="Fill",O0="FlipLeftRight",rh="Floor",oh="FloorDiv",am="FusedBatchNorm",lm="GatherV2",L0="GatherNd",um="Greater",ih="GreaterEqual",ah="Identity",z0="IFFT",M0="Imag",lh="IsFinite",uh="IsInf",ch="IsNan",cm="LeakyRelu",dm="Less",hm="LessEqual",B0="LinSpace",dh="Log",hh="Log1p",pm="LogicalAnd",fm="LogicalNot",mm="LogicalOr",Yj="LogSoftmax",gm="LRN",V0="LRNGrad",ym="Max",ph="Maximum",xm="MaxPool",U0="MaxPoolGrad",wm="MaxPool3D",W0="MaxPool3DGrad",j0="MaxPoolWithArgmax",vm="Mean",bm="Min",fh="Minimum",Sm="MirrorPad",mh="Mod",G0="Multinomial",gh="Multiply",Cm="Neg",km="NotEqual",H0="NonMaxSuppressionV3",f2="NonMaxSuppressionV4",K0="NonMaxSuppressionV5",Im="OnesLike",$m="OneHot",Nm="Pack",Tm="PadV2",yh="Pow",Em="Prelu",Rm="Prod",m2="RaggedGather",g2="RaggedRange",y2="RaggedTensorToTensor",q0="Range",X0="Real",xh="Reciprocal",wh="Relu",Dm="Reshape",Am="ResizeNearestNeighbor",Y0="ResizeNearestNeighborGrad",_m="ResizeBilinear",Q0="ResizeBilinearGrad",vh="Relu6",Fm="Reverse",bh="Round",Sh="Rsqrt",J0="ScatterNd",Z0="TensorScatterUpdate",ew="SearchSorted",Pm="Select",Ch="Selu",Om="Slice",kh="Sin",Ih="Sinh",$h="Sign",Nh="Sigmoid",Th="Softplus",Eh="Sqrt",Lm="Sum",zm="SpaceToBatchND",Mm="SplitV",Bm="Softmax",x2="SparseFillEmptyRows",w2="SparseReshape",tw="SparseSegmentMean",nw="SparseSegmentSum",sw="SparseToDense",Rh="SquaredDifference",rw="Square",ow="StaticRegexReplace",iw="StridedSlice",aw="StringNGrams",v2="StringSplit",b2="StringToHashBucketFast",Dh="Sub",Ah="Tan",_h="Tanh",Fh="Tile",lw="TopK",uw="Transform",Eu="Transpose",S2="Unique",Vm="Unpack",Um="UnsortedSegmentSum",Wm="ZerosLike",Ph="Step",cx="FromPixels",cw="RotateWithOffset",pf="_FusedMatMul",ff="FusedConv2D",mf="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oo(...t){re().getBool("IS_TEST")||re().getBool("PROD")||console.warn(...t)}function Qj(...t){re().getBool("IS_TEST")||re().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dx=h2("kernelRegistry",()=>new Map),Qb=h2("gradRegistry",()=>new Map);function hx(t,e){const n=s3(t,e);return dx.get(n)}function kN(t){return Qb.get(t)}function IN(t){const e=dx.entries(),n=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[o,i]=r,[a]=o.split("_");a===t&&n.push(i)}return n}function C2(t){const{kernelName:e,backendName:n}=t,s=s3(e,n);dx.has(s)&&oo(`The kernel '${e}' for backend '${n}' is already registered`),dx.set(s,t)}function Jj(t){const{kernelName:e}=t;Qb.has(e)&&re().getBool("DEBUG")&&oo(`Overriding the gradient for '${e}'`),Qb.set(e,t)}function s3(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r3(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var o3=vn,Lo=null;try{Lo=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function vn(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}vn.prototype.__isLong__;Object.defineProperty(vn.prototype,"__isLong__",{value:!0});function Jr(t){return(t&&t.__isLong__)===!0}vn.isLong=Jr;var $N={},NN={};function ac(t,e){var n,s,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(s=NN[t],s)?s:(n=bn(t,(t|0)<0?-1:0,!0),r&&(NN[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(s=$N[t],s)?s:(n=bn(t,t<0?-1:0,!1),r&&($N[t]=n),n))}vn.fromInt=ac;function zo(t,e){if(isNaN(t))return e?Su:Mo;if(e){if(t<0)return Su;if(t>=i3)return u3}else{if(t<=-EN)return Vr;if(t+1>=EN)return l3}return t<0?zo(-t,e).neg():bn(t%vd|0,t/vd|0,e)}vn.fromNumber=zo;function bn(t,e,n){return new vn(t,e,n)}vn.fromBits=bn;var px=Math.pow;function k2(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return Mo;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return k2(t.substring(1),e,n).neg();for(var r=zo(px(n,8)),o=Mo,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),l=parseInt(t.substring(i,i+a),n);if(a<8){var u=zo(px(n,a));o=o.mul(u).add(zo(l))}else o=o.mul(r),o=o.add(zo(l))}return o.unsigned=e,o}vn.fromString=k2;function Fi(t,e){return typeof t=="number"?zo(t,e):typeof t=="string"?k2(t,e):bn(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}vn.fromValue=Fi;var TN=65536,Zj=1<<24,vd=TN*TN,i3=vd*vd,EN=i3/2,RN=ac(Zj),Mo=ac(0);vn.ZERO=Mo;var Su=ac(0,!0);vn.UZERO=Su;var Jc=ac(1);vn.ONE=Jc;var a3=ac(1,!0);vn.UONE=a3;var Jb=ac(-1);vn.NEG_ONE=Jb;var l3=bn(-1,2147483647,!1);vn.MAX_VALUE=l3;var u3=bn(-1,-1,!0);vn.MAX_UNSIGNED_VALUE=u3;var Vr=bn(0,-2147483648,!1);vn.MIN_VALUE=Vr;var Pe=vn.prototype;Pe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Pe.toNumber=function(){return this.unsigned?(this.high>>>0)*vd+(this.low>>>0):this.high*vd+(this.low>>>0)};Pe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Vr)){var n=zo(e),s=this.div(n),r=s.mul(n).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=zo(px(e,6),this.unsigned),i=this,a="";;){var l=i.div(o),u=i.sub(l.mul(o)).toInt()>>>0,c=u.toString(e);if(i=l,i.isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}};Pe.getHighBits=function(){return this.high};Pe.getHighBitsUnsigned=function(){return this.high>>>0};Pe.getLowBits=function(){return this.low};Pe.getLowBitsUnsigned=function(){return this.low>>>0};Pe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Vr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};Pe.isZero=function(){return this.high===0&&this.low===0};Pe.eqz=Pe.isZero;Pe.isNegative=function(){return!this.unsigned&&this.high<0};Pe.isPositive=function(){return this.unsigned||this.high>=0};Pe.isOdd=function(){return(this.low&1)===1};Pe.isEven=function(){return(this.low&1)===0};Pe.equals=function(e){return Jr(e)||(e=Fi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Pe.eq=Pe.equals;Pe.notEquals=function(e){return!this.eq(e)};Pe.neq=Pe.notEquals;Pe.ne=Pe.notEquals;Pe.lessThan=function(e){return this.comp(e)<0};Pe.lt=Pe.lessThan;Pe.lessThanOrEqual=function(e){return this.comp(e)<=0};Pe.lte=Pe.lessThanOrEqual;Pe.le=Pe.lessThanOrEqual;Pe.greaterThan=function(e){return this.comp(e)>0};Pe.gt=Pe.greaterThan;Pe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Pe.gte=Pe.greaterThanOrEqual;Pe.ge=Pe.greaterThanOrEqual;Pe.compare=function(e){if(Jr(e)||(e=Fi(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Pe.comp=Pe.compare;Pe.negate=function(){return!this.unsigned&&this.eq(Vr)?Vr:this.not().add(Jc)};Pe.neg=Pe.negate;Pe.add=function(e){Jr(e)||(e=Fi(e));var n=this.high>>>16,s=this.high&65535,r=this.low>>>16,o=this.low&65535,i=e.high>>>16,a=e.high&65535,l=e.low>>>16,u=e.low&65535,c=0,d=0,h=0,p=0;return p+=o+u,h+=p>>>16,p&=65535,h+=r+l,d+=h>>>16,h&=65535,d+=s+a,c+=d>>>16,d&=65535,c+=n+i,c&=65535,bn(h<<16|p,c<<16|d,this.unsigned)};Pe.subtract=function(e){return Jr(e)||(e=Fi(e)),this.add(e.neg())};Pe.sub=Pe.subtract;Pe.multiply=function(e){if(this.isZero())return Mo;if(Jr(e)||(e=Fi(e)),Lo){var n=Lo.mul(this.low,this.high,e.low,e.high);return bn(n,Lo.get_high(),this.unsigned)}if(e.isZero())return Mo;if(this.eq(Vr))return e.isOdd()?Vr:Mo;if(e.eq(Vr))return this.isOdd()?Vr:Mo;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(RN)&&e.lt(RN))return zo(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,o=this.low>>>16,i=this.low&65535,a=e.high>>>16,l=e.high&65535,u=e.low>>>16,c=e.low&65535,d=0,h=0,p=0,f=0;return f+=i*c,p+=f>>>16,f&=65535,p+=o*c,h+=p>>>16,p&=65535,p+=i*u,h+=p>>>16,p&=65535,h+=r*c,d+=h>>>16,h&=65535,h+=o*u,d+=h>>>16,h&=65535,h+=i*l,d+=h>>>16,h&=65535,d+=s*c+r*u+o*l+i*a,d&=65535,bn(p<<16|f,d<<16|h,this.unsigned)};Pe.mul=Pe.multiply;Pe.divide=function(e){if(Jr(e)||(e=Fi(e)),e.isZero())throw Error("division by zero");if(Lo){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?Lo.div_u:Lo.div_s)(this.low,this.high,e.low,e.high);return bn(n,Lo.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Su:Mo;var s,r,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Su;if(e.gt(this.shru(1)))return a3;o=Su}else{if(this.eq(Vr)){if(e.eq(Jc)||e.eq(Jb))return Vr;if(e.eq(Vr))return Jc;var i=this.shr(1);return s=i.div(e).shl(1),s.eq(Mo)?e.isNegative()?Jc:Jb:(r=this.sub(e.mul(s)),o=s.add(r.div(e)),o)}else if(e.eq(Vr))return this.unsigned?Su:Mo;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=Mo}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:px(2,a-48),u=zo(s),c=u.mul(e);c.isNegative()||c.gt(r);)s-=l,u=zo(s,this.unsigned),c=u.mul(e);u.isZero()&&(u=Jc),o=o.add(u),r=r.sub(c)}return o};Pe.div=Pe.divide;Pe.modulo=function(e){if(Jr(e)||(e=Fi(e)),Lo){var n=(this.unsigned?Lo.rem_u:Lo.rem_s)(this.low,this.high,e.low,e.high);return bn(n,Lo.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Pe.mod=Pe.modulo;Pe.rem=Pe.modulo;Pe.not=function(){return bn(~this.low,~this.high,this.unsigned)};Pe.and=function(e){return Jr(e)||(e=Fi(e)),bn(this.low&e.low,this.high&e.high,this.unsigned)};Pe.or=function(e){return Jr(e)||(e=Fi(e)),bn(this.low|e.low,this.high|e.high,this.unsigned)};Pe.xor=function(e){return Jr(e)||(e=Fi(e)),bn(this.low^e.low,this.high^e.high,this.unsigned)};Pe.shiftLeft=function(e){return Jr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?bn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):bn(0,this.low<<e-32,this.unsigned)};Pe.shl=Pe.shiftLeft;Pe.shiftRight=function(e){return Jr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?bn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):bn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Pe.shr=Pe.shiftRight;Pe.shiftRightUnsigned=function(e){if(Jr(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var s=this.low;return bn(s>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?bn(n,0,this.unsigned):bn(n>>>e-32,0,this.unsigned)};Pe.shru=Pe.shiftRightUnsigned;Pe.shr_u=Pe.shiftRightUnsigned;Pe.toSigned=function(){return this.unsigned?bn(this.low,this.high,!1):this};Pe.toUnsigned=function(){return this.unsigned?this:bn(this.low,this.high,!0)};Pe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Pe.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Pe.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};vn.fromBytes=function(e,n,s){return s?vn.fromBytesLE(e,n):vn.fromBytesBE(e,n)};vn.fromBytesLE=function(e,n){return new vn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};vn.fromBytesBE=function(e,n){return new vn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const c3=jx(o3),eG=tC({__proto__:null,default:c3},[o3]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hu=c3||eG;function dw(t){return hu.fromString(t,!0,16)}const d3=dw("c3a5c85c97cb3127"),lu=dw("b492b66fbe98f273"),ar=dw("9ae16a3b2f90404f");function Zb(t){return t.xor(t.shru(47))}function h3(t,e,n){const s=t.slice(e,e+n);return hu.fromBytes(Array.from(s),!0,!0)}function fn(t,e){return h3(t,e,8)}function DN(t,e){return h3(t,e,4)}function Ss(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function vl(t,e,n=dw("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let r=e.xor(s).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function tG(t,e,n,s,r,o){r=r.add(t),o=Ss(o.add(r).add(s),21);const i=r;return r=r.add(e),r=r.add(n),o=o.add(Ss(r,44)),[r.add(s),o.add(i)]}function Gg(t,e,n,s){return tG(fn(t,e),fn(t,e+8),fn(t,e+16),fn(t,e+24),n,s)}function nG(t,e=t.length){if(e>=8){const n=ar.add(e*2),s=fn(t,0).add(ar),r=fn(t,e-8),o=Ss(r,37).mul(n).add(s),i=Ss(s,25).add(r).mul(n);return vl(o,i,n)}if(e>=4){const n=ar.add(e*2),s=DN(t,0);return vl(s.shl(3).add(e),DN(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],r=t[e-1],o=n+(s<<8),i=e+(r<<2);return Zb(ar.mul(o).xor(d3.mul(i))).mul(ar)}return ar}function sG(t,e=t.length){const n=ar.add(e*2),s=fn(t,0).mul(lu),r=fn(t,8),o=fn(t,e-8).mul(n),i=fn(t,e-16).mul(ar);return vl(Ss(s.add(r),43).add(Ss(o,30)).add(i),s.add(Ss(r.add(ar),18)).add(o),n)}function rG(t,e=t.length){const n=ar.add(e*2),s=fn(t,0).mul(ar),r=fn(t,8),o=fn(t,e-8).mul(n),i=fn(t,e-16).mul(ar),a=Ss(s.add(r),43).add(Ss(o,30)).add(i),l=vl(a,s.add(Ss(r.add(ar),18)).add(o),n),u=fn(t,16).mul(n),c=fn(t,24),d=a.add(fn(t,e-32)).mul(n),h=l.add(fn(t,e-24)).mul(n);return vl(Ss(u.add(c),43).add(Ss(d,30)).add(h),u.add(Ss(c.add(s),18)).add(d),n)}function oG(t,e=t.length){const n=hu.fromNumber(81,!0);if(e<=32)return e<=16?nG(t,e):sG(t,e);if(e<=64)return rG(t,e);let s=n,r=n.mul(lu).add(113),o=Zb(r.mul(ar).add(113)).mul(ar),i=[hu.UZERO,hu.UZERO],a=[hu.UZERO,hu.UZERO];s=s.mul(ar).add(fn(t,0));let l=0;const u=(e-1>>6)*64,c=u+(e-1&63)-63;do s=Ss(s.add(r).add(i[0]).add(fn(t,l+8)),37).mul(lu),r=Ss(r.add(i[1]).add(fn(t,l+48)),42).mul(lu),s=s.xor(a[1]),r=r.add(i[0]).add(fn(t,l+40)),o=Ss(o.add(a[0]),33).mul(lu),i=Gg(t,l,i[1].mul(lu),s.add(a[0])),a=Gg(t,l+32,o.add(a[1]),r.add(fn(t,l+16))),[o,s]=[s,o],l+=64;while(l!==u);const d=lu.add(o.and(255).shl(1));return l=c,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),s=Ss(s.add(r).add(i[0]).add(fn(t,l+8)),37).mul(d),r=Ss(r.add(i[1]).add(fn(t,l+48)),42).mul(d),s=s.xor(a[1].mul(9)),r=r.add(i[0].mul(9).add(fn(t,l+40))),o=Ss(o.add(a[0]),33).mul(d),i=Gg(t,l,i[1].mul(d),s.add(a[0])),a=Gg(t,l+32,o.add(a[1]),r.add(fn(t,l+16))),[o,s]=[s,o],vl(vl(i[0],a[0],d).add(Zb(r).mul(d3)).add(o),vl(i[1],a[1],d).add(s),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ul(t,e){return e==="string"?Da(t):lc([t],e)}function iG(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function lc(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Ma(t)),re().getBool("DEBUG")&&Mj(t,e),iG(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function xr(){return re().platform.now()}function Da(t,e="utf-8"){return e=e||"utf-8",re().platform.encode(t,e)}function ki(t,e="utf-8"){return e=e||"utf-8",re().platform.decode(t,e)}function Xo(t){return re().platform.isTypedArray!=null?re().platform.isTypedArray(t):r3(t)}function Ma(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||Uu(t)||t==null||Xo(t)&&n)e.push(t);else if(Array.isArray(t)||Xo(t))for(let s=0;s<t.length;++s)Ma(t[s],e,n);else{let s=-1;for(const r of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Ma(t[r],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aG{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new uG)}profileKernel(e,n,s){let r;const o=()=>{r=s()};let i;const a=xr();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const u of r)u.dataSync();i=Promise.resolve({kernelMs:xr()-a})}if(re().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const c=r[u];c.data().then(d=>{lG(d,c.dtype,e)})}return{kernelName:e,outputs:r,inputs:n,timeMs:i.then(u=>u.kernelMs),extraInfo:i.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:r,inputs:o,extraInfo:i}=e;s.forEach(a=>{Promise.all([a.data(),r,i]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],o,l[2])})})}}function lG(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const r=t[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class uG{logKernelProfile(e,n,s,r,o,i){const a=typeof r=="number"?od(`${r}ms`,9):r.error,l=od(e,25),u=n.rank,c=n.size,d=od(n.shape.toString(),14);let h="";for(const p in o){const f=o[p];if(f!=null){const m=f.shape||n.shape,g=m.length;h+=`${p}: ${g}D ${g>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${d}	%c${c}	%c${h}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cG(t,e,n){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<t.length;l++){const u=t[l],c=u.inputs;for(const d in c){const h=c[d];let p=!1;for(let f=0;f<e.length;f++)if(s[h.id]){u.outputs.forEach(m=>s[m.id]=!0),p=!0,r[u.id]=!0;break}if(p)break}}const o={};o[n.id]=!0;const i={};for(let l=t.length-1;l>=0;l--){const u=t[l],c=u.inputs;for(let d=0;d<u.outputs.length;d++)if(o[u.outputs[d].id]){for(const h in c)o[c[h].id]=!0,i[u.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const u=t[l];if(r[u.id]&&i[u.id]){const c={};for(const h in u.inputs){const p=u.inputs[h];s[p.id]&&(c[h]=p)}const d=Object.assign({},u);d.inputs=c,d.outputs=u.outputs,a.push(d)}}return a}function dG(t,e,n,s){for(let r=e.length-1;r>=0;r--){const o=e[r],i=[];if(o.outputs.forEach(l=>{const u=t[l.id];u!=null?i.push(u):i.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const l in o.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=n(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const c=o.inputs[l];if(!Ct(u.shape,c.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${c.shape}'`);if(t[c.id]==null)t[c.id]=u;else{const d=t[c.id];t[c.id]=s(d,u),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AN=20,yp=3,wv=7;function hG(t,e,n,s){const r=st(e),o=pG(t,e,n,r),i=e.length,a=Sy(t,e,n,r,o),l=["Tensor"];return s&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${i}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function pG(t,e,n,s){const r=te(e),o=s[s.length-1],i=new Array(o).fill(0),a=e.length,l=n==="complex64"?Ep(t):t;if(a>1)for(let u=0;u<r/o;u++){const c=u*o;for(let d=0;d<o;d++)i[d]=Math.max(i[d],Tp(l[c+d],0,n).length)}return i}function Tp(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(wv))} + ${parseFloat(t[1].toFixed(wv))}j`:Md(t)?s=`'${t}'`:n==="bool"?s=p3(t):s=parseFloat(t.toFixed(wv)).toString(),od(s,e)}function p3(t){return t===0?"false":"true"}function Sy(t,e,n,s,r,o=!0){const i=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const m=Ep(t);return[Tp(m[0],0,n)]}return n==="bool"?[p3(t[0])]:[t[0].toString()]}if(l===1){if(a>AN){const g=yp*i;let y=Array.from(t.slice(0,g)),x=Array.from(t.slice((a-yp)*i,a*i));return n==="complex64"&&(y=Ep(y),x=Ep(x)),["["+y.map((v,b)=>Tp(v,r[b],n)).join(", ")+", ..., "+x.map((v,b)=>Tp(v,r[a-yp+b],n)).join(", ")+"]"]}return["["+(n==="complex64"?Ep(t):Array.from(t)).map((g,y)=>Tp(g,r[y],n)).join(", ")+"]"]}const u=e.slice(1),c=s.slice(1),d=s[0]*i,h=[];if(a>AN){for(let m=0;m<yp;m++){const g=m*d,y=g+d;h.push(...Sy(t.slice(g,y),u,n,c,r,!1))}h.push("...");for(let m=a-yp;m<a;m++){const g=m*d,y=g+d;h.push(...Sy(t.slice(g,y),u,n,c,r,m===a-1))}}else for(let m=0;m<a;m++){const g=m*d,y=g+d;h.push(...Sy(t.slice(g,y),u,n,c,r,m===a-1))}const p=l===2?",":"";h[0]="["+(a>0?h[0]+p:"");for(let m=1;m<h.length-1;m++)h[m]=" "+h[m]+p;let f=`,
`;for(let m=2;m<l;m++)f+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":f),h}function Ep(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cs{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=te(e),s!=null){const r=s.length;A(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||Mn(n,this.size),this.strides=st(e)}set(e,...n){n.length===0&&(n=[0]),A(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const r of e){if(r<0||r>=this.shape[n]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}n++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return mi().makeTensor(this.values,this.shape,this.dtype)}}let mi=null,Lc=null;function fG(t){mi=t}function mG(t){Lc=t}class Qt{constructor(e,n,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=te(e),this.strides=st(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Lc.buffer(this.shape,this.dtype,e)}bufferSync(){return Lc.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return jo(this.shape,e,this.dtype==="complex64")}arraySync(){return jo(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=mi().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>ki(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),mi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=mi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>ki(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await mi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),mi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Lc.print(this,e)}clone(){return this.throwIfDisposed(),Lc.clone(this)}toString(e=!1){const n=this.dataSync();return hG(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Lc.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),mi().makeVariable(this,e,n,s)}}Object.defineProperty(Qt,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function he(){return h2("Tensor",()=>Qt)}he();class fx extends Qt{constructor(e,n,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Ct(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);mi().disposeTensor(this),this.dataId=e.dataId,mi().incRef(this,null)}dispose(){mi().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(fx,Symbol.hasInstance,{value:t=>t instanceof Qt&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var _N;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(_N||(_N={}));var eS;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(eS||(eS={}));var tS;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(tS||(tS={}));var nS;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(nS||(nS={}));var sS;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(sS||(sS={}));const gG={float32:nS,int32:eS,bool:tS,complex64:sS};function $s(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return gG[t][e]}function hw(t){return $s(t,"int32")}function f3(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function m3(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Un(t,e){if(t.dtype===e.dtype)return[t,e];const n=$s(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function yG(t,e){A(t.dtype===e.dtype,()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`)}function g3(t){const e=[];return y3(t,e,new Set),e}function y3(t,e,n){if(t==null)return;if(t instanceof Qt){e.push(t);return}if(!xG(t))return;const s=t;for(const r in s){const o=s[r];n.has(o)||(n.add(o),y3(o,e,n))}}function xG(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vv(t){return t.kernelName!=null}class FN{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class bd{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new FN}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(oo(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new aG(this.backendInstance),!0}setupRegisteredKernels(){IN(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){IN(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof p0)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,o=s.then(i=>r<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,oo(`Initialization of backend ${e} failed`),oo(i.stack||i.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return oo(`Initialization of backend ${e} failed`),oo(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:r,asyncInit:o}=this.initializeBackend(s);if(o||r)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),r=s.backend,o=this.readSync(n),i=r.refCount(n);r.disposeData(n,!0),s.backend=e,e.move(n,o,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=n(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,n,s){e();try{const r=s();return n(),r}catch(r){throw n(),r}}nextTensorId(){return bd.nextTensorId++}nextVariableId(){return bd.nextVariableId++}clone(e){const n=K.runKernel(ah,{x:e}),s={x:e},r=i=>({x:()=>{const a="float32",l={x:i},u={dtype:a};return K.runKernel(qd,l,u)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[n],r,o,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(hx(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const r=this.backend.numDataIds();let o=0;s.forEach(l=>{o+=l.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-n-o-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const r=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=vv(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(vv(e)){const{kernelName:f,inputs:m,attrs:g}=e;this.backendName==null&&this.backend;const y=hx(f,this.backendName);A(y!=null,()=>`Cannot find registered kernel '${f}' for backend '${this.backendName}'`),a=()=>{const x=this.backend.numDataIds();l=y.kernelFunc({inputs:m,attrs:g,backend:this.backend});const v=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(f,x,v);const b=v.map(S=>S.rank!=null?S:this.makeTensorFromTensorInfo(S));if(r){const S=this.getTensorsForGradient(f,m,b);s=this.saveTensorsForBackwardMode(S)}return b}}else{const{forwardFunc:f}=e,m=g=>{r&&(s=g.map(y=>this.keep(this.clone(y))))};a=()=>{const g=this.backend.numDataIds();l=this.tidy(()=>f(this.backend,m));const y=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,g,y),y}}const{inputs:c,attrs:d}=e,h=vv(e)?null:e.backwardsFunc;let p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(p=this.profiler.profileKernel(u,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),n=p.outputs)}),r&&this.addTapeNode(u,c,n,h,s,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(f=>c[f]!=null?c[f].shape:null),outputShapes:n.map(f=>f.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const r=kN(e);if(r!=null){const o=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(A(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(u=>n[u])):a=o.map(u=>n[u]);const l=s.filter((u,c)=>i[c]);return a.concat(l)}return[]}makeTensor(e,n,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let o=e;s==="string"&&Md(e[0])&&(o=e.map(l=>Da(l)));const i=r.write(o,n,s),a=new Qt(n,s,i,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(i),u=Vj(o);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,n,s,r){s=s||"float32";const o={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:r,dtype:o}=e,i=new Qt(r,o,s,this.nextTensorId());return this.trackTensor(i,n),i}makeVariable(e,n=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const o=new fx(e,n,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*ax(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof fx||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*ax(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,r,o,i){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:o},l=kN(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((c,d)=>{if(c==null){const h=s[d],p=Ls(h.size,h.dtype);return this.makeTensor(p,h.shape,h.dtype)}return c}),r(u.length>1?u:u[0],o,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=g3(e),s=new Set(n.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const i=this.state.activeScope.track[o];!i.kept&&!s.has(i.id)&&i.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(e,n,s,r=!1){if(A(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));A(o instanceof Qt,()=>"The result y returned by f() must be a tensor.");const i=cG(this.state.activeTape,n,o);if(!r&&i.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=s??wG(o.shape),dG(a,i,u=>this.tidy(u),vG);const l=n.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const c of u.saved)c.dispose()}),this.state.activeTape=null),{value:o,grads:l}})}customGrad(e){return A(Xb(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{A(n.every(a=>a instanceof Qt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};n.forEach((a,l)=>{r[l]=a});const o=(a,l)=>(s=e(...n,l),A(s.value instanceof Qt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),A(Xb(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(a,l)=>{const u=s.gradFunc(a,l),c=Array.isArray(u)?u:[u];A(c.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),A(c.every(h=>h instanceof Qt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return c.forEach((h,p)=>{d[p]=()=>h}),d};return this.runKernelFunc({forwardFunc:o,backwardsFunc:i,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=xr(),s=await this.backend.time(e);return s.wallMs=xr()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new FN;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}bd.nextTensorId=0;bd.nextVariableId=0;function wG(t){const e=d2(te(t),"float32");return K.makeTensor(e,t,"float32")}function x3(){const t=n3();if(t._tfengine==null){const e=new Wj(t);t._tfengine=new bd(e)}return Kj(t._tfengine.ENV),fG(()=>t._tfengine),t._tfengine}const K=x3();function vG(t,e){const n={a:t,b:e};return K.runKernel(ic,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bG(){return typeof navigator<"u"&&navigator!=null}function w3(t){if(t||bG()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function v3(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kr=re();kr.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});kr.registerFlag("IS_BROWSER",()=>v3());kr.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");kr.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));kr.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));kr.registerFlag("PROD",()=>!1);kr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>kr.getBool("DEBUG"));kr.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);kr.registerFlag("IS_TEST",()=>!1);kr.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>kr.getBool("DEBUG"));kr.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);kr.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);kr.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wl(t,e){let n=t;if(Xo(t))return e==="string"?[]:[t.length];if(f3(t)){const r=t.channels||"RGBA";return[t.height,t.width*r.length]}else if(m3(t))return[t.buffer.size/(e==null?4:ax(e))];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||Xo(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&re().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&b3(t,s,[]),s}function b3(t,e,n){if(n=n||[],!Array.isArray(t)&&!Xo(t)){A(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}A(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),A(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let r=0;r<t.length;++r)b3(t[r],s,n.concat(r))}function PN(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function F(t,e,n,s="numeric"){if(t instanceof he())return PN(s,t.dtype,e,n),t;let r=oc(t);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),PN(s,r,e,n),t==null||!Xo(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const o=Wl(t,r);!Xo(t)&&!Array.isArray(t)&&(t=[t]);const a=r!=="string"?lc(t,r):Ma(t,[],!0);return K.makeTensor(a,o,r)}function mx(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((o,i)=>F(o,`${e}[${i}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S3="__op";function G(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+S3;const r=(...o)=>{K.startScope(n);try{const i=s(...o);return Uu(i)&&console.error("Cannot return a Promise inside of tidy."),K.endScope(i),i}catch(i){throw K.endScope(null),i}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SG(t,e){const n=F(t,"real","complex"),s=F(e,"imag","complex");Er(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:n,imag:s};return K.runKernel(b0,r)}const Il=G({complex_:SG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jl(t,e,n,s){if(s==null)s=oc(t);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(m3(t)||f3(t)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return K.backend.createTensorFromGPUData(t,e||n,s)}if(!Xo(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){yo(e);const r=te(e),o=te(n);A(r===o,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${o}`);for(let i=0;i<n.length;++i){const a=n[i],l=i===n.length-1?a!==te(e.slice(i)):!0;A(n[i]===e[i]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!Xo(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?lc(t,s):Ma(t,[],!0),K.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bi(t,e,n){const s=Wl(t,n);return jl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wu={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Pi{static join(e){return new Pi(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Xo(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=n+r.byteLength;this.shards.push({buffer:r,start:n,end:o}),n=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=n-e,o=new ArrayBuffer(r),i=new Uint8Array(o);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],d=e+a-u.start,h=a,f=Math.min(n,u.end)-u.start,m=new Uint8Array(u.buffer,d,f-d);if(i.set(m,h),a+=m.length,n<u.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(r){return e<r.start?-1:e>=r.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=CG(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function CG(t,e){let n=0,s=t.length;for(;n<=s;){const r=Math.floor((s-n)/2)+n,o=e(t[r]);if(o===0)return r;o<0?s=r:n=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rr(){return K}function ON(){return K.memory()}function ne(t,e){return K.tidy(t,e)}function lt(t){g3(t).forEach(n=>n.dispose())}function ks(t){return K.keep(t)}function kG(){return K.ready()}function gf(){return K.backendName}function I2(t,e,n=1){return K.registerBackend(t,e,n)}function ju(){return K.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $l=4;async function rS(t,e){const n=[],s=[],r=Array.isArray(t)?t.map(i=>i.name):Object.keys(t);for(let i=0;i<r.length;++i){const a=r[i],l=Array.isArray(t)?t[i].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const c=new Promise(async d=>{const h=await l.bytes(),p=h.reduce((g,y)=>g+y.length,0)+$l*h.length,f=new Uint8Array(p);let m=0;for(let g=0;g<h.length;g++){const y=h[g],x=new Uint8Array(new Uint32Array([y.length]).buffer);f.set(x,m),m+=$l,f.set(y,m),m+=y.length}d(f)});s.push(c)}else s.push(l.data());e!=null&&(u.group=e),n.push(u)}const o=await Promise.all(s);return{data:NG(o),specs:n}}function C3(t,e){const n=new Pi(t),s={};let r=0;for(const o of e){const i=IG(o,(a,l)=>n.slice(r+a,r+l));s[o.name]=k3(o,n.slice(r,r+i)),r+=i}return s}function IG(t,e){const n=te(t.shape);let s;if("quantization"in t){const r=t.quantization;s=Wu[r.dtype]}else if(t.dtype==="string"){let r=0;for(let o=0;o<n;o++)r+=$l+new Uint32Array(e(r,r+$l))[0];return r}else s=Wu[t.dtype];return n*s}async function $G(t,e){const n=te(t.shape);let s;if("quantization"in t){const r=t.quantization;s=Wu[r.dtype]}else if(t.dtype==="string"){let r=0;for(let o=0;o<n;o++)r+=$l+new Uint32Array(await e(r,r+$l))[0];return r}else s=Wu[t.dtype];return n*s}function k3(t,e){const n=t.name,s=t.dtype,r=t.shape,o=te(r);let i,a=0;if("quantization"in t){const l=t.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${t.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${t.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=Wu[l.dtype],c=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){i=new Float32Array(c.length);for(let d=0;d<c.length;d++){const h=c[d];i[d]=h*l.scale+l.min}}else if(l.dtype==="float16")i=_G()(c);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);i=new Int32Array(c.length);for(let d=0;d<c.length;d++){const h=c[d];i[d]=Math.round(h*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=o*u}else if(s==="string"){const l=te(t.shape);i=[];for(let u=0;u<l;u++){const c=new Uint32Array(e.slice(a,a+$l))[0];a+=$l;const d=new Uint8Array(e.slice(a,a+c));i.push(d),a+=c}}else{const l=Wu[s];if(s==="float32")i=new Float32Array(e);else if(s==="int32")i=new Int32Array(e);else if(s==="bool")i=new Uint8Array(e);else if(s==="complex64"){i=new Float32Array(e);const u=new Float32Array(i.length/2),c=new Float32Array(i.length/2);for(let f=0;f<u.length;f++)u[f]=i[f*2],c[f]=i[f*2+1];const d=bi(u,r,"float32"),h=bi(c,r,"float32"),p=Il(d,h);return d.dispose(),h.dispose(),p}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=o*l}return bi(i,r,s)}async function LN(t,e,n){let s=new Uint8Array(e);for(;s.byteLength<n;){const{done:r,value:o}=await t.read();if(r&&o==null){const a=n-s.byteLength;throw new Error(`Reader is done but ${a} bytes are still expected`)}const i=new Uint8Array(s.length+o.byteLength);i.set(s,0),i.set(new Uint8Array(o),s.length),s=i}return s.buffer}async function I3(t,e){const n={},s=t.getReader();let r=new ArrayBuffer(0);for(const o of e){const i=await $G(o,async(u,c)=>(r=await LN(s,r,c),r.slice(u,c)));r=await LN(s,r,i);const a=r.slice(0,i);r=r.slice(i);const l=k3(o,a);if(n[o.name]=l,gf()==="webgpu"){const u=ju();"uploadToGPU"in u&&te(l.shape)>=re().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&u.uploadToGPU(l.dataId)}}return n}function NG(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(o=>{if(e+=o.byteLength,n.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(e);let r=0;return n.forEach(o=>{s.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),s.buffer}const $2=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function zN(t){return $2?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function TG(t){if($2)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,r=e.length;s<r;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function EG(t){if($2){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function $3(t){return Pi.join(t)}function MN(t){const e="/";for(t=t.trim();t.endsWith(e);)t=t.slice(0,t.length-1);const n=t.split(e);return n[n.length-1]}function N3(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function T3(t,e,n){const s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(s.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=n}return t.signature!=null&&(s.signature=t.signature),t.userDefinedMetadata!=null&&(s.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(s.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(s.initializerSignature=t.initializerSignature),s}async function N2(t,e){let n,s;return t.weightsManifest!=null&&([n,s]=await e(t.weightsManifest)),T3(t,n,s)}function jm(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:zN(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:zN(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new Pi(t.weightData).byteLength}}function oS(t){const e=[];for(const n of t)e.push(...n.weights);return e}function RG(){const t=n=>{let s=n<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function DG(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function AG(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function _G(){const t=RG(),e=DG(),n=AG();return s=>{const r=new ArrayBuffer(4*s.length),o=new Uint32Array(r);for(let i=0;i<s.length;i++){const a=s[i],l=t[n[a>>10]+(a&1023)]+e[a>>10];o[i]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class An{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return An.instance==null&&(An.instance=new An),An.instance}static registerSaveRouter(e){An.getInstance().saveRouters.push(e)}static registerLoadRouter(e){An.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return An.getHandlers(e,"save")}static getLoadHandlers(e,n){return An.getHandlers(e,"load",n)}static getHandlers(e,n,s){const r=[];return(n==="load"?An.getInstance().loadRouters:An.getInstance().saveRouters).forEach(i=>{const a=i(e,s);a!==null&&r.push(a)}),r}}const FG=t=>An.registerSaveRouter(t),PG=t=>An.registerLoadRouter(t),E3=t=>An.getSaveHandlers(t),OG=(t,e)=>An.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iS="tensorflowjs",aS=1,Cu="models_store",ll="model_info_store";function R3(){if(!re().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function lS(t){const e=t.result;e.createObjectStore(Cu,{keyPath:"modelPath"}),e.createObjectStore(ll,{keyPath:"modelPath"})}class Gu{constructor(e){if(this.indexedDB=R3(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,r)=>{const o=this.indexedDB.open(iS,aS);o.onupgradeneeded=()=>lS(o),o.onsuccess=()=>{const i=o.result;if(n==null){const a=i.transaction(Cu,"readonly"),u=a.objectStore(Cu).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return i.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=c=>(i.close(),r(u.error)),a.oncomplete=()=>i.close()}else{n.weightData=Pi.join(n.weightData);const a=jm(n),l=i.transaction(ll,"readwrite");let u=l.objectStore(ll),c;try{c=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(h){return r(h)}let d;c.onsuccess=()=>{d=i.transaction(Cu,"readwrite");const h=d.objectStore(Cu);let p;try{p=h.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(f){return r(f)}p.onsuccess=()=>s({modelArtifactsInfo:a}),p.onerror=f=>{u=l.objectStore(ll);const m=u.delete(this.modelPath);m.onsuccess=()=>(i.close(),r(p.error)),m.onerror=g=>(i.close(),r(p.error))}},c.onerror=h=>(i.close(),r(c.error)),l.oncomplete=()=>{d==null?i.close():d.oncomplete=()=>i.close()}}},o.onerror=i=>r(o.error)})}}Gu.URL_SCHEME="indexeddb://";const D3=t=>re().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Gu.URL_SCHEME)?LG(t.slice(Gu.URL_SCHEME.length)):null;An.registerSaveRouter(D3);An.registerLoadRouter(D3);function LG(t){return new Gu(t)}function zG(t){return t.startsWith(Gu.URL_SCHEME)?t.slice(Gu.URL_SCHEME.length):t}class MG{constructor(){this.indexedDB=R3()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(iS,aS);s.onupgradeneeded=()=>lS(s),s.onsuccess=()=>{const r=s.result,o=r.transaction(ll,"readonly"),a=o.objectStore(ll).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),n(a.error)),o.oncomplete=()=>r.close()},s.onerror=r=>n(s.error)})}async removeModel(e){return e=zG(e),new Promise((n,s)=>{const r=this.indexedDB.open(iS,aS);r.onupgradeneeded=()=>lS(r),r.onsuccess=()=>{const o=r.result,i=o.transaction(ll,"readwrite"),a=i.objectStore(ll),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return o.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const c=a.delete(e),d=()=>{u=o.transaction(Cu,"readwrite");const p=u.objectStore(Cu).delete(e);p.onsuccess=()=>n(l.result.modelArtifactsInfo),p.onerror=f=>s(l.error)};c.onsuccess=d,c.onerror=h=>(d(),o.close(),s(l.error))}},l.onerror=c=>(o.close(),s(l.error)),i.oncomplete=()=>{u==null?o.close():u.oncomplete=()=>o.close()}},r.onerror=o=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $a="/",zc="tensorflowjs_models",A3="info",BG="model_topology",VG="weight_specs",UG="weight_data",WG="model_metadata";function _3(t){return{info:[zc,t,A3].join($a),topology:[zc,t,BG].join($a),weightSpecs:[zc,t,VG].join($a),weightData:[zc,t,UG].join($a),modelMetadata:[zc,t,WG].join($a)}}function F3(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function jG(t){const e=t.split($a);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join($a)}function GG(t){return t.startsWith(Hu.URL_SCHEME)?t.slice(Hu.URL_SCHEME.length):t}class Hu{constructor(e){if(!re().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=_3(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=jm(e),o=Pi.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,TG(o));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch{throw F3(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=EG(i),n}}Hu.URL_SCHEME="localstorage://";const P3=t=>re().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Hu.URL_SCHEME)?HG(t.slice(Hu.URL_SCHEME.length)):null;An.registerSaveRouter(P3);An.registerLoadRouter(P3);function HG(t){return new Hu(t)}class KG{constructor(){A(re().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),A(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=zc+$a,s=$a+A3;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(n)&&o.endsWith(s)){const i=jG(o);e[i]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=GG(e);const n=_3(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return F3(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const id="://";class or{constructor(){this.managers={}}static getInstance(){return or.instance==null&&(or.instance=new or),or.instance}static registerManager(e,n){A(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(id)&&(e=e.slice(0,e.indexOf(id))),A(e.length>0,()=>"scheme must not be an empty string.");const s=or.getInstance();A(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=or.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(or.getInstance().managers)}}function Cy(t){if(t.indexOf(id)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${or.getSchemes().join(",")}`);return{scheme:t.split(id)[0],path:t.split(id)[1]}}async function O3(t,e,n=!1){A(t!==e,()=>`Old path and new path are the same: '${t}'`);const s=An.getLoadHandlers(t);A(s.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),A(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${t}.`);const r=s[0],o=An.getSaveHandlers(e);A(o.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),A(o.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${e}.`);const i=o[0],a=Cy(t).scheme,l=Cy(t).path,u=a===Cy(t).scheme,c=await r.load();n&&u&&await or.getManager(a).removeModel(l);const d=await i.save(c);return n&&!u&&await or.getManager(a).removeModel(l),d.modelArtifactsInfo}async function qG(){const t=or.getSchemes(),e={};for(const n of t){const s=await or.getManager(n).listModels();for(const r in s){const o=n+id+r;e[o]=s[r]}}return e}async function XG(t){const e=Cy(t);return or.getManager(e.scheme).removeModel(e.path)}async function YG(t,e){return O3(t,e,!1)}async function QG(t,e){return O3(t,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JG{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!re().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return r3(e)}}if(re().get("IS_BROWSER")){re().setPlatform("browser",new JG);try{or.registerManager(Hu.URL_SCHEME,new KG)}catch{}try{or.registerManager(Gu.URL_SCHEME,new MG)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZG={importFetch:()=>require("node-fetch")};let bv;class eH{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return re().global.fetch!=null?re().global.fetch(e,n):(bv==null&&(bv=ZG.importFetch()),bv(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}re().get("IS_NODE")&&!re().get("IS_BROWSER")&&re().setPlatform("node",new eH);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yt(t,e="float32",n){return e=e||"float32",yo(t),new cs(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tH(t,e){const n=F(t,"x","cast");if(!Bj(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},r={dtype:e};return K.runKernel(qd,s,r)}const Ee=G({cast_:tH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nH(t){const n={x:F(t,"x","clone","string_or_numeric")};return K.runKernel(ah,n)}const Aa=G({clone_:nH});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L3(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */x3();const sH={buffer:yt,cast:Ee,clone:Aa,print:L3};mG(sH);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rH(t,e){let n=F(t,"a","add"),s=F(e,"b","add");[n,s]=Un(n,s);const r={a:n,b:s};return K.runKernel(ic,r)}const me=G({add_:rH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oH(t,e){let n=F(t,"a","floorDiv"),s=F(e,"b","floorDiv");[n,s]=Un(n,s);const r={a:n,b:s};return K.runKernel(oh,r)}const T2=G({floorDiv_:oH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iH(t,e){let n=F(t,"a","div"),s=F(e,"b","div");if([n,s]=Un(n,s),n.dtype==="int32"&&s.dtype==="int32")return T2(n,s);const r={a:n,b:s},o={};return K.runKernel(Zd,r,o)}const Me=G({div_:iH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aH(t,e){let n=F(t,"a","mul"),s=F(e,"b","mul");[n,s]=Un(n,s);const r={a:n,b:s};return K.runKernel(gh,r)}const U=G({mul_:aH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lH(t){const e=F(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return K.runKernel(Qf,n)}else{const n={x:e};return K.runKernel(Wf,n)}}const is=G({abs_:lH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uH(t){const n={x:F(t,"x","acos")};return K.runKernel(Vd,n)}const z3=G({acos_:uH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cH(t){const n={x:F(t,"x","acosh")};return K.runKernel(Ud,n)}const M3=G({acosh_:cH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dH(t){A(Array.isArray(t),()=>"The argument passed to tf.addN() must be a list of tensors"),A(t.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`);const e=t.map((r,o)=>F(r,`tensors${o}`,"addN")),n=e[0];e.forEach(r=>{if(r.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(r=>{if(!Ct(r.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const s=e;return K.runKernel(jf,s)}const hH=G({addN_:dH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pH(t,e=null,n=!1){const r={x:F(t,"x","all","bool")},o={axis:e,keepDims:n};return K.runKernel(f0,r,o)}const E2=G({all_:pH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fH(t,e=null,n=!1){const r={x:F(t,"x","any","bool")},o={axis:e,keepDims:n};return K.runKernel(m0,r,o)}const gx=G({any_:fH});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mH(t,e=0){const s={x:F(t,"x","argMax")},r={axis:e};return K.runKernel(Gf,s,r)}const Ku=G({argMax_:mH});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gH(t,e=0){const s={x:F(t,"x","argMin")},r={axis:e};return K.runKernel(Hf,s,r)}const B3=G({argMin_:gH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yH(t){const n={x:F(t,"x","asin")};return K.runKernel(Wd,n)}const V3=G({asin_:yH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xH(t){const n={x:F(t,"x","asinh")};return K.runKernel(jd,n)}const U3=G({asinh_:xH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wH(t){const n={x:F(t,"x","atan")};return K.runKernel(Gd,n)}const W3=G({atan_:wH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vH(t,e){let n=F(t,"a","atan2"),s=F(e,"b","atan2");[n,s]=Un(n,s);const r={a:n,b:s};return K.runKernel(Kd,r)}const j3=G({atan2_:vH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bH(t){const n={x:F(t,"x","atanh")};return K.runKernel(Hd,n)}const G3=G({atanh_:bH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gl(t,e,n,s,r="NHWC",o){const i=t[3],a=[...e,i],l=Zr(r);return gn(t,a,n,o,s,null,null,l)}function qs(t,e,n,s,r,o,i="channelsLast"){const[a,l]=yf(e);let u;if(i==="channelsLast")u=[a,l,t[3],t[3]];else if(i==="channelsFirst")u=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return gn(t,u,n,s,r,o,!1,i)}function xo(t,e,n,s,r,o,i="NDHWC"){const[a,l,u]=uS(e);let c,d;if(i==="NDHWC")d="channelsLast",c=[a,l,u,t[4],t[4]];else if(i==="NCDHW")d="channelsFirst",c=[a,l,u,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return Oi(t,c,n,s,r,!1,d,o)}function gn(t,e,n,s,r,o,i=!1,a="channelsLast"){let[l,u,c,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,c,d]=t;else if(a==="channelsFirst")[l,d,u,c]=t;else throw new Error(`Unknown dataFormat ${a}`);const[h,p,,f]=e,[m,g]=yf(n),[y,x]=yf(s),v=ad(h,y),b=ad(p,x),{padInfo:S,outHeight:C,outWidth:I}=kH(r,u,c,m,g,v,b,o,a),T=i?f*d:f;let R;return a==="channelsFirst"?R=[l,T,C,I]:a==="channelsLast"&&(R=[l,C,I,T]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:c,inChannels:d,outHeight:C,outWidth:I,outChannels:T,padInfo:S,strideHeight:m,strideWidth:g,filterHeight:h,filterWidth:p,effectiveFilterHeight:v,effectiveFilterWidth:b,dilationHeight:y,dilationWidth:x,inShape:t,outShape:R,filterShape:e}}function Oi(t,e,n,s,r,o=!1,i="channelsLast",a){let[l,u,c,d,h]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[l,u,c,d,h]=t;else if(i==="channelsFirst")[l,h,u,c,d]=t;else throw new Error(`Unknown dataFormat ${i}`);const[p,f,m,,g]=e,[y,x,v]=uS(n),[b,S,C]=uS(s),I=ad(p,b),T=ad(f,S),R=ad(m,C),{padInfo:_,outDepth:P,outHeight:z,outWidth:O}=IH(r,u,c,d,y,x,v,I,T,R,a),V=o?g*h:g;let H;return i==="channelsFirst"?H=[l,V,P,z,O]:i==="channelsLast"&&(H=[l,P,z,O,V]),{batchSize:l,dataFormat:i,inDepth:u,inHeight:c,inWidth:d,inChannels:h,outDepth:P,outHeight:z,outWidth:O,outChannels:V,padInfo:_,strideDepth:y,strideHeight:x,strideWidth:v,filterDepth:p,filterHeight:f,filterWidth:m,effectiveFilterDepth:I,effectiveFilterHeight:T,effectiveFilterWidth:R,dilationDepth:b,dilationHeight:S,dilationWidth:C,inShape:t,outShape:H,filterShape:e}}function SH(t,e,n,s,r){s==null&&(s=R2(t,e,n));const o=t[0],i=t[1],a=xf((o-e+2*s)/n+1,r),l=xf((i-e+2*s)/n+1,r);return[a,l]}function CH(t,e,n,s,r,o){r==null&&(r=R2(t,e[0],s[0]));const i=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*r>=e[a]&&(i[a]=xf((t[a]-e[a]+2*r)/s[a]+1,o));return i}function R2(t,e,n,s=1){const r=ad(e,s);return Math.floor((t[0]*(n-1)-n+r)/2)}function yf(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function uS(t){return typeof t=="number"?[t,t,t]:t}function ad(t,e){return e<=1?t:t+(t-1)*(e-1)}function kH(t,e,n,s,r,o,i,a,l){let u,c,d;if(typeof t=="number"){u={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const p=SH([e,n],o,s,t,a);c=p[0],d=p[1]}else if(t==="same"){c=Math.ceil(e/s),d=Math.ceil(n/r);const h=Math.max(0,(c-1)*s+o-e),p=Math.max(0,(d-1)*r+i-n),f=Math.floor(h/2),m=h-f,g=Math.floor(p/2),y=p-g;u={top:f,bottom:m,left:g,right:y,type:"SAME"}}else if(t==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-o+1)/s),d=Math.ceil((n-i+1)/r);else if(typeof t=="object"){const h=l==="channelsLast"?t[1][0]:t[2][0],p=l==="channelsLast"?t[1][1]:t[2][1],f=l==="channelsLast"?t[2][0]:t[3][0],m=l==="channelsLast"?t[2][1]:t[3][1];u={top:h,bottom:p,left:f,right:m,type:h===0&&p===0&&f===0&&m===0?"VALID":"EXPLICIT"},c=xf((e-o+h+p)/s+1,a),d=xf((n-i+f+m)/r+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:u,outHeight:c,outWidth:d}}function IH(t,e,n,s,r,o,i,a,l,u,c){let d,h,p,f;if(t==="valid"&&(t=0),typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const g=CH([e,n,s,1],[a,l,u],1,[r,o,i],t,c);h=g[0],p=g[1],f=g[2]}else if(t==="same"){h=Math.ceil(e/r),p=Math.ceil(n/o),f=Math.ceil(s/i);const m=(h-1)*r+a-e,g=(p-1)*o+l-n,y=(f-1)*i+u-s,x=Math.floor(m/2),v=m-x,b=Math.floor(g/2),S=g-b,C=Math.floor(y/2),I=y-C;d={top:b,bottom:S,left:C,right:I,front:x,back:v,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:h,outHeight:p,outWidth:f}}function xf(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Nl(t){const[e,n,s]=yf(t);return e===1&&n===1&&s===1}function ms(t,e){return Nl(t)||Nl(e)}function qu(t){return yf(t).every(e=>e>0)}function Zr(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function fr(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")A(wd(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{A(wd(r),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${r}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $H(t,e){const s={x:F(t,"x","reshape","string_or_numeric")},r={shape:e};return K.runKernel(Dm,s,r)}const q=G({reshape_:$H});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NH(t,e,n,s,r){const o=F(t,"x","avgPool","float32"),i=1;A(ms(n,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);let a=o,l=!1;o.rank===3&&(l=!0,a=q(o,[1,o.shape[0],o.shape[1],o.shape[2]])),A(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),fr("avgPool",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r};let d=K.runKernel(Kf,u,c);return d=Ee(d,o.dtype),l?q(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const pw=G({avgPool_:NH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TH(t,e,n,s,r,o="NDHWC"){const i=F(t,"x","avgPool3d","float32");let a=i,l=!1;i.rank===4&&(l=!0,a=q(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),A(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),A(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),A(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),fr("avgPool3d",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:o};let d=K.runKernel(qf,u,c);return d=Ee(d,a.dtype),l?q(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const H3=G({avgPool3d_:TH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EH(t,e=0){A(t.length>=1,()=>"Pass at least one tensor to concat");const n=mx(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),n.length===1)return Aa(n[0]);const s=n,r={axis:e};return K.runKernel(Jf,s,r)}const Pn=G({concat_:EH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RH(t,e,n=!1,s=!1){let r=F(t,"a","matMul"),o=F(e,"b","matMul");[r,o]=Un(r,o);const i={a:r,b:o},a={transposeA:n,transposeB:s};return K.runKernel(Xf,i,a)}const At=G({matMul_:RH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DH(t){const n={x:F(t,"x","sigmoid","float32")};return K.runKernel(Nh,n)}const uo=G({sigmoid_:DH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AH(t,e,n){const s=F(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},o={begin:e,size:n};return K.runKernel(Om,r,o)}const pt=G({slice_:AH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _H(t){const n={x:F(t,"x","tanh","float32")};return K.runKernel(_h,n)}const Xu=G({tanh_:_H});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FH(t,e,n,s,r,o){const i=F(t,"forgetBias","basicLSTMCell"),a=F(e,"lstmKernel","basicLSTMCell"),l=F(n,"lstmBias","basicLSTMCell"),u=F(s,"data","basicLSTMCell"),c=F(r,"c","basicLSTMCell"),d=F(o,"h","basicLSTMCell"),h=Pn([u,d],1),p=At(h,a),f=me(p,l),m=f.shape[0],g=f.shape[1]/4,y=[m,g],x=pt(f,[0,0],y),v=pt(f,[0,g],y),b=pt(f,[0,g*2],y),S=pt(f,[0,g*3],y),C=me(U(uo(x),Xu(v)),U(c,uo(me(i,b)))),I=U(Xu(C),uo(S));return[C,I]}const PH=G({basicLSTMCell_:FH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OH(t,e,n){const s=F(t,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);A(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),A(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),A(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const o={x:s},i={blockShape:e,crops:n};return K.runKernel(Yf,o,i)}const fw=G({batchToSpaceND_:OH});function LH(t){let e;return t.rank===0||t.rank===1?e=q(t,[1,1,1,t.size]):t.rank===2?e=q(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=q(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zH(t,e,n,s,r,o){o==null&&(o=.001);const i=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let u;r!=null&&(u=F(r,"scale","batchNorm"));let c;s!=null&&(c=F(s,"offset","batchNorm")),A(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h={x:LH(i),scale:u,offset:c,mean:a,variance:l},p={varianceEpsilon:o},f=K.runKernel(am,h,p);return q(f,i.shape)}const Gm=G({batchNorm_:zH});function MH(t,e,n,s,r,o){const i=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let u;r!=null&&(u=F(r,"scale","batchNorm"));let c;return s!=null&&(c=F(s,"offset","batchNorm")),A(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),A(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),A(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&A(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),c!=null&&A(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),Gm(i,a,l,c,u,o)}const K3=G({batchNorm2d_:MH});function BH(t,e,n,s,r,o){const i=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let u;r!=null&&(u=F(r,"scale","batchNorm"));let c;return s!=null&&(c=F(s,"offset","batchNorm")),A(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),A(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),A(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&A(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),c!=null&&A(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),Gm(i,a,l,c,u,o)}const q3=G({batchNorm3d_:BH});function VH(t,e,n,s,r,o){const i=F(t,"x","batchNorm"),a=F(e,"mean","batchNorm"),l=F(n,"variance","batchNorm");let u;r!=null&&(u=F(r,"scale","batchNorm"));let c;return s!=null&&(c=F(s,"offset","batchNorm")),A(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),A(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),A(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&A(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),c!=null&&A(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),Gm(i,a,l,c,u,o)}const X3=G({batchNorm4d_:VH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UH(t,e,n){const s=F(t,"x","bincount"),r=F(e,"weights","bincount");A(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),A(n>=0,()=>`size must be non-negative, but got ${n}.`),A(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const o={x:s,weights:r},i={size:n};return K.runKernel(x0,o,i)}const Y3=G({bincount_:UH});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WH(t,e){const n=F(t,"x","bitwiseAnd"),s=F(e,"y","bitwiseAnd");if(!Ct(n.shape,s.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${s.shape}`);if(n.dtype!=="int32"||s.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${s.dtype}`);const r={a:n,b:s};return K.runKernel(w0,r)}const jH=G({bitwiseAnd_:WH});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GH(t,e){const n=F(t,"s0","broadcastArgs","int32"),s=F(e,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);const r={s0:n,s1:s};return K.runKernel(v0,r)}const HH=G({broadcastArgs_:GH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KH(t,e){let n=F(t,"broadcastTo","x");const s=n.shape;if(yo(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const u=n.shape.slice();for(;u.length<e.length;)u.unshift(1);n=q(n,u)}const r=n.shape,o=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])o[u]=1;else if(n.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(o.map((u,c)=>u>1?c:-1).filter(u=>u>=0).length===0)return Aa(n);const a={x:n},l={reps:o};return K.runKernel(Fh,a,l)}const ld=G({broadcastTo_:KH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qH(t){const n={x:F(t,"x","ceil","float32")};return K.runKernel(Xd,n)}const Q3=G({ceil_:qH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oh(t,e,n){yo(t),n=n||oc(e);const s={shape:t,value:e,dtype:n};return K.runKernel(P0,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XH(t,e,n){const s=F(t,"x","clipByValue");if(A(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return Oh(s.shape,e,s.dtype);const r={x:s},o={clipValueMin:e,clipValueMax:n};return K.runKernel(Yd,r,o)}const Ir=G({clipByValue_:XH});function YH(t){return Pn(t,0)}const J3=G({concat1d_:YH});function QH(t,e){return Pn(t,e)}const Z3=G({concat2d_:QH});function JH(t,e){return Pn(t,e)}const e_=G({concat3d_:JH});function ZH(t,e){return Pn(t,e)}const t_=G({concat4d_:ZH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e6(t,e,n,s,r="NHWC",o=[1,1],i){const a=F(t,"x","conv2d","float32"),l=F(e,"filter","conv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=q(a,[1,a.shape[0],a.shape[1],a.shape[2]])),A(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),A(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),fr("conv2d",s,i);const d=r==="NHWC"?u.shape[3]:u.shape[1];A(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),A(ms(n,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),A(qu(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),A(qu(n),()=>"Error in conv2D: Strides should be larger than 0.");const h={x:u,filter:l},p={strides:n,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},f=K.runKernel(Zf,h,p);return c?q(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Tl=G({conv2d_:e6});function t6(t,e,n,s,r="NWC",o=1,i){const a=F(t,"x","conv1d"),l=F(e,"filter","conv1d");let u=a,c=!1;a.rank===2&&(c=!0,u=q(a,[1,a.shape[0],a.shape[1]])),A(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),A(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),fr("conv1d",s,i),A(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),A(ms(n,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`),A(qu(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),A(qu(n),()=>"Error in conv1D: Stride should be larger than 0."),A(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const d=q(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=q(u,[u.shape[0],1,u.shape[1],u.shape[2]]),g=Tl(h,d,[1,n],s,"NHWC",[1,o],i);return c?q(g,[g.shape[2],g.shape[3]]):q(g,[g.shape[0],g.shape[2],g.shape[3]])}const D2=G({conv1d_:t6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n6(t,e,n,s,r,o="NHWC",i){A(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,u=!1;e.rank===3&&(u=!0,l=q(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),A(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),A(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),A(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const c=o==="NHWC"?a[3]:a[1],d=o==="NHWC"?l.shape[3]:l.shape[1];A(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),A(d===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`),fr("conv2dDerInput",r,i);const h={dy:l,filter:n},p={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,inputShape:a},f=K.runKernel(em,h,p);return u?q(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const A2=G({conv2DBackpropInput_:n6});function s6(t,e,n,s,r,o){const i=F(t,"x","conv2dTranspose"),a=F(e,"filter","conv2dTranspose");return A2(n,i,a,s,r,"NHWC",o)}const _2=G({conv2dTranspose_:s6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r6(t,e,n,s,r="NDHWC",o=[1,1,1]){const i=F(t,"x","conv3d"),a=F(e,"filter","conv3d");let l=i,u=!1;i.rank===4&&(u=!0,l=q(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),A(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),A(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),A(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),A(ms(n,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),A(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),A(qu(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),A(qu(n),()=>"Error in conv3D: Strides should be larger than 0.");const c={x:l,filter:a},d={strides:n,pad:s,dataFormat:r,dilations:o},h=K.runKernel(tm,c,d);return u?q(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const n_=G({conv3d_:r6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o6(t,e,n,s,r){A(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let o=t,i=e,a=!1;e.rank===4&&(a=!0,i=q(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const l=o[4],u=i.shape[4];A(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),A(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),A(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),A(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),A(u===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${n.shape[4]}.`);const c={dy:i,filter:n},d={pad:r,strides:s,inputShape:o},h=K.runKernel(k0,c,d);return a?q(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const s_=G({conv3DBackpropInput_:o6});function i6(t,e,n,s,r){const o=F(t,"x","conv3dTranspose"),i=F(e,"filter","conv3dTranspose");return s_(n,o,i,s,r)}const r_=G({conv3dTranspose_:i6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a6(t){const n={x:F(t,"x","cos","float32")};return K.runKernel(Qd,n)}const mw=G({cos_:a6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l6(t){const n={x:F(t,"x","cosh","float32")};return K.runKernel(Jd,n)}const F2=G({cosh_:l6});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u6(t,e=0,n=!1,s=!1){const o={x:F(t,"x","cumprod")},i={axis:e,exclusive:n,reverse:s};return K.runKernel(I0,o,i)}const yx=G({cumprod_:u6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c6(t,e=0,n=!1,s=!1){const o={x:F(t,"x","cumsum")},i={axis:e,exclusive:n,reverse:s};return K.runKernel(nm,o,i)}const P2=G({cumsum_:c6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d6(t,e,n,s=!1){const r=F(t,"x","denseBincount"),o=F(e,"weights","denseBincount");A(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),A(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),A(n>=0,()=>`size must be non-negative, but got ${n}.`),A(o.size===r.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`);const i={x:r,weights:o},a={size:n,binaryOutput:s};return K.runKernel(N0,i,a)}const cS=G({denseBincount_:d6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h6(t,e,n="NHWC"){const s=F(t,"x","depthToSpace","float32"),r=n==="NHWC"?s.shape[1]:s.shape[2],o=n==="NHWC"?s.shape[2]:s.shape[3],i=n==="NHWC"?s.shape[3]:s.shape[1];A(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),A(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),A(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${s.shape}`),A(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:n};return K.runKernel(T0,a,l)}const o_=G({depthToSpace_:h6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p6(t,e,n,s,r="NHWC",o=[1,1],i){const a=F(t,"x","depthwiseConv2d","float32"),l=F(e,"filter","depthwiseConv2d","float32");let u=a,c=!1;a.rank===3&&(c=!0,u=q(a,[1,a.shape[0],a.shape[1],a.shape[2]])),A(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),A(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=r==="NHWC"?u.shape[3]:u.shape[1];A(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),fr("depthwiseConv2d",s,i);const h={x:u,filter:l},p={strides:n,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},f=K.runKernel(sm,h,p);return c?q(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Hm=G({depthwiseConv2d_:p6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f6(t){const n={x:F(t,"x","diag")};return K.runKernel(D0,n)}const m6=G({diag_:f6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g6(t,e,n,s,r=[1,1],o="NHWC"){const i=F(t,"x","dilation2d"),a=F(e,"filter","dilation2d");A(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),A(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),A(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let l=i,u=!1;i.rank===3&&(l=q(i,[1,i.shape[0],i.shape[1],i.shape[2]]),u=!0),A(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const c={x:l,filter:a},d={strides:n,pad:s,dilations:r},h=K.runKernel(rm,c,d);return u?q(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const i_=G({dilation2d_:g6});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function El(t,e){const n=t.length,s=[];for(let r=0;r<n;r++){const o=n-1-r,i=t[o]||1;(e[e.length-1-r]||1)>1&&i===1&&s.unshift(o)}return s}function fs(t,e){const n=[];for(let s=0;s<e.length;s++){const r=t[t.length-s-1],o=e.length-s-1,i=e[o];(r==null||r===1&&i>1)&&n.unshift(o)}return n}function ct(t,e){const n=Math.max(t.length,e.length),s=new Array(n);for(let r=0;r<n;r++){let o=t[t.length-r-1];o==null&&(o=1);let i=e[e.length-r-1];if(i==null&&(i=1),o===1)s[n-r-1]=i;else if(i===1)s[n-r-1]=o;else if(o!==i){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else s[n-r-1]=o}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y6(t,e){let n=F(t,"a","equal","string_or_numeric"),s=F(e,"b","equal","string_or_numeric");[n,s]=Un(n,s),ct(n.shape,s.shape);const r={a:n,b:s};return K.runKernel(om,r)}const Ii=G({equal_:y6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x6(t,e,n){const s=F(e,"a","where"),r=F(n,"b","where"),o=F(t,"condition","where","bool"),i=ct(ct(o.shape,s.shape),r.shape),a=ld(o,i),l=ld(s,i),u=ld(r,i),c={condition:a,t:l,e:u};return K.runKernel(Pm,c)}const Hs=G({where_:x6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w6(t){const n={x:F(t,"x","zerosLike")};return K.runKernel(Wm,n)}const Ut=G({zerosLike_:w6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v6(t,e){let n=F(t,"a","div"),s=F(e,"b","div");[n,s]=Un(n,s);const r=Me(n,s),o=Ut(r),i=Ii(s,o);return Hs(i,o,r)}const a_=G({divNoNan_:v6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b6(t,e){const n=F(t,"t1","dot"),s=F(e,"t2","dot");A((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const r=n.rank===1?n.size:n.shape[1],o=s.rank===1?s.size:s.shape[0];if(A(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),n.rank===1&&s.rank===1){const i=q(n,[1,-1]),a=q(s,[-1,1]),l=At(i,a);return q(l,[])}else if(n.rank===1&&s.rank===2){const i=q(n,[1,-1]),a=q(s,[s.shape[0],s.shape[1]]),l=At(i,a);return q(l,[l.size])}else if(n.rank===2&&s.rank===1){const i=q(s,[-1,1]),a=At(n,i);return q(a,[a.size])}else{const i=q(s,[s.shape[0],s.shape[1]]);return At(n,i)}}const l_=G({dot_:b6});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S6(t,...e){const n=e.map((r,o)=>F(r,`tensors${o}`,"einsum")),s={equation:t};return K.runKernel(A0,n,s)}const Mc=G({einsum_:S6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C6(t){const n={x:F(t,"x","elu","float32")};return K.runKernel(eh,n)}const Km=G({elu_:C6});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k6(t,e){const n=F(t,"x","ensureShape","string_or_numeric");if(!zj(n.shape,e))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${e}`);return t}const I6=G({ensureShape_:k6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $6(t){let e=F(t,"x","erf");A(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Ee(e,"float32"));const n={x:e};return K.runKernel(th,n)}const O2=G({erf_:$6});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L2(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function u_(t,e,n){const s=t.length+e.length,r=[];let o=0,i=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?r.push(t[o++]):r.push(e[i++]);return r}function qn(t,e){const n=[],s=t.length;for(let o=0;o<s;o++)e.indexOf(o)===-1&&n.push(t[o]);const r=e.map(o=>t[o]);return[n,r]}function Wn(t,e){const n=e.map(s=>1);return u_(t,n,e)}function ss(t,e,n){A(L2(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function an(t,e){if(L2(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function ha(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function yn(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N6(t,e=null,n=!1){const r={x:F(t,"x","max")},o={reductionIndices:e,keepDims:n};return K.runKernel(ym,r,o)}const Go=G({max_:N6});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T6(t,e=null,n=!1){const r={x:F(t,"x","min")},o={axis:e,keepDims:n};return K.runKernel(bm,r,o)}const wf=G({min_:T6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E6(t,e){let n=F(t,"base","pow"),s=F(e,"exp","pow");[n,s]=Un(n,s);const r={a:n,b:s};return K.runKernel(yh,r)}const Ba=G({pow_:E6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ot(t,e){if((Xo(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Xo(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return jl(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R6(t){const n={x:F(t,"x","sqrt","float32")};return K.runKernel(Eh,n)}const zs=G({sqrt_:R6});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D6(t){const e=F(t,"x","square"),n={};return K.runKernel("Square",{x:e},n)}const sn=G({square_:D6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A6(t,e=null,n=!1){let s=F(t,"x","sum");s.dtype==="bool"&&(s=Ee(s,"int32"));const r={x:s},o={axis:e,keepDims:n};return K.runKernel(Lm,r,o)}const Qe=G({sum_:A6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _6(t,e="euclidean",n=null,s=!1){t=F(t,"x","norm");const r=c_(t,e,n);let o=r.shape;if(s){const i=xt(n,t.shape);o=Wn(r.shape,i)}return q(r,o)}function c_(t,e,n=null){if(t.rank===0)return is(t);if(t.rank!==1&&n===null)return c_(q(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return Qe(is(t),n);if(e===1/0)return Go(is(t),n);if(e===-1/0)return wf(is(t),n);if(e==="euclidean"||e===2)return zs(Qe(Ba(is(t),ot(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return Go(Qe(is(t),n[0]),n[1]-1);if(e===1/0)return Go(Qe(is(t),n[1]),n[0]);if(e===-1/0)return wf(Qe(is(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return zs(Qe(sn(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const qm=G({norm_:_6});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F6(t,e=null,n=!1){return qm(t,"euclidean",e,n)}const d_=G({euclideanNorm_:F6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P6(t){const n={x:F(t,"x","exp")};return K.runKernel(nh,n)}const hr=G({exp_:P6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O6(t,e=0){const n=F(t,"x","expandDims","string_or_numeric");A(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},r={dim:e};return K.runKernel(im,s,r)}const Zn=G({expandDims_:O6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L6(t){const n={x:F(t,"x","expm1")};return K.runKernel(sh,n)}const h_=G({expm1_:L6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z6(t,e){const n=F(t,"x","tile","string_or_numeric");A(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},r={reps:e};return K.runKernel(Fh,s,r)}const Bo=G({tile_:z6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M6(t,e,n,s="float32"){e==null&&(e=t);const r=yt([t,e],s),o=t<=e?t:e;for(let a=0;a<o;++a)r.set(1,a,a);const i=q(r.toTensor(),[t,e]);if(n==null)return i;if(n.length===1)return Bo(Zn(i,0),[n[0],1,1]);if(n.length===2)return Bo(Zn(Zn(i,0),0),[n[0],n[1],1,1]);if(n.length===3)return Bo(Zn(Zn(Zn(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const z2=G({eye_:M6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B6(t){const n={x:F(t,"x","floor","float32")};return K.runKernel(rh,n)}const Xm=G({floor_:B6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V6(t,e,n=0,s=0){const r=F(t,"x","gather"),o=F(e,"indices","gather","int32"),i={x:r,indices:o},a={axis:n,batchDims:s};return K.runKernel(lm,i,a)}const Ym=G({gather_:V6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U6(t,e){let n=F(t,"a","greater","string_or_numeric"),s=F(e,"b","greater","string_or_numeric");[n,s]=Un(n,s),ct(n.shape,s.shape);const r={a:n,b:s};return K.runKernel(um,r)}const eo=G({greater_:U6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W6(t,e){let n=F(t,"a","greaterEqual","string_or_numeric"),s=F(e,"b","greaterEqual","string_or_numeric");[n,s]=Un(n,s),ct(n.shape,s.shape);const r={a:n,b:s};return K.runKernel(ih,r)}const Hl=G({greaterEqual_:W6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j6(t){const n={input:F(t,"input","imag")};return K.runKernel(M0,n)}const gw=G({imag_:j6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G6(t){const n={x:F(t,"x","isFinite")};return K.runKernel(lh,n)}const p_=G({isFinite_:G6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H6(t){const n={x:F(t,"x","isInf")};return K.runKernel(uh,n)}const f_=G({isInf_:H6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K6(t){const n={x:F(t,"x","isNaN")};return K.runKernel(ch,n)}const m_=G({isNaN_:K6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q6(t,e=.2){const s={x:F(t,"x","leakyRelu")},r={alpha:e};return K.runKernel(cm,s,r)}const yw=G({leakyRelu_:q6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X6(t,e){let n=F(t,"a","less","string_or_numeric"),s=F(e,"b","less","string_or_numeric");[n,s]=Un(n,s),ct(n.shape,s.shape);const r={a:n,b:s};return K.runKernel(dm,r)}const vf=G({less_:X6});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y6(t,e){let n=F(t,"a","lessEqual","string_or_numeric"),s=F(e,"b","lessEqual","string_or_numeric");[n,s]=Un(n,s),ct(n.shape,s.shape);const r={a:n,b:s};return K.runKernel(hm,r)}const uc=G({lessEqual_:Y6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q6(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const s={start:t,stop:e,num:n};return K.runKernel(B0,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J6(t,e=5,n=1,s=1,r=.5){const o=F(t,"x","localResponseNormalization");A(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),A(wd(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=o,a=!1;o.rank===3&&(a=!0,i=q(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const l={x:i},u={depthRadius:e,bias:n,alpha:s,beta:r},c=K.runKernel(gm,l,u);return a?q(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const g_=G({localResponseNormalization_:J6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z6(t){const n={x:F(t,"x","log","float32")};return K.runKernel(dh,n)}const po=G({log_:Z6});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e5(t){const n={x:F(t,"x","log1p")};return K.runKernel(hh,n)}const xw=G({log1p_:e5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t5(t,e){A(Xb(t),()=>"The f passed in variableGrads(f) must be a function"),A(e==null||Array.isArray(e)&&e.every(u=>u instanceof fx),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const u in K.registeredVariables)e.push(K.registeredVariables[u])}const s=n?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),A(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:i,grads:a}=K.gradients(t,e,null,o);A(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),A(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const l={};return e.forEach((u,c)=>{a[c]!=null&&(l[u.name]=a[c])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:i,grads:l}}function Va(t){return K.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5(t){const n={x:F(t,"x","neg")};return K.runKernel(Cm,n)}const Sn=G({neg_:n5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s5(t){const n={x:F(t,"x","softplus")};return K.runKernel(Th,n)}const Lh=G({softplus_:s5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r5(t){const e=F(t,"x","logSigmoid");return Va(s=>({value:Sn(Lh(Sn(s))),gradFunc:i=>U(i,uo(Sn(s)))}))(e)}const y_=G({logSigmoid_:r5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o5(t,e){let n=F(t,"a","sub"),s=F(e,"b","sub");[n,s]=Un(n,s);const r={a:n,b:s};return K.runKernel(Dh,r)}const Be=G({sub_:o5});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i5(t,e=-1){const n=F(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return Va((r,o)=>{const a=Go(r,e,!0),l=Be(r,a),u=Be(Ee(l,"float32"),po(Qe(hr(l),e,!0)));return o([u]),{value:u,gradFunc:(d,h)=>{const[p]=h,f=!0,m=hr(p);return Be(d,U(Qe(d,e,f),m))}}})(n)}const M2=G({logSoftmax_:i5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a5(t,e=null,n=!1){const s=F(t,"x","logSumExp"),r=xt(e,s.shape),o=Go(s,r,!0),i=Be(s,o),a=hr(i),l=Qe(a,r),u=po(l),c=me(q(o,u.shape),u);if(n){const d=Wn(c.shape,r);return q(c,d)}return c}const ww=G({logSumExp_:a5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l5(t,e){const n=F(t,"a","logicalAnd","bool"),s=F(e,"b","logicalAnd","bool");ct(n.shape,s.shape);const r={a:n,b:s};return K.runKernel(pm,r)}const aa=G({logicalAnd_:l5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u5(t){const n={x:F(t,"x","logicalNot","bool")};return K.runKernel(fm,n)}const vw=G({logicalNot_:u5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c5(t,e){const n=F(t,"a","logicalOr","bool"),s=F(e,"b","logicalOr","bool");ct(n.shape,s.shape);const r={a:n,b:s};return K.runKernel(mm,r)}const B2=G({logicalOr_:c5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d5(t,e){const n=F(t,"a","logicalXor","bool"),s=F(e,"b","logicalXor","bool");return ct(n.shape,s.shape),aa(B2(t,e),vw(aa(t,e)))}const x_=G({logicalXor_:d5});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hg=2147483648;function h5(t,e,n="left"){const s=F(t,"sortedSequence","searchSorted"),r=F(e,"values","searchSorted"),o=s.shape[s.shape.length-1],i=r.shape[r.shape.length-1],a=q(s,[-1,o]),l=q(r,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==l.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(te(l.shape)>=Hg)throw new Error(`values tensor size must less than ${Hg}`);if(a.shape[1]>=Hg)throw new Error(`trailing dim_size must less than ${Hg} for int32 output type, was ${a.shape[1]}`);const u={sortedSequence:a,values:l},c={side:n};return K.runKernel(ew,u,c)}const V2=G({searchSorted_:h5});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p5(t,e){return V2(t,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5(t,e,n,s,r){const o=F(t,"x","maxPool"),i=1;let a=o,l=!1;o.rank===3&&(l=!0,a=q(o,[1,o.shape[0],o.shape[1],o.shape[2]])),A(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),A(ms(n,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),fr("maxPool",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r},d=K.runKernel(xm,u,c);return l?q(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const bw=G({maxPool_:f5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m5(t,e=[1,1,1],n,s,r,o="NDHWC"){const i=F(t,"x","maxPool3d");let a=i,l=!1;i.rank===4&&(l=!0,a=q(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),A(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),A(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),fr("maxPool3d",s,r);const u={x:a},c={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:o},d=K.runKernel(wm,u,c);return l?q(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const w_=G({maxPool3d_:m5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g5(t,e,n,s,r=!1){const i={x:F(t,"x","maxPoolWithArgmax")},a={filterSize:e,strides:n,pad:s,includeBatchInIndex:r},l=K.runKernel(j0,i,a);return{result:l[0],indexes:l[1]}}const y5=G({maxPoolWithArgmax_:g5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x5(t,e){let n=F(t,"a","maximum"),s=F(e,"b","maximum");[n,s]=Un(n,s),n.dtype==="bool"&&(n=Ee(n,"int32"),s=Ee(s,"int32")),ct(n.shape,s.shape);const r={a:n,b:s};return K.runKernel(ph,r)}const ja=G({maximum_:x5});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w5(t,e=null,n=!1){const r={x:F(t,"x","mean")},o={axis:e,keepDims:n};return K.runKernel(vm,r,o)}const zn=G({mean_:w5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gn(t,e="float32"){if(yo(t),e==="complex64"){const s=Gn(t,"float32"),r=Gn(t,"float32");return Il(s,r)}const n=Ls(te(t),e);return K.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ur(t,e="float32"){if(yo(t),e==="complex64"){const s=Ur(t,"float32"),r=Gn(t,"float32");return Il(s,r)}const n=d2(te(t),e);return K.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v5(t,e,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(t===void 0)return[];let s=F(t,"x","meshgrid",t instanceof Qt?t.dtype:"float32");if(e===void 0)return[s];let r=F(e,"y","meshgrid",e instanceof Qt?e.dtype:"float32");const o=te(s.shape),i=te(r.shape);return n==="xy"?(s=q(s,[1,-1]),r=q(r,[-1,1]),[At(Ur([i,1],s.dtype),s),At(r,Ur([1,o],r.dtype))]):(s=q(s,[-1,1]),r=q(r,[1,-1]),[At(s,Ur([1,i],s.dtype)),At(Ur([o,1],r.dtype),r)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b5(t,e){let n=F(t,"a","minimum"),s=F(e,"b","minimum");[n,s]=Un(n,s),n.dtype==="bool"&&(n=Ee(n,"int32"),s=Ee(s,"int32")),ct(n.shape,s.shape);const r={a:n,b:s};return K.runKernel(fh,r)}const Rl=G({minimum_:b5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S5(t,e,n){A(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=F(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");A(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)A(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),A(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const o={paddings:e,mode:n},i={x:s};return K.runKernel(Sm,i,o)}const U2=G({mirrorPad_:S5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C5(t,e){let n=F(t,"a","mod"),s=F(e,"b","mod");[n,s]=Un(n,s);const r={a:n,b:s};return K.runKernel(mh,r)}const v_=G({mod_:C5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k5(t,e=null,n=!1){t=F(t,"x","moments");const s=xt(e,t.shape),r=zn(t,s,n);let o=r.shape;n||(o=Wn(r.shape,s));const i=sn(Be(Ee(t,"float32"),q(r,o))),a=zn(i,s,n);return{mean:r,variance:a}}const Sw=G({moments_:k5});function I5(t,e,n,s){const r=F(e,"data","multiRNNCell"),o=mx(n,"c","multiRNNCell"),i=mx(s,"h","multiRNNCell");let a=r;const l=[];for(let d=0;d<t.length;d++){const h=t[d](a,o[d],i[d]);l.push(h[0]),l.push(h[1]),a=h[1]}const u=[],c=[];for(let d=0;d<l.length;d+=2)u.push(l[d]),c.push(l[d+1]);return[u,c]}const $5=G({multiRNNCell_:I5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N5(t,e,n,s=!1){const r=F(t,"logits","multinomial"),o=r.size,i=r.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();const l={logits:i===1?q(r,[1,-1]):r},u={numSamples:e,seed:n,normalized:s},c=K.runKernel(G0,l,u);return i===1?q(c,[c.size]):c}const T5=G({multinomial_:N5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E5(t,e){let n=F(t,"a","notEqual","string_or_numeric"),s=F(e,"b","notEqual","string_or_numeric");[n,s]=Un(n,s),ct(n.shape,s.shape);const r={a:n,b:s};return K.runKernel(km,r)}const Sd=G({notEqual_:E5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R5(t,e,n=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:F(t,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:n,offValue:s};return K.runKernel($m,i,a)}const W2=G({oneHot_:R5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D5(t){const n={x:F(t,"x","onesLike")};return K.runKernel(Im,n)}const fo=G({onesLike_:D5});function A5(t,e){const n=F(t,"v1","outerProduct"),s=F(e,"v2","outerProduct");A(n.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${s.rank}.`);const r=q(n,[-1,1]),o=q(s,[1,-1]);return At(r,o)}const _5=G({outerProduct_:A5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F5(t,e,n=0){const s=F(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:n},o={x:s};return K.runKernel(Tm,o,r)}const $i=G({pad_:F5});function P5(t,e,n=0){return A(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),$i(t,[e],n)}const O5=G({pad1d_:P5});function L5(t,e,n=0){return A(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),$i(t,e,n)}const z5=G({pad2d_:L5});function M5(t,e,n=0){return A(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),$i(t,e,n)}const B5=G({pad3d_:M5});function V5(t,e,n=0){return A(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),$i(t,e,n)}const U5=G({pad4d_:V5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W5(t,e,n){const s=F(t,"x","spaceToBatchND");A(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),A(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),A(s.shape.reduce((i,a,l)=>l>0&&l<=e.length?i&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},o={blockShape:e,paddings:n};return K.runKernel(zm,r,o)}const Cw=G({spaceToBatchND_:W5});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j5(t,e,n,s,r,o,i){r==null&&(r=[1,1]),o==null&&(o=1),s===0&&(s="valid");const a=F(t,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=q(a,[1,a.shape[0],a.shape[1],a.shape[2]])),A(ms(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const c=qs(l.shape,e,o,r,s),d=[c.dilationHeight,c.dilationWidth];let h;s==="same"?h=H5([c.filterHeight,c.filterWidth],d):h=[[0,0],[0,0]];const p=d[0]===1&&d[1]===1,[f,m]=G5([c.inHeight,c.inWidth],d,h),g=p?s:"valid",y=p?l:Cw(l,d,f),v=(n==="avg"?()=>pw(y,e,o,g,i):()=>bw(y,e,o,g,i))(),b=p?v:fw(v,d,m);return u?q(b,[b.shape[1],b.shape[2],b.shape[3]]):b}function G5(t,e,n){const s=n.map(c=>c[0]),r=n.map(c=>c[1]),o=t.concat(s,r),i=e.map((c,d)=>(c-o[d]%c)%c),a=r.map((c,d)=>c+i[d]),l=e.map((c,d)=>[s[d],a[d]]),u=e.map((c,d)=>[0,i[d]]);return[l,u]}function H5(t,e){const s=t.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),r=s.map(i=>Math.floor(i/2)),o=s.map((i,a)=>i-r[a]);return s.map((i,a)=>[r[a],o[a]])}const b_=G({pool_:j5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K5(t,e){const n=F(t,"x","prelu"),s=F(e,"alpha","prelu"),r={x:n,alpha:s};return K.runKernel(Em,r)}const kw=G({prelu_:K5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q5(t,e=null,n=!1){let s=F(t,"x","prod");s.dtype==="bool"&&(s=Ee(s,"int32"));const r={x:s},o={axis:e,keepDims:n};return K.runKernel(Rm,r,o)}const S_=G({prod_:q5});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(t,e,n,s){const r=t.map((c,d)=>F(c,`tensors${d}`,"raggedGather","int32")),o=F(e,"paramsDenseValues","raggedGather"),i=F(n,"indices","raggedGather","int32"),a={paramsNestedSplits:r,paramsDenseValues:o,indices:i},l={outputRaggedRank:s},u=K.runKernel(m2,a,l);return{outputNestedSplits:u.slice(0,u.length-1),outputDenseValues:u[u.length-1]}}const Y5=G({raggedGather_:X5});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q5(t,e,n){const s=F(t,"starts","raggedRange"),r=F(e,"limits","raggedRange",s.dtype),o=F(n,"deltas","raggedRange",s.dtype),i={starts:s,limits:r,deltas:o},a=K.runKernel(g2,i);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const J5=G({raggedRange_:Q5});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z5(t,e,n,s,r){const o=F(t,"shape","raggedTensorToTensor","int32"),i=F(e,"values","raggedTensorToTensor"),a=F(n,"defaultValue","raggedTensorToTensor",i.dtype),l=s.map((d,h)=>F(d,`tensors${h}`,"raggedTensorToTensor","int32")),u={shape:o,values:i,defaultValue:a,rowPartitionTensors:l},c={rowPartitionTypes:r};return K.runKernel(y2,u,c)}const e8=G({raggedTensorToTensor_:Z5});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t8(t,e,n){yo(t);const s=te(t);let r=null;if(n==null||n==="float32")r=new Float32Array(s);else if(n==="int32")r=new Int32Array(s);else if(n==="bool")r=new Uint8Array(s);else throw new Error(`Unknown data type ${n}`);for(let o=0;o<s;o++)r[o]=e();return K.makeTensor(r,t,n)}const n8=G({rand_:t8});var j2={exports:{}};j2.exports;(function(t){(function(e,n,s){function r(l){var u=this,c=a();u.next=function(){var d=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=d-(u.c=d|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(l),u.s0<0&&(u.s0+=1),u.s1-=c(l),u.s1<0&&(u.s1+=1),u.s2-=c(l),u.s2<0&&(u.s2+=1),c=null}function o(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function i(l,u){var c=new r(l),d=u&&u.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,d&&(typeof d=="object"&&o(d,c),h.state=function(){return o(c,{})}),h}function a(){var l=4022871197,u=function(c){c=String(c);for(var d=0;d<c.length;d++){l+=c.charCodeAt(d);var h=.02519603282416938*l;l=h>>>0,h-=l,h*=l,l=h>>>0,h-=l,l+=h*4294967296}return(l>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=i:this.alea=i})(xi,t)})(j2);var s8=j2.exports,G2={exports:{}};G2.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function i(a,l){var u=new r(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=u.next()>>>11,p=(u.next()>>>0)/4294967296,f=(h+p)/(1<<21);while(f===0);return f},d.int32=u.next,d.quick=d,c&&(typeof c=="object"&&o(c,u),d.state=function(){return o(u,{})}),d}n&&n.exports?n.exports=i:this.xor128=i})(xi,t)})(G2);var r8=G2.exports,H2={exports:{}};H2.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var c=0;c<u.length+64;c++)l.x^=u.charCodeAt(c)|0,c==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function i(a,l){var u=new r(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=u.next()>>>11,p=(u.next()>>>0)/4294967296,f=(h+p)/(1<<21);while(f===0);return f},d.int32=u.next,d.quick=d,c&&(typeof c=="object"&&o(c,u),d.state=function(){return o(u,{})}),d}n&&n.exports?n.exports=i:this.xorwow=i})(xi,t)})(H2);var o8=H2.exports,K2={exports:{}};K2.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.x,d=l.i,h,p;return h=c[d],h^=h>>>7,p=h^h<<24,h=c[d+1&7],p^=h^h>>>10,h=c[d+3&7],p^=h^h>>>3,h=c[d+4&7],p^=h^h<<7,h=c[d+7&7],h=h^h<<13,p^=h^h<<9,c[d]=p,l.i=d+1&7,p};function u(c,d){var h,p=[];if(d===(d|0))p[0]=d;else for(d=""+d,h=0;h<d.length;++h)p[h&7]=p[h&7]<<15^d.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],c.x=p,c.i=0,h=256;h>0;--h)c.next()}u(l,a)}function o(a,l){return l.x=a.x.slice(),l.i=a.i,l}function i(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=u.next()>>>11,p=(u.next()>>>0)/4294967296,f=(h+p)/(1<<21);while(f===0);return f},d.int32=u.next,d.quick=d,c&&(c.x&&o(c,u),d.state=function(){return o(u,{})}),d}n&&n.exports?n.exports=i:this.xorshift7=i})(xi,t)})(K2);var i8=K2.exports,q2={exports:{}};q2.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var c=l.w,d=l.X,h=l.i,p,f;return l.w=c=c+1640531527|0,f=d[h+34&127],p=d[h=h+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=d[h]=f^p,l.i=h,f+(c^c>>>16)|0};function u(c,d){var h,p,f,m,g,y=[],x=128;for(d===(d|0)?(p=d,d=null):(d=d+"\0",p=0,x=Math.max(x,d.length)),f=0,m=-32;m<x;++m)d&&(p^=d.charCodeAt((m+32)%d.length)),m===0&&(g=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(g=g+1640531527|0,h=y[m&127]^=p+g,f=h==0?f+1:0);for(f>=128&&(y[(d&&d.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=y[f+34&127],h=y[f=f+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,y[f]=p^h;c.w=g,c.X=y,c.i=f}u(l,a)}function o(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function i(a,l){a==null&&(a=+new Date);var u=new r(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=u.next()>>>11,p=(u.next()>>>0)/4294967296,f=(h+p)/(1<<21);while(f===0);return f},d.int32=u.next,d.quick=d,c&&(c.X&&o(c,u),d.state=function(){return o(u,{})}),d}n&&n.exports?n.exports=i:this.xor4096=i})(xi,t)})(q2);var a8=q2.exports,X2={exports:{}};X2.exports;(function(t){(function(e,n,s){function r(a){var l=this,u="";l.next=function(){var d=l.b,h=l.c,p=l.d,f=l.a;return d=d<<25^d>>>7^h,h=h-p|0,p=p<<24^p>>>8^f,f=f-d|0,l.b=d=d<<20^d>>>12^h,l.c=h=h-p|0,l.d=p<<16^h>>>16^f,l.a=f-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var c=0;c<u.length+20;c++)l.b^=u.charCodeAt(c)|0,l.next()}function o(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function i(a,l){var u=new r(a),c=l&&l.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var h=u.next()>>>11,p=(u.next()>>>0)/4294967296,f=(h+p)/(1<<21);while(f===0);return f},d.int32=u.next,d.quick=d,c&&(typeof c=="object"&&o(c,u),d.state=function(){return o(u,{})}),d}n&&n.exports?n.exports=i:this.tychei=i})(xi,t)})(X2);var l8=X2.exports,C_={exports:{}};const u8={},c8=Object.freeze(Object.defineProperty({__proto__:null,default:u8},Symbol.toStringTag,{value:"Module"})),d8=YB(c8);(function(t){(function(e,n,s){var r=256,o=6,i=52,a="random",l=s.pow(r,o),u=s.pow(2,i),c=u*2,d=r-1,h;function p(b,S,C){var I=[];S=S==!0?{entropy:!0}:S||{};var T=y(g(S.entropy?[b,v(n)]:b??x(),3),I),R=new f(I),_=function(){for(var P=R.g(o),z=l,O=0;P<u;)P=(P+O)*r,z*=r,O=R.g(1);for(;P>=c;)P/=2,z/=2,O>>>=1;return(P+O)/z};return _.int32=function(){return R.g(4)|0},_.quick=function(){return R.g(4)/4294967296},_.double=_,y(v(R.S),n),(S.pass||C||function(P,z,O,V){return V&&(V.S&&m(V,R),P.state=function(){return m(R,{})}),O?(s[a]=P,z):P})(_,T,"global"in S?S.global:this==s,S.state)}function f(b){var S,C=b.length,I=this,T=0,R=I.i=I.j=0,_=I.S=[];for(C||(b=[C++]);T<r;)_[T]=T++;for(T=0;T<r;T++)_[T]=_[R=d&R+b[T%C]+(S=_[T])],_[R]=S;(I.g=function(P){for(var z,O=0,V=I.i,H=I.j,Q=I.S;P--;)z=Q[V=d&V+1],O=O*r+Q[d&(Q[V]=Q[H=d&H+z])+(Q[H]=z)];return I.i=V,I.j=H,O})(r)}function m(b,S){return S.i=b.i,S.j=b.j,S.S=b.S.slice(),S}function g(b,S){var C=[],I=typeof b,T;if(S&&I=="object")for(T in b)try{C.push(g(b[T],S-1))}catch{}return C.length?C:I=="string"?b:b+"\0"}function y(b,S){for(var C=b+"",I,T=0;T<C.length;)S[d&T]=d&(I^=S[d&T]*19)+C.charCodeAt(T++);return v(S)}function x(){try{var b;return h&&(b=h.randomBytes)?b=b(r):(b=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(b)),v(b)}catch{var S=e.navigator,C=S&&S.plugins;return[+new Date,e,C,e.screen,v(n)]}}function v(b){return String.fromCharCode.apply(0,b)}if(y(s.random(),n),t.exports){t.exports=p;try{h=d8}catch{}}else s["seed"+a]=p})(typeof self<"u"?self:xi,[],Math)})(C_);var h8=C_.exports,p8=s8,f8=r8,m8=o8,g8=i8,y8=a8,x8=l8,cc=h8;cc.alea=p8;cc.xor128=f8;cc.xorwow=m8;cc.xorshift7=g8;cc.xor4096=y8;cc.tychei=x8;var Iw=cc;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y2{constructor(e,n,s,r,o){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=o||Math.random();this.random=Iw.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,n,s=!1;for(;!s;){let r,o,i;do r=2*this.random()-1,o=2*this.random()-1,i=r*r+o*o;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*a,n=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class w8{constructor(e,n,s,r){this.alpha=e,this.beta=1/n,this.dtype=s;const o=r||Math.random();this.randu=Iw.alea(o.toString()),this.randn=new Y2(0,1,s,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,n,s,r,o,i;for(;;){do r=this.randn.nextValue(),i=1+this.c*r;while(i<=0);if(i*=i*i,e=r*r,n=1-.331*e*e,s=.5*e+this.d*(1-i+Math.log(i)),o=this.randu(),o<n||Math.log(o)<s)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class v8{constructor(e=0,n=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=Iw.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b8(t,e,n=1,s="float32",r){if(yo(t),n==null&&(n=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);const o=new w8(e,n,s,r),i=yt(t,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const S8=G({randomGamma_:b8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C8(t,e=0,n=1,s,r){if(yo(t),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new Y2(e,n,s,!1,r),i=yt(t,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Q2=G({randomNormal_:C8});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k8(t,e,n){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return Q2(t,0,1,e,n)}const I8=G({randomStandardNormal_:k8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $8(t,e=0,n=1,s="float32",r){yo(t);const o=yt(t,s),i=new v8(e,n,null,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const dc=G({randomUniform_:$8});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N8(t,e,n,s){return dc(t,e,n,"int32",s)}const T8=G({randomUniformInt_:N8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cd(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const r={start:t,stop:e,step:n,dtype:s};return K.runKernel(q0,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E8(t){const n={input:F(t,"input","real")};return K.runKernel(X0,n)}const bf=G({real_:E8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R8(t){const n={x:F(t,"x","reciprocal")};return K.runKernel(xh,n)}const k_=G({reciprocal_:R8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D8(t){const n={x:F(t,"x","relu")};return K.runKernel(wh,n)}const pa=G({relu_:D8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A8(t){const n={x:F(t,"x","relu6")};return K.runKernel(vh,n)}const J2=G({relu6_:A8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _8(t,e){const s={x:F(t,"x","reverse")},r={dims:e};return K.runKernel(Fm,s,r)}const Yo=G({reverse_:_8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F8(t){const e=F(t,"x","reverse");return A(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),Yo(e,0)}const P8=G({reverse1d_:F8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O8(t,e){const n=F(t,"x","reverse");return A(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),Yo(n,e)}const L8=G({reverse2d_:O8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z8(t,e){const n=F(t,"x","reverse");return A(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),Yo(n,e)}const M8=G({reverse3d_:z8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B8(t,e){const n=F(t,"x","reverse");return A(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),Yo(n,e)}const V8=G({reverse4d_:B8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U8(t){const n={x:F(t,"x","round")};return K.runKernel(bh,n)}const Z2=G({round_:U8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W8(t){const n={x:F(t,"x","rsqrt","float32")};return K.runKernel(Sh,n)}const ek=G({rsqrt_:W8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j8(t){const n={x:F(t,"x","selu")};return K.runKernel(Ch,n)}const tk=G({selu_:j8});function G8(t,e,n,s,r,o=[1,1],i="NHWC"){const a=F(t,"x","separableConv2d"),l=F(e,"depthwiseFilter","separableConv2d"),u=F(n,"pointwiseFilter","separableConv2d");let c=a,d=!1;if(a.rank===3&&(d=!0,c=q(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");A(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),A(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),A(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),A(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),A(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const h=l.shape[2],p=l.shape[3];A(u.shape[2]===h*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${u.shape[2]}.`);const f=Hm(c,l,s,r,i,o),g=Tl(f,u,1,"valid",i);return d?q(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const nk=G({separableConv2d_:G8});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function H8(t,e){const n=F(t,"x","setdiff1d"),s=F(e,"y","setdiff1d");A(n.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${s.dtype}).`),A(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),A(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);const r=await n.data(),o=await s.data(),i=new Set(o);let a=0;for(let c=0;c<r.length;c++)i.has(r[c])||a++;const l=new cs([a],n.dtype),u=new cs([a],"int32");for(let c=0,d=0;c<r.length;c++)i.has(r[c])||(l.values[d]=r[c],u.values[d]=c,d++);return[l.toTensor(),u.toTensor()]}const K8=H8;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q8(t){const n={x:F(t,"x","sign")};return K.runKernel($h,n)}const I_=G({sign_:q8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X8(t){const n={x:F(t,"x","sin","float32")};return K.runKernel(kh,n)}const sk=G({sin_:X8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y8(t){const n={x:F(t,"x","sinh")};return K.runKernel(Ih,n)}const rk=G({sinh_:Y8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q8(t,e,n){const s=F(t,"x","slice1d");return A(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),pt(s,[e],[n])}const $w=G({slice1d_:Q8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J8(t,e,n){const s=F(t,"x","slice2d");return A(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),pt(s,e,n)}const ok=G({slice2d_:J8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z8(t,e,n){const s=F(t,"x","slice3d");return A(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),pt(s,e,n)}const Nw=G({slice3d_:Z8});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eK(t,e,n){const s=F(t,"x","slice4d");return A(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),pt(s,e,n)}const Sf=G({slice4d_:eK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tK(t,e=-1){const n=F(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},r={dim:e};return K.runKernel(Bm,s,r)}const Tw=G({softmax_:tK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nK(t){A(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return K.runKernel(F0,e)}const Ew=G({fft_:nK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sK(t){A(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return K.runKernel(z0,e)}const Cf=G({ifft_:sK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rK(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const r=q(t,[n,e]);s=Cf(r)}else{const r=[n,2*(e-1)],o=q(bf(t),[n,e]),i=q(gw(t),[n,e]),a=Yo(pt(o,[0,1],[n,e-2]),1),l=U(Yo(pt(i,[0,1],[n,e-2]),1),ot(-1)),u=Pn([o,a],1),c=Pn([i,l],1),d=q(Il(u,c),[r[0],r[1]]);s=Cf(d)}if(s=bf(s),t.rank===3&&t.shape[0]!==0){const r=s,o=t.shape[0];s=q(s,[o,s.shape[0]/o,s.shape[1]]),r.dispose()}return s}const ik=G({irfft_:rK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oK(t,e,n=0){const r={x:F(t,"x","split")},o={numOrSizeSplits:e,axis:n};return K.runKernel(Mm,r,o)}const Hr=G({split_:oK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iK(t,e){A(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let r;if(e!=null&&e<n){const f=t.shape.map(g=>0),m=t.shape.map(g=>g);m[t.shape.length-1]=e,r=pt(t,f,m),n=e}else if(e!=null&&e>n){const f=t.shape.map(m=>m);f[t.shape.length-1]=e-n,r=Pn([t,Gn(f)],t.shape.length-1),n=e}else r=t;const o=Ut(r),i=q(Il(r,o),[s,n]),a=Ew(i),l=Math.floor(n/2)+1,u=bf(a),c=gw(a),d=Hr(u,[l,n-l],u.shape.length-1),h=Hr(c,[l,n-l],c.shape.length-1),p=r.shape.slice();return p[r.shape.length-1]=l,q(Il(d[0],h[0]),p)}const Rw=G({rfft_:iK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aK(t,e){let n=F(t,"a","squaredDifference"),s=F(e,"b","squaredDifference");[n,s]=Un(n,s),ct(n.shape,s.shape);const r={a:n,b:s},o={};return K.runKernel(Rh,r,o)}const ak=G({squaredDifference_:aK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lK(t,e){const n=F(t,"x","squeeze","string_or_numeric");return q(n,Vl(n.shape,e).newShape)}const Ht=G({squeeze_:lK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uK(t,e=0){const n=mx(t,"tensors","stack","string_or_numeric");A(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&A(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,r={axis:e};return K.runKernel(Nm,s,r)}const qr=G({stack_:uK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cK(t,e=0){const s={x:F(t,"x","step")},r={alpha:e};return K.runKernel(Ph,s,r)}const zh=G({step_:cK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dK(t,e,n,s,r=0,o=0,i=0,a=0,l=0){const c={x:F(t,"x","stridedSlice","string_or_numeric")},d={begin:e,end:n,strides:s,beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};return K.runKernel(iw,c,d)}const $_=G({stridedSlice_:dK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hK(t){const n={x:F(t,"x","tan","float32")};return K.runKernel(Ah,n)}const N_=G({tan_:hK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function es(t,e){zd(t);const n=Wl(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return jl(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ho(t,e,n){if(zd(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Wl(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return jl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T_(t,e,n){if(zd(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=Wl(t,n);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return jl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pK(t,e,n){if(zd(t),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const s=Wl(t,n);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return jl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fK(t,e,n){if(zd(t),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const s=Wl(t,n);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return jl(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mK(t,e,n){if(zd(t),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const s=Wl(t,n);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||s,jl(t,e,s,n)}function E_(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(o+` update.rank < ${r}. `);if(t.length<s+(n.rank-r))throw new Error(o+` Output shape length < ${s+(n.rank-r)}`);if(n.rank!==r+t.length-s)throw new Error(o+` update.rank != ${r+t.length-s}`);for(let i=0;i<r;++i)if(n.shape[i]!==e.shape[i])throw new Error(o+` updates.shape[${i}] (${n.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<n.rank-r;++i)if(n.shape[i+r]!==t[i+s])throw new Error(o+` updates.shape[${i+r}] (${n.shape[i+r]}) != shape[${i+r}] (${t[i+r]})`)}function lk(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}E_(n,e,t)}function fa(t,e,n){const s=e.shape.length,r=s>1?e.shape[s-1]:1,o=n.length;let i=1;for(let d=r;d<o;++d)i*=n[d];const a=r<1?1:r,l=te(e.shape)/a,u=[...st(n.slice(0,r)),1],c=te(n);return{sliceRank:r,numUpdates:l,sliceSize:i,strides:u,outputSize:c}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gK(t,e,n){const s=F(t,"tensor","tensorScatterupdate"),r=F(e,"indices","tensorScatterupdate","int32"),o=F(n,"updates","tensorScatterupdate");if(lk(o,r,s.shape),s.dtype!==o.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${s.dtype} and ${o.dtype}.`);const i={tensor:s,indices:r,updates:o},a={};return K.runKernel(Z0,i,a)}const yK=G({tensorScatterUpdate_:gK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xK(t,e=1,n=!0){const s=F(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const o={x:s},i={k:e,sorted:n},[a,l]=K.runKernel(lw,o,i);return{values:a,indices:l}}const R_=G({topk_:xK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wK(t,e=0,n=1,s,r){if(yo(t),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new Y2(e,n,s,!0,r),i=yt(t,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const uk=G({truncatedNormal_:wK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vK(t,e=0){const n=F(t,"x","unique","string_or_numeric");A(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},r={axis:e},[o,i]=K.runKernel(S2,s,r);return{values:o,indices:i}}const D_=G({unique_:vK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bK(t,e,n){const s=F(t,"x","unsortedSegmentSum"),r=F(e,"segmentIds","unsortedSegmentSum","int32");A(wd(n),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:r},i={numSegments:n};return K.runKernel(Um,o,i)}const ck=G({unsortedSegmentSum_:bK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SK(t,e=0){const n=F(t,"x","unstack","string_or_numeric");A(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},r={axis:e};return K.runKernel(Vm,s,r)}const Qo=G({unstack_:SK});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CK(t,e){return V2(t,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A_(t,e=!0,n,s){return K.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dk(t,e){const n=[];for(let o=0;o<e.length;o++)e[o]&&n.push(o);const s=yt(t,"int32"),r=yt([n.length,t.length],"int32");for(let o=0;o<n.length;o++){const i=s.indexToLoc(n[o]),a=o*t.length;r.values.set(i,a)}return r.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function kK(t){const e=F(t,"condition","whereAsync","bool"),n=await e.data(),s=dk(e.shape,n);return t!==e&&e.dispose(),s}const __=kK;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function IK(t,e,n){const s=F(t,"tensor","boolMask"),r=F(e,"mask","boolMask","bool"),o=n??0,i=r.rank,a=s.shape;A(i>0,()=>"mask cannot be scalar"),Er(a.slice(o,o+i),r.shape,"mask's shape must match the first K dimensions of tensor's shape,");let l=1;for(let m=o;m<o+i;m++)l*=a[m];const u=a.slice(0,o).concat([l],a.slice(o+i)),c=q(s,u),d=q(r,[-1]),h=await __(d),p=Ht(h,[1]),f=Ym(c,p,o);return t!==s&&s.dispose(),e!==r&&r.dispose(),p.dispose(),c.dispose(),d.dispose(),h.dispose(),f}const $K=IK;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NK(t,e,n){const s=F(t,"x","transpose");if(e==null&&(e=s.shape.map((i,a)=>a).reverse()),A(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(i=>{A(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},o={perm:e};return s.dtype==="complex64"?ne(()=>{let i=bf(s),a=gw(s);return i=K.runKernel(Eu,{x:i},o),a=K.runKernel(Eu,{x:a},o),n&&(a=Sn(a)),Il(i,a)}):K.runKernel(Eu,r,o)}const Vt=G({transpose_:NK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TK(t,e,n,s,r=!0){const o=F(t,"v","movingAverage"),i=F(e,"x","movingAverage"),a=F(n,"decay","movingAverage");yG(o,i),A(Ct(o.shape,i.shape),()=>"Shape mismatch in v and x");const l=ot(1),u=Be(l,a);let c=U(Be(i,o),u);if(r){A(s!=null,()=>"When using zeroDebias: true, step is required.");const d=F(s,"step","movingAverage");c=Me(c,Be(l,Ba(a,d)))}return me(o,c)}const EK=G({movingAverage_:TK});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RK(t,e,n){yo(n);const s=F(t,"indices","scatterND","int32"),r=F(e,"updates","scatterND");lk(r,s,n);const o={indices:s,updates:r},i={shape:n};return K.runKernel(J0,o,i)}const DK=G({scatterND_:RK});function AK(t,e,n,s){if(t.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const r=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const i=e.size;if(!(e.rank===0||e.rank===1&&i===r))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${r}]`);if(e.dtype!==s.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _K(t,e,n,s=0){yo(n);const r=F(t,"sparseIndices","sparseToDense","int32"),o=F(e,"sparseValues","sparseToDense","string_or_numeric"),i=F(s,"defaultValue","sparseToDense",o.dtype);AK(r,o,n,i);const a={sparseIndices:r,sparseValues:o,defaultValue:i},l={outputShape:n};return K.runKernel(sw,a,l)}const FK=G({sparseToDense_:_K});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PK(t,e){const n=F(e,"indices","gatherND","int32"),r={params:F(t,"x","gatherND","string_or_numeric"),indices:n};return K.runKernel(L0,r)}const OK=G({gatherND_:PK});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LK(t,e){if(e==null)return t.shape.slice();if(Ct(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zK(t,e,n,s){const r=F(t,"x","dropout");if(A(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),A(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Qt?r.clone():r;const o=LK(r,n),i=1-e,a=Me(Xm(me(dc(o,0,1,"float32",s),i)),i);return U(r,a)}const F_=G({dropout_:zK});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P_(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function hk(t,e,n){const s=1-t%2,r=new Float32Array(t);for(let o=0;o<t;++o){const i=2*Math.PI*o/(t+s-1);r[o]=e-n*Math.cos(i)}return es(r,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function MK(t,e,n=1){const s=F(t,"predictions","inTopK"),r=F(e,"targets","inTopK");A(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),A(s.rank-1===r.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${r.rank}`),Er(s.shape.slice(0,s.shape.length-1),r.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const o=s.shape[s.shape.length-1];A(n>0&&n<=o,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${o}), but got ${n}`);const i=await s.data(),a=await r.data(),[l,u]=[i.length/o,o],c=ps("bool",l);for(let d=0;d<l;d++){const h=d*u,p=i.subarray(h,h+u),f=[];for(let m=0;m<p.length;m++)f.push({value:p[m],index:m});f.sort((m,g)=>g.value-m.value),c[d]=0;for(let m=0;m<n;m++)if(f[m].index===a[d]){c[d]=1;break}}return t!==s&&s.dispose(),e!==r&&r.dispose(),bi(c,r.shape,"bool")}const BK=MK;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VK(t,e,n,s,r,o="NHWC",i){let a=t;t.rank===3&&(a=q(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=q(e,[1,e.shape[0],e.shape[1],e.shape[2]])),A(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),A(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),A(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const u=o==="NHWC"?a.shape[3]:a.shape[1],c=o==="NHWC"?l.shape[3]:l.shape[1];A(u===n[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${n[2]}.`),A(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),fr("conv2dDerFilter",r,i);const d={x:a,dy:l},h={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,filterShape:n};return K.runKernel(S0,d,h)}const pk=G({conv2DBackpropFilter_:VK});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dw(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return U(t,zh(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Aw(t,e){let n=e;const s=fs(t.shape,e.shape);return s.length>0&&(n=Qe(n,s)),q(n,t.shape)}function _w(t,e,n,s){if(e==="linear")return t;if(e==="relu")return pa(t);if(e==="elu")return Km(t);if(e==="relu6")return J2(t);if(e==="prelu")return kw(t,n);if(e==="leakyrelu")return yw(t,s);if(e==="sigmoid")return uo(t);throw new Error(`Unknown fused activation ${e}.`)}const Fw=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UK({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(l=l||"linear",Fw(K.state.gradientDepth,l)===!1){A(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let C=Tl(t,e,n,s,r,o,i);return a!=null&&(C=me(C,a)),_w(C,l,u,c)}const d=F(t,"x","conv2d","float32"),h=F(e,"filter","conv2d","float32");let p=d,f=!1;d.rank===3&&(f=!0,p=q(d,[1,d.shape[0],d.shape[1],d.shape[2]])),A(p.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`),A(h.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),fr("fused conv2d",s,i);const m=r==="NHWC"?p.shape[3]:p.shape[1];A(h.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`),A(ms(n,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);const g=gn(p.shape,h.shape,n,o,s,i);let y;a!=null&&(y=F(a,"bias","fused conv2d"),[y]=Un(y,d),r==="NHWC"?ct(g.outShape,y.shape):(A(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),A(y.shape.length===0||y.shape[0]===g.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let x;if(u!=null){const C=u.shape;if(A(C.length<=1||C.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${C.length}.`),C.length===1)A(C[0]===1||C[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the number of output channels (${g.outChannels}).`);else if(C.length===3)try{ct(C,g.outShape)}catch{const T=`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(T)}x=F(u,"prelu weights","fused conv2d")}const v=(C,I)=>{A(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[T,R,_,P]=I,z=Dw(C,_,l);A(Nl(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const O=A2(R.shape,z,T,n,s),V=pk(R,z,T.shape,n,s),H=[O,V];if(P!=null){const Q=Aw(P,z);H.push(Q)}return H},b={x:p,filter:h,bias:y,preluActivationWeights:x},S={strides:n,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i,activation:l,leakyreluAlpha:c};return a==null?Va((I,T,R)=>{let _=K.runKernel(ff,b,S);return R([T,I,_]),f&&(_=q(_,[_.shape[1],_.shape[2],_.shape[3]])),{value:_,gradFunc:v}})(p,h):Va((I,T,R,_)=>{let P=K.runKernel(ff,b,S);return _([T,I,P,R]),f&&(P=q(P,[P.shape[1],P.shape[2],P.shape[3]])),{value:P,gradFunc:v}})(p,h,y)}const O_=G({fusedConv2d_:UK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WK(t,e,n,s,r,o=[1,1],i){let a=t;t.rank===3&&(a=q(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=q(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},c={strides:s,pad:r,dimRoundingMode:i,dilations:o,filterShape:n};return K.runKernel(E0,u,c)}const L_=G({depthwiseConv2dNativeBackpropFilter_:WK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jK(t,e,n,s,r,o=[1,1],i){let a=e,l=!1;e.rank===3&&(l=!0,a=q(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:n},c={strides:s,pad:r,dimRoundingMode:i,dilations:o,inputShape:t},d=K.runKernel(R0,u,c);return l?q(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const z_=G({depthwiseConv2dNativeBackpropInput_:jK});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GK({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(Fw(K.state.gradientDepth,l)===!1){let S=Hm(t,e,n,s,r,o,i);return a!=null&&(S=me(S,a)),_w(S,l,u,c)}const d=F(t,"x","depthwiseConv2d","float32"),h=F(e,"filter","depthwiseConv2d","float32");let p=d,f=!1;d.rank===3&&(f=!0,p=q(d,[1,d.shape[0],d.shape[1],d.shape[2]])),A(p.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`),A(h.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`),A(p.shape[3]===h.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),o==null&&(o=[1,1]),A(ms(n,o),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),fr("fused depthwiseConv2d",s,i);const m=gn(p.shape,h.shape,n,o,s,i,!0);let g;a!=null&&(g=F(a,"bias","fused conv2d"),[g]=Un(g,d),ct(m.outShape,g.shape));let y;u!=null&&(y=F(u,"prelu weights","fused depthwiseConv2d"));const x=(S,C)=>{A(Nl(o),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`);const[I,T,R,_]=C,P=Dw(S,R,l),z=z_(T.shape,P,I,n,s,o,i),O=L_(T,P,I.shape,n,s,o,i);if(_!=null){const V=Aw(g,P);return[z,O,V]}return[z,O]},v={x:p,filter:h,bias:g,preluActivationWeights:y},b={strides:n,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i,activation:l,leakyreluAlpha:c};return a==null?Va((C,I,T)=>{let R=K.runKernel(mf,v,b);return T([I,C,R]),f&&(R=q(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:x}})(p,h):Va((C,I,T,R)=>{let _=K.runKernel(mf,v,b);return R([I,C,_,T]),f&&(_=q(_,[_.shape[1],_.shape[2],_.shape[3]])),{value:_,gradFunc:x}})(p,h,g)}const HK=G({fusedDepthwiseConv2d_:GK});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KK({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:r,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(Fw(K.state.gradientDepth,o)===!1){let P=At(t,e,n,s);return r!=null&&(P=me(P,r)),_w(P,o,i,a)}let l=F(t,"a","fused matMul"),u=F(e,"b","fused matMul");[l,u]=Un(l,u);const c=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=s?u.shape[u.rank-1]:u.shape[u.rank-2],h=n?l.shape[l.rank-1]:l.shape[l.rank-2],p=s?u.shape[u.rank-2]:u.shape[u.rank-1],f=l.shape.slice(0,-2),m=u.shape.slice(0,-2),g=te(f),y=te(m);A(c===d,()=>`Error in fused matMul: inner shapes (${c}) and (${d}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${n} and transposeB=${s} must match.`);const v=ct(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([h,p]),b=n?q(l,[g,c,h]):q(l,[g,h,c]),S=s?q(u,[y,p,d]):q(u,[y,d,p]);let C;r!=null&&(C=F(r,"bias","fused matMul"),[C]=Un(C,l),ct(v,C.shape));let I;i!=null&&(I=F(i,"prelu weights","fused matMul"));const T=(P,z)=>{const[O,V,H,Q]=z,oe=Dw(q(P,H.shape),H,o);let j,ee;if(!n&&!s?(j=At(oe,V,!1,!0),ee=At(O,oe,!0,!1)):!n&&s?(j=At(oe,V,!1,!1),ee=At(oe,O,!0,!1)):n&&!s?(j=At(V,oe,!1,!0),ee=At(O,oe,!1,!1)):(j=At(V,oe,!0,!0),ee=At(oe,O,!0,!0)),r!=null){const ie=Aw(Q,oe);return[j,ee,ie]}else return[j,ee]},R={a:b,b:S,bias:C,preluActivationWeights:I},_={transposeA:n,transposeB:s,activation:o,leakyreluAlpha:a};return r==null?Va((z,O,V)=>{const H=K.runKernel(pf,R,_);return V([z,O,H]),{value:q(H,v),gradFunc:T}})(b,S):Va((z,O,V,H)=>{const Q=K.runKernel(pf,R,_);return H([z,O,Q,V]),{value:q(Q,v),gradFunc:T}})(b,S,C)}const dS=G({fusedMatMul_:KK});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qK=Object.freeze(Object.defineProperty({__proto__:null,conv2d:O_,depthwiseConv2d:HK,matMul:dS},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XK(t){return hk(t,.54,.46)}const YK=G({hammingWindow_:XK});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QK(t){return hk(t,.5,.5)}const M_=G({hannWindow_:QK});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JK(t,e,n,s=!1,r=0){let o=0;const i=[];for(;o+e<=t.size;)i.push(pt(t,o,e)),o+=n;if(s)for(;o<t.size;){const a=o+e-t.size,l=Pn([pt(t,o,e-a),Oh([a],r)]);i.push(l),o+=n}return i.length===0?Ho([],[0,e]):q(Pn(i),[i.length,e])}const B_=G({frame_:JK});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZK(t,e,n,s,r=M_){s==null&&(s=P_(e));const o=B_(t,e,n),i=U(o,r(e));return Rw(i,s)}const eq=G({stft_:ZK});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tq(t,e,n,s,r="bilinear",o=0){const i=F(t,"image","cropAndResize"),a=F(e,"boxes","cropAndResize","float32"),l=F(n,"boxInd","cropAndResize","int32"),u=a.shape[0];A(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),A(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),A(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),A(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),A(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),A(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const c={image:i,boxes:a,boxInd:l},d={method:r,extrapolationValue:o,cropSize:s};return K.runKernel($0,c,d)}const nq=G({cropAndResize_:tq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sq(t){const e=F(t,"image","flipLeftRight","float32");A(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return K.runKernel(O0,n,{})}const rq=G({flipLeftRight_:sq});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oq(t){const e=F(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];A(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),A(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,n),r[n]=3,Bo(e,r)}const iq=G({grayscaleToRGB_:oq});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aq(t){const e=F(t,"image","RGBToGrayscale"),n=e.rank-1,s=e.shape[n];A(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),A(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,o=Ee(e,"float32"),i=es([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Mc("ij,j->i",o,i);break;case 3:a=Mc("ijk,k->ij",o,i);break;case 4:a=Mc("ijkl,l->ijk",o,i);break;case 5:a=Mc("ijklm,m->ijkl",o,i);break;case 6:a=Mc("ijklmn,n->ijklm",o,i);break;default:throw new Error("Not a valid tensor rank.")}return a=Zn(a,-1),Ee(a,r)}const lq=G({rgbToGrayscale_:aq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uq(t,e,n=0,s=.5){const r=F(t,"image","rotateWithOffset","float32");A(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},i={radians:e,fillValue:n,center:s};return K.runKernel(cw,o,i)}const cq=G({rotateWithOffset_:uq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mh(t,e,n,s,r,o){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const i=t.shape[0];return n=Math.min(n,i),A(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),A(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),A(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),A(e.rank===1,()=>"scores must be a 1D tensor"),A(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),A(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dq(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const o=F(t,"boxes","nonMaxSuppression","float32"),i=F(e,"scores","nonMaxSuppression","float32"),a=Mh(o,i,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:s,scoreThreshold:r};return K.runKernel(H0,{boxes:o,scores:i},l)}const hq=G({nonMaxSuppression_:dq});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pq(t,e,n){const s=fq(t,e,n),r=s<0?-(s+1):s;t.splice(r,0,e)}function fq(t,e,n){return gq(t,e,n||mq)}function mq(t,e){return t>e?1:t<e?-1:0}function gq(t,e,n){let s=0,r=t.length,o=0,i=!1;for(;s<r;){o=s+(r-s>>>1);const a=n(e,t[o]);a>0?s=o+1:(r=o,i=!a)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pw(t,e,n,s,r){return mk(t,e,n,s,r,0)}function fk(t,e,n,s,r,o){return mk(t,e,n,s,r,0,!1,o,!0)}function Ow(t,e,n,s,r,o){return mk(t,e,n,s,r,o,!0)}function mk(t,e,n,s,r,o,i=!1,a=!1,l=!1){const u=[];for(let g=0;g<e.length;g++)e[g]>r&&u.push({score:e[g],boxIndex:g,suppressBeginIndex:0});u.sort(BN);const c=o>0?-.5/o:0,d=[],h=[];for(;d.length<n&&u.length>0;){const g=u.pop(),{score:y,boxIndex:x,suppressBeginIndex:v}=g;if(y<r)break;let b=!1;for(let S=d.length-1;S>=v;--S){const C=yq(t,x,d[S]);if(C>=s){b=!0;break}if(g.score=g.score*xq(s,c,C),g.score<=r)break}g.suppressBeginIndex=d.length,b||(g.score===y?(d.push(x),h.push(g.score)):g.score>r&&pq(u,g,BN))}const p=d.length,f=n-p;a&&f>0&&(d.push(...new Array(f).fill(0)),h.push(...new Array(f).fill(0)));const m={selectedIndices:d};return i&&(m.selectedScores=h),l&&(m.validOutputs=p),m}function yq(t,e,n){const s=t.subarray(e*4,e*4+4),r=t.subarray(n*4,n*4+4),o=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),c=Math.min(r[1],r[3]),d=Math.max(r[0],r[2]),h=Math.max(r[1],r[3]),p=(a-o)*(l-i),f=(d-u)*(h-c);if(p<=0||f<=0)return 0;const m=Math.max(o,u),g=Math.max(i,c),y=Math.min(a,d),x=Math.min(l,h),v=Math.max(y-m,0)*Math.max(x-g,0);return v/(p+f-v)}function xq(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function BN(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function wq(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const o=F(t,"boxes","nonMaxSuppressionAsync"),i=F(e,"scores","nonMaxSuppressionAsync"),a=Mh(o,i,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([o.data(),i.data()]),u=l[0],c=l[1],{selectedIndices:d}=Pw(u,c,n,s,r);return o!==t&&o.dispose(),i!==e&&i.dispose(),es(d,"int32")}const vq=wq;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bq(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=F(t,"boxes","nonMaxSuppression"),a=F(e,"scores","nonMaxSuppression"),l=Mh(i,a,n,s,r,o);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const u={boxes:i,scores:a},c={maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:o},d=K.runKernel(K0,u,c);return{selectedIndices:d[0],selectedScores:d[1]}}const Sq=G({nonMaxSuppressionWithScore_:bq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Cq(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=F(t,"boxes","nonMaxSuppressionAsync"),a=F(e,"scores","nonMaxSuppressionAsync"),l=Mh(i,a,n,s,r,o);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const u=await Promise.all([i.data(),a.data()]),c=u[0],d=u[1],{selectedIndices:h,selectedScores:p}=Ow(c,d,n,s,r,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:es(h,"int32"),selectedScores:es(p)}}const kq=Cq;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iq(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=F(t,"boxes","nonMaxSuppression"),a=F(e,"scores","nonMaxSuppression"),l=Mh(i,a,n,s,r,null),u=l.maxOutputSize,c=l.iouThreshold,d=l.scoreThreshold,h={boxes:i,scores:a},p={maxOutputSize:u,iouThreshold:c,scoreThreshold:d,padToMaxOutputSize:o},f=K.runKernel(f2,h,p);return{selectedIndices:f[0],validOutputs:f[1]}}const $q=G({nonMaxSuppressionPadded_:Iq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Nq(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=F(t,"boxes","nonMaxSuppressionAsync"),a=F(e,"scores","nonMaxSuppressionAsync"),l=Mh(i,a,n,s,r,null),u=l.maxOutputSize,c=l.iouThreshold,d=l.scoreThreshold,[h,p]=await Promise.all([i.data(),a.data()]),{selectedIndices:f,validOutputs:m}=fk(h,p,u,c,d,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:es(f,"int32"),validOutputs:ot(m,"int32")}}const Tq=Nq;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eq(t,e,n=!1,s=!1){const r=F(t,"images","resizeBilinear");A(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),A(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),A(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=q(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:n,halfPixelCenters:s,size:e},u=K.runKernel(_m,a,l);return i?q(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const V_=G({resizeBilinear_:Eq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rq(t,e,n=!1,s=!1){const r=F(t,"images","resizeNearestNeighbor");A(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),A(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),A(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),A(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=q(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:n,halfPixelCenters:s,size:e},u=K.runKernel(Am,a,l);return i?q(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const U_=G({resizeNearestNeighbor_:Rq});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dq(t,e="binary",n=!1,s=.5){const r=F(t,"image","threshold"),o=.2989,i=.587,a=.114,l=r.shape[0]*r.shape[1];let u=U(es([s]),255),c,d,h,p;if(A(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),A(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),A(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),A(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[c,d,h]=Hr(r,[1,1,1],-1);const g=U(c,o),y=U(d,i),x=U(h,a);p=me(me(g,y),x)}else p=t;if(e==="otsu"){const g=Y3(Ee(Z2(p),"int32"),bi([]),256);u=Aq(g,l)}const f=n?uc(p,u):eo(p,u);return Ee(U(f,255),"int32")}function Aq(t,e){let n=es([-1]),s=es([0]),r=es([0]),o,i,a,l,u,c;for(let d=0;d<t.size-1;d++){o=pt(t,0,d+1),i=pt(t,d+1),u=Me(Qe(o),e),c=Me(Qe(i),e);const h=Qe(U(o,Cd(0,o.size)));a=Me(h,Qe(o));const p=Oh(i.shape,o.size),f=me(Cd(0,i.size),p),m=U(i,f);l=Me(Qe(m),Qe(i));const g=Be(a,l),y=Be(a,l),x=U(u,c);r=U(U(x,g),y);const v=eo(r,s);s=Hs(v,r,s),n=Hs(v,es([d]),n)}return n}const _q=G({threshold_:Dq});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fq(t,e,n="nearest",s="constant",r=0,o){const i=F(t,"image","transform","float32"),a=F(e,"transforms","transform","float32");A(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),A(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),A(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const l={image:i,transforms:a},u={interpolation:n,fillMode:s,fillValue:r,outputShape:o};return K.runKernel(uw,l,u)}const Pq=G({transform_:Fq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oq(t,e,n){const s=F(t,"a","bandPart");A(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[o,i]=s.shape.slice(-2);let a,l;typeof e=="number"?(A(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),A(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),a=F(e<0?o:e,"numLower","bandPart")):(A(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Hs(vf(e,0),o,Rl(e,o))),typeof n=="number"?(A(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),A(n<=i,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`),l=F(n<0?i:n,"numUpper","bandPart")):(A(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Hs(vf(n,0),i,Rl(n,i)));const u=q(Cd(0,o,1,"int32"),[-1,1]),c=Cd(0,i,1,"int32"),d=Be(u,c),h=aa(uc(d,a),Hl(d,Sn(l))),p=Gn([o,i],s.dtype);return q(qr(Qo(q(s,[-1,o,i])).map(f=>Hs(h,f,p))),r)}const Lq=G({bandPart_:Oq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zq(t){let e;if(Array.isArray(t)){e=!1,A(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=t[0].shape[0];for(let o=1;o<t.length;++o)A(t[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[o].shape[0]} vs. ${r})`)}else e=!0,t=Hr(t,t.shape[0],0).map(r=>Ht(r,[0]));A(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let r=0;r<t.length;++r)n.push(K.tidy(()=>{let o=s[r];if(r>0)for(let i=0;i<r;++i){const a=U(Qe(U(n[i],o)),n[i]);o=Be(o,a)}return Me(o,qm(o,"euclidean"))}));return e?qr(n,0):n}const Mq=G({gramSchmidt_:zq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bq(t,e=!1){if(A(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return VN(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,u)=>l*u),s=Qo(q(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),r=[],o=[];s.forEach(l=>{const[u,c]=VN(l,e);r.push(u),o.push(c)});const i=q(qr(r,0),t.shape),a=q(qr(o,0),t.shape);return[i,a]}}function VN(t,e=!1){return K.tidy(()=>{A(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let r=z2(n),o=Aa(t);const i=Ho([[1]],[1,1]);let a=Aa(i);const l=n>=s?s:n;for(let u=0;u<l;++u){const c=o,d=a,h=r;[a,o,r]=K.tidy(()=>{const p=pt(o,[u,u],[n-u,1]),f=qm(p),m=pt(o,[u,u],[1,1]),g=Hs(eo(m,0),Ho([[-1]]),Ho([[1]])),y=Be(m,U(g,f)),x=Me(p,y);x.shape[0]===1?a=Aa(i):a=Pn([i,pt(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);const v=Sn(Me(At(g,y),f)),b=pt(o,[u,0],[n-u,s]),S=U(v,a),C=Vt(a);if(u===0)o=Be(b,At(S,At(C,b)));else{const R=Be(b,At(S,At(C,b)));o=Pn([pt(o,[0,0],[u,s]),R],0)}const I=Vt(S),T=pt(r,[0,u],[n,r.shape[1]-u]);if(u===0)r=Be(T,At(At(T,a),I));else{const R=Be(T,At(At(T,a),I));r=Pn([pt(r,[0,0],[n,u]),R],1)}return[a,o,r]}),lt([c,d,h])}return!e&&n>s&&(r=pt(r,[0,0],[n,s]),o=pt(o,[0,0],[s,s])),[r,o]})}const Vq=G({qr_:Bq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var vr;(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(vr||(vr={}));function Uq(t,e,n=vr.SUM_BY_NONZERO_WEIGHTS){const s=F(t,"losses","computeWeightedLoss");let r=null;e!=null&&(r=F(e,"weights","computeWeightedLoss"));const o=r==null?s:U(s,r);if(n===vr.NONE)return o;if(n===vr.SUM)return Qe(o);if(n===vr.MEAN){if(r==null)return zn(o);{const i=s.size/r.size,a=Me(Qe(o),Qe(r));return i>1?Me(a,ot(i)):a}}if(n===vr.SUM_BY_NONZERO_WEIGHTS){if(r==null)return Me(Qe(o),ot(s.size));{const i=U(r,Ur(s.shape)),a=Ee(Qe(Sd(i,ot(0))),"float32");return Me(Qe(o),a)}}throw Error(`Unknown reduction: ${n}`)}const Ga=G({computeWeightedLoss_:Uq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wq(t,e,n,s=vr.SUM_BY_NONZERO_WEIGHTS){const r=F(t,"labels","absoluteDifference"),o=F(e,"predictions","absoluteDifference");let i=null;n!=null&&(i=F(n,"weights","absoluteDifference")),Er(r.shape,o.shape,"Error in absoluteDifference: ");const a=is(Be(r,o));return Ga(a,i,s)}const jq=G({absoluteDifference_:Wq});function Gq(t,e,n,s,r=vr.SUM_BY_NONZERO_WEIGHTS){const o=F(t,"labels","cosineDistance"),i=F(e,"predictions","cosineDistance");let a=null;s!=null&&(a=F(s,"weights","cosineDistance")),Er(o.shape,i.shape,"Error in cosineDistance: ");const l=ot(1),u=Be(l,Qe(U(o,i),n,!0));return Ga(u,a,r)}const Hq=G({cosineDistance_:Gq});function Kq(t,e,n,s=vr.SUM_BY_NONZERO_WEIGHTS){let r=F(t,"labels","hingeLoss");const o=F(e,"predictions","hingeLoss");let i=null;n!=null&&(i=F(n,"weights","hingeLoss")),Er(r.shape,o.shape,"Error in hingeLoss: ");const a=ot(1);r=Be(U(ot(2),r),a);const l=pa(Be(a,U(r,o)));return Ga(l,i,s)}const qq=G({hingeLoss_:Kq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xq(t,e,n,s=1,r=vr.SUM_BY_NONZERO_WEIGHTS){const o=F(t,"labels","huberLoss"),i=F(e,"predictions","huberLoss");let a=null;n!=null&&(a=F(n,"weights","huberLoss")),Er(o.shape,i.shape,"Error in huberLoss: ");const l=ot(s),u=is(Be(i,o)),c=Rl(u,l),d=Be(u,c),h=me(U(ot(.5),sn(c)),U(l,d));return Ga(h,a,r)}const Yq=G({huberLoss_:Xq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qq(t,e,n,s=1e-7,r=vr.SUM_BY_NONZERO_WEIGHTS){const o=F(t,"labels","logLoss"),i=F(e,"predictions","logLoss");let a=null;n!=null&&(a=F(n,"weights","logLoss")),Er(o.shape,i.shape,"Error in logLoss: ");const l=ot(1),u=ot(s),c=Sn(U(o,po(me(i,u)))),d=U(Be(l,o),po(me(Be(l,i),u))),h=Be(c,d);return Ga(h,a,r)}const Jq=G({logLoss_:Qq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zq(t,e,n,s=vr.SUM_BY_NONZERO_WEIGHTS){const r=F(t,"labels","meanSquaredError"),o=F(e,"predictions","meanSquaredError");let i=null;n!=null&&(i=F(n,"weights","meanSquaredError")),Er(r.shape,o.shape,"Error in meanSquaredError: ");const a=ak(r,o);return Ga(a,i,s)}const eX=G({meanSquaredError_:Zq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tX(t,e){const n=F(t,"labels","sigmoidCrossEntropyWithLogits"),s=F(e,"logits","sigmoidCrossEntropyWithLogits");Er(n.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const r=pa(s),o=U(s,n),i=xw(hr(Sn(is(s))));return me(Be(r,o),i)}function nX(t,e,n,s=0,r=vr.SUM_BY_NONZERO_WEIGHTS){let o=F(t,"multiClassLabels","sigmoidCrossEntropy");const i=F(e,"logits","sigmoidCrossEntropy");let a=null;if(n!=null&&(a=F(n,"weights","sigmoidCrossEntropy")),Er(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),s>0){const u=ot(s),c=ot(1),d=ot(.5);o=me(U(o,Be(c,u)),U(d,u))}const l=tX(o,i);return Ga(l,a,r)}const sX=G({sigmoidCrossEntropy_:nX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rX(t,e,n=-1){if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);return Va((r,o,i)=>{const l=ww(o,[n],!0),u=Be(Ee(o,"float32"),l);i([r,u]);const c=Sn(U(u,r));return{value:Qe(c,[n]),gradFunc:(p,f)=>{const[m,g]=f,y=Wn(p.shape,[n]);return[U(q(p,y),Be(Ee(m,"float32"),hr(g))),U(q(p,y),Be(hr(g),Ee(m,"float32")))]}}})(t,e)}function oX(t,e,n,s=0,r=vr.SUM_BY_NONZERO_WEIGHTS){let o=F(t,"onehotLabels","softmaxCrossEntropy");const i=F(e,"logits","softmaxCrossEntropy");let a=null;if(n!=null&&(a=F(n,"weights","softmaxCrossEntropy")),Er(o.shape,i.shape,"Error in softmaxCrossEntropy: "),s>0){const u=ot(s),c=ot(1),d=ot(o.shape[1]);o=me(U(o,Be(c,u)),Me(u,d))}const l=rX(o,i);return Ga(l,a,r)}const iX=G({softmaxCrossEntropy_:oX});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aX(t,e,n,s){const r=F(t,"indices","sparseFillEmptyRows","int32"),o=F(e,"values","sparseFillEmptyRows"),i=F(n,"denseShape","sparseFillEmptyRows","int32"),a=F(s,"defaultValue","sparseFillEmptyRows",o.dtype);if(r.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${r.shape}`);if(o.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${o.shape}`);if(i.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const l={indices:r,values:o,denseShape:i,defaultValue:a},u=K.runKernel(x2,l);return{outputIndices:u[0],outputValues:u[1],emptyRowIndicator:u[2],reverseIndexMap:u[3]}}const lX=G({sparseFillEmptyRows_:aX});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uX(t,e,n){const s=F(t,"inputIndices","sparseReshape","int32"),r=F(e,"inputShape","sparseReshape","int32"),o=F(n,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(r.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${r.shape}`);if(o.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const i={inputIndices:s,inputShape:r,newShape:o},a=K.runKernel(w2,i);return{outputIndices:a[0],outputShape:a[1]}}const cX=G({sparseReshape_:uX});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dX(t,e,n){const s=F(t,"data","sparseSegmentMean"),r=F(e,"indices","sparseSegmentMean","int32"),o=F(n,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${r.shape}`);if(o.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${o.shape}`);const i={data:s,indices:r,segmentIds:o};return K.runKernel(tw,i)}const hX=G({sparseSegmentMean_:dX});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pX(t,e,n){const s=F(t,"data","sparseSegmentSum"),r=F(e,"indices","sparseSegmentSum","int32"),o=F(n,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${r.shape}`);if(o.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${o.shape}`);const i={data:s,indices:r,segmentIds:o};return K.runKernel(nw,i)}const fX=G({sparseSegmentSum_:pX});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mX(t,e,n,s,r,o,i,a){const l=F(t,"data","stringNGrams","string");if(l.dtype!=="string")throw new Error("Data must be of datatype string");if(l.shape.length!==1)throw new Error(`Data must be a vector, saw: ${l.shape}`);const u=F(e,"dataSplits","stringNGrams");if(u.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const c={separator:n,nGramWidths:s,leftPad:r,rightPad:o,padWidth:i,preserveShortSequences:a},d={data:l,dataSplits:u},h=K.runKernel(aw,d,c);return{nGrams:h[0],nGramsSplits:h[1]}}const gX=G({stringNGrams_:mX});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yX(t,e,n=!0){const s=F(t,"input","stringSplit","string"),r=F(e,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(r.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${r.shape}`);const o={skipEmpty:n},i={input:s,delimiter:r},a=K.runKernel(v2,i,o);return{indices:a[0],values:a[1],shape:a[2]}}const xX=G({stringSplit_:yX});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wX(t,e){const n=F(t,"input","stringToHashBucketFast","string"),s={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const r={input:n};return K.runKernel(b2,r,s)}const vX=G({stringToHashBucketFast_:wX});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bX(t,e,n,s=!0){const r=F(t,"input","staticRegexReplace","string"),o={pattern:e,rewrite:n,replaceGlobal:s};return K.runKernel(ow,{x:r},o)}const SX=G({staticRegexReplace_:bX});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CX={fft:Ew,ifft:Cf,rfft:Rw,irfft:ik},kX={hammingWindow:YK,hannWindow:M_,frame:B_,stft:eq},cr={flipLeftRight:rq,grayscaleToRGB:iq,resizeNearestNeighbor:U_,resizeBilinear:V_,rgbToGrayscale:lq,rotateWithOffset:cq,cropAndResize:nq,nonMaxSuppression:hq,nonMaxSuppressionAsync:vq,nonMaxSuppressionWithScore:Sq,nonMaxSuppressionWithScoreAsync:kq,nonMaxSuppressionPadded:$q,nonMaxSuppressionPaddedAsync:Tq,threshold:_q,transform:Pq},W_={bandPart:Lq,gramSchmidt:Mq,qr:Vq},IX={absoluteDifference:jq,computeWeightedLoss:Ga,cosineDistance:Hq,hingeLoss:qq,huberLoss:Yq,logLoss:Jq,meanSquaredError:eX,sigmoidCrossEntropy:sX,softmaxCrossEntropy:iX},$X={sparseFillEmptyRows:lX,sparseReshape:cX,sparseSegmentMean:hX,sparseSegmentSum:fX},NX={stringNGrams:gX,stringSplit:xX,stringToHashBucketFast:vX,staticRegexReplace:SX};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TX=new Map,EX=new Map;class Bh{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class Po{constructor(){this.classNameMap={}}static getMap(){return Po.instance==null&&(Po.instance=new Po),Po.instance}static register(e){Po.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Se(t,e,n){A(t.className!=null,()=>"Class being registered does not have the static className property defined."),A(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),A(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const s=n,r=e+">"+s;return Po.register(t),TX.set(r,t),EX.set(t,r),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kl extends Bh{minimize(e,n=!1,s){const{value:r,grads:o}=this.computeGradients(e,s);if(s!=null){const i=s.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(i)}else this.applyGradients(o);return lt(o),n?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return t5(e,n)}dispose(){this.iterations_!=null&&lt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:ot(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Kl,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j_ extends Kl{static get className(){return"Adadelta"}constructor(e,n,s=null){super(),this.learningRate=e,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=K.registeredVariables[s],i=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:ne(()=>Ut(o).variable(i))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:ne(()=>Ut(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;ne(()=>{const c=me(U(l,this.rho),U(sn(a),1-this.rho)),d=U(Me(zs(me(u,this.epsilon)),zs(me(l,this.epsilon))),a),h=me(U(u,this.rho),U(sn(d),1-this.rho));l.assign(c),u.assign(h);const p=me(U(d,-this.learningRate),o);o.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(lt(this.accumulatedGrads.map(e=>e.variable)),lt(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G_ extends Kl{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=K.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:ne(()=>Oh(o.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const a=this.accumulatedGrads[r].variable;ne(()=>{const l=me(a,sn(i));a.assign(l);const u=me(U(Me(i,zs(me(l,K.backend.epsilon()))),-this.learningRate),o);o.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&lt(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H_ extends Kl{static get className(){return"Adam"}constructor(e,n,s,r=null){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ne(()=>{this.accBeta1=ot(n).variable(),this.accBeta2=ot(s).variable()}),r==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ne(()=>{const s=Be(1,this.accBeta1),r=Be(1,this.accBeta2);n.forEach((o,i)=>{const a=K.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:ne(()=>Ut(a).variable(l))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${o}/v`,variable:ne(()=>Ut(a).variable(l))});const u=Array.isArray(e)?e[i].tensor:e[o];if(u==null)return;const c=this.accumulatedFirstMoment[i].variable,d=this.accumulatedSecondMoment[i].variable,h=me(U(c,this.beta1),U(u,1-this.beta1)),p=me(U(d,this.beta2),U(sn(u),1-this.beta2)),f=Me(h,s),m=Me(p,r);c.assign(h),d.assign(p);const g=me(U(Me(f,me(zs(m),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign(U(this.accBeta1,this.beta1)),this.accBeta2.assign(U(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&lt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&lt(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),ne(()=>{this.accBeta1.assign(Ba(this.beta1,this.iterations_+1)),this.accBeta2.assign(Ba(this.beta2,this.iterations_+1))});const n=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K_ extends Kl{static get className(){return"Adamax"}constructor(e,n,s,r=null,o=0){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ne(()=>{this.iteration=ot(0).variable(),this.accBeta1=ot(n).variable()}),r==null&&(this.epsilon=K.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);ne(()=>{const s=Be(1,this.accBeta1),r=Me(-this.learningRate,me(U(this.iteration,this.decay),1));n.forEach((o,i)=>{const a=K.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:Ut(a).variable(l)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${o}/v`,variable:Ut(a).variable(l)});const u=Array.isArray(e)?e[i].tensor:e[o];if(u==null)return;const c=this.accumulatedFirstMoment[i].variable,d=this.accumulatedWeightedInfNorm[i].variable,h=me(U(c,this.beta1),U(u,1-this.beta1)),p=U(d,this.beta2),f=is(u),m=ja(p,f);c.assign(h),d.assign(m);const g=me(U(Me(r,s),Me(h,me(m,this.epsilon))),a);a.assign(g)}),this.iteration.assign(me(this.iteration,1)),this.accBeta1.assign(U(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&lt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&lt(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gk extends Kl{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const i=K.registeredVariables[s];ne(()=>{const a=me(U(this.c,o),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=ks(ot(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q_ extends gk{static get className(){return"Momentum"}constructor(e,n,s=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=ot(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=K.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:ne(()=>Ut(o).variable(!1))});const i=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&ne(()=>{let l;const u=me(U(this.m,i),a);this.useNesterov?l=me(U(this.c,me(a,U(u,this.m))),o):l=me(U(this.c,u),o),i.assign(u),o.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&lt(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X_ extends Kl{static get className(){return"RMSProp"}constructor(e,n=.9,s=0,r=null,o=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=K.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=K.registeredVariables[s],i=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:ne(()=>Ut(o).variable(i))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:ne(()=>Ut(o).variable(i))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:ne(()=>Ut(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;ne(()=>{const c=me(U(l,this.decay),U(sn(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[r].variable,h=me(U(d,this.decay),U(a,1-this.decay)),p=Me(U(a,this.learningRate),zs(Be(c,me(sn(h),this.epsilon)))),f=me(U(u,this.momentum),p);l.assign(c),d.assign(h),u.assign(f);const m=Be(o,f);o.assign(m)}else{const d=me(U(l,this.decay),U(sn(a),1-this.decay)),h=me(U(u,this.momentum),Me(U(a,this.learningRate),zs(me(d,this.epsilon))));l.assign(d),u.assign(h);const p=Be(o,h);o.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&lt(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&lt(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&lt(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RX=[j_,G_,H_,K_,q_,X_,gk];function DX(){for(const t of RX)Se(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AX="model",_X=".json",FX=".weights.bin";function UN(t){return new Promise(e=>setTimeout(e)).then(t)}class Yu{constructor(e){if(!re().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Yu.URL_SCHEME)&&(e=e.slice(Yu.URL_SCHEME.length)),(e==null||e.length===0)&&(e=AX),this.modelJsonFileName=e+_X,this.weightDataFileName=e+FX}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=Pi.join(e.weightData),s=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],o=N3(e,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=i,await UN(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=s,await UN(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:jm(e)}}}}Yu.URL_SCHEME="downloads://";class PX{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,n)=>{const s=new FileReader;s.onload=r=>{const o=JSON.parse(r.target.result),i=o.modelTopology;if(i==null){n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(o.weightsManifest==null){n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:i});return}const l=N2(o,u=>this.loadWeights(u));e(l)},s.onerror=r=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(e){const n=[],s=[];for(const i of e)n.push(...i.weights),s.push(...i.paths);const r=this.checkManifestAndWeightFiles(e),o=s.map(i=>this.loadWeightsFile(i,r[i]));return Promise.all(o).then(i=>[n,i])}loadWeightsFile(e,n){return new Promise((s,r)=>{const o=new FileReader;o.onload=i=>{const a=i.target.result;s(a)},o.onerror=i=>r(`Failed to weights data from file of path '${e}'.`),o.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(e){const n=[],s=this.weightsFiles.map(o=>MN(o.name)),r={};for(const o of e)o.paths.forEach(i=>{const a=MN(i);if(n.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(n.push(a),s.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);r[i]=this.weightsFiles[s.indexOf(a)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}}const OX=t=>re().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Yu.URL_SCHEME)?LX(t.slice(Yu.URL_SCHEME.length)):null;An.registerSaveRouter(OX);function LX(t="model"){return new Yu(t)}function zX(t){return new PX(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WN(t,e,n,s){i(t),n=n??0,s=s??1,a(n,s);let r=0;const o=l=>(l.then(u=>{const c=n+ ++r/t.length*(s-n);return e(c),u}),l);function i(l){A(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){A(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),A(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),A(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(t.map(o))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Y_(t,e){e==null&&(e={});const n=e.fetchFunc==null?re().platform.fetch:e.fetchFunc,s=t.map(d=>n(d,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await WN(s,e.onProgress,0,.5)).map(d=>d.arrayBuffer());return e.onProgress==null?await Promise.all(a):await WN(a,e.onProgress,.5,1)}function MX(t,e){var n;const s=e.fetchFunc==null?re().platform.fetch:e.fetchFunc;let r=0,o;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async i=>{for(var a;r<t.length;){o||(o=(await s(t[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await o.read();if(l){r++,o=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/t.length);continue}i.enqueue(u);return}i.close()}})}async function BX(t,e="",n,s){return Q_(i=>Y_(i,{requestInit:s}))(t,e,n)}function Q_(t){return async(e,n="",s)=>{const r=e.map(()=>!1),o={},i=s!=null?s.map(()=>!1):[],a=[];if(e.forEach((p,f)=>{let m=0;p.weights.forEach(g=>{const y="quantization"in g?g.quantization.dtype:g.dtype,x=Wu[y]*te(g.shape),v=()=>{r[f]=!0,o[f]==null&&(o[f]=[]),o[f].push({manifestEntry:g,groupOffset:m,sizeBytes:x})};s!=null?s.forEach((b,S)=>{b===g.name&&(v(),i[S]=!0)}):v(),a.push(g.name),m+=x})}),!i.every(p=>p)){const p=s.filter((f,m)=>!i[m]);throw new Error(`Could not find weights in manifest with names: ${p.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const l=r.reduce((p,f,m)=>(f&&p.push(m),p),[]),u=[];l.forEach(p=>{e[p].paths.forEach(f=>{const m=n+(n.endsWith("/")?"":"/")+f;u.push(m)})});const c=await t(u),d={};let h=0;return l.forEach(p=>{const f=e[p].paths.length,m=new Pi(c.slice(h,h+f));o[p].forEach(y=>{const x=m.slice(y.groupOffset,y.groupOffset+y.sizeBytes),v=C3(x,[y.manifestEntry]);for(const b in v)d[b]=v[b]}),h+=f}),d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VX="application/octet-stream",UX="application/json";class yk{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(A(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=re().platform.fetch,A(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&A(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=N3(e,s);if(n.body.append("model.json",new Blob([JSON.stringify(r)],{type:UX}),"model.json"),e.weightData!=null){const i=Pi.join(e.weightData);n.body.append("model.weights.bin",new Blob([i],{type:VX}),"model.weights.bin")}const o=await this.fetch(this.path,n);if(o.ok)return{modelArtifactsInfo:jm(e),responses:[o]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${o.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let i=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?i+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":i+=" Please make sure the server is serving valid JSON for this request.",new Error(i)}const s=n.modelTopology,r=n.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return N2(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),s=oS(e.weightsManifest),r=()=>MX(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=WX(n),o=this.weightPathPrefix||s,i=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):i.push(o+u+r);return this.weightUrlConverter&&i.push(...await Promise.all(a)),i}async loadWeights(e){const n=await this.getWeightUrls(e),s=oS(e),r=await Y_(n,this.loadOptions);return[s,r]}}yk.URL_SCHEME_REGEX=/^https?:\/\//;function WX(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),s=t.substring(0,e),r=n>e?t.substring(n):"";return[s+"/",r]}function hS(t){return t.match(yk.URL_SCHEME_REGEX)!=null}const J_=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(s=>hS(s)):n=hS(t),n)return xk(t,e)}return null};An.registerSaveRouter(J_);An.registerLoadRouter(J_);function xk(t,e){return new yk(t,e)}function jX(t,e){return xk(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sv{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class Z_{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class GX{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=n=>Promise.resolve(e.save(n)))}}function HX(t,e,n,s){const r=arguments;return new GX(eF(...r))}function eF(t,e,n,s){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new Sv(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Sv({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Sv({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:s}))}function KX(t){return new Z_(t)}function qX(t){return new Z_(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tF=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:Pi,browserFiles:zX,browserHTTPRequest:jX,concatenateArrayBuffers:$3,copyModel:YG,decodeWeights:C3,decodeWeightsStream:I3,encodeWeights:rS,fromMemory:HX,fromMemorySync:eF,getLoadHandlers:OG,getModelArtifactsForJSON:N2,getModelArtifactsForJSONSync:T3,getModelArtifactsInfoForJSON:jm,getSaveHandlers:E3,getWeightSpecs:oS,http:xk,isHTTPScheme:hS,listModels:qG,loadWeights:BX,moveModel:QG,registerLoadRouter:PG,registerSaveRouter:FG,removeModel:XG,weightsLoaderFactory:Q_,withSaveHandler:KX,withSaveHandlerSync:qX},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let su,jN=!1;function XX(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,s=!1,r=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)r=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)o=!0;else if(t.getContext!=null)i=!0;else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(hx(cx,K.backendName)!=null){const f={pixels:t},m={numChannels:e};return K.runKernel(cx,f,m)}const[u,c]=r?[t.videoWidth,t.videoHeight]:[t.width,t.height];let d;if(i)d=t.getContext("2d").getImageData(0,0,u,c).data;else if(s||n)d=t.data;else if(o||r||a){if(su==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")su=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else su=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});su.canvas.width=u,su.canvas.height=c,su.drawImage(t,0,0,u,c),d=su.getImageData(0,0,u,c).data}let h;if(e===4)h=new Int32Array(d);else{const f=u*c;h=new Int32Array(f*e);for(let m=0;m<f;m++)for(let g=0;g<e;++g)h[m*e+g]=d[m*4+g]}return T_(h,[c,u,e],"int32")}function YX(t){if(t.rank!==2&&t.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${t.rank}.`);const e=t.rank===2?1:t.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(t.dtype!=="float32"&&t.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${t.dtype}. Please use float32 or int32 tensors.`)}async function wk(t,e){let n=F(t,"img","toPixels");if(!(t instanceof Qt)){const u=n;n=Ee(u,"int32"),u.dispose()}YX(n);const[s,r]=n.shape.slice(0,2),o=n.rank===2?1:n.shape[2],i=await n.data(),a=n.dtype==="float32"?255:1,l=new Uint8ClampedArray(r*s*4);for(let u=0;u<s*r;++u){const c=[0,0,0,255];for(let h=0;h<o;h++){const p=i[u*o+h];if(n.dtype==="float32"){if(p<0||p>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${p}.`)}else if(n.dtype==="int32"&&(p<0||p>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${p}.`);o===1?(c[0]=p*a,c[1]=p*a,c[2]=p*a):c[h]=p*a}const d=u*4;l[d+0]=Math.round(c[0]),l[d+1]=Math.round(c[1]),l[d+2]=Math.round(c[2]),l[d+3]=Math.round(c[3])}if(e!=null){jN||hx(p2,K.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),jN=!0),e.width=r,e.height=s;const u=e.getContext("2d"),c=new ImageData(l,r,s);u.putImageData(c,0,0)}return n!==t&&n.dispose(),l}const nF=G({fromPixels_:XX});function Lw(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(te(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const r=e.shape,o=r[r.length-1];let i=1;for(let d=0;d<r.length-1;++d)i*=r[d];const a=t.shape,l=r.slice();l.pop();let u=1;for(let d=o;d<n;++d)u*=a[d],l.push(a[d]);const c=[...st(t.shape).map(d=>d/u),1].slice(0,o);return[l,i,u,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pS=-2,QX=-1;function zw(t,e,n){const s=t.shape.length;A(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),A(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)A(e[r]+n[r]<=t.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+n[r]}) would overflow input.shape[${r}] (${t.shape[r]})`)}function JX(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function Mw(t,e,n){const s=[];for(let r=0;r<t.length;r++)s[r]=Math.ceil((e[r]-t[r])/n[r]);return s}function sF(t,e,n,s){const r=[...t];for(let o=r.length;o<s.length;o++)r.push(1);for(let o=0;o<n;o++)o===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function rF(t,e,n){return n<=t?n:n-(e-1)}function oF(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function ZX(t,e,n,s,r,o,i,a,l){const u=t.length;let c=new Array(u),d=new Array(u),h=new Array(u);if(e.length&&n>0){const p=e[0],f=n+1;c=iF(i,p,f,s,t),d=aF(a,p,f,r,t),h=sF(o,p,f,t)}else for(let p=0;p<u;p++)c[p]=uF(i,s,o,t,p,l),d[p]=cF(a,r,o,t,p,l),h[p]=lF(o,p,l);return{begin:c,end:d,strides:h}}function iF(t,e,n,s,r){const o=[...r],i=oF(n,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=0;else{const l=rF(e,n,a);let u=s[l];t&1<<l&&(u=0),o[a]=u}return o}function aF(t,e,n,s,r){const o=[...r],i=oF(n,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const l=rF(e,n,a);let u=s[l];t&1<<l&&(u=Number.MAX_SAFE_INTEGER),o[a]=u}for(let a=0;a<o.length;a++){const l=r[a];o[a]<0&&(o[a]+=l),o[a]=Vu(0,o[a],r[a])}return o}function lF(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function uF(t,e,n,s,r,o){let i=e[r];const a=n[r]||1;(t&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const l=s[r];return i<0&&(i+=l),i=Vu(0,i,l-1),i}function cF(t,e,n,s,r,o){let i=e[r];const a=n[r]||1;(t&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const l=s[r];return i<0&&(i+=l),a>0?i=Vu(0,i,l):i=Vu(-1,i,l-1),i}function vk(t,e,n){let s=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){s=r;break}for(let r=s+1;r<n.length;r++)if(e[r]>0||n[r]!==t[r])return!1;return!0}function bk(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function Qm(t,e,n){let s;const r=t.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(i=>{A(i!==-1,()=>"slice() does not support negative begin indexing.")});let o;return n==null?o=new Array(r).fill(-1):typeof n=="number"?o=[n,...new Array(r-1).fill(-1)]:n.length<r?o=n.concat(new Array(r-n.length).fill(-1)):o=n,o=o.map((i,a)=>i>=0?i:(A(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),t.shape[a]-s[a])),[s,o]}function Bw(t,e,n,s,r,o,i,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,i!=null&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const d={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:u.slice(),beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};for(let v=0;v<d.dims;v++)c&&1<<v&a&&d.numAddAxisAfterEllipsis++,1<<v&i&&(c=!0);c||(d.ellipsisMask|=1<<d.dims,d.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};e7(d,h);let p=!0,f=!0,m=!0;const g=[],y=[];for(let v=0;v<t.length;++v){if(h.strides[v]===0)throw Error(`strides[${v}] must be non-zero`);const b=!!(h.shrinkAxisMask&1<<v),S=t[v];if(S===-1){g.push(b?1:-1);continue}const C=[h.beginMask&1<<v,h.endMask&1<<v],I=[h.strides[v]>0?0:-1,h.strides[v]>0?S:S-1];if(b&&h.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&h.strides[v]===1;const T=!!(h.beginMask&1<<v&&h.endMask&1<<v);if(h.beginValid&&h.endValid){if(b){const z=h.begin[v]<0?S+h.begin[v]:h.begin[v];if(h.begin[v]=z,h.end[v]=h.begin[v]+1,z<0||z>=S)throw Error(`slice index ${h.begin[v]} of dimension ${v} out of bounds.`)}else h.begin[v]=GN(h.begin[v],0,h.strides[v],S,C,I),h.end[v]=GN(h.end[v],1,h.strides[v],S,C,I);const P=h.strides[v]===1&&h.begin[v]===0&&h.end[v]===S;p=p&&P,f=f&&(v===0&&h.strides[v]===1||P)}else p=p&&h.strides[v]===1&&T,f=f&&(v===0&&h.strides[v]===1||T);let R,_=!1;if(h.beginValid&&h.endValid?(R=h.end[v]-h.begin[v],_=!0):b?(R=1,_=!0):T&&S>=0&&(h.strides[v]<0?R=-S:R=S,_=!0),_){let P;R===0||R<0!=h.strides[v]<0?P=0:P=Math.trunc(R/h.strides[v])+(R%h.strides[v]!==0?1:0),g.push(P)}else g.push(-1)}for(let v=0;v<h.finalShapeGatherIndices.length;++v){const b=h.finalShapeGatherIndices[v];b>=0?y.push(g[b]):b===pS&&y.push(1)}return{finalShapeSparse:y.filter((v,b)=>h.finalShapeGatherIndices[b]!==pS),finalShape:y,isIdentity:p,sliceDim0:f,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}function e7(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const r=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<r;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push(pS),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(QX),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function GN(t,e,n,s,r,o){if(r[e])return n>0?o[e]:o[e+1&1];{const i=t<0?s+t:t;return i<o[0]?o[0]:i>o[1]?o[1]:i}}const t7=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:zw,computeFlatOffset:bk,computeOutShape:Mw,getNormalizedAxes:ZX,isSliceContinous:vk,maskToAxes:JX,parseSliceParams:Qm,sliceInfo:Bw,startForAxis:uF,startIndicesWithElidedDims:iF,stopForAxis:cF,stopIndicesWithElidedDims:aF,stridesForAxis:lF,stridesWithElidedDims:sF},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n7{static sgd(e){return new gk(e)}static momentum(e,n,s=!1){return new q_(e,n,s)}static rmsprop(e,n=.9,s=0,r=null,o=!1){return new X_(e,n,s,r,o)}static adam(e=.001,n=.9,s=.999,r=null){return new H_(e,n,s,r)}static adadelta(e=.001,n=.95,s=null){return new j_(e,n,s)}static adamax(e=.002,n=.9,s=.999,r=null,o=0){return new K_(e,n,s,r,o)}static adagrad(e,n=.1){return new G_(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rc=n7;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s7=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function dF(){return new Promise(t=>s7(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vw(t,e){const n=t[0].length;t.forEach((r,o)=>{A(r.length===n,()=>`Error in concat${n}D: rank of tensors[${o}] must be the same as the rank of the rest (${n})`)}),A(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((r,o)=>{for(let i=0;i<n;i++)A(i===e||r[i]===s[i],()=>`Error in concat${n}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function Sr(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var gi;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(gi||(gi={}));function hF(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let r=1;r<n.length;++r){const o=n[r],i=s[s.length-n.length+r],a=s[i];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+t}] = ${o} but shape[${r+t}] = ${a}`)}else s[i]=o}return s}function pF(t){const e={FIRST_DIM_SIZE:gi.FIRST_DIM_SIZE,VALUE_ROWIDS:gi.VALUE_ROWIDS,ROW_LENGTHS:gi.ROW_LENGTHS,ROW_SPLITS:gi.ROW_SPLITS,ROW_LIMITS:gi.ROW_LIMITS,ROW_STARTS:gi.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function fF(t){return t.length===0?0:t[0]===gi.FIRST_DIM_SIZE?t.length-1:t.length}function mF(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(n,s-1);++r){const o=t[r],i=e[r+1];if(o>=0&&i>=0&&o!==1&&o!==i)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-t.length}] = ${o} but ragged tensor input.flatValues.shape[${r-t.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sk=30;function Uw(t){return t<=Sk?t:Yb(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ww(t,e,n){const s=n*(typeof t=="number"?t:t[0]),r=e*(typeof t=="number"?t:t[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hc(t,e,n,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(t[0]/n),r=r.concat(t.slice(1));else{r=r.concat(t[0]);const o=e.length;for(let i=0;i<o;++i)r=r.concat([t[i+1]/e[i],e[i]]);r=r.concat(t.slice(o+1))}return r}function pc(t,e,n=!0){const s=[];if(n){s.push(e);for(let r=e+1;r<t;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],o=[];for(let i=1;i<t;++i)i>=e*2+1||i%2===1?o.push(i):r.push(i);s.push(...r),s.push(0),s.push(...o)}return s}function fc(t,e,n,s=!0){const r=[];s?r.push(t[0]/n):r.push(t[0]*n);for(let o=1;o<t.length;++o)o<=e.length?s?r.push(e[o-1]*t[o]):r.push(t[o]/e[o-1]):r.push(t[o]);return r}function jw(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function Gw(t,e,n){const s=t.slice(0,1);for(let r=0;r<n;++r)s.push(t[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jm=1.7580993408473768,Zm=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hw=.3275911,Kw=.254829592,qw=-.284496736,Xw=1.421413741,Yw=-1.453152027,Qw=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ni(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function gF(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function yF(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function xF(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function Ck(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function wF(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function vF(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let r=0;r<Math.ceil(t/2);r++){const o=(e?2:-2)*Math.PI*(r/t);n[r]=Math.cos(o),s[r]=Math.sin(o)}return{real:n,imag:s}}function bF(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),r=Math.cos(s),o=Math.sin(s);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cv="->",r7=/->/g,HN=",",KN="...";function Jw(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(r7,"").length)/Cv.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${Cv}").`);const[s,r]=t.split(Cv);A(s.indexOf(KN)===-1,()=>`The ellipsis notation ("${KN}") is not supported yet.`);const o=s.split(HN),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let h=0;h<r.length;++h){const p=r[h];if(!o.some(f=>f.indexOf(p)!==-1))throw new Error(`Output subscripts contain the label ${p} not present in the input subscripts.`);a.indexOf(p)===-1&&a.push(p)}for(let h=0;h<s.length;++h){const p=s[h];a.indexOf(p)===-1&&p!==HN&&a.push(p)}const l=new Array(o.length);for(let h=0;h<i;++h){if(new Set(o[h].split("")).size!==o[h].length)throw new Error(`Found duplicate axes in input component ${o[h]}. Support for duplicate axes in input is not implemented yet.`);l[h]=[];for(let p=0;p<o[h].length;++p)l[h].push(a.indexOf(o[h][p]))}const u=a.length,c=r.length,d=[];for(let h=c;h<u;++h)d.push(h);return{allDims:a,summedDims:d,idDims:l}}function Zw(t,e){let n=new Array(t);n.fill(-1);for(let r=0;r<e.length;++r)n[e[r]]=r;const s=[];for(let r=0;r<t;++r)n[r]===-1&&s.push(r);return n=n.filter(r=>r!==-1),{permutationIndices:n,expandDims:s}}function e1(t,e,n){const s=new Array(t);for(let r=0;r<n.length;++r){const o=n[r].shape;for(let i=0;i<e[r].length;++i)s[e[r][i]]===void 0?s[e[r][i]]=o[i]:A(s[e[r][i]]===o[i],()=>`Expected dimension ${s[e[r][i]]} at axis ${i} of input shaped ${JSON.stringify(o)}, but got dimension ${o[i]}`)}}function t1(t,e){const n=t,s=[];let r=0;t.length===0&&n.push(-1),r=t.length+1;for(let i=0;i<r;++i)s.push([]);const o=[];for(let i=0;i<n.length;++i){const a=n[i],l=o7(e,a);for(const u of l)o.indexOf(u)===-1&&(s[i].push(u),o.push(u))}return{path:n,steps:s}}function n1(t){return t.every((e,n)=>e===n)}function o7(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function s1(t,e,n=0){let s=[];if(typeof e=="number")A(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const r=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);A(r<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const i=e.reduce((a,l)=>l>0?a+l:a);e[o]=t.shape[n]-i}A(t.shape[n]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SF(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function CF(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function kF(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IF(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function $F(t,e){return`size ${t} must be non-negative, not ${e}`}function NF(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function TF(t,e){const n=te(t),s=te(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function EF(t,e){const n=te(t),s=te(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fS(){return"segment ids must be >= 0"}function RF(){return"segment ids are not increasing"}function DF(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function AF(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _F(t,e){let n=!1,s;for(t<=Sk?(s=t,n=!0):s=Yb(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=Yb(t,s+1);return s}function kk(t,e,n){const s=[],r=t.length;for(let o=0;o<r;o++)o!==e?s.push(t[o]):s.push(n);return s}function r1(t,e,n,s){const r=e.shape.length,o=t.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let d=0;d<s;++d)if(t.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const i=t.shape[n],a=[];let l=1,u=1,c=1;for(let d=0;d<s;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=s;d<n;d++)a.push(t.shape[d]),u*=t.shape[d];for(let d=s;d<r;d++)a.push(e.shape[d]);for(let d=n+1;d<o;d++)a.push(t.shape[d]),c*=t.shape[d];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:i,outputShape:a}}const i7=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:r1,computeOutShape:kk,segOpComputeOptimalWindowSize:_F},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ti(t){try{return t.map(e=>ki(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function FF(t){return t.map(e=>Da(e))}const a7=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:Kw,ERF_A2:qw,ERF_A3:Xw,ERF_A4:Yw,ERF_A5:Qw,ERF_P:Hw,PARALLELIZE_THRESHOLD:Sk,get RowPartitionType(){return gi},SELU_SCALE:Zm,SELU_SCALEALPHA:Jm,applyActivation:_w,assertAndGetBroadcastShape:ct,assertAxesAreInnerMostDims:ss,assertParamsConsistent:Vw,assignToTypedArray:wF,axesAreInnerMostDims:L2,calculateShapes:fa,checkEinsumDimSizes:e1,checkPadOnDimRoundingMode:fr,combineLocations:u_,combineRaggedTensorToTensorShapes:hF,complexWithEvenIndex:yF,complexWithOddIndex:xF,computeConv2DInfo:gn,computeConv3DInfo:Oi,computeDefaultPad:R2,computeDilation2DInfo:Gl,computeOptimalWindowSize:Uw,computeOutAndReduceShapes:qn,computeOutShape:Sr,computePool2DInfo:qs,computePool3DInfo:xo,convertConv2DDataFormat:Zr,decodeEinsumEquation:Jw,eitherStridesOrDilationsAreOne:ms,expandShapeToKeepDim:Wn,exponent:bF,exponents:vF,fromStringArrayToUint8:FF,fromUint8ToStringArray:Ti,getAxesPermutation:an,getBroadcastDims:El,getComplexWithIndex:Ck,getEinsumComputePath:t1,getEinsumPermutation:Zw,getFusedBiasGradient:Aw,getFusedDyActivation:Dw,getImageCenter:Ww,getInnerMostAxes:yn,getPermuted:pc,getRaggedRank:fF,getReductionAxes:fs,getReshaped:hc,getReshapedPermuted:fc,getRowPartitionTypesHelper:pF,getSliceBeginCoords:jw,getSliceSize:Gw,getSparseFillEmptyRowsIndicesDenseShapeMismatch:SF,getSparseFillEmptyRowsNegativeIndexErrorMessage:CF,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:kF,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:NF,getSparseReshapeInputOutputMismatchErrorMessage:EF,getSparseReshapeInputOutputMultipleErrorMessage:TF,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:IF,getSparseReshapeNegativeOutputDimErrorMessage:$F,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:AF,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:fS,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:RF,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:DF,getUndoAxesPermutation:ha,isIdentityPermutation:n1,log:Qj,mergeRealAndImagArrays:Ni,prepareAndValidate:Lw,prepareSplitSize:s1,segment_util:i7,shouldFuse:Fw,slice_util:t7,splitRealAndImagArrays:gF,stridesOrDilationsArePositive:qu,tupleValuesAreOne:Nl,upcastType:$s,validateDefaultValueShape:mF,validateInput:lk,validateUpdateShape:E_,warn:oo},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */DX();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PF={kernelName:Wf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,zh(Ee(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l7={kernelName:Vd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=sn(Ee(n,"float32")),r=zs(Be(ot(1),s));return Sn(Me(t,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u7={kernelName:Ud,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=zs(Be(sn(Ee(n,"float32")),1));return Me(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c7={kernelName:ic,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=ct(n.shape,s.shape);return{a:()=>{let a=t;const l=fs(n.shape,r);return l.length>0&&(a=Qe(a,l)),q(a,n.shape)},b:()=>{let a=t;const l=fs(s.shape,r);return l.length>0&&(a=Qe(a,l)),q(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d7={kernelName:jf,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((s,r)=>{n[r]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h7={kernelName:Gf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ut(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p7={kernelName:Hf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ut(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f7={kernelName:Wd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,zs(Be(ot(1),sn(Ee(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m7={kernelName:jd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=zs(me(ot(1),sn(Ee(n,"float32"))));return Me(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g7={kernelName:Kd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=ct(n.shape,s.shape);return{a:()=>{const a=me(sn(n),sn(s));let l=U(t,Me(s,a));const u=fs(n.shape,r);return u.length>0&&(l=Qe(l,u)),q(l,n.shape)},b:()=>{const a=me(sn(n),sn(s));let l=Sn(U(t,Me(n,a)));const u=fs(s.shape,r);return u.length>0&&(l=Qe(l,u)),q(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y7={kernelName:Gd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,me(sn(Ee(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x7={kernelName:Hd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,Be(ot(1),sn(Ee(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w7(t,e,n,s,r,o){const i=F(t,"dy","avgPool3dGrad"),a=F(e,"input","avgPool3dGrad");let l=i,u=a,c=!1;a.rank===4&&(c=!0,l=q(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),u=q(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),A(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),A(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),fr("avgPool3dGrad",r,o);const d={dy:l,input:u},h={filterSize:n,strides:s,pad:r,dimRoundingMode:o},p=K.runKernel(y0,d,h);return c?q(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const v7=G({avgPool3dGrad_:w7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b7={kernelName:qf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:o,pad:i,dimRoundingMode:a}=n;return{x:()=>v7(t,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S7(t,e,n,s,r){const o=F(t,"dy","avgPoolGrad"),i=F(e,"input","avgPoolGrad");A(i.rank===o.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${o.rank})`);let a=i,l=o,u=!1;i.rank===3&&(u=!0,a=q(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=q(o,[1,o.shape[0],o.shape[1],o.shape[2]])),A(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),A(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const c={dy:l,input:a},d={filterSize:n,strides:s,pad:r},h=K.runKernel(g0,c,d);return u?q(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const C7=G({avgPoolGrad_:S7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k7={kernelName:Kf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:o,pad:i}=n;return{x:()=>C7(t,s,r,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I7={kernelName:Xf,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[s,r]=e,{transposeA:o,transposeB:i}=n;return!o&&!i?{a:()=>At(t,r,!1,!0),b:()=>At(s,t,!0,!1)}:!o&&i?{a:()=>At(t,r,!1,!1),b:()=>At(t,s,!0,!1)}:o&&!i?{a:()=>At(r,t,!1,!0),b:()=>At(s,t,!1,!1)}:{a:()=>At(r,t,!0,!0),b:()=>At(t,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $7={kernelName:Yf,gradFunc:(t,e,n)=>{const{blockShape:s,crops:r}=n;return{x:()=>Cw(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N7={kernelName:Xj,gradFunc:(t,e,n)=>{const s=n,r=s.inputShape,o=s.shape,i=Array.from(o);for(let l=r.length-1;l>=0;l--)if(r[l]===o[l])i[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const a=[];for(let l=0;l<i.length;l++)i[l]>1&&a.push(l);return{x:()=>Qe(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T7={kernelName:qd,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E7={kernelName:Xd,gradFunc:t=>({x:()=>Ut(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R7={kernelName:Yd,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{clipValueMin:r,clipValueMax:o}=n;return{x:()=>Hs(aa(Hl(s,r),uc(s,o)),t,Ut(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D7={kernelName:Qf,inputsToSave:["x"],gradFunc:PF.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A7={kernelName:Jf,saveAllInputs:!0,gradFunc:(t,e,n)=>{const s=e.map(l=>l.shape),{axis:r}=n,o=xt(r,e[0].shape)[0],i=s.map(l=>l[o]);return Hr(t,i,o).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _7={kernelName:Zf,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{dilations:o,strides:i,pad:a,dataFormat:l}=n;return A(Nl(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>A2(s.shape,t,r,i,a,l),filter:()=>pk(s,t,r.shape,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F7={kernelName:em,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{strides:o,pad:i,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>Tl(t,r,o,i,a,1,l),filter:()=>pk(t,s,r.shape,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P7(t,e,n,s,r){let o=t;t.rank===4&&(o=q(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let i=e;i.rank===4&&(i=q(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),A(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),A(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),A(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),A(o.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${n[3]}.`),A(i.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:o,dy:i},l={strides:s,pad:r,filterShape:n};return K.runKernel(C0,a,l)}const O7=G({conv3DBackpropFilter_:P7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L7={kernelName:tm,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:o}=n;A(Nl(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,a]=e;return{x:()=>s_(i.shape,t,a,r,o),filter:()=>O7(i,t,a.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z7={kernelName:Qd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(Sn(sk(Ee(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M7={kernelName:Jd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(rk(Ee(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B7={kernelName:nm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r,exclusive:o,reverse:i}=n;return{x:()=>{const a=an([r],s.rank);let l=P2(t,r,o,!i);return a!=null&&(l=Vt(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V7={kernelName:sm,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:o,dimRoundingMode:i}=n,a=s??[1,1];A(Nl(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return A(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),A(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),A(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),A(ms(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),fr("depthwiseConv2d",o,i),{x:()=>z_(l.shape,t,u,r,o,a,i),filter:()=>L_(l,t,u.shape,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U7={kernelName:rm,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,o={x:s,filter:r,dy:t},i={x:s,filter:r,dy:t};return{x:()=>K.runKernel(lx,o,n),filter:()=>K.runKernel(ux,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W7={kernelName:eh,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,s={dy:t,y:n};return{x:()=>K.runKernel(_0,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j7={kernelName:th,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=U(hr(Sn(sn(n))),2/Math.sqrt(Math.PI));return{x:()=>U(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G7={kernelName:nh,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H7={kernelName:im,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>q(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K7={kernelName:sh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,hr(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q7={kernelName:rh,gradFunc:t=>({x:()=>Ut(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X7={kernelName:oh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=ct(n.shape,s.shape);return{a:()=>{const a=Me(t,Ee(s,"float32")),l=fs(n.shape,r);return l.length>0?q(Qe(a,l),n.shape):a},b:()=>{let a=U(t,Ee(n,"float32"));const l=fs(s.shape,r);l.length>0&&(a=q(Qe(a,l),s.shape));const u=sn(s);return Sn(Me(a,Ee(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y7={kernelName:am,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:s}=n,[r,o,i,a]=e,l=a??ot(1),u=fs(o.shape,r.shape),c=[];if(o.rank===1){for(let b=0;b<r.shape.length-1;++b)c.push(r.shape[b]);c.push(1)}const d=Be(r,o),h=U(t,l),p=ek(me(i,ot(s))),f=U(U(U(p,p),p),ot(-.5));return{x:()=>o.rank===1?q(U(U(t,Bo(q(p,[1,1,1,o.shape[0]]),c)),l),r.shape):q(U(U(t,p),l),r.shape),mean:()=>{let b=U(U(p,ot(-1)),h);return o.rank===1&&(b=Qe(b,u)),q(b,o.shape)},variance:()=>{let b=U(U(f,d),h);return o.rank===1&&(b=Qe(b,u)),q(b,o.shape)},scale:()=>{const b=U(d,p);let S=U(t,b);return o.rank===1&&(S=Qe(S,u)),q(S,o.shape)},offset:()=>{let b=t;return o.rank===1&&(b=Qe(b,u)),q(b,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q7={kernelName:lm,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[s,r]=e,{axis:o,batchDims:i}=n,a=xt(o,s.shape)[0],l=(u,c,d)=>()=>{const h=u.shape,p=c.size,f=h.slice(0,a),m=f.length,g=h.slice(o,h.length).slice(1),y=g.length,x=qN(0,m),v=qN(m+1,m+1+y),b=XN([f,[p],g]),S=q(d,b),C=q(c,[p]),I=XN([[m],x,v]),T=Vt(S,I);let R=ck(T,C,u.shape[a]);const _=ha(I);return R=Vt(R,_),R};if(i===1){const u=s.shape[0],c=s.split(u,0);return{x:()=>qr(c.map((p,f)=>l(p,r.slice(f,1),t.slice(f,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,t),indices:()=>r}}};function qN(t,e){const n=[];for(let s=t;s<e;++s)n.push(s);return n}function XN(t){const e=[];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)e.push(t[n][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J7={kernelName:ih,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>Ut(n),b:()=>Ut(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z7={kernelName:ah,gradFunc:t=>({x:()=>Ee(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e9={kernelName:lh,gradFunc:t=>({x:()=>Ut(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t9={kernelName:uh,gradFunc:t=>({x:()=>Ut(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n9={kernelName:ch,gradFunc:t=>({x:()=>Ut(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s9={kernelName:cm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{alpha:r}=n,o=eo(s,0);return{x:()=>Hs(o,t,U(t,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r9={kernelName:hh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,me(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o9={kernelName:dh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,Ee(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i9={kernelName:Yj,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;return{logits:()=>{const i=hr(s);return Be(t,U(Qe(t,r,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a9(t,e,n,s=5,r=1,o=1,i=.5){const a={x:t,y:e,dy:n},l={depthRadius:s,bias:r,alpha:o,beta:i};return K.runKernel(V0,a,l)}const l9=G({localResponseNormalizationBackprop_:a9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u9={kernelName:gm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{depthRadius:o,bias:i,alpha:a,beta:l}=n;return{x:()=>l9(s,r,t,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OF(t,e,n,s){return e.rank<n.rank&&(e=q(e,Wn(e.shape,s))),t.rank<n.rank&&(t=q(t,Wn(t.shape,s))),{x:()=>U(t,Ee(Ii(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YN={kernelName:ym,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{reductionIndices:r}=s,o=e[0],i=e[1],a=xt(r,o.shape),l=OF(t,i,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c9={kernelName:ph,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>U(t,Ee(Hl(n,s),"float32")),b:()=>U(t,Ee(vf(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d9(t,e,n,s,r,o,i){const a=F(t,"dy","maxPool3dGrad"),l=F(e,"input","maxPool3dGrad"),u=F(n,"output","maxPool3dGrad");let c=a,d=l,h=u,p=!1;l.rank===4&&(p=!0,c=q(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=q(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=q(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),A(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),A(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),A(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),fr("maxPool3dGrad",o,i);const f={dy:c,input:d,output:h},m={filterSize:s,strides:r,pad:o,dimRoundingMode:i},g=K.runKernel(W0,f,m);return p?q(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const h9=G({maxPool3dGrad_:d9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p9={kernelName:wm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=n;return{x:()=>h9(t,s,r,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f9(t,e,n,s,r,o,i){const a=F(t,"dy","maxPoolGrad"),l=F(e,"input","maxPoolGrad"),u=F(n,"output","maxPoolGrad");A(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),A(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),A(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),fr("maxPoolGrad",o,i);const c={dy:a,input:l,output:u},d={filterSize:s,strides:r,pad:o,dimRoundingMode:i};return K.runKernel(U0,c,d)}const m9=G({maxPoolGrad_:f9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g9={kernelName:xm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a}=n;return{x:()=>m9(t,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y9={kernelName:vm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n,o=xt(r,s.shape),a=qn(s.shape,o)[1],l=te(a);return{x:()=>{const c=s.shape.slice();o.forEach(p=>{c[p]=1});const d=q(t,c);return Me(U(d,Ur(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x9={kernelName:bm,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{axis:r}=s,[o,i]=e,a=xt(r,o.shape),l=OF(t,i,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w9={kernelName:fh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>U(t,Ee(uc(n,s),"float32")),b:()=>U(t,Ee(eo(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v9={kernelName:Sm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,o=r.map(i=>i[0]);return{x:()=>pt(t,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b9={kernelName:mh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=ct(n.shape,s.shape);return{a:()=>{const a=fs(n.shape,r);return a.length>0?q(Qe(t,a),n.shape):t},b:()=>{const a=U(t,Sn(Xm(Me(n,s)))),l=fs(s.shape,r);return l.length>0?q(Qe(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S9={kernelName:gh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=ct(n.shape,s.shape);return{a:()=>{const a=U(t,Ee(s,"float32")),l=fs(n.shape,r);return l.length>0?q(Qe(a,l),n.shape):a},b:()=>{const a=U(t,Ee(n,"float32")),l=fs(s.shape,r);return l.length>0?q(Qe(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C9={kernelName:Cm,gradFunc:t=>({x:()=>Sn(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k9={kernelName:$m,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>Gn(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I9={kernelName:Im,gradFunc:t=>({x:()=>Ut(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $9={kernelName:Nm,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:s}=n;return Qo(t,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QN={kernelName:Tm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,o=r.map(i=>i[0]);return{x:()=>pt(t,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N9={kernelName:yh,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,s,r]=e,o=n,i=s,a=ct(o.shape,i.shape);return{a:()=>{const c=Ee(i,"float32");let d=U(t,U(c,Ba(o,Be(c,ot(1)))));const h=fs(o.shape,a);return h.length>0&&(d=Qe(d,h)),q(d,o.shape)},b:()=>{const c=eo(o,0),d=Hs(c,po(o),Ut(o));let h=U(t,U(r,d));const p=fs(i.shape,a);return p.length>0&&(h=Qe(h,p)),q(h,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T9={kernelName:Em,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,s]=e,r=eo(n,0);return{x:()=>Hs(r,t,U(t,s)),alpha:()=>{let o=Hs(r,Ut(t),U(t,n));const i=fs(s.shape,t.shape);return i.length>0&&(o=Qe(o,i)),q(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E9(t,e,n){const s=t.shape.slice();s[n]=1;const r=q(e,s),o=yx(t,n,!0,!1),i=yx(t,n,!0,!0),a=U(o,i);return U(r,a)}function R9(t,e,n){const s=t.shape.length,r=s-n.length,o=an(n,s);let i=t;o!=null&&(i=Vt(t,o));const a=i.shape.slice(),u=a.splice(s-n.length,n.length).reduce((h,p)=>h*p,1);a.push(u);const c=i.reshape(a);let d=E9(c,e,r);if(d=d.reshape(i.shape),o!=null){const h=ha(o);d=Vt(d,h)}return d}const D9={kernelName:Rm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;let o=[];return r==null?o=s.shape.map((i,a)=>a):typeof r=="number"?o=[r]:o=r,{x:()=>R9(s,t,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A9={kernelName:Zd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=ct(n.shape,s.shape);return{a:()=>{const a=Me(t,Ee(s,"float32")),l=fs(n.shape,r);return l.length>0?q(Qe(a,l),n.shape):a},b:()=>{let a=U(t,Ee(n,"float32"));const l=fs(s.shape,r);l.length>0&&(a=q(Qe(a,l),s.shape));const u=sn(s);return Sn(Me(a,Ee(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _9={kernelName:xh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,Sn(sn(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F9={kernelName:vh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=U(uc(n,6),zh(n));return{x:()=>U(t,Ee(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P9={kernelName:wh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,Ee(zh(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O9={kernelName:Dm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>q(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L9={kernelName:_m,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>K.runKernel(Q0,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z9={kernelName:Am,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>K.runKernel(Y0,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M9={kernelName:Fm,gradFunc:(t,e,n)=>{const{dims:s}=n,r=xt(s,t.shape);return{x:()=>Yo(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B9={kernelName:bh,gradFunc:t=>({x:()=>Ut(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V9={kernelName:Sh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Sn(Me(t,U(Ba(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U9={kernelName:Pm,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>Ee(Ut(n),"float32"),t:()=>U(t,Ee(n,t.dtype)),e:()=>U(t,Ee(vw(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W9={kernelName:Ch,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=eo(n,ot(0)),r=ot(Jm),o=ot(Zm),i=U(t,o),a=U(U(t,r),hr(Ee(n,"float32")));return Hs(s,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j9={kernelName:Nh,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,U(n,Be(ot(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G9={kernelName:$h,gradFunc:t=>({x:()=>Ut(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H9={kernelName:kh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(mw(Ee(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K9={kernelName:Ih,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(F2(Ee(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q9={kernelName:Om,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{begin:r,size:o}=n,i=s.shape,[a,l]=Qm(s,r,o),u=[];for(let c=0;c<t.rank;c++)u.push([a[c],i[c]-a[c]-l[c]]);return{x:()=>$i(t,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X9={kernelName:Bm,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{dim:r}=n,o=!0,i=U(t,s);return{logits:()=>Be(i,U(Qe(i,[r],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y9={kernelName:Th,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,uo(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JN={kernelName:zm,gradFunc:(t,e,n)=>{const{blockShape:s,paddings:r}=n;return{x:()=>fw(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZN={kernelName:Mm,gradFunc:(t,e,n)=>{const{axis:s}=n;return{x:()=>Pn(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q9={kernelName:Eh,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,U(zs(Ee(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J9={kernelName:rw,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(t,U(Ee(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z9={kernelName:Rh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=ot(2);return{a:()=>U(t,U(r,Be(n,s))),b:()=>U(t,U(r,Be(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eY={kernelName:Ph,gradFunc:t=>({x:()=>Ut(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tY={kernelName:Dh,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=ct(n.shape,s.shape);return{a:()=>{let a=t;const l=fs(n.shape,r);return l.length>0&&(a=Qe(a,l)),q(a,n.shape)},b:()=>{let a=t;const l=fs(s.shape,r);return l.length>0&&(a=Qe(a,l)),q(Sn(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nY={kernelName:Lm,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,r=s.shape.slice(),{axis:o}=n;xt(o,s.shape).forEach(u=>{r[u]=1});const a=q(t,r),l=U(a,Ur(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sY={kernelName:Ah,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,sn(mw(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rY={kernelName:_h,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>U(Be(ot(1),sn(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oY={kernelName:Fh,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{reps:r}=n;return{x:()=>{let i=Ut(s);if(s.rank===1)for(let a=0;a<r[0];++a)i=me(i,pt(t,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)i=me(i,pt(t,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)i=me(i,pt(t,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let c=0;c<r[3];++c)i=me(i,pt(t,[a*s.shape[0],l*s.shape[1],u*s.shape[2],c*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iY={kernelName:Eu,gradFunc:(t,e,n)=>{const s=n,{perm:r}=s,o=ha(r);return{x:()=>Vt(t,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aY={kernelName:Vm,gradFunc:(t,e,n)=>{const s=n,{axis:r}=s;return{value:()=>qr(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lY={kernelName:Um,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>uY(t,n)}}};function uY(t,e){const n=ja(e,Ut(e)),s=Ym(t,n);let r=Hl(e,ot(0,"int32"));const o=s.rank-r.rank;for(let a=0;a<o;++a)r=Zn(r,a+1);r=aa(r,Ur(s.shape,"bool"));const i=Ut(s);return Hs(r,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cY={kernelName:Wm,gradFunc:t=>({x:()=>Ut(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dY=[PF,l7,u7,c7,d7,h7,p7,f7,m7,g7,y7,x7,b7,k7,I7,$7,N7,T7,E7,R7,D7,A7,F7,_7,L7,z7,M7,B7,V7,U7,A9,W7,j7,G7,H7,K7,X7,q7,Y7,Q7,J7,Z7,e9,t9,n9,s9,r9,o9,i9,u9,YN,YN,c9,p9,g9,y9,x9,w9,v9,b9,S9,C9,k9,I9,$9,QN,QN,N9,T9,D9,_9,F9,P9,O9,L9,z9,M9,B9,V9,U9,W9,j9,G9,H9,K9,q9,X9,Y9,JN,JN,ZN,ZN,Q9,Z9,J9,eY,tY,nY,sY,rY,oY,iY,aY,lY,cY];for(const t of dY)Jj(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.abs=function(){return this.throwIfDisposed(),is(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.acos=function(){return this.throwIfDisposed(),z3(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.acosh=function(){return this.throwIfDisposed(),M3(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.add=function(t){return this.throwIfDisposed(),me(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.all=function(t,e){return this.throwIfDisposed(),E2(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.any=function(t,e){return this.throwIfDisposed(),gx(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.argMax=function(t){return this.throwIfDisposed(),Ku(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.argMin=function(t){return this.throwIfDisposed(),B3(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.asScalar=function(){return this.throwIfDisposed(),A(this.size===1,()=>"The array must have only 1 element."),q(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.asType=function(t){return this.throwIfDisposed(),Ee(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.as1D=function(){return this.throwIfDisposed(),q(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.as2D=function(t,e){return this.throwIfDisposed(),q(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),q(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.as4D=function(t,e,n,s){return this.throwIfDisposed(),q(this,[t,e,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.as5D=function(t,e,n,s,r){return this.throwIfDisposed(),q(this,[t,e,n,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.asin=function(){return this.throwIfDisposed(),V3(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.asinh=function(){return this.throwIfDisposed(),U3(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.atan=function(){return this.throwIfDisposed(),W3(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.atan2=function(t){return this.throwIfDisposed(),j3(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.atanh=function(){return this.throwIfDisposed(),G3(this)};he().prototype.avgPool=function(t,e,n,s){return this.throwIfDisposed(),pw(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),fw(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.batchNorm=function(t,e,n,s,r){return this.throwIfDisposed(),Gm(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.broadcastTo=function(t){return this.throwIfDisposed(),ld(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.cast=function(t){return this.throwIfDisposed(),Ee(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.ceil=function(){return this.throwIfDisposed(),Q3(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Ir(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof Qt&&(t=[t]),Pn([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.conv1d=function(t,e,n,s,r,o){return this.throwIfDisposed(),D2(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.conv2dTranspose=function(t,e,n,s,r){return this.throwIfDisposed(),_2(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.conv2d=function(t,e,n,s,r,o){return this.throwIfDisposed(),Tl(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.cos=function(){return this.throwIfDisposed(),mw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.cosh=function(){return this.throwIfDisposed(),F2(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),yx(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),P2(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),o_(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.depthwiseConv2d=function(t,e,n,s,r,o){return this.throwIfDisposed(),Hm(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.dilation2d=function(t,e,n,s,r){return this.throwIfDisposed(),i_(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.divNoNan=function(t){return this.throwIfDisposed(),a_(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.div=function(t){return this.throwIfDisposed(),Me(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.dot=function(t){return this.throwIfDisposed(),l_(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.elu=function(){return this.throwIfDisposed(),Km(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.equal=function(t){return this.throwIfDisposed(),Ii(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.erf=function(){return this.throwIfDisposed(),O2(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),d_(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.exp=function(){return this.throwIfDisposed(),hr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.expandDims=function(t){return this.throwIfDisposed(),Zn(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.expm1=function(){return this.throwIfDisposed(),h_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.fft=function(){return this.throwIfDisposed(),Ew(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.flatten=function(){return this.throwIfDisposed(),q(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.floor=function(){return this.throwIfDisposed(),Xm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.floorDiv=function(t){return this.throwIfDisposed(),T2(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.gather=function(t,e,n){return this.throwIfDisposed(),Ym(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Hl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.greater=function(t){return this.throwIfDisposed(),eo(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.ifft=function(){return this.throwIfDisposed(),Cf(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.irfft=function(){return this.throwIfDisposed(),ik(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.isFinite=function(){return this.throwIfDisposed(),p_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.isInf=function(){return this.throwIfDisposed(),f_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.isNaN=function(){return this.throwIfDisposed(),m_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.leakyRelu=function(t){return this.throwIfDisposed(),yw(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.lessEqual=function(t){return this.throwIfDisposed(),uc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.less=function(t){return this.throwIfDisposed(),vf(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.localResponseNormalization=function(t,e,n,s){return this.throwIfDisposed(),g_(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logSigmoid=function(){return this.throwIfDisposed(),y_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logSoftmax=function(t){return this.throwIfDisposed(),M2(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),ww(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.log=function(){return this.throwIfDisposed(),po(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.log1p=function(){return this.throwIfDisposed(),xw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logicalAnd=function(t){return this.throwIfDisposed(),aa(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logicalNot=function(){return this.throwIfDisposed(),vw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logicalOr=function(t){return this.throwIfDisposed(),B2(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logicalXor=function(t){return this.throwIfDisposed(),x_(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),At(this,t,e,n)};he().prototype.maxPool=function(t,e,n,s){return this.throwIfDisposed(),bw(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.max=function(t,e){return this.throwIfDisposed(),Go(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.maximum=function(t){return this.throwIfDisposed(),ja(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.mean=function(t,e){return this.throwIfDisposed(),zn(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.min=function(t,e){return this.throwIfDisposed(),wf(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.minimum=function(t){return this.throwIfDisposed(),Rl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),U2(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.mod=function(t){return this.throwIfDisposed(),v_(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.mul=function(t){return this.throwIfDisposed(),U(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.neg=function(){return this.throwIfDisposed(),Sn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.norm=function(t,e,n){return this.throwIfDisposed(),qm(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.notEqual=function(t){return this.throwIfDisposed(),Sd(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),W2(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.onesLike=function(){return this.throwIfDisposed(),fo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.pad=function(t,e){return this.throwIfDisposed(),$i(this,t,e)};he().prototype.pool=function(t,e,n,s,r,o){return this.throwIfDisposed(),b_(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.pow=function(t){return this.throwIfDisposed(),Ba(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.prelu=function(t){return this.throwIfDisposed(),kw(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.prod=function(t,e){return this.throwIfDisposed(),S_(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.reciprocal=function(){return this.throwIfDisposed(),k_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.relu=function(){return this.throwIfDisposed(),pa(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.relu6=function(){return this.throwIfDisposed(),J2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.reshapeAs=function(t){return this.throwIfDisposed(),q(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.reshape=function(t){return this.throwIfDisposed(),q(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),V_(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),U_(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.reverse=function(t){return this.throwIfDisposed(),Yo(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.rfft=function(){return this.throwIfDisposed(),Rw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.round=function(){return this.throwIfDisposed(),Z2(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.rsqrt=function(){return this.throwIfDisposed(),ek(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.selu=function(){return this.throwIfDisposed(),tk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.separableConv2d=function(t,e,n,s,r,o){return this.throwIfDisposed(),nk(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sigmoid=function(){return this.throwIfDisposed(),uo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sign=function(){return this.throwIfDisposed(),I_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sin=function(){return this.throwIfDisposed(),sk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sinh=function(){return this.throwIfDisposed(),rk(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.slice=function(t,e){return this.throwIfDisposed(),pt(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.softmax=function(t){return this.throwIfDisposed(),Tw(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.softplus=function(){return this.throwIfDisposed(),Lh(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Cw(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.split=function(t,e){return this.throwIfDisposed(),Hr(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sqrt=function(){return this.throwIfDisposed(),zs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.square=function(){return this.throwIfDisposed(),sn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.squaredDifference=function(t){return this.throwIfDisposed(),ak(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.squeeze=function(t){return this.throwIfDisposed(),Ht(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof Qt?[this,t]:[this,...t];return qr(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.step=function(t){return this.throwIfDisposed(),zh(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.stridedSlice=function(t,e,n,s,r,o,i,a){return this.throwIfDisposed(),$_(this,t,e,n,s,r,o,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sub=function(t){return this.throwIfDisposed(),Be(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sum=function(t,e){return this.throwIfDisposed(),Qe(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.tan=function(){return this.throwIfDisposed(),N_(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.tanh=function(){return this.throwIfDisposed(),Xu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.tile=function(t){return this.throwIfDisposed(),Bo(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.toBool=function(){return this.throwIfDisposed(),Ee(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.toFloat=function(){return this.throwIfDisposed(),Ee(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.toInt=function(){return this.throwIfDisposed(),Ee(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.topk=function(t,e){return this.throwIfDisposed(),R_(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.transpose=function(t){return this.throwIfDisposed(),Vt(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.unique=function(t){return this.throwIfDisposed(),D_(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),ck(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.unstack=function(t){return this.throwIfDisposed(),Qo(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.where=function(t,e){return this.throwIfDisposed(),Hs(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.zerosLike=function(){return this.throwIfDisposed(),Ut(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class qi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,qi.prototype)}}class Vo extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Vo.prototype)}}class J extends Error{constructor(e){super(e),Object.setPrototypeOf(this,J.prototype)}}class $t extends Error{constructor(e){super(e),Object.setPrototypeOf(this,$t.prototype)}}class Ik extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ik.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class LF{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qu(t,e){if(Array.isArray(t)){let n=[];for(let s=0;s<e;s++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function Xi(t,e){if(!t)throw new Ik(e)}function eT(t,e){let n=0;for(const s of t)s===e&&n++;return n}function wr(t){return t.length===1?t[0]:t}function en(t){return Array.isArray(t)?t:[t]}function Ca(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function pu(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let To={};function $k(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function mS(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>mS(e));else{const e=Object.keys(t);for(const n of e){const s=t[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?t[n]=s.value:mS(s))}}}function eg(t,e={},n={},s="object",r=!1){if(typeof t=="string"){const o=t;let i;if(o in n)i=n[o];else if(o in To)i=To[o];else if(i=e[o],i==null)throw new J(`Unknown ${s}: ${t}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const o=t;if(o.className==null||o.config==null)throw new J(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const i=o.className;let a,l;if(i in n?[a,l]=n[i]:i in To?[a,l]=To.className:i in e&&([a,l]=e[i]),a==null)throw new J(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const p of Object.keys(To))u[p]=To[p];for(const p of Object.keys(n))u[p]=n[p];const c=o.config;c.customObjects=u;const d=Object.assign({},To);for(const p of Object.keys(n))To[p]=n[p];mS(o.config);const h=l(a,o.config,n,r);return To=Object.assign({},d),h}else{const u=Object.assign({},To);for(const d of Object.keys(n))To[d]=n[d];const c=new a(o.config);return To=Object.assign({},u),c}}}function hY(t,e){return t<e?-1:t>e?1:0}function Kg(t,e){return-1*hY(t,e)}function bl(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function pY(t){if(t==null)throw new J(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function mc(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new J(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function Nk(t,e,n=0,s=1/0){return Xi(n>=0),Xi(s>=n),Array.isArray(t)&&t.length>=n&&t.length<=s&&t.every(r=>typeof r===e)}function Is(t,e){Array.isArray(t)?(A(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,s)=>Is(n,`element ${s+1} of ${e}`))):A(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${zF(t)}.`)}function zF(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>zF(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function fY(t,e,n){let s=n!=null?n():xr(),r;return(...i)=>{const a=n!=null?n():xr();return a-s<e||(s=a,r=t(...i)),r}}function MF(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let mY=0;function BF(){return mY++}const qg={};function o1(t=""){return t in qg||(qg[t]=0),qg[t]+=1,t+qg[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const gY=["channelsFirst","channelsLast"],yY=["nearest","bilinear"],xY=["valid","same","causal"],wY=["max","avg"],vY=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Dc=new Map;function Xn(t){mc(gY,"DataFormat",t)}function bY(t){mc(yY,"InterpolationFormat",t)}function wo(t){mc(xY,"PaddingMode",t)}function VF(t){mc(wY,"PoolMode",t)}const Gp=[],tT="/";function Ru(t,e){Gp.push(t);try{const n=e();return Gp.pop(),n}catch(n){throw Gp.pop(),n}}function SY(){return Gp.length===0?"":Gp.join(tT)+tT}function UF(t){if(!jF(t))throw new Error("Not a valid tensor name: '"+t+"'");return SY()+t}function WF(t){if(!jF(t))throw new Error("Not a valid tensor name: '"+t+"'");Dc.has(t)||Dc.set(t,0);const e=Dc.get(t);if(Dc.set(t,Dc.get(t)+1),e>0){const n=`${t}_${e}`;return Dc.set(n,1),n}else return t}const CY=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function jF(t){return!!t.match(CY)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kY(t){return t===parseInt(t.toString(),10)}function Sl(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let s=1;for(let r=e;r<n;++r)s*=t[r];return s}function kd(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s<e&&(e=s)}return e}function Dl(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s>e&&(e=s)}return e}function Ei(t,e){if(e<t)throw new J(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let s=t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let kv;function ls(){return kv==null&&(kv=ju().epsilon()),kv}function Ri(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ra(t,e){return Ee(t,e)}function tg(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),q(t,n)}function IY(t,e){return ne(()=>{if(t.shape.length!==2)throw new J(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=tg(t,1);return gS(n,[1,e,1])})}function $Y(t){const e=[Sl(t.shape)];return q(t,e)}function NY(t){if(t.rank<=1)throw new J(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],Sl(t.shape,1)];return q(t,e)}function Du(t,e,n){return ne(()=>{switch(t.rank){case 1:return $w(t,e,n);case 2:return ok(t,[e,0],[n,t.shape[1]]);case 3:return Nw(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return Sf(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return pt(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return pt(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new J(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Iv(t,e,n){return ne(()=>{switch(t.rank){case 1:return $w(t,e,n);case 2:return ok(t,[0,e],[t.shape[0],n]);case 3:return Nw(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return Sf(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new J(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Xg(t,e,n,s){return ne(()=>{switch(t.rank){case 1:return $w(t,e,n);case 2:switch(s){case 1:return Du(t,e,n);case 2:return Iv(t,e,n);default:throw new J(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Du(t,e,n);case 2:return Nw(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return Iv(t,e,n);default:throw new J(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Du(t,e,n);case 2:return Sf(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return Sf(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return Iv(t,e,n);default:throw new J(`The axis is not within the rank of the tensor ${s}`)}default:throw new J(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Tk(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),Pn(t,e)}function nT(t,e){switch(t.rank){case 1:return J3([t,e]);case 2:return Z3([t,e],0);case 3:return e_([t,e],0);case 4:return t_([t,e],0);default:throw new J(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function gS(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new J(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return Bo(t,e)}function i1(t,e=0,n=1,s,r){return Q2(t,e,n,s,r)}function oa(t,e,n,s){if(t.rank<2||e.rank<2)throw new $t(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=t.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(r!==o)throw new $t(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return dS({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?yS(t.rank,s,Ri()):null,activation:n});{const r=t.shape.slice(),o=r.pop();t=q(t,[-1,o]);const i=e.shape.slice(),a=i.pop(),l=i.pop(),u=[...i,a],c=Array.from({length:e.rank},(f,m)=>m===0?e.rank-2:m<=e.rank-2?m-1:m);e=q(Vt(e,c),[l,-1]);const d=[...r,...u];return q(dS({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?yS(t.rank,s,Ri()):null,activation:n}),d)}}function GF(t,e,n){return ne(()=>(Array.isArray(e)?e=es(e,"int32"):e=Ee(e,"int32"),Ym(t,e,n)))}function ng(t){return U(t,t)}function yS(t,e,n){const s=e.shape;if(e.rank!==1&&e.rank!==t)throw new J(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return s.length===1?q(e,[1,s[0],1,1,1]):q(e,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?q(e,[1,1,1,1,s[0]]):q(e,[1].concat(s))}else if(t===4){if(n==="channelsFirst")return s.length===1?q(e,[1,s[0],1,1]):q(e,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?q(e,[1,1,1,s[0]]):q(e,[1].concat(s))}else if(t===3){if(n==="channelsFirst")return s.length===1?q(e,[1,s[0],1]):q(e,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?q(e,[1,1,s[0]]):q(e,[1].concat(s))}else if(t<3)return e;throw new J(`Unsupported input rank by biasAdd: ${e.rank}`)}function Li(t,e,n){return ne(()=>(n==null&&(n=Ri()),Xn(n),me(t,yS(t.rank,e,n))))}function TY(t,e=1){if(e!==1)throw new $t(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Km(t)}function EY(t){return ne(()=>Me(t,me(is(t),1)))}function HF(t,e,n,s){return ne(()=>F_(t,e,n,s))}function RY(t){return ne(()=>{const e=me(.5,U(.2,t));return Ir(e,0,1)})}function sg(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const DY=["fanIn","fanOut","fanAvg"],AY=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _Y(t){mc(DY,"FanMode",t)}function FY(t){mc(AY,"Distribution",t)}class Jo extends Bh{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class KF extends Jo{apply(e,n){return Gn(e,n)}}KF.className="Zeros";Se(KF);class Ek extends Jo{apply(e,n){return Ur(e,n)}}Ek.className="Ones";Se(Ek);class qF extends Jo{constructor(e){if(super(),typeof e!="object")throw new J(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new J(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return ne(()=>U(ot(this.value),Ur(e,n)))}getConfig(){return{value:this.value}}}qF.className="Constant";Se(qF);class XF extends Jo{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return dc(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}XF.className="RandomUniform";Se(XF);class YF extends Jo{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new $t(`randomNormal does not support dType ${n}.`);return i1(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}YF.className="RandomNormal";Se(YF);class QF extends Jo{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new $t(`truncatedNormal does not support dType ${n}.`);return uk(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}QF.className="TruncatedNormal";Se(QF);class JF extends Jo{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return ne(()=>{if(e.length!==2||e[0]!==e[1])throw new J("Identity matrix initializer can only be used for 2D square matrices.");return U(this.gain,z2(e[0]))})}getConfig(){return{gain:this.gain}}}JF.className="Identity";Se(JF);function PY(t,e="channelsLast"){let n,s;if(Xn(e),t.length===2)n=t[0],s=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const r=Sl(t,2);n=t[1]*r,s=t[0]*r}else if(e==="channelsLast"){const r=Sl(t,0,t.length-2);n=t[t.length-2]*r,s=t[t.length-1]*r}}else{const r=Sl(t);n=Math.sqrt(r),s=Math.sqrt(r)}return[n,s]}class Xr extends Jo{constructor(e){if(super(),e.scale<0)throw new J(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,_Y(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,FY(this.distribution),this.seed=e.seed}apply(e,n){const s=PY(e),r=s[0],o=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,r):this.mode==="fanOut"?i/=Math.max(1,o):i/=Math.max(1,(r+o)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new $t(`${this.getClassName()} does not support dType ${n}.`);return uk(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*i);return dc(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Xr.className="VarianceScaling";Se(Xr);class Rk extends Xr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Xr.className}}Rk.className="GlorotUniform";Se(Rk);class Dk extends Xr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Xr.className}}Dk.className="GlorotNormal";Se(Dk);class Ak extends Xr{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Xr.className}}Ak.className="HeNormal";Se(Ak);class _k extends Xr{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Xr.className}}_k.className="HeUniform";Se(_k);class Fk extends Xr{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Xr.className}}Fk.className="LeCunNormal";Se(Fk);class Pk extends Xr{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Xr.className}}Pk.className="LeCunUniform";Se(Pk);class ZF extends Jo{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return ne(()=>{if(e.length<2)throw new $t("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const s=te(e.slice(0,-1)),r=e[e.length-1],o=s*r;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const i=[Math.max(r,s),Math.min(r,s)],a=i1(i,0,1,n,this.seed),l=W_.qr(a,!1);let u=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=U(u,d.sign()),s<r&&(u=u.transpose()),U(ot(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}ZF.className="Orthogonal";Se(ZF);const sT={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function rT(t,e={}){return eg(t,Po.getMap().classNameMap,e,"initializer")}function Fn(t){return $k(t)}function Tn(t){if(typeof t=="string"){const e=t in sT?sT[t]:t;if(e==="GlorotNormal")return new Dk;if(e==="GlorotUniform")return new Rk;if(e==="HeNormal")return new Ak;if(e==="HeUniform")return new _k;if(e==="LeCunNormal")return new Fk;if(e==="LeCunUniform")return new Pk;{const n={};return n.className=e,n.config={},rT(n)}}else return t instanceof Jo?t:rT(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function xS(t){return Array.isArray(t)&&Array.isArray(t[0])}function xx(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function ft(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new J(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function Gt(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new J(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wx(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const oT="Variable";class OY{constructor(e,n="float32",s=oT,r=!0,o=null){this.dtype=n??"float32",this.shape=e.shape,this.id=BF(),s=s??oT,this.originalName=UF(s),this.name=WF(this.originalName),this.trainable_=r,this.constraint=o,this.val=A_(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),LY(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function LY(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function wS(t){return t.map(e=>e.read())}function Ok(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class us{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class la{constructor(e,n,s,r,o,i,a){this.dtype=e,this.shape=n,this.sourceLayer=s,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=BF(),i!=null&&(this.originalName=UF(i),this.name=WF(this.originalName)),this.rank=n.length}}let zY=0;class a1{constructor(e,n){this.callArgs=n,this.id=zY++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let MY=0;class Rt extends Bh{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=MY++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const s=this.getClassName();n=Ca(s)+"_"+o1(s)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),s=[o].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new Vo(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new J(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return wr(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return wr(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new qi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new qi(`Layer ${this.name} is not connected, no input to return.`);return wr(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new qi(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new qi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return wr(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=en(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=en(this.inputSpec);if(n.length!==s.length)throw new J(`Layer ${this.name} expects ${s.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let r=0;r<n.length;r++){const o=n[r],i=s[r];if(i==null)continue;const a=o.rank;if(i.ndim!=null&&a!==i.ndim)throw new J(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new J(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new J(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new J(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){const l=o.shape;for(const u in i.axes){const c=Number(u),d=i.axes[u],h=c>=0?l[c]:l[l.length+c];if(d!=null&&[d,null].indexOf(h)===-1)throw new J(`Input ${r} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${d} but got shape ${l}.`)}}if(i.shape!=null)for(let l=0;l<i.shape.length;++l){const u=i.shape[l],c=o.shape[l];if(u!=null&&c!=null&&u!==c)throw new J(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const s=en(e),r=UY(e),o=WY(e);if(r===o)throw new J("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ru(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const a of en(e))i.push(a.shape);this.build(wr(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let i=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,i);const a=en(i),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(i=wr(l),this.activityRegularizer!=null)throw new $t("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=BY(e),a=this.computeOutputShape(i);let l;const u=VY(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((c,d)=>new la(u,c,this,en(e),n,this.name,d)):l=new la(u,a,this,en(e),n,this.name),this.addInboundNode(e,l,null,null,i,a,n),this._refCount++,this.activityRegularizer!=null)throw new $t("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new qi(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new qi(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Vo(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return wx(this.weights)}build(e){this.built=!0}getWeights(e=!1){return wS(e?this.trainableWeights:this.weights)}setWeights(e){ne(()=>{const n=this.weights;if(n.length!==e.length)throw new J(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const s=[],r=wS(n);for(let o=0;o<r.length;++o){const i=r[o],a=n[o],l=e[o];if(!Ct(i.shape,l.shape))throw new J(`Layer weight shape ${i.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}Ok(s)})}addWeight(e,n,s,r,o,i,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new J(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():Tn("zeros"));const u=r.apply(n,s),c=new OY(u,s,e,i,a);return u.dispose(),o!=null&&this.addLoss(()=>o.apply(c.read())),i==null&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=en(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),o=en(n),i=en(r);if(o.length!==i.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let a=0;a<o.length;a++)o[a].kerasMask=i[a]}addInboundNode(e,n,s,r,o,i,a=null){const l=en(e);n=en(n),s=en(s),r=en(r),o=xx(o),i=xx(i);const u=[],c=[],d=[];for(const h of l)u.push(h.sourceLayer),c.push(h.nodeIndex),d.push(h.tensorIndex);new a1({outboundLayer:this,inboundLayers:u,nodeIndices:c,tensorIndices:d,inputTensors:l,outputTensors:n,inputMasks:s,outputMasks:r,inputShapes:o,outputShapes:i},a);for(let h=0;h<n.length;h++)n[h].sourceLayer=this,n[h].nodeIndex=this.inboundNodes.length-1,n[h].tensorIndex=h}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function BY(t){t=en(t);const e=[];for(const n of t)e.push(n.shape);return wr(e)}function VY(t){return"float32"}function eP(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const s=e.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let o=0;o<s.inboundLayers.length;o++){const i=s.inputTensors[o],a=s.inboundLayers[o],l=s.nodeIndices[o],u=eP(i,a,l);for(const c of u)r.indexOf(c)===-1&&r.push(c)}return r}}}function UY(t){let e=!0;for(const n of en(t))if(!(n instanceof la)){e=!1;break}return e}function WY(t){let e=!0;for(const n of en(t))if(n instanceof la){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rg extends Rt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:o1("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new J("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new J("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new J("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const r=new la(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new a1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new J(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}rg.className="InputLayer";Se(rg);function jY(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new J("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new rg({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function GY(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return Ee(e,t.dtype)}catch{throw new J(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class ul{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof ul)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=GY(e,n),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new J(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof la){if(this.id2Value[e.id]==null)throw new J(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new J(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof la){if(this.id2Value[e.id]==null)throw new J(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new J(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&lt(this.id2Mask)}}const vx=new LF,bx=new LF;function HY(t){vx!=null&&vx.setMaxEntries(t),bx!=null&&bx.setMaxEntries(t)}function Rp(t,e,n,s){const r=n==null?!1:n.training,o=Array.isArray(t),i=o?t:[t],a=i.map(f=>f.name),l=[],u=e.names();for(const f of a)u.indexOf(f)!==-1?l.push(e.getValue(f)):l.push(null);const c=a.join(",")+"|"+e.names().sort().join(",");let d=vx.get(c),h;if(d==null){const f=KY(i,e);d=f.sorted,h=f.recipientCounts,vx.put(c,d),bx.put(c,h)}h={},r||Object.assign(h,bx.get(c));const p=new ul(e);for(let f=0;f<d.length;++f){const m=d[f],g=m.sourceLayer;if(g instanceof rg)continue;const y=[],x=[],v=[];let b=!1;for(const R of m.inputs){const _=p.getValue(R),P=p.getMask(R);y.push(_),x.push(P),P!=null&&(b=!0),r||(h[R.name]--,h[R.name]===0&&!e.hasKey(R)&&a.indexOf(R.name)===-1&&!_.isDisposed&&R.sourceLayer.stateful!==!0&&v.push(_))}b&&(n=n||{},n.mask=x[0]);const S=en(g.apply(y,n));let C=null;g.supportsMasking&&(C=g.computeMask(y,x));const I=XY(m),T=Array.isArray(I)?I:[I];for(let R=0;R<T.length;++R){p.hasKey(T[R])||p.add(T[R],S[R],Array.isArray(C)?C[0]:C);const _=a.indexOf(T[R].name);_!==-1&&(l[_]=S[R])}r||lt(v)}return p.disposeMasks(),o?l:l[0]}function KY(t,e){A(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(t.length===1){const r=iT(t[0],e);n=r.sorted,s=r.recipientMap}else{const r=new Set;for(const o of t){const{sorted:i,recipientMap:a}=iT(o,e);for(const l of i)r.has(l.name)||(n.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:n,recipientCounts:qY(s)}}function qY(t){const e={};for(const n in t)e[n]=t[n].size;return e}function iT(t,e){const n=new Set,s=[],r={};for(const a of e.names())n.add(a);const o=[],i=[];for(o.push(t);o.length>0;){const a=o[o.length-1];if(n.has(a.name)){o.pop();continue}const l=i[i.length-1]===o.length-1;if(a.inputs.length===0||l)o.pop(),s.push(a),n.add(a.name),l&&i.pop();else{i.push(o.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!n.has(u.name)&&o.push(u)}}return{sorted:s,recipientMap:r}}function XY(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let s=0;s<t.sourceLayer.inboundNodes.length;++s)for(const r of t.sourceLayer.inboundNodes[s].outputTensors)if(r.id===t.id){n=s;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YY=re();YY.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,HY);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Lk(t,e){return ne(()=>zs(Qe(U(t,t),e,!0)))}class og extends Bh{getConfig(){return{}}}class tP extends og{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ne(()=>{const n=Lk(e,this.axis),s=Ir(n,0,this.maxValue);return U(e,Me(s,me(ls(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}tP.className="MaxNorm";Se(tP);class nP extends og{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ne(()=>Me(e,me(ls(),Lk(e,this.axis))))}getConfig(){return{axis:this.axis}}}nP.className="UnitNorm";Se(nP);class sP extends og{apply(e){return pa(e)}}sP.className="NonNeg";Se(sP);class rP extends og{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ne(()=>{const n=Lk(e,this.axis),s=me(U(this.rate,Ir(n,this.minValue,this.maxValue)),U(1-this.rate,n));return U(e,Me(s,me(ls(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}rP.className="MinMaxNorm";Se(rP);const aT={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function ds(t){return $k(t)}function lT(t,e={}){return eg(t,Po.getMap().classNameMap,e,"constraint")}function hs(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in aT?aT[t]:t,config:{}};return lT(n)}else return t instanceof og?t:lT(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function ru(t){if(t==null)return;const e=[],n=[],s=[];for(const r in t){const o=t[r];if(typeof o!="number"){const i=o;e.push(i.data()),n.push(r),s.push(i)}}if(e.length>0){const r=await Promise.all(e);for(let o=0;o<r.length;++o)t[n[o]]=r[o][0];lt(s)}}function oP(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var uT;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(uT||(uT={}));const QY=125;class kf{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class JY{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class ZY extends kf{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const r in n){const o=n[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*s;else{let i;r in this.totals?i=this.totals[r]:this.totals[r]=0;const a=ne(()=>me(this.totals[r],U(o,s)));this.totals[r]=a,i!=null&&i.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:ne(()=>{const r=U(Me(1,this.seen),this.totals[s]);n[s]=r,this.totals[s].dispose(),ks(n[s])}))}}class eQ extends kf{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const e=[],n=[],s=[];for(const o in this.history){const i=this.history[o];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const l=i[a];e.push(l.data()),n.push(o),s.push(a)}}const r=await Promise.all(e);for(let o=0;o<r.length;++o)this.history[n[o]][s[o]].dispose(),this.history[n[o]][s[o]]=r[o][0]}}class tQ extends kf{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||dF,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=QY),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");qb(this.yieldEvery)&&(this.maybeWait=fY(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,s){const r=[];this.yield!=null&&(await ru(s),r.push(this.yield(e,n,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await ru(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const s=[];this.epochEnd!=null&&(await ru(n),s.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,n){this.batchBegin!=null&&(await ru(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const s=[];this.batchEnd!=null&&(await ru(n),s.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):qb(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await ru(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await ru(e),await this.trainEnd(e))}}function iP(t,e){return t==null&&(t={}),t instanceof kf?[t]:Array.isArray(t)&&t[0]instanceof kf?t:en(t).map(s=>new tQ(s,e))}class Do{constructor(){}static registerCallbackConstructor(e,n){A(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Do.checkForDuplicate(n),Do.constructors[e]==null&&(Do.constructors[e]=[]),Do.constructors[e].push(n)}static checkForDuplicate(e){for(const n in Do.constructors)Do.constructors[+n].forEach(r=>{if(r===e)throw new J("Duplicate callback constructor.")})}static clear(){Do.constructors={}}static createCallbacks(e){const n=[];for(const s in Do.constructors){const r=+s;e>=r&&n.push(...Do.constructors[r])}return n.map(s=>new s)}}Do.constructors={};function aP(t,e,n,s,r,o,i,a,l){const u=new eQ,c=[new ZY,...Do.createCallbacks(e)];t!=null&&c.push(...t),c.push(u);const d=new JY(c);return d.setParams({epochs:n,initialEpoch:s,samples:r,steps:o,batchSize:i,verbose:e,doValidation:a,metrics:l}),{callbackList:d,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _a(t,e={},n=!1){return eg(t,Po.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Sx(t,e){return ne(()=>{t.dtype!=="float32"&&(t=Ee(t,"float32"));const n=Qe(ng(t),e,!0),s=Oh(n.shape,ls()),r=zs(ja(n,s));return Me(t,r)})}function l1(t,e){return ne(()=>zn(ng(Be(e,t)),-1))}function zk(t,e){return ne(()=>zn(is(Be(e,t)),-1))}function Mk(t,e){return ne(()=>{const n=Be(t,e),s=Ir(is(t),ls(),Number.MAX_VALUE),r=is(Me(n,s));return U(100,zn(r,-1))})}function nQ(t,e){return ne(()=>{const n=Ir(e,ls(),Number.MAX_VALUE),s=po(me(1,n)),r=Ir(t,ls(),Number.MAX_VALUE),o=po(me(1,r));return zn(ng(Be(s,o)),-1)})}function sQ(t,e){return ne(()=>{const n=ja(0,Be(1,U(t,e)));return zn(ng(n),-1)})}function rQ(t,e){return ne(()=>{const n=ja(0,Be(1,U(t,e)));return zn(n,-1)})}function oQ(t,e){return ne(()=>{const n=Qe(U(t,e),-1),s=Go(U(Be(1,t),e),-1);return ja(0,me(1,Be(s,n)))})}function iQ(t,e){return ne(()=>{const n=Math.log(2),s=Be(e,t),r=Be(me(s,Lh(U(-2,s))),n);return zn(r,-1)})}function If(t,e,n=!1){return ne(()=>{if(n)e=Tw(e);else{const s=Qe(e,e.shape.length-1,!0);e=Me(e,s)}return e=Ir(e,ls(),1-ls()),Sn(Qe(U(Ee(t,"float32"),po(e)),e.shape.length-1))})}function Cx(t,e,n=!1){return ne(()=>{const s=Ee(Xm($Y(t)),"int32");e=Ir(e,ls(),1-ls());const r=e.shape,o=q(W2(s,r[r.length-1]),r);return If(o,e,n)})}function aQ(t,e){if(!Ct(t.shape,e.shape))throw new J(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return ne(()=>{const n=pa(e),s=Sn(is(e));return me(Be(n,U(e,t)),xw(hr(s)))})}function u1(t,e){return ne(()=>{let n;return n=Ir(e,ls(),1-ls()),n=po(Me(n,Be(1,n))),zn(aQ(t,n),-1)})}function lQ(t,e){return ne(()=>{const n=Ir(t,ls(),1),s=Ir(e,ls(),1);return Qe(U(t,po(Me(n,s))),-1)})}function uQ(t,e){return ne(()=>{const n=po(me(ls(),e));return zn(Be(e,U(t,n)),-1)})}function lP(t,e){return ne(()=>{const n=Sx(t,-1),s=Sx(e,-1),r=U(n,s);return Sn(Qe(r,-1))})}const kx={meanSquaredError:l1,meanAbsoluteError:zk,meanAbsolutePercentageError:Mk,meanSquaredLogarithmicError:nQ,squaredHinge:sQ,hinge:rQ,categoricalHinge:oQ,logcosh:iQ,categoricalCrossentropy:If,sparseCategoricalCrossentropy:Cx,binaryCrossentropy:u1,kullbackLeiblerDivergence:lQ,poisson:uQ,cosineProximity:lP};function $v(t){if(typeof t=="string"){if(t in kx)return kx[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new J(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function uP(t,e){return ne(()=>{const n=U(.5,fo(e)),s=ra(eo(e,n),t.dtype);return zn(Ii(t,s),-1)})}function cP(t,e){return ne(()=>ra(Ii(Ku(t,-1),Ku(e,-1)),"float32"))}function cQ(t,e){return ne(()=>Ee(Qe(aa(Ii(t,1),Ii(e,1))),"float32"))}function dQ(t,e){return ne(()=>Ee(Qe(aa(Ii(t,0),Ii(e,1))),"float32"))}function hQ(t,e){return ne(()=>{const n=cQ(t,e),s=dQ(t,e),r=me(n,s);return Ee(Hs(eo(r,0),Me(n,r),0),"float32")})}function pQ(t,e){return u1(t,e)}function fQ(t,e){return t.rank===e.rank&&(t=Ht(t,[t.rank-1])),e=Ku(e,-1),e.dtype!==t.dtype&&(e=Ee(e,t.dtype)),Ee(Ii(t,e),"float32")}const mQ=l1,gQ=l1,yQ=zk,xQ=zk,wQ=Mk,vQ=Mk,dP=If,bQ=lP,hP=Cx,Ix={binaryAccuracy:uP,categoricalAccuracy:cP,precision:hQ,categoricalCrossentropy:dP,sparseCategoricalCrossentropy:hP,mse:mQ,MSE:gQ,mae:yQ,MAE:xQ,mape:wQ,MAPE:vQ,cosine:bQ};function SQ(t){if(typeof t=="string"&&t in Ix)return Ix[t];if(typeof t!="string"&&t!=null)return t;throw new J(`Unknown metric ${t}`)}function Yg(t){if(Xi(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(kx))if(kx[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(Ix))if(Ix[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function CQ(t){const e={Adagrad:()=>Rc.adagrad(.01),Adadelta:()=>Rc.adadelta(1,.95,ls()),Adam:()=>Rc.adam(.001,.9,.999,ls()),Adamax:()=>Rc.adamax(.002,.9,.999,ls(),0),RMSProp:()=>Rc.rmsprop(.001,.9,0,ls()),SGD:()=>Rc.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new J(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const cT=1*1024*1024;function dT(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!vS(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(t);s.length>cT&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${cT}.`)}}function vS(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!vS(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!vS(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kQ(t,e,n,s=console.log){const r=$Q(t),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(c=>Math.floor(e*c)));let i;if(!r){o.push("Receives inputs"),i=[];for(const c in t.nodesByDepth)i.push(...t.nodesByDepth[c])}s("_".repeat(e)),$x(o,n,s),s("=".repeat(e));const a=t.layers;for(let c=0;c<a.length;++c)r?NQ(a[c],n,s):TQ(a[c],n,i,s),s((c===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=IQ(t),u=wx(t.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function IQ(t){let e;return t.collectedTrainableWeights!=null?e=wx(t.collectedTrainableWeights):e=wx(t.trainableWeights),e}function $Q(t){let e=!0;const n=[],s=[];for(const r in t.nodesByDepth)n.push(t.nodesByDepth[r]);for(const r of n){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of t.layers){let o=!1;for(const i of r.inboundNodes)if(s.indexOf(i)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function $x(t,e,n=console.log){let s="";for(let r=0;r<t.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=t[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);n(s)}function NQ(t,e,n){let s,r;try{r=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const o=t.name,i=t.getClassName(),a=[`${o} (${i})`,r,s,t.countParams().toString()];$x(a,e,n)}function TQ(t,e,n,s){let r,o;try{o=t.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}const i=[];for(const d of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(d)===-1))for(let h=0;h<d.inboundLayers.length;++h){const p=d.inboundLayers[h].name,f=d.nodeIndices[h],m=d.tensorIndices[h];i.push(`${p}[${f}][${m}]`)}const a=t.name,l=t.getClassName(),u=i.length===0?"":i[0],c=[`${a} (${l})`,o,r,t.countParams().toString(),u];$x(c,e,s);for(let d=1;d<i.length;++d)$x(["","","","",i[d]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pP(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function bS(t,e){if(t===null)return null;if(typeof t=="string")return pu(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const o=t[r];pP(e,r,o)?n.push(o):n.push(bS(o,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s];if(s==="name"&&typeof r=="string")n[s]=r;else{const o=pu(s);n[o]=bS(r,o)}}return n}}function SS(t,e){if(t==null)return null;if(typeof t=="string")return Ca(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const o=t[r];pP(e,r,o)?n.push(o):n.push(SS(o,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s],o=Ca(s);(s==="name"||s==="className")&&typeof r=="string"?n[o]=r:n[o]=SS(r,s)}return n}}/** @license See the LICENSE file. */const fP="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const EQ=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class ci extends Rt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const x=this.getClassName().toLowerCase();this.name=o1(x)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],bl(this.inputs).length!==this.inputs.length)throw new J(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(x=>x.name)}`);bl(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(x=>x.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const x of this.outputs){const v=x.sourceLayer,b=x.nodeIndex,S=x.tensorIndex;this.outputLayers.push(v),this.outputLayersNodeIndices.push(b),this.outputLayersTensorIndices.push(S)}for(const x of this.inputs){const v=x.sourceLayer,b=x.nodeIndex,S=x.tensorIndex;Xi(b===0,"input layer has >1 nodes"),Xi(S===0,"input layer has >1 tensors"),this.inputLayers.push(v),this.inputLayersNodeIndices.push(b),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let x=0;x<this.inputLayers.length;x++){const v=this.inputLayers[x];if(!(v instanceof rg))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${x} (0-based) originates from layer type ${v.getClassName()}.`);this.inputNames.push(v.name),this.feedInputShapes.push(v.batchInputShape),this.feedInputNames.push(v.name)}for(const x of this.outputLayers)this.outputNames.push(x.name);this.internalInputShapes=this.inputs.map(x=>x.shape),this.internalOutputShapes=this.outputs.map(x=>x.shape);const n={},s={},r={},o={},i={},a=[],l=(x,v,b,S,C,I)=>{(S==null||C==null||I==null)&&(S=x.sourceLayer,C=x.nodeIndex,I=x.tensorIndex);const T=S.inboundNodes[C];if(b.indexOf(T)!==-1)throw new Vo(`The tensor ${x.name} at layer "${S.name}" is part of a cycle.`);if(v.indexOf(T)!==-1)return;this.containerNodes.add(ci.nodeKey(S,C)),S.id in i||(i[S.id]=Object.keys(i).length),b.indexOf(T)===-1&&b.push(T);const R=T.inboundLayers.length;for(let _=0;_<R;_++){const P=T.inputTensors[_],z=T.inboundLayers[_],O=T.nodeIndices[_],V=T.tensorIndices[_];l(P,v,b,z,O,V)}for(v.push(T);b.indexOf(T)>=0;)b.splice(b.indexOf(T),1);a.push(T)},u=[],c=[];for(const x of this.outputs)l(x,u,c);const d=a.slice().reverse();for(const x of d){s[x.id]=x,x.id in n||(n[x.id]=0);let v=n[x.id];const b=r[x.outboundLayer.id]==null?0:r[x.outboundLayer.id];v=Math.max(v,b),r[x.outboundLayer.id]=v,o[x.outboundLayer.id]=x.outboundLayer,n[x.id]=v;for(let S=0;S<x.inboundLayers.length;S++){const C=x.inboundLayers[S],I=x.nodeIndices[S],T=C.inboundNodes[I],R=n[T.id]==null?0:n[T.id];n[T.id]=Math.max(v+1,R),s[T.id]=T}}const h={};for(const x in n){const v=n[x];v in h||(h[v]=[]),h[v].push(s[x])}const p={};for(const x in r){const v=r[x];v in p||(p[v]=[]),p[v].push(o[x])}let f=Object.keys(p).map(x=>parseInt(x,10)).sort(Kg);this.layers=[];for(const x of f){const v=p[x];v.sort((b,S)=>{const C=i[b.id],I=i[S.id];return C<I?-1:C>I?1:0});for(const b of v)b instanceof ci&&this.internalContainerRefs.push(b),this.layers.push(b)}this.layersByDepth=p,f=Object.keys(h).map(x=>parseInt(x,10)).sort(Kg);const m=this.inputs.slice(),g=[];for(const x of f)for(const v of h[x]){const b=v.outboundLayer;if(b!=null){for(const S of v.inputTensors)if(m.indexOf(S)===-1)throw new Vo(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${b.name}". The following previous layers were accessed without issue: ${g}`);for(const S of v.outputTensors)m.push(S);g.push(b.name)}}this.nodesByDepth=h;const y=this.layers.map(x=>x.name);for(const x of y){const v=y.filter(b=>b===x).length;if(v!==1)throw new Vo(`The name "${x}" is used ${v} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new a1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(x=>null),outputMasks:this.outputs.map(x=>null),inputShapes:this.inputs.map(x=>x.shape),outputShapes:this.outputs.map(x=>x.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new J("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const s={};let r=0;const o=EQ(e);o&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const c=o?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[c]!=null)throw new J(`Duplicate weight name: ${c}`);s[c]=u,r++}const i=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)i.push([s[l],e[a]]);else if(n)throw new J(`Provided weight data has no target variable: ${a}`);delete s[l]}if(n){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new J(`${a.length} of ${r} weights are not set: ${a}`)}Ok(i)}parseWeights(e){for(const n in Object.keys(e)){const s=n.split("/"),r=["vars","layer_checkpoint_dependencies"],o=s.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!r.includes(i)).join("/");o!==n&&(e[o]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${fP}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const s=SS(this.updatedConfig());return n?JSON.stringify(s):s}call(e,n){return ne(()=>{e=en(e);const s=new ul;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Rp(this.outputs,s,n)})}computeMask(e,n){return ne(()=>{e=en(e);let s;return n==null?s=Qu(null,e.length):s=en(n),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const n=xx(e);if(n.length!==this.inputLayers.length)throw new J(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],u=n[a],c=l.name+"_0_0";s[c]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Kg);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const c=u.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(c.id)!==-1)continue;const d=[];for(let m=0;m<u.inboundLayers.length;m++){const g=u.inboundLayers[m],y=u.nodeIndices[m],x=u.tensorIndices[m],v=`${g.name}_${y}_${x}`,b=s[v];d.push(b)}const h=c.computeOutputShape(wr(d)),p=xx(h),f=c.inboundNodes.indexOf(u);for(let m=0;m<p.length;m++){const g=`${c.name}_${f}_${m}`;s[g]=p[m]}}}const o=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],d=`${l.name}_${u}_${c}`;i.push(d)}for(let a=0;a<i.length;a++){const l=i[a];Xi(l in s),o.push(s[l])}return wr(o)}runInternalGraph(e,n){n==null&&(n=Qu(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],c=e[l],d=n[l];s[u.id]=[c,d]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Kg);for(const l of r){const u=this.nodesByDepth[l];for(const c of u){const d=c.outboundLayer,h=c.inputTensors,p=c.outputTensors,f=new Array;for(const m of h)m.id in s&&f.push(s[m.id]);if(f.length===h.length){let m={},g,y,x,v;if(c.callArgs!=null&&(m=c.callArgs),f.length===1){const[b,S]=f[0];m.mask==null&&(m.mask=S),x=en(d.call(b,m)),v=en(d.computeMask(b,S)),g=[b],y=[S]}else g=f.map(b=>b[0]),y=f.map(b=>b[1]),m.mask==null&&(m.mask=y),x=en(d.call(g,m)),v=en(d.computeMask(g,y));if(d.activityRegularizer)throw new $t("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let b=0;b<p.length;++b){const S=p[b],C=x[b],I=v[b];s[S.id]=[C,I]}}}}const o=[],i=[],a=[];for(const l of this.outputs){Xi(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,c]=s[l.id];a.push(u.shape),o.push(u),i.push(c)}return[o,i,a]}buildNodeConversionMap(e){const n={};let s;for(const r of this.layers){s=r instanceof ci?1:0;for(let o=0;o<r.inboundNodes.length;o++){const i=ci.nodeKey(r,o);this.containerNodes.has(i)&&(n[i]=s,s+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new J("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new J(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new J(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ne(()=>{const e=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const r=ci.nodeKey(n,s);this.containerNodes.has(r)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const a=i.getClassName(),l=i.getConfig(),u=[];for(let d=0;d<i.inboundNodes.length;d++){const h=i.inboundNodes[d],p=ci.nodeKey(i,d);let f={};if(this.containerNodes.has(p)){if(h.callArgs)try{JSON.stringify(h.callArgs),f=h.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${h.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),f={}}if(h.inboundLayers.length>0){const m=[];for(let g=0;g<h.inboundLayers.length;g++){const y=h.inboundLayers[g],x=h.nodeIndices[g],v=h.tensorIndices[g],b=ci.nodeKey(y,x);let S=n[b];S==null&&(S=0),m.push([y.name,S,v,f])}u.push(m)}}}const c={};c.name=i.name,c.className=a,c.config=l,c.inboundNodes=u,s.push(c)}e.layers=s;const r=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],l=this.inputLayersNodeIndices[i],u=ci.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=n[u];c==null&&(c=0);const d=this.inputLayersTensorIndices[i];r.push([a.name,c,d])}e.inputLayers=r;const o=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],l=this.outputLayersNodeIndices[i],u=ci.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=n[u];c==null&&(c=0);const d=this.outputLayersTensorIndices[i];o.push([a.name,c,d])}return e.outputLayers=o,e}static fromConfig(e,n,s={},r=!1){const o={},i={};function a(g,y){g.name in i?i[g.name].push(y):i[g.name]=[y]}function l(g,y){const x=[];let v;for(const b of y){const S=b[0],C=b[1],I=b[2];if(v=b[3]==null?{}:b[3],!(S in o)){a(g,y);return}const T=o[S];if(T.inboundNodes.length<=C){a(g,y);return}const R=T.inboundNodes[C];x.push(R.outputTensors[I])}x.length>0&&g.apply(wr(x),v)}function u(g){const y=g.name,x=_a(g,n.customObjects!=null?n.customObjects:{});x.setFastWeightInitDuringBuild(r),o[y]=x,g.inboundNodes.forEach(b=>{if(!(b instanceof Array))throw new J(`Corrupted configuration, expected array for nodeData: ${b}`);a(x,b)})}const c=n.name,d=n.layers;for(const g of d)u(g);for(;!pY(i);)for(const g of d){const y=o[g.name];if(y.name in i){const x=i[y.name];delete i[y.name];for(const v of x)l(y,v)}}const h=[],p=[],f=n.inputLayers;for(const g of f){const y=g[0],x=g[1],v=g[2];Xi(y in o);const S=o[y].inboundNodes[x].outputTensors;h.push(S[v])}const m=n.outputLayers;for(const g of m){const y=g[0],x=g[1],v=g[2];Xi(y in o);const S=o[y].inboundNodes[x].outputTensors;p.push(S[v])}return new e({inputs:h,outputs:p,name:c})}get stateful(){if(this._stateful)throw new J("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ne(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function RQ(t,e,n){const s=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(r=>null);if(s===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==s)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const r=[];return e.forEach(o=>{o in t?r.push(t[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function mP(t,e){return RQ(t,e,"classWeight")}async function gP(t,e,n,s){if(n!=null){const r=ne(()=>{if(t.shape.length===1)return Aa(t);if(t.shape.length===2){if(t.shape[1]>1)return Ku(t,1);if(t.shape[1]===1)return q(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());lt(r);const i=[];return o.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(n[a])}),es(i,"float32")}else return null}function DQ(t,e){return U(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const AQ=32;function yP(t,e){let n,s;const r=e;n=r.xs,s=r.ys,A(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=hT("input",t.inputNames,n),i=hT("output",t.outputNames,s),a=o[0].shape[0];A(o.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),A(i.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<o.length;l++)A(o[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<i.length;l++)A(i[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:o,ys:i}}function hT(t,e,n){if(n instanceof Qt)return[n];if(Array.isArray(n))return A(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const s=[];for(const r of e){if(n[r]==null)throw new J(`The feature data generated by the dataset lacks the required ${t} key '${r}'.`);s.push(n[r])}return s}}function _Q(t){if(t.length===3)throw new $t("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function FQ(t,e,n){const s=n.batchesPerEpoch!=null;if(A(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),A(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),A(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),A(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),A(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const r=n.validationData!=null;let o,i;if(r)if(pT(n.validationData))A(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const g=_Q(n.validationData);o=g.xs,i=g.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(g=>"val_"+g)):u=l.slice();const c=iP(n.callbacks,n.yieldEvery),d=n.verbose==null?1:n.verbose,{callbackList:h,history:p}=aP(c,d,n.epochs,null,null,PQ(e,n),null,r,u);h.setModel(t),t.history=p,await h.onTrainBegin(),t.stopTraining_=!1;let f=n.initialEpoch==null?0:n.initialEpoch,m=await e.iterator();for(;f<n.epochs;){const g={};await h.onEpochBegin(f);let y=0,x=0;for(s||(m=await e.iterator());!s||y<n.batchesPerEpoch;){const v=await m.next();if(s&&v.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(v.value!=null){const{xs:b,ys:S}=yP(t,v.value),C={};C.batch=x,C.size=b[0].shape[0],await h.onBatchBegin(x,C);const I=[];if(n.classWeight!=null){const _=mP(n.classWeight,t.outputNames);for(let P=0;P<_.length;++P)I.push(await gP(S[P],null,_[P]))}const T=b.concat(S).concat(I),R=a(T);lt(T);for(let _=0;_<l.length;++_){const P=l[_],z=R[_];C[P]=z,ks(z)}await h.onBatchEnd(x,C),oP(C),x++,y++}if(s?y>=n.batchesPerEpoch:v.done){if(r){let b;pT(n.validationData)?b=en(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):b=en(t.evaluate(o,i,{batchSize:n.validationBatchSize==null?AQ:n.validationBatchSize,verbose:0}));for(let S=0;S<t.metricsNames.length;++S)g[`val_${t.metricsNames[S]}`]=b[S]}break}if(t.stopTraining_)break}if(await h.onEpochEnd(f,g),f++,t.stopTraining_)break}return await h.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function PQ(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function pT(t){return typeof t.iterator=="function"}function OQ(t){return typeof t.next=="function"}async function LQ(t,e,n){n=n||{};const s=n.batches!=null,r=t.testFunction;let o=[];if(n.verbose>0)throw new $t("Verbose mode is not implemented yet.");A(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const i=OQ(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<n.batches;){const u=await i.next();if(o=ne(()=>{if(u.value){const{xs:c,ys:d}=yP(t,u.value),h=c.concat(d),p=ne(()=>r(h));if(lt(h),l===0)for(let m=0;m<p.length;++m)o.push(ot(0));const f=h[0].shape[0];for(let m=0;m<p.length;++m){const g=p[m],y=o[m];o[m]=ne(()=>me(o[m],U(f,g))),l>0&&lt(y)}lt(p),a+=f,++l}return o}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<o.length;++u){const c=o[u];o[u]=Me(o[u],a),lt(c)}return wr(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Nv(t){A(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function xp(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(s=>Du(s,e,n-e)):Du(t,e,n-e)}function CS(t,e){return ne(()=>t==null?null:Array.isArray(t)?t.map(n=>CS(n,e)):GF(t,e.dtype==="int32"?e:Ee(e,"int32")))}function Tv(t,e){const n=[];let s=0,r=null;for(;s<t;)r=s+e,r>=t&&(r=t),n.push([s,r]),s=r;return n}function xP(t){const e=[];t instanceof Qt&&(t=[t]);for(let n=0;n<t.length;++n){const s=t[n];if(s.rank===1)e.push(tg(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function ui(t,e){if(t==null)return;const n=[];if(e instanceof Qt)n.push(e.id);else if(Array.isArray(e))e.forEach(r=>n.push(r.id));else if(e!=null)for(const r in e){const o=e[r];n.push(o.id)}const s=[];if(t instanceof Qt)n.indexOf(t.id)===-1&&s.push(t);else if(Array.isArray(t))t.forEach(r=>{n.indexOf(r.id)===-1&&s.push(r)});else if(t!=null)for(const r in t){const o=t[r];n.indexOf(o.id)===-1&&s.push(o)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zQ(t){return t instanceof Qt}function kS(t){return Array.isArray(t)}function fT(t){return!zQ(t)&&!kS(t)}function mT(t,e,n,s=!0,r=""){if(e==null||e.length===0){if(t!=null){let i=!1;if(kS(t)&&t.length>0)i=!0;else if(fT(t)){for(const a in t)if(t.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new J(`Error when checking model ${r} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(i=>null);let o;if(fT(t)){t=t,o=[];for(const i of e){if(t[i]==null)throw new J(`No data provided for "${i}". Need data for each key in: ${e}`);o.push(t[i])}}else if(kS(t)){if(t=t,t.length!==e.length)throw new J(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);o=t}else{if(t=t,e.length>1)throw new J(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);o=[t]}if(o=xP(o),n!=null)for(let i=0;i<e.length;++i){if(n[i]==null)continue;const a=o[i];if(a.shape.length!==n[i].length)throw new J(`Error when checking ${r}: expected ${e[i]} to have ${n[i].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[i].length;++l){if(l===0&&!s)continue;const u=a.shape[l],c=n[i][l];if(c!=null&&c>=0&&u!==c)throw new J(`${r} expected a batch of elements where each example has shape [${n[i].slice(1,n[i].length)}] (i.e.,tensor shape [*,${n[i].slice(1,n[i].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function MQ(t,e,n){const s=bl(t.map(o=>o.shape[0]));s.sort();const r=bl(e.map(o=>o.shape[0]));if(r.sort(),s.length>1)throw new J(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(o=>o.shape))}`);if(r.length>1)throw new J(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(s.length>0&&r.length>0&&!Ct(s,r))throw new J(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function BQ(t,e,n){const s=[l1,u1,If];for(let r=0;r<t.length;++r){const o=t[r],i=e[r],a=n[r];if(i!=null){if(i===If&&o.shape[o.shape.length-1]===1)throw new J(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const l=o.shape.slice(1),u=a.slice(1);for(let c=0;c<l.length;++c){const d=l[c],h=u[c];if(h!=null&&d!==h)throw new J(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function gT(t,e,n,s=!0,r=""){let o;if(Array.isArray(t)){if(t.length!==e.length)throw new J(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);o=t}else{if(e.length>1)throw new J(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);o=[t]}if(n!=null)for(let i=0;i<e.length;++i){if(n[i]==null)continue;const a=o[i];if(a.shape.length!==n[i].length)throw new J(`Error when checking ${r}: expected ${e[i]} to have ${n[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[i].length;++l){if(l===0&&!s)continue;const u=a.shape[l],c=n[i][l];if(c!=null&&c!==u)throw new J(`Error when checking ${r}: expected ${e[i]} to have shape ${JSON.stringify(n[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function VQ(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(s=>n);{const s=[];for(const r of e){let o=n.hasOwnProperty(r)?n[r]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const UQ="layers-model";class ud extends ci{constructor(e){super(e),this.isTraining=!1}summary(e,n,s=console.log){if(!this.built)throw new J("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");kQ(this,e,n,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=CQ(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Kl))throw new J("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new J(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),n.push($v(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new J(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>$v(a))}else{const i=$v(e.loss);this.outputs.forEach(a=>{n.push(i)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],l=this.outputNames[i];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ru("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const r=VQ(e.metrics,this.outputNames),o=(i,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,i])};Ru("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=r[i];(u=>{const c="";let d,h,p;for(const f of u){if(typeof f=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(f)!==-1){const g=this.internalOutputShapes[i];g[g.length-1]===1||this.lossFunctions[i]===u1?["accuracy","acc"].indexOf(f)!==-1?h=uP:["crossentropy","ce"].indexOf(f)!==-1&&(h=pQ):this.lossFunctions[i]===Cx?["accuracy","acc"].indexOf(f)!==-1?h=fQ:["crossentropy","ce"].indexOf(f)!==-1&&(h=hP):["accuracy","acc"].indexOf(f)!==-1?h=cP:["crossentropy","ce"].indexOf(f)!==-1&&(h=dP);let y;["accuracy","acc"].indexOf(f)!==-1?y="acc":["crossentropy","ce"].indexOf(f)!==-1&&(y="ce"),p=h,d=c+y}else p=SQ(f),d=c+Yg(f);let m;Ru(d,()=>{m=p}),o(i,d,m)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,s={}){const r=s.batchSize==null?32:s.batchSize;Nv(r);const i=this.standardizeUserDataXY(e,n,!0,r);try{const a=i[0].concat(i[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return wr(u)}finally{ui(i[0],e),ui(i[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),LQ(this,e,n)}checkNumSamples(e,n,s,r="steps"){let o;if(s!=null){if(o=null,n!=null)throw new J(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new J(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new J("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),r=s?n:[n],o=this.retrieveSymbolicTensors(r),i=new ul;if(e instanceof Qt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new J(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)i.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new J(`No value is provided for the model's input ${l.name}`);i.add(l,u)}const a=Rp(o,i);return s?a:a[0]}retrieveSymbolicTensors(e){const n=Qu(null,e.length);let s=e.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],i=o.map(a=>a.name);for(let a=0;a<e.length;++a){const l=i.indexOf(e[a]);if(l!==-1&&(n[a]=o[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw n.forEach((o,i)=>{o==null&&r.push(e[i])}),new J(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return n}predictLoop(e,n=32,s=!1){return ne(()=>{const r=this.checkNumSamples(e);if(s)throw new $t("Verbose predictLoop() is not implemented yet.");const o=Tv(r,n),i=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)ne(()=>{const u=o[a][0],c=o[a][1],d=xp(e,u,c),h=[];if(Array.isArray(d))for(let f=0;f<d.length;++f)h.push({key:this.inputs[f],value:d[f]});else h.push({key:this.inputs[0],value:d});const p=new ul(h);return Rp(this.outputs,p)}).forEach((u,c)=>i[c].push(u));return wr(i.map(a=>Pn(a,0)))})}predict(e,n={}){const s=xP(e);gT(s,this.inputNames,this.feedInputShapes,!1);try{const r=n.batchSize==null?32:n.batchSize;return Nv(r),this.predictLoop(s,r)}finally{ui(s,e)}}predictOnBatch(e){gT(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,s=!0,r){if(this.optimizer_==null)throw new Vo("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===Cx?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(e=mT(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=mT(n,this.feedOutputNames,o,!1,"target"),MQ(e,n),BQ(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new J(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,s,r,o=!0,i){const[a,l]=this.standardizeUserDataXY(e,n,o,i);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const c=mP(r,this.outputNames);u=[];for(let d=0;d<c.length;++d)u.push(await gP(l[d],null,c[d]))}return[a,l,u]}testLoop(e,n,s,r=0,o){return ne(()=>{const i=this.checkNumSamples(n,s,o,"steps"),a=[];if(r>0)throw new $t("Verbose mode is not implemented yet.");if(o!=null)throw new $t("steps mode in testLoop() is not implemented yet");{const l=Tv(i,s),u=es(Ei(0,i));for(let c=0;c<l.length;++c){const d=l[c][0],h=l[c][1],p=Du(u,d,h-d),f=CS(n,p),m=e(f);if(c===0)for(let g=0;g<m.length;++g)a.push(ot(0));for(let g=0;g<m.length;++g){const y=m[g];a[g]=me(a[g],U(h-d,y))}}for(let c=0;c<a.length;++c)a[c]=Me(a[c],i)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let s=0;s<e.length;++s){const r=e[s];let o=r;if(eT(e,r)>1){const i=eT(e.slice(0,s),r);o+=`_${i}`}n.push(o)}return n}makeTrainFunction(){return e=>{const n=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const d=[];for(let m=0;m<this.inputs.length;++m)d.push({key:this.inputs[m],value:s[m]});const h=new ul(d),p=Rp(this.outputs,h,{training:!0});let f;for(let m=0;m<this.lossFunctions.length;++m){const g=this.lossFunctions[m];let y=g(r[m],p[m]);o[m]!=null&&(y=DQ(y,o[m]));const x=zn(y);n.push(x),m===0?f=y:f=me(f,y)}for(let m=0;m<this.metricsTensors.length;++m){let g;if(this.outputs.length>1&&m<this.outputs.length)g=n[m];else{const y=this.metricsTensors[m][0],x=this.metricsTensors[m][1];g=zn(y(r[x],p[x]))}ks(g),i.push(g)}return f=zn(f),this.calculateLosses().forEach(m=>{f=me(f,m)}),f},l=this.collectedTrainableWeights.map(d=>d.read());return[this.optimizer_.minimize(a,!0,l)].concat(i)}}makeTestFunction(){this.testFunction=e=>ne(()=>{const n=[];let s;const r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let u=0;u<this.inputs.length;++u)i.push({key:this.inputs[u],value:r[u]});const a=new ul(i),l=Rp(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const c=this.lossFunctions[u],d=zn(c(o[u],l[u]));u===0?s=d:s=me(s,d),n.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const c=this.metricsTensors[u][0],d=this.metricsTensors[u][1],h=zn(c(o[d],l[d]));n.push(h)}return n})}async fit(e,n,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,o,i,a,l,u,c,d,h;try{const p=s.batchSize==null?32:s.batchSize;Nv(p);const m=await this.standardizeUserData(e,n,s.sampleWeight,s.classWeight,!1,p);r=m[0],o=m[1],h=m[2];let g=!1,y;if(s.validationData!=null&&s.validationData.length>0){if(g=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new $t("validationData including sample weights is not supported yet."):new J(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const _=await this.standardizeUserData(l,u,null,null,!0,p);c=_[0],d=_[1],y=c.concat(d)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){g=!0;const R=Math.floor(r[0].shape[0]*(1-s.validationSplit)),_=r[0].shape[0];c=xp(r,R,_),i=r,r=xp(r,0,R),d=xp(o,R,_),a=o,o=xp(o,0,R),y=c.concat(d)}else s.validationSteps!=null&&(g=!0);const x=r.concat(o).concat(h);this.checkTrainableWeightsConsistency();const v=this.makeTrainFunction(),b=this.getDedupedMetricsNames();let S,C;g?(this.makeTestFunction(),S=this.testFunction,C=b.slice().concat(b.map(R=>"val_"+R))):(S=null,y=[],C=b.slice());const I=iP(s.callbacks,s.yieldEvery);return await this.fitLoop(v,x,b,p,s.epochs,s.verbose,I,S,y,s.shuffle,C,s.initialEpoch,null,null)}finally{this.isTraining=!1,ui(r,e),ui(o,n),ui(i,e),ui(a,n),ui(c,l),ui(d,u),h!=null&&lt(h)}}async fitLoop(e,n,s,r,o,i,a,l,u,c,d,h,p,f){r==null&&(r=32),o==null&&(o=1),c==null&&(c=!0),h==null&&(h=0);let m=!1;if(l!=null&&u!=null&&(m=!0),f!=null&&(m=!0,p==null))throw new J("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(n,r,p,"steps_per_epoch");let y;g!=null&&(y=Ei(0,g)),i==null&&(i=1);const{callbackList:x,history:v}=aP(a,i,o,h,g,p,r,m,d);x.setModel(this),this.history=v,await x.onTrainBegin(),this.stopTraining_=!1;for(let b=h;b<o;++b){await x.onEpochBegin(b);const S={};if(p!=null)throw new $t("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new $t("batch shuffling is not implemneted yet");c&&Lj(y);const C=es(y),I=Tv(g,r);for(let T=0;T<I.length;++T){const R={};if(await x.onBatchBegin(T,R),ne(()=>{const _=I[T][0],P=I[T][1],z=Du(C,_,P-_);R.batch=T,R.size=P-_;const O=CS(n,z),V=e(O);for(let H=0;H<s.length;++H){const Q=s[H],oe=V[H];R[Q]=oe,ks(oe)}if(T===I.length-1&&m){const H=this.testLoop(l,u,r);for(let Q=0;Q<s.length;++Q){const oe=s[Q],j=H[Q];ks(j),S["val_"+oe]=j}}}),await x.onBatchEnd(T,R),oP(R),this.stopTraining_)break}C.dispose()}if(await x.onEpochEnd(b,S),this.stopTraining_)break}return await x.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return FQ(this,e,n)}async trainOnBatch(e,n){const s=await this.standardizeUserData(e,n),r=s[0],o=s[1],a=this.makeTrainFunction()(r.concat(o)),l=[];for(const u of a){const c=await u.data();l.push(c[0])}return lt(a),ui(s[0],e),ui(s[1],n),wr(l)}getNamedWeights(e){const n=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let i=0;i<r.length;++i)s&&!r[i].trainable||n.push({name:r[i].originalName,tensor:o[i]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=ON().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-ON().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Ca(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>Ca(n))}else{const n=Object.keys(this.loss);e={};const s=this.loss;for(const r of n)if(typeof s[r]=="string")e[r]=Ca(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Ca(Yg(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Ca(Yg(e)));{const e={};for(const n in this.metrics)e[n]=Ca(Yg(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=bS(e.optimizer_config),s=_a(n);let r;if(typeof e.loss=="string")r=pu(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(i=>pu(i));else if(e.loss!=null){r={};for(const i in e.loss)r[i]=pu(e.loss[i])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(i=>pu(i));else if(e.metrics!=null){o={};for(const i in e.metrics)o[i]=pu(e.metrics[i])}this.compile({loss:r,metrics:o,optimizer:s})}async save(e,n){if(typeof e=="string"){const u=E3(e);if(u.length===0)throw new J(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new J(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new J("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await rS(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:UQ,generatedBy:`TensorFlow.js tfjs-layers v${fP}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:c,specs:d}=await rS(await this.optimizer.getWeights(),u);s.specs.push(...d),s.data=$3([s.data,c])}return this.userDefinedMetadata!=null&&(dT(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){dT(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}ud.className="Model";Se(ud);class wP extends ud{}wP.className="Functional";Se(wP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $f extends ud{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:o1("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new J(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof $f||e instanceof ud;let s;if(n){if(s=e,s.outputs.length!==1)throw new J("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new J("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new J("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=jY({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new J(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new J("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=eP(this.outputs[0])}this.inboundNodes=[],new a1({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Qu(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(Gt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new ud({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,s=console.log){this.built||this.build(),super.summary(e,n,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,s={}){if(!this.built)throw new Vo("The model needs to be compiled before being used.");return this.model.evaluate(e,n,s)}async evaluateDataset(e,n){if(!this.built)throw new Vo("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,s={}){if(!this.built)throw new Vo("The model needs to be compiled before being used.");return this.model.fit(e,n,s)}async fitDataset(e,n){if(!this.built)throw new Vo("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,s={},r=!1){let o,i={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new J("Legacy serialization format not supported yet.");o=n}else A(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=n.layers,delete n.layers,i=n;const a=new e(i);if(!(a instanceof $f))throw new $t(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of o){const c=_a(l,void 0,r);r&&c.setFastWeightInitDuringBuild(!0),a.add(c)}return a}set stopTraining(e){if(this.model==null)throw new J("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new J("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),e.push(s)}return{name:this.name,layers:e}}}$f.className="Sequential";Se($f);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Xs=class extends Bh{getConfig(){return{}}};class vP extends Xs{apply(e,n=1){return TY(e,n)}}vP.className="elu";Se(vP);class bP extends Xs{apply(e){return tk(e)}}bP.className="selu";Se(bP);class SP extends Xs{apply(e){return pa(e)}}SP.className="relu";Se(SP);class CP extends Xs{apply(e){return ne(()=>Rl(6,pa(e)))}}CP.className="relu6";Se(CP);class kP extends Xs{apply(e){return e}}kP.className="linear";Se(kP);class IP extends Xs{apply(e){return uo(e)}}IP.className="sigmoid";Se(IP);class $P extends Xs{apply(e){return RY(e)}}$P.className="hardSigmoid";Se($P);class NP extends Xs{apply(e){return Lh(e)}}NP.className="softplus";Se(NP);class TP extends Xs{apply(e){return EY(e)}}TP.className="softsign";Se(TP);class EP extends Xs{apply(e){return Xu(e)}}EP.className="tanh";Se(EP);let Bk=class extends Xs{apply(e,n=-1){return Tw(e,n)}};Bk.className="softmax";Se(Bk);class RP extends Xs{apply(e,n=-1){return M2(e,n)}}RP.className="logSoftmax";Se(RP);class DP extends Xs{apply(e){return ne(()=>ne(()=>{const n=Math.sqrt(2),s=U(.5,me(1,O2(Me(e,n))));return U(e,s)}))}}DP.className="gelu";Se(DP);class AP extends Xs{apply(e){return ne(()=>U(.5,U(e,me(1,Xu(U(zs(Me(2,Math.PI)),me(e,U(.044715,Ba(e,3)))))))))}}AP.className="gelu_new";Se(AP);class _P extends Xs{apply(e){return ne(()=>U(e,Xu(Lh(e))))}}_P.className="mish";Se(_P);class FP extends Xs{apply(e,n=1){return ne(()=>U(uo(U(e,n)),e))}}FP.className="swish";Se(FP);function Al(t){return t.getClassName()}function Ev(t,e={}){return eg(t,Po.getMap().classNameMap,e,"activation")}function _l(t){if(t==null){const e={};return e.className="linear",e.config={},Ev(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},Ev(e)}else return t instanceof Xs?t:Ev(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function WQ(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class PP extends Bh{}class OP extends PP{constructor(e){super(),WQ(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ne(()=>{let n=Gn([1]);return this.hasL1&&(n=me(n,Qe(U(this.l1,is(e))))),this.hasL2&&(n=me(n,Qe(U(this.l2,ng(e))))),q(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}OP.className="L1L2";Se(OP);const yT={l1l2:"L1L2"};function cn(t){return $k(t)}function xT(t,e={}){return eg(t,Po.getMap().classNameMap,e,"regularizer")}function En(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in yT?yT[t]:t,config:{}};return xT(n)}else return t instanceof PP?t:xT(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class LP extends Rt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=ft(e);let s=pa(e);return this.maxValue!=null&&(s=Ir(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}LP.className="ReLU";Se(LP);class zP extends Rt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=ft(e);return yw(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}zP.className="LeakyReLU";Se(zP);class MP extends Rt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Tn(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=En(e.alphaRegularizer),this.alphaConstraint=hs(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new J(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Gt(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)n[r-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new us({ndim:e.length,axes:s})],this.built=!0}call(e,n){return e=ft(e),kw(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Fn(this.alphaInitializer),alphaRegularizer:cn(this.alphaRegularizer),alphaConstraint:ds(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}MP.className="PReLU";Se(MP);let BP=class extends Rt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new $t(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=ft(e);return Km(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}};BP.className="ELU";Se(BP);class VP extends Rt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const s=ft(e);return U(s,Ee(eo(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}VP.className="ThresholdedReLU";Se(VP);class UP extends Rt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Bk().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return ne(()=>{let s=ft(e);const r=n.mask;if(r!=null){const o=U(Be(Ur(s.shape),Ee(r,s.dtype)),ot(-1e9));s=me(s,o)}return this.axis instanceof Array?this.axis.length>1?hr(Be(s,ww(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}UP.className="Softmax";Se(UP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cd(t,e,n){if(typeof t=="number")return Qu(t,e);if(t.length!==e)throw new J(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let s=0;s<e;++s){const r=t[s];if(!kY(r))throw new J(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${r}`)}return t}function Si(t,e,n,s,r=1){if(t==null)return t;const o=e+(e-1)*(r-1);let i;return n==="same"?i=t:i=t-o+1,Math.floor((i+s-1)/s)}function Yi(t,e,n,s){if(t==null)return null;if(s==="valid")t=t*e+Dl([n-e,0]);else if(s==="same")t=t*e;else throw new J(`Unsupport padding mode: ${s}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vk(t,e){return ne(()=>(Xn(e),e==="channelsFirst"?Vt(t,[0,2,3,1]):t))}function WP(t,e){return ne(()=>(Xn(e),e==="channelsFirst"?Vt(t,[0,2,3,4,1]):t))}function jQ(t,e,n,s=1,r="valid",o,i=1){return ne(()=>{if(o==null&&(o=Ri()),Xn(o),t.shape.length!==3)throw new J(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new J(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new J(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(o==="channelsFirst"&&(t=Vt(t,[0,2,1])),r==="causal")throw new $t("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=D2(t,e,s,r==="same"?"same":"valid","NWC",i);return n!=null&&(a=Li(a,n)),a})}function wT(t,e,n,s=[1,1],r="valid",o,i,a=null){return ne(()=>{if(o==null&&(o=Ri()),Xn(o),t.rank!==3&&t.rank!==4)throw new J(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new J(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=Vk(t,o);if(r==="causal")throw new $t("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=O_({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:n,activation:a}),o==="channelsFirst"&&(l=Vt(l,[0,3,1,2])),l})}function GQ(t,e,n,s=[1,1,1],r="valid",o,i){return ne(()=>{if(o==null&&(o=Ri()),Xn(o),t.rank!==4&&t.rank!==5)throw new J(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new J(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=WP(t,o);if(r==="causal")throw new $t("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=n_(a,e,s,r==="same"?"same":"valid","NDHWC",i),n!=null&&(a=Li(a,n)),o==="channelsFirst"&&(a=Vt(a,[0,4,1,2,3])),a})}class c1 extends Rt{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",c1.verifyArgs(n),this.rank=e,Is(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new $t(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=cd(n.kernelSize,e,"kernelSize"),this.strides=cd(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,wo(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Xn(this.dataFormat),this.activation=_l(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=Tn(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=hs(n.biasConstraint),this.biasRegularizer=En(n.biasRegularizer),this.activityRegularizer=En(n.activityRegularizer),this.dilationRate=cd(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new J(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new J(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new J(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Xi("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!Nk(e.kernelSize,"number",1,3))throw new J(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Al(this.activation),useBias:this.useBias,biasInitializer:Fn(this.biasInitializer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),biasConstraint:ds(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class Vh extends c1{constructor(e,n){super(e,n),this.kernel=null,Vh.verifyArgs(n),this.filters=n.filters,Is(this.filters,"filters"),this.kernelInitializer=Tn(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=hs(n.kernelConstraint),this.kernelRegularizer=En(n.kernelRegularizer)}build(e){e=Gt(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new J(`The channel dimension of the input should be defined. Found ${e[n]}`);const s=e[n],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(e,n){return ne(()=>{e=ft(e);let s;const r=this.bias==null?null:this.bias.read(),o=MF(this.activation.getClassName());if(o!=null&&this.rank===2)s=wT(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=jQ(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=wT(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=GQ(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new $t("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Gt(e);const n=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<s.length;++o){const i=Si(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);n.push(i)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(n),r.push(this.filters)):(r.push(this.filters),r=r.concat(n)),r}getConfig(){const e={filters:this.filters,kernelInitializer:Fn(this.kernelInitializer),kernelRegularizer:cn(this.kernelRegularizer),kernelConstraint:ds(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new J(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class ig extends Vh{constructor(e){super(2,e),ig.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Nk(e.kernelSize,"number",1,2))throw new J(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}ig.className="Conv2D";Se(ig);class ag extends Vh{constructor(e){super(3,e),ag.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new J(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}ag.className="Conv3D";Se(ag);class jP extends ig{constructor(e){if(super(e),this.inputSpec=[new us({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new J(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Gt(e),e.length!==4)throw new J("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new J("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new us({ndim:4,axes:{[n]:s}})],this.built=!0}call(e,n){return ne(()=>{let s=ft(e);if(s.shape.length!==4)throw new J(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const l=r[i],u=r[a],c=this.kernelSize[0],d=this.kernelSize[1],h=this.strides[0],p=this.strides[1],f=Yi(l,h,c,this.padding),m=Yi(u,p,d,this.padding),g=[o,f,m,this.filters];this.dataFormat!=="channelsLast"&&(s=Vt(s,[0,2,3,1]));let y=_2(s,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=Vt(y,[0,3,1,2])),this.bias!=null&&(y=Li(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(e){e=Gt(e);const n=e.slice();let s,r,o;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3):(s=3,r=1,o=2);const i=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return n[s]=this.filters,n[r]=Yi(n[r],l,i,this.padding),n[o]=Yi(n[o],u,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}jP.className="Conv2DTranspose";Se(jP);class GP extends ag{constructor(e){if(super(e),this.inputSpec=[new us({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new J(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Gt(e),e.length!==5)throw new J("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new J("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new us({ndim:5,axes:{[n]:s}})],this.built=!0}call(e,n){return ne(()=>{let s=ft(e);if(s.shape.length!==5)throw new J(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a,l;this.dataFormat==="channelsFirst"?(l=2,i=3,a=4):(l=1,i=2,a=3);const u=r[l],c=r[i],d=r[a],h=this.kernelSize[0],p=this.kernelSize[1],f=this.kernelSize[2],m=this.strides[0],g=this.strides[1],y=this.strides[2],x=Yi(u,m,h,this.padding),v=Yi(c,g,p,this.padding),b=Yi(d,y,f,this.padding),S=[o,x,v,b,this.filters];this.dataFormat!=="channelsLast"&&(s=Vt(s,[0,2,3,4,1]));let C=r_(s,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(C=Vt(C,[0,4,1,2,3])),this.bias!==null&&(C=Li(C,this.bias.read(),this.dataFormat)),this.activation!==null&&(C=this.activation.apply(C)),C})}computeOutputShape(e){e=Gt(e);const n=e.slice();let s,r,o,i;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3,i=4):(s=4,r=1,o=2,i=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],d=this.strides[1],h=this.strides[2];return n[s]=this.filters,n[r]=Yi(n[r],c,a,this.padding),n[o]=Yi(n[o],d,l,this.padding),n[i]=Yi(n[i],h,u,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}GP.className="Conv3DTranspose";Se(GP);class HP extends Vh{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new J("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new J("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new J(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=Tn(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=En(n.depthwiseRegularizer),this.depthwiseConstraint=hs(n.depthwiseConstraint),this.pointwiseInitializer=Tn(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=En(n.pointwiseRegularizer),this.pointwiseConstraint=hs(n.pointwiseConstraint)}build(e){if(e=Gt(e),e.length<this.rank+2)throw new J(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new J(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const s=e[n],r=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new us({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(e,n){return ne(()=>{e=ft(e);let s;if(this.rank===1)throw new $t("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Vt(e,[0,2,3,1])),s=nk(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Li(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Vt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Fn(this.depthwiseInitializer),e.pointwiseInitializer=Fn(this.pointwiseInitializer),e.depthwiseRegularizer=cn(this.depthwiseRegularizer),e.pointwiseRegularizer=cn(this.pointwiseRegularizer),e.depthwiseConstraint=ds(this.depthwiseConstraint),e.pointwiseConstraint=ds(this.pointwiseConstraint),e}}HP.className="SeparableConv";class KP extends HP{constructor(e){super(2,e)}}KP.className="SeparableConv2D";Se(KP);class d1 extends Vh{constructor(e){super(1,e),d1.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Nk(e.kernelSize,"number",1,1))throw new J(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}d1.className="Conv1D";Se(d1);class qP extends Rt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return ne(()=>{if(e=ft(e),this.dataFormat==="channelsLast"){const s=Xg(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Xg(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Xg(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Xg(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}qP.className="Cropping2D";Se(qP);class XP extends Rt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Xn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,bY(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,s]}else{const n=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],n,s,e[3]]}}call(e,n){return ne(()=>{let s=ft(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=Vt(s,[0,2,3,1]);const o=this.size[0]*r[2],i=this.size[1]*r[3],a=this.interpolation==="nearest"?cr.resizeNearestNeighbor(s,[o,i]):cr.resizeBilinear(s,[o,i]);return Vt(a,[0,3,1,2])}else{const o=this.size[0]*r[1],i=this.size[1]*r[2];return this.interpolation==="nearest"?cr.resizeNearestNeighbor(s,[o,i]):cr.resizeBilinear(s,[o,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}XP.className="UpSampling2D";Se(XP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function HQ(t,e,n=[1,1],s="valid",r,o){return ne(()=>{r==null&&(r=Ri()),Xn(r);let i=Vk(t,r);if(t.rank!==4)throw new J(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new J(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=Hm(i,e,n,s==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(i=Vt(i,[0,3,1,2])),i})}class YP extends c1{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Tn(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=hs(e.depthwiseConstraint),this.depthwiseRegularizer=En(e.depthwiseRegularizer)}build(e){if(e=Gt(e),e.length<4)throw new J(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new J(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const s=e[n],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return ne(()=>{e=ft(e);let s=HQ(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Li(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Gt(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=Si(n,this.kernelSize[0],this.padding,this.strides[0]),i=Si(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,o,i]:[e[0],o,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Fn(this.depthwiseInitializer),e.depthwiseRegularizer=cn(this.depthwiseRegularizer),e.depthwiseConstraint=ds(this.depthwiseRegularizer),e}}YP.className="DepthwiseConv2D";Se(YP);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function QP(t,e,n,s){if(Array.isArray(t)){if(e!=null||n!=null)throw new J("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=t.slice(t.length-s,t.length),t=t.slice(0,t.length-s)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return e=r(e),n=r(n),{inputs:t,initialState:e,constants:n}}function JP(t,e,n,s=!1,r,o,i=!1,a=!1){return ne(()=>{const l=e.shape.length;if(l<3)throw new J(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(Ei(2,l));e=Vt(e,u),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Ee(Ee(r,"bool"),"float32"),r.rank===l-1&&(r=Zn(r,-1)),r=Vt(r,u)),s&&(e=Yo(e,0),r!=null&&(r=Yo(r,0)));const c=[];let d,h=n;const p=e.shape[0],f=Qo(e);let m;r!=null&&(m=Qo(r));for(let y=0;y<p;++y){const x=f[y],v=ne(()=>t(x,h));if(r==null)d=v[0],h=v[1];else{const b=ne(()=>{const S=m[y],C=Be(fo(S),S),I=me(U(v[0],S),U(h[0],C)),T=h.map((R,_)=>me(U(v[1][_],S),U(R,C)));return{output:I,newStates:T}});d=b.output,h=b.newStates}a&&c.push(d)}let g;return a&&(g=qr(c,1)),[d,g,h]})}class ql extends Rt{constructor(e){super(e);let n;if(e.cell==null)throw new J("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new jk({cells:e.cell}):n=e.cell,n.stateSize==null)throw new J("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new us({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Ei(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){xS(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const o=[];for(const i of n)o.push([e[0],i]);return[r].concat(o)}else return r}computeMask(e,n){return ne(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const r=this.states.map(o=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<e;++s)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new $t("Constants support is not implemented in RNN yet.");xS(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new us({shape:[n,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!Ct(this.stateSpec.map(i=>i.shape[i.shape.length-1]),o))throw new J(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(i=>new us({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){ne(()=>{if(!this.stateful)throw new qi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new J("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Gn([s,r])):this.states_=[Gn([s,this.cell.stateSize])];else if(e==null)lt(this.states_),this.keptStates!=null&&(lt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Gn([s,r])):this.states_[0]=Gn([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new J(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):lt(this.states_);for(let r=0;r<this.states_.length;++r){const o=e[r],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,i];if(!Ct(o.shape,a))throw new J(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>ks(r.clone()))})}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const o=QP(e,s,r,this.numConstants);e=o.inputs,s=o.initialState,r=o.constants;let i=[],a=[];if(s!=null){n.initialState=s,i=i.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new us({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(n.constants=r,i=i.concat(r),this.numConstants=r.length),i[0]instanceof la){const u=[e].concat(i),c=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=c;const h=super.apply(u,n);return this.inputSpec=d,h}else return super.apply(e,n)}call(e,n){return ne(()=>{const s=n==null?null:n.mask,r=n==null?null:n.training;let o=n==null?null:n.initialState;e=ft(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new J(`RNN Layer has ${i} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=JP((f,m)=>{const g=this.cell.call([f].concat(m),a);return[g[0],g.slice(1)]},e,o,this.goBackwards,s,null,this.unroll,this.returnSequences),c=u[0],d=u[1],h=u[2];this.stateful&&this.resetStates(h,r);const p=this.returnSequences?d:c;return this.returnState?[p].concat(h):p})}getInitialState(e){return ne(()=>{let n=Gn(e.shape);return n=Qe(n,[1,2]),n=tg(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?gS(n,[1,s]):n):this.cell.stateSize>1?[gS(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===ql.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),n)}static fromConfig(e,n,s={}){const r=n.cell,o=_a(r,s);return new e(Object.assign(n,{cell:o}))}}ql.className="RNN";Se(ql);class h1 extends Rt{}class Uk extends h1{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Is(this.units,"units"),this.activation=_l(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Tn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Tn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Tn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=En(e.kernelRegularizer),this.recurrentRegularizer=En(e.recurrentRegularizer),this.biasRegularizer=En(e.biasRegularizer),this.kernelConstraint=hs(e.kernelConstraint),this.recurrentConstraint=hs(e.recurrentConstraint),this.biasConstraint=hs(e.biasConstraint),this.dropout=kd([1,Dl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=kd([1,Dl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Gt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return ne(()=>{if(e=e,e.length!==2)throw new J(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Fl({ones:()=>fo(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Fl({ones:()=>fo(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?o=oa(U(e,i),this.kernel.read()):o=oa(e,this.kernel.read()),this.bias!=null&&(o=Li(o,this.bias.read())),a!=null&&(s=U(s,a));let l=me(o,oa(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Al(this.activation),useBias:this.useBias,kernelInitializer:Fn(this.kernelInitializer),recurrentInitializer:Fn(this.recurrentInitializer),biasInitializer:Fn(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:ds(this.kernelConstraint),recurrentConstraint:ds(this.recurrentConstraint),biasConstraint:ds(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}Uk.className="SimpleRNNCell";Se(Uk);class ZP extends ql{constructor(e){e.cell=new Uk(e),super(e)}call(e,n){return ne(()=>{this.cell.dropoutMask!=null&&(lt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(lt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,n){return new e(n)}}ZP.className="SimpleRNN";Se(ZP);class Wk extends h1{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new J("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Is(this.units,"units"),this.activation=_l(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=_l(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Tn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Tn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Tn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=En(e.kernelRegularizer),this.recurrentRegularizer=En(e.recurrentRegularizer),this.biasRegularizer=En(e.biasRegularizer),this.kernelConstraint=hs(e.kernelConstraint),this.recurrentConstraint=hs(e.recurrentConstraint),this.biasConstraint=hs(e.biasConstraint),this.dropout=kd([1,Dl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=kd([1,Dl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Gt(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return ne(()=>{if(e=e,e.length!==2)throw new J(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training==null?!1:n.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Fl({ones:()=>fo(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Fl({ones:()=>fo(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=U(e,o[0]));let c=oa(e,this.kernel.read());this.useBias&&(c=Li(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=U(r,i[0]));const d=this.recurrentKernel.read(),[h,p]=Hr(d,[2*this.units,this.units],d.rank-1),f=oa(r,h),[m,g,y]=Hr(c,3,c.rank-1),[x,v]=Hr(f,2,f.rank-1);a=this.recurrentActivation.apply(me(m,x)),l=this.recurrentActivation.apply(me(g,v));const b=oa(U(l,r),p);u=this.activation.apply(me(y,b));const S=me(U(a,r),U(me(1,Sn(a)),u));return[S,S]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Al(this.activation),recurrentActivation:Al(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Fn(this.kernelInitializer),recurrentInitializer:Fn(this.recurrentInitializer),biasInitializer:Fn(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:ds(this.kernelConstraint),recurrentConstraint:ds(this.recurrentConstraint),biasConstraint:ds(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}Wk.className="GRUCell";Se(Wk);class eO extends ql{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Wk(e),super(e)}call(e,n){return ne(()=>{this.cell.dropoutMask!=null&&(lt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(lt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}eO.className="GRU";Se(eO);class p1 extends h1{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Is(this.units,"units"),this.activation=_l(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=_l(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Tn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Tn(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Tn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=En(e.kernelRegularizer),this.recurrentRegularizer=En(e.recurrentRegularizer),this.biasRegularizer=En(e.biasRegularizer),this.kernelConstraint=hs(e.kernelConstraint),this.recurrentConstraint=hs(e.recurrentConstraint),this.biasConstraint=hs(e.biasConstraint),this.dropout=kd([1,Dl([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=kd([1,Dl([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=Gt(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,i=this.units;r=new(n=class extends Jo{apply(l,u){const c=o.apply([i]),d=new Ek().apply([i]),h=o.apply([i*2]);return nT(nT(c,d),h)}},n.className="CustomInit",n)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return ne(()=>{const s=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new J(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Fl({ones:()=>fo(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Fl({ones:()=>fo(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,c,d;0<this.dropout&&this.dropout<1&&(e=U(e,i[0]));let h=oa(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=U(r,a[0])),h=me(h,oa(r,this.recurrentKernel.read())),this.useBias&&(h=Li(h,this.bias.read()));const[p,f,m,g]=Hr(h,4,h.rank-1);l=this.recurrentActivation.apply(p),u=this.recurrentActivation.apply(f),c=me(U(u,o),U(l,this.activation.apply(m))),d=this.recurrentActivation.apply(g);const y=U(d,this.activation.apply(c));return[y,y,c]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Al(this.activation),recurrentActivation:Al(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Fn(this.kernelInitializer),recurrentInitializer:Fn(this.recurrentInitializer),biasInitializer:Fn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:cn(this.kernelRegularizer),recurrentRegularizer:cn(this.recurrentRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:ds(this.kernelConstraint),recurrentConstraint:ds(this.recurrentConstraint),biasConstraint:ds(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}p1.className="LSTMCell";Se(p1);class tO extends ql{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new p1(e),super(e)}call(e,n){return ne(()=>{this.cell.dropoutMask!=null&&(lt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(lt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}tO.className="LSTM";Se(tO);class jk extends h1{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return ne(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const o=[];let i;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?i=[e[0]].concat(s):i=[i[0]].concat(s),i=l.call(i,n),o.push(i.slice(1))}s=[];for(const a of o.slice().reverse())s.push(...a);return[i[0]].concat(s)})}build(e){xS(e)&&(e=e[0]),e=e;let n;this.cells.forEach((s,r)=>{Ru(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,n,s={}){const r=[];for(const o of n.cells)r.push(_a(o,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return wS(e)}setWeights(e){const n=[];for(const s of this.cells){const r=s.weights.length,o=e.splice(r);for(let i=0;i<s.weights.length;++i)n.push([s.weights[i],o[i]])}Ok(n)}}jk.className="StackedRNNCells";Se(jk);function Fl(t){const{ones:e,rate:n,training:s=!1,count:r=1,dropoutFunc:o}=t,i=()=>o!=null?o(e(),n):HF(e(),n),a=()=>sg(i,e,s);return!r||r<=1?ks(a().clone()):Array(r).fill(void 0).map(a).map(u=>ks(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var KQ=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n};class nO extends ql{constructor(e){if(e.unroll)throw new $t("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new $t("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new us({ndim:5})]}call(e,n){return ne(()=>{if(this.cell.dropoutMask!=null&&(lt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(lt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new J("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return ne(()=>{const{stateSize:n}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)],i=Gn(o);return Array.isArray(n)?Array(n.length).fill(i):[i]})}resetStates(e,n=!1){ne(()=>{if(!this.stateful)throw new qi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)];if(s[0]==null)throw new J("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Gn(o)):this.states_=[Gn(o)];else if(e==null)lt(this.states_),this.keptStates!=null&&(lt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Gn(o)):this.states_[0]=Gn(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new J(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):lt(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=o;if(!Ct(l.shape,u))throw new J(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>ks(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:s,kernelSize:r,padding:o,strides:i,dilationRate:a}=this.cell,l=n==="channelsFirst",u=e[l?3:2],c=e[l?4:3],d=Si(u,r[0],o,i[0],a[0]),h=Si(c,r[1],o,i[1],a[1]);return[...e.slice(0,2),...l?[s,d,h]:[d,h,s]]}}nO.className="ConvRNN2D";class Gk extends p1{constructor(e){const{filters:n,kernelSize:s,strides:r,padding:o,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,Is(this.filters,"filters"),this.kernelSize=cd(s,2,"kernelSize"),this.kernelSize.forEach(l=>Is(l,"kernelSize")),this.strides=cd(r||1,2,"strides"),this.strides.forEach(l=>Is(l,"strides")),this.padding=o||"valid",wo(this.padding),this.dataFormat=i||"channelsLast",Xn(this.dataFormat),this.dilationRate=cd(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Is(l,"dilationRate"))}build(e){var n;e=Gt(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new J(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],o=4,i=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,c=this.filters;l=new(n=class extends Jo{apply(h,p){const f=u.apply([c]),m=Ur([c]),g=u.apply([c*2]);return Tk([f,m,g])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return ne(()=>{if(e.length!==3)throw new J(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training||!1,r=e[0],o=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Fl({ones:()=>fo(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(ie,le,fe)=>!le||!le[fe]?ie:U(le[fe],ie);let c=u(r,l,0),d=u(r,l,1),h=u(r,l,2),p=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Fl({ones:()=>fo(o),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const f=this.recurrentDropoutMask;let m=u(o,f,0),g=u(o,f,1),y=u(o,f,2),x=u(o,f,3);const v=3,[b,S,C,I]=Hr(this.kernel.read(),a,v),[T,R,_,P]=this.useBias?Hr(this.bias.read(),a):[null,null,null,null];c=this.inputConv(c,b,T,this.padding),d=this.inputConv(d,S,R,this.padding),h=this.inputConv(h,C,_,this.padding),p=this.inputConv(p,I,P,this.padding);const[z,O,V,H]=Hr(this.recurrentKernel.read(),a,v);m=this.recurrentConv(m,z),g=this.recurrentConv(g,O),y=this.recurrentConv(y,V),x=this.recurrentConv(x,H);const Q=this.recurrentActivation.apply(me(c,m)),oe=this.recurrentActivation.apply(me(d,g)),j=me(U(oe,i),U(Q,this.activation.apply(me(h,y)))),ee=U(this.recurrentActivation.apply(me(p,x)),this.activation.apply(j));return[ee,ee,j]})}getConfig(){const e=super.getConfig(),n=KQ(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),s)}inputConv(e,n,s,r){const o=Tl(e,n,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Li(o,s,this.dataFormat):o}recurrentConv(e,n){return Tl(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Gk.className="ConvLSTM2DCell";Se(Gk);class sO extends nO{constructor(e){const n=new Gk(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}sO.className="ConvLSTM2D";Se(sO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Hk extends Rt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?n[r]:this.noiseShape[r]);return s}call(e,n){return ne(()=>{this.invokeCallHook(e,n);const s=ft(e);if(0<this.rate&&this.rate<1){const r=n.training==null?!1:n.training,o=this.getNoiseShape(s);return sg(()=>HF(s,this.rate,o,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}Hk.className="Dropout";Se(Hk);class rO extends Hk{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}rO.className="SpatialDropout1D";Se(rO);class oO extends Rt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,Is(this.units,"units"),this.activation=_l(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Tn(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Tn(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=hs(e.kernelConstraint),this.biasConstraint=hs(e.biasConstraint),this.kernelRegularizer=En(e.kernelRegularizer),this.biasRegularizer=En(e.biasRegularizer),this.activityRegularizer=En(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Gt(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=Gt(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return ne(()=>{this.invokeCallHook(e,n);const s=ft(e),r=MF(this.activation.getClassName());let o;return r!=null?o=oa(s,this.kernel.read(),r,this.bias?this.bias.read():null):(o=oa(s,this.kernel.read()),this.bias!=null&&(o=Li(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:Al(this.activation),useBias:this.useBias,kernelInitializer:Fn(this.kernelInitializer),biasInitializer:Fn(this.biasInitializer),kernelRegularizer:cn(this.kernelRegularizer),biasRegularizer:cn(this.biasRegularizer),activityRegularizer:cn(this.activityRegularizer),kernelConstraint:ds(this.kernelConstraint),biasConstraint:ds(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}oO.className="Dense";Se(oO);class iO extends Rt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Gt(e);for(const n of e.slice(1))if(n==null)throw new J(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Sl(e,1)]}call(e,n){return ne(()=>{this.invokeCallHook(e,n);let s=ft(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let o=2;o<s.rank;++o)r.push(o);r.push(1),s=Vt(s,r)}return NY(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}iO.className="Flatten";Se(iO);class aO extends Rt{constructor(e){super(e),this.supportsMasking=!0,this.activation=_l(e.activation)}call(e,n){return ne(()=>{this.invokeCallHook(e,n);const s=ft(e);return this.activation.apply(s)})}getConfig(){const e={activation:Al(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}aO.className="Activation";Se(aO);class lO extends Rt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return ne(()=>(e=ft(e),IY(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}lO.className="RepeatVector";Se(lO);class uO extends Rt{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const s="Total size of new array must be unchanged.",r=n.slice();let o=1,i=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(i===null)i=l;else throw new J("Can only specifiy one unknown dimension.");else o*=u}const a=Sl(e);if(i!==null){if(o===0||a%o!==0)throw new J(s);r[i]=a/o}else if(a!==o)throw new J(s);return r}computeOutputShape(e){let n=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return ne(()=>{this.invokeCallHook(e,n);const s=ft(e),r=s.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return q(s,o)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}uO.className="Reshape";Se(uO);class cO extends Rt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=Ei(1,e.dims.length+1);if(!Ct(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new us({ndim:this.dims.length+1})]}computeOutputShape(e){e=Gt(e);const n=e.slice();return this.dims.forEach((s,r)=>{n[r+1]=e[s]}),n}call(e,n){return Vt(ft(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}cO.className="Permute";Se(cO);class dO extends Rt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const s=ft(e);return gx(Sd(s,this.maskValue),-1)}call(e,n){return ne(()=>{this.invokeCallHook(e,n);const s=ft(e),i=gx(Sd(s,this.maskValue),-1,!0);return U(s,Ee(i,s.dtype))})}}dO.className="Masking";Se(dO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class hO extends Rt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(en(e.inputLength))}this.inputDim=e.inputDim,Is(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Is(this.outputDim,"outputDim"),this.embeddingsInitializer=Tn(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=En(e.embeddingsRegularizer),this.activityRegularizer=En(e.activityRegularizer),this.embeddingsConstraint=hs(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return ne(()=>this.maskZero?(e=ft(e),Sd(e,Ut(e))):null)}computeOutputShape(e){if(e=Gt(e),this.inputLength==null)return[...e,this.outputDim];const n=en(this.inputLength);if(n.length!==e.length-1)throw new J(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<n.length;++r){const o=n[r],i=e[r+1];if(o!=null&&i!=null&&o!==i)throw new J(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(n[s]=i),s++}}return[e[0],...n,this.outputDim]}call(e,n){return ne(()=>{this.invokeCallHook(e,n);let s=ft(e);s.dtype!=="int32"&&(s=ra(s,"int32"));const r=GF(this.embeddings.read(),q(s,[s.size]));return q(r,Gt(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Fn(this.embeddingsInitializer),embeddingsRegularizer:cn(this.embeddingsRegularizer),activityRegularizer:cn(this.activityRegularizer),embeddingsConstraint:ds(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}hO.className="Embedding";Se(hO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class gc extends Rt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new $t}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const s=e.slice(0,e.length-n.length);for(let r=0;r<n.length;++r){const o=e[e.length-n.length+r],i=n[r];if(o==null||i==null||o<0||i<0)s.push(null);else if(o===1)s.push(i);else if(i===1)s.push(o);else{if(o!==i)throw new J("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));s.push(o)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Gt(e)]),e=e,e.length<2)throw new J(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const o of e)o!=null&&o[0]!==null&&n.push(o[0]);if(n=bl(n),n.length>1)throw new J(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const i=e[o]==null?null:e[o].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const r=e.map(o=>o.length);e.indexOf(null)===-1&&bl(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return ne(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(o=>o.rank);if(r.indexOf(null)===-1){const o=Dl(r);for(let i of e){const a=i.rank;for(let l=0;l<o-a;++l)i=tg(i,1);s.push(i)}return this.mergeFunction(s)}else{let o=!1;for(const l of e){const u=l.rank;if(u==null){const c=l.shape,d=c[0],h=c.slice(1).concat([d]);let p=q(l,[d].concat(Sl(c.slice(1))));p=Vt(p,[1,0]),p=q(p,h),s.push(p),o=!0}else if(u>1){const c=Ei(1,u).concat([0]);s.push(Vt(l,c)),o=!0}else s.push(l)}let i=this.mergeFunction(s);const a=i.rank;if(o){if(a==null){const l=i.shape,u=l.length,c=l[u-1],d=[c].concat(l.slice(0,l.length-1));i=q(Vt(q(i,[-1,c]),[1,0]),d)}else if(a>1){const l=[a-1].concat(Ei(0,a-1));i=Vt(i,l)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);n=this.computeElementwiseOpOutputShape(n,o)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=bl(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(e,n){return ne(()=>{if(n==null)return null;if(!Array.isArray(n))throw new J("`mask` should be an Array");if(!Array.isArray(e))throw new J("`inputs` should be an Array");if(n.length!==e.length)throw new J(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(r=>r==null))return null;n=n.map(r=>r==null?r:Zn(r,0));let s=n[0];for(let r=1;r<n.length-1;++r)s=aa(s,n[r]);return s})}}class pO extends gc{constructor(e){super(e)}mergeFunction(e){return ne(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=me(n,e[s]);return n})}}pO.className="Add";Se(pO);class fO extends gc{constructor(e){super(e)}mergeFunction(e){return ne(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=U(n,e[s]);return n})}}fO.className="Multiply";Se(fO);class mO extends gc{constructor(e){super(e)}mergeFunction(e){return ne(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=me(n,e[s]);return U(1/e.length,n)})}}mO.className="Average";Se(mO);class gO extends gc{constructor(e){super(e)}mergeFunction(e){return ne(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=ja(n,e[s]);return n})}}gO.className="Maximum";Se(gO);class yO extends gc{constructor(e){super(e)}mergeFunction(e){return ne(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=Rl(n,e[s]);return n})}}yO.className="Minimum";Se(yO);class xO extends gc{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new J("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const r of e)if(r!=null){n=!1;break}if(n)return;const s=[];for(let r=0;r<e.length;++r){const o=e[r].slice();o.splice(this.axis,1);let i=!1;for(const a of s)if(Ct(a,o)){i=!0;break}i||s.push(o)}if(s.length>1)throw new J("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ne(()=>Tk(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new J("A `Concatenate` layer should be called on a list of inputs.");const n=e,s=n[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const o of n.slice(1)){if(s[r]==null||o[r]==null){s[r]=null;break}s[r]+=o[r]}return s}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new J("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new J("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new J(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return ne(()=>{let s=!0;if(n.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const r=[];for(let i=0;i<e.length;++i)n[i]==null?r.push(Ee(fo(e[i]),"bool")):n[i].rank<e[i].rank?r.push(Zn(n[i],-1)):r.push(n[i]);const o=Pn(r,this.axis);return E2(o,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}xO.className="Concatenate";Se(xO);function wp(t,e){for(;t<0;)t+=e;return t}function qQ(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new $t("batchDot is not implemented for tensors of 4D or higher rank yet");if(A(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),A(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new $t("batchDot is not implemented for complex64-type Tensors yet.");const s=t.shape.length,r=e.shape.length;n==null&&(n=[s-1,r-2]);const o=n;return ne(()=>{let i;if(s>r){i=s-r;const l=[];for(let u=0;u<i;++u)l.push(1);e=q(e,e.shape.concat(l))}else if(r>s){i=r-s;const l=[];for(let u=0;u<i;++u)l.push(1);t=q(t,t.shape.concat(l))}else i=0;let a;if(t.shape.length===2&&e.shape.length===2)o[0]===o[1]?a=Qe(U(t,e),o[0]):a=Qe(U(Vt(t,[1,0]),e),o[1]);else{const l=o[0]!==t.shape.length-1,u=o[1]===e.shape.length-1;a=At(t,e,l,u)}if(i>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let c=l;c<l+i;++c)u.push(c);a=Ht(a,u)}return a.shape.length===1&&(a=Zn(a,1)),a})}class wO extends gc{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){A(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],s=e[1];if(n.length>3||s.length>3)throw new $t("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);if(n[r[0]]!==s[r[1]])throw new J(`Dimension incompatibility: ${n[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new J(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,i)=>wp(o,e[i].shape.length)):r=[wp(this.axes,n.shape.length),wp(this.axes,s.shape.length)],this.normalize&&(n=Sx(n,r[0]),s=Sx(s,r[1])),qQ(n,s,r)}interpretAxes(e,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[wp(this.axes,e.length),wp(this.axes,n.length)],s}computeOutputShape(e){A(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),s=e[1].slice();if(n.length>3||s.length>3)throw new $t("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);n.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const o=n.concat(s);return o.length===1&&o.push(1),o}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}wO.className="Dot";Se(wO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class vO extends Rt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return ne(()=>{this.invokeCallHook(e,n);const s=ft(e);return sg(()=>me(i1(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}vO.className="GaussianNoise";Se(vO);class bO extends Rt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return ne(()=>{this.invokeCallHook(e,n);const s=ft(e);return this.rate>0&&this.rate<1?sg(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return U(s,i1(s.shape,1,o))},()=>s,n.training||!1):s})}}bO.className="GaussianDropout";Se(bO);class SO extends Rt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||ft(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return ne(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return sg(()=>{const o=ft(e),l=-1.6732632423543772*1.0507009873554805;let u=Hl(dc(s),this.rate);u=ra(u,"float32");const c=((1-this.rate)*(1+this.rate*l**2))**-.5,d=-c*l*this.rate,h=me(U(o,u),U(me(u,-1),l));return me(U(h,c),d)},()=>ft(e),n.training||!1)}return e})}}SO.className="AlphaDropout";Se(SO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Nf(t,e,n,s,r,o=.001){let i;if(t.rank===2)i=K3(t,e,n,s,r,o);else if(t.rank===3)i=q3(t,e,n,s,r,o);else if(t.rank===4)i=X3(t,e,n,s,r,o);else throw new $t(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return i}function XQ(t,e,n,s,r=.001){return ne(()=>{const o=Sw(t,s),i=o.mean,a=o.variance;return[Nf(t,i,a,n,e,r),i,a]})}function YQ(t,e,n,s,r=.001){return ne(()=>{const o=Sw(t,s),i=o.mean,a=o.variance,l=[];for(const f of Ei(0,t.rank))s.indexOf(f)!==-1?l.push(1):l.push(t.shape[f]);const u=q(i,l),c=q(a,l),d=e==null?null:q(e,l),h=n==null?null:q(n,l);return[Nf(t,u,c,h,d,r),i,a]})}function QQ(t,e,n,s,r=.001){return Ct(s.slice().sort(),Ei(0,t.rank-1))?XQ(t,e,n,s,r):YQ(t,e,n,s,r)}class CO extends Rt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Tn(e.betaInitializer||"zeros"),this.gammaInitializer=Tn(e.gammaInitializer||"ones"),this.movingMeanInitializer=Tn(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Tn(e.movingVarianceInitializer||"ones"),this.betaConstraint=hs(e.betaConstraint),this.gammaConstraint=hs(e.gammaConstraint),this.betaRegularizer=En(e.betaRegularizer),this.gammaRegularizer=En(e.gammaRegularizer)}build(e){e=Gt(e);const n=this.axis>=0?this.axis:this.axis+e.length,s=e[n];if(s==null)throw new J(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new us({ndim:e.length,axes:{[n]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return ne(()=>{const s=n.training==null?!1:n.training,r=ft(e),o=r.shape,i=o.length,a=Ei(0,i),l=this.axis>=0?this.axis:this.axis+i;a.splice(l,1);const u=Qu(1,i);u[l]=o[l];const c=a.slice();c.sort();const d=!Ct(c,Ei(0,i).slice(0,i-1)),h=()=>{if(d){const x=q(this.movingMean.read(),u),v=q(this.movingVariance.read(),u),b=this.center?q(this.beta.read(),u):null,S=this.scale?q(this.gamma.read(),u):null;return Nf(r,x,v,b,S,this.epsilon)}else return Nf(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return h();const[p,f,m]=QQ(r,this.gamma.read(),this.beta.read(),a,this.epsilon),g=(x,v,b)=>{ne(()=>{const S=1-b,C=x.read(),I=U(Be(C,v),S);x.write(Be(C,I))})};return(()=>{g(this.movingMean,f,this.momentum),g(this.movingVariance,m,this.momentum)})(),p})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Fn(this.betaInitializer),gammaInitializer:Fn(this.gammaInitializer),movingMeanInitializer:Fn(this.movingMeanInitializer),movingVarianceInitializer:Fn(this.movingVarianceInitializer),betaRegularizer:cn(this.betaRegularizer),gammaRegularizer:cn(this.gammaRegularizer),betaConstraint:ds(this.betaConstraint),gammaConstraint:ds(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}CO.className="BatchNormalization";Se(CO);class kO extends Rt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Tn(e.betaInitializer||"zeros"),this.gammaInitializer=Tn(e.gammaInitializer||"ones"),this.betaRegularizer=En(e.betaRegularizer),this.gammaRegularizer=En(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Gt(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=n);for(const o of this.axis)if(o<0||o>=n)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==bl(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>e[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,n){const s=ft(e),r=s.shape,o=r.length;return ne(()=>{let{mean:a,variance:l}=Sw(s,this.axis,!0);const u=Qu(1,o);for(const m of this.axis)u[m]=r[m];const c=m=>m!=null&&m.shape.length!==o?q(m,u):m;let d=this.scale?c(this.gamma.read()):null,h=this.center?c(this.beta.read()):null;const p=[],f=[];for(let m=0;m<o;++m)this.axis.indexOf(m)!==-1?(p.push(r[m]),f.push(1)):(p.push(1),f.push(r[m]));return a=Bo(a,p),l=Bo(l,p),d!=null&&(d=Bo(d,f)),h!=null&&(h=Bo(h,f)),Nf(s,a,l,h,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Fn(this.betaInitializer),gammaInitializer:Fn(this.gammaInitializer),betaRegularizer:cn(this.betaRegularizer),gammaRegularizer:cn(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}kO.className="LayerNormalization";Se(kO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function JQ(t,e,n){return ne(()=>{if(t.rank!==4)throw new J(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new J("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Ri()),n!=="channelsLast"&&n!=="channelsFirst")throw new J(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],$i(t,s)})}class IO extends Rt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Ri():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new J(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,s;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new J(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new J(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[n,s]}this.inputSpec=[new us({ndim:4})]}computeOutputShape(e){e=Gt(e);let n,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],n,s]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],n,s,e[3]])}call(e,n){return ne(()=>JQ(ft(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}IO.className="ZeroPadding2D";Se(IO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function f1(t,e,n,s,r,o){return ne(()=>{Xn(r),VF(o),wo(s),n==null&&(n=[1,1]),s==null&&(s="valid"),r==null&&(r=Ri()),o==null&&(o="max"),t=Vk(t,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=bw(t,e,n,a):i=pw(t,e,n,a),r==="channelsFirst"&&(i=Vt(i,[0,3,1,2])),i})}function $O(t,e,n,s,r,o){return ne(()=>{Xn(r),VF(o),wo(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),r==null&&(r=Ri()),o==null&&(o="max"),t=WP(t,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=w_(t,e,n,a):i=H3(t,e,n,a),r==="channelsFirst"&&(i=Vt(i,[0,4,1,2,3])),i})}class NO extends Rt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new J(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Is(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new J(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Is(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,wo(this.padding),this.inputSpec=[new us({ndim:3})]}computeOutputShape(e){e=Gt(e);const n=Si(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return ne(()=>{this.invokeCallHook(e,n),e=tg(ft(e),2);const s=this.poolingFunction(ft(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Ht(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class TO extends NO{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return Xn(o),wo(r),f1(e,n,s,r,o,"max")}}TO.className="MaxPooling1D";Se(TO);class EO extends NO{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return Xn(o),wo(r),f1(e,n,s,r,o,"avg")}}EO.className="AveragePooling1D";Se(EO);class RO extends Rt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new J(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Is(this.poolSize,"poolSize"),Is(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Xn(this.dataFormat),wo(this.padding),this.inputSpec=[new us({ndim:4})]}computeOutputShape(e){e=Gt(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=Si(n,this.poolSize[0],this.padding,this.strides[0]),s=Si(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s]:[e[0],n,s,e[3]]}call(e,n){return ne(()=>(this.invokeCallHook(e,n),this.poolingFunction(ft(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class DO extends RO{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return Xn(o),wo(r),f1(e,n,s,r,o,"max")}}DO.className="MaxPooling2D";Se(DO);class AO extends RO{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return Xn(o),wo(r),f1(e,n,s,r,o,"avg")}}AO.className="AveragePooling2D";Se(AO);class _O extends Rt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new J(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Is(this.poolSize,"poolSize"),Is(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Xn(this.dataFormat),wo(this.padding),this.inputSpec=[new us({ndim:5})]}computeOutputShape(e){e=Gt(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=Si(n,this.poolSize[0],this.padding,this.strides[0]),s=Si(s,this.poolSize[1],this.padding,this.strides[1]),r=Si(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s,r]:[e[0],n,s,r,e[4]]}call(e,n){return ne(()=>(this.invokeCallHook(e,n),this.poolingFunction(ft(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class FO extends _O{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return Xn(o),wo(r),$O(e,n,s,r,o,"max")}}FO.className="MaxPooling3D";Se(FO);class PO extends _O{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return Xn(o),wo(r),$O(e,n,s,r,o,"avg")}}PO.className="AveragePooling3D";Se(PO);class OO extends Rt{constructor(e){super(e),this.inputSpec=[new us({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new $t}}class LO extends OO{constructor(e){super(e||{})}call(e,n){return ne(()=>{const s=ft(e);return zn(s,1)})}}LO.className="GlobalAveragePooling1D";Se(LO);class zO extends OO{constructor(e){super(e||{})}call(e,n){return ne(()=>{const s=ft(e);return Go(s,1)})}}zO.className="GlobalMaxPooling1D";Se(zO);class MO extends Rt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Xn(this.dataFormat),this.inputSpec=[new us({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new $t}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class BO extends MO{call(e,n){return ne(()=>{const s=ft(e);return this.dataFormat==="channelsLast"?zn(s,[1,2]):zn(s,[2,3])})}}BO.className="GlobalAveragePooling2D";Se(BO);class VO extends MO{call(e,n){return ne(()=>{const s=ft(e);return this.dataFormat==="channelsLast"?Go(s,[1,2]):Go(s,[2,3])})}}VO.className="GlobalMaxPooling2D";Se(VO);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class UO extends Rt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,s={}){const r=n.layer,o=_a(r,s);delete n.layer;const i={layer:o};return Object.assign(i,n),new e(i)}}class WO extends UO{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Gt(e),e.length<3)throw new J(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Gt(e);const n=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(n),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,n){return ne(()=>(e=ft(e),JP((i,a)=>[ft(this.layer.call(i,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}WO.className="TimeDistributed";Se(WO);function ZQ(t){mc(vY,"BidirectionalMergeMode",t)}const eJ="concat";class jO extends UO{constructor(e){super(e);const n=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=n,this.forwardLayer=_a(s),n.goBackwards=n.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=n,this.backwardLayer=_a(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?eJ:e.mergeMode,ZQ(this.mergeMode),e.weights)throw new $t("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,s=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,r,o;return this.returnState&&(o=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):wr(r)}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const o=QP(e,s,r,this.numConstants);if(e=o.inputs,s=o.initialState,r=o.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,n);const i=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new J("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,i.push(...s);const c=s.map(d=>new us({shape:d.shape}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),a.push(...c)}if(r!=null)throw new $t("Support for constants in Bidirectional layers is not implemented yet.");const l=i[0]instanceof la;for(const u of i)if(u instanceof la!==l)throw new J("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(i),c=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=c;const h=super.apply(u,n);return this.inputSpec=d,h}else return super.apply(e,n)}call(e,n){return ne(()=>{const s=n.initialState;let r,o;if(s==null)r=this.forwardLayer.call(e,n),o=this.backwardLayer.call(e,n);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),o=this.backwardLayer.call(e,Object.assign(n,{initialState:u}))}let i;this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=Yo(o,1));let a;return this.mergeMode==="concat"?a=Tk([r,o]):this.mergeMode==="sum"?a=me(r,o):this.mergeMode==="ave"?a=U(.5,me(r,o)):this.mergeMode==="mul"?a=U(r,o):this.mergeMode==null&&(a=[r,o]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Ru(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Ru(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const s=_a(n.layer);if(delete n.layer,n.numConstants!=null)throw new $t("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=n;return r.layer=s,new e(r)}}jO.className="Bidirectional";Se(jO);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class GO extends Rt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return ne(()=>(e=ft(e),e.dtype!=="float32"&&(e=ra(e,"float32")),me(U(e,this.scale),this.offset)))}}GO.className="Rescaling";Se(GO);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:tJ,cropAndResize:nJ}=cr;class HO extends Rt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,s,r,o,i,a,l){return ne(()=>{let u,c=!1;const d=n/i,h=s/a,p=(r+n)/i,f=(o+s)/a,m=[d,h,p,f],g=[];e.rank===3?(c=!0,u=qr([e])):u=e;for(let S=0;S<u.shape[0];S++)g.push(m);const y=bi(g,[g.length,4]),x=Cd(0,g.length,1,"int32"),b=nJ(u,y,x,[r,o],"nearest");return ra(c?ft(Qo(b)):b,l)})}upsize(e,n,s,r){return ne(()=>{const o=tJ(e,[n,s]);return ra(o,r)})}call(e,n){return ne(()=>{const s=ft(e),r=s.dtype,o=s.shape,i=o[o.length-3],a=o[o.length-2];let l=0;i!==this.height&&(l=Math.floor((i-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,i,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=Gt(e);const n=e.length-3,s=e.length-2;return e[n]=this.height,e[s]=this.width,e}}HO.className="CenterCrop";Se(HO);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sJ(t,e,n,s){let r=ft(t);if(r.dtype!=="int32"&&(r=ra(r,"int32")),e==="int")return r;const o=r.shape;if(r.rank===0&&(r=Zn(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=Zn(r,-1)),r.rank>2)throw new J(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${r.rank}.`);const i=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=cS(a,s,n,i):l=cS(a,[],n,i),e!=="tfIdf")return l;if(s)return U(l,s);throw new J("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class KO extends Rt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=Gt(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return ne(()=>{e=ft(e),e.dtype!=="int32"&&(e=ra(e,"int32"));let s;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new J(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);s=ft(n.countWeights)}const r=Go(e),o=wf(e),i=eo(this.numTokens,r).bufferSync().get(0),a=Hl(o,0).bufferSync().get(0);if(!(i&&a))throw new J(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return sJ(e,this.outputMode,this.numTokens,s)})}}KO.className="CategoryEncoding";Se(KO);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const rJ=["bilinear","nearest"],vT=new Set(rJ);class qO extends Rt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(vT.has(e.interpolation))this.interpolation=e.interpolation;else throw new J(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Gt(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return ne(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return cr.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return cr.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...vT]} are supported`)})}}qO.className="Resizing";Se(qO);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class XO{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}XO.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class YO extends Rt{constructor(e){super(e),this.randomGenerator=new XO(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}YO.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const oJ=["bilinear","nearest"],bT=new Set(oJ);class QO extends YO{constructor(e){super(e);const{factor:n,interpolation:s="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new J(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new J(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new J(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(bT.has(s))this.interpolation=s;else throw new J(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=Gt(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return ne(()=>{const s=ft(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=dc([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*r;o=Math.round(o);const i=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return cr.resizeBilinear(e,i);case"nearest":return cr.resizeNearestNeighbor(e,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...bT]} are supported`)}})}}QO.className="RandomWidth";Se(QO);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iJ=re();iJ.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Fr;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(Fr||(Fr={}));var ST;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(ST||(ST={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aJ={};function JO(t){return aJ[t]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $(t,e,n,s,r){const o=e.inputParams[t];if(o&&o.inputIndexStart!==void 0){const a=o.inputIndexStart,l=o.inputIndexEnd===0?void 0:o.inputIndexEnd===void 0?a+1:o.inputIndexEnd,u=a<0?e.inputNames.length+a:a;if(o.type==="tensor")return Fs(e.inputNames[u],n,s,r);if(o.type==="tensors"){const h=e.inputs.slice(a,l);return e.inputNames.slice(a,l).filter((f,m)=>{var g;return((g=h[m])===null||g===void 0?void 0:g.op)!=="NoOp"}).map(f=>Fs(f,n,s,r))}const c=Fs(e.inputNames[u],n,s,r),d=c.dataSync();return o.type==="number"?d[0]:jo(c.shape,d)}const i=e.attrParams[t];return i&&i.value}function Fs(t,e,n,s){const[r,o]=Lr(t,n);if(s!=null){const a=s.getHashTableHandleByName(r);if(a!=null)return a}const i=n.currentContextIds.find(a=>!!e[Nx(r,a)]);return i!==void 0?e[Nx(r,i)][o]:void 0}function CT(t,e,n){return e[Nx(t,n.currentContextId)]}function ka(t,e){const[n,s,r]=Lr(t,e);return[Nx(n,e&&e.currentContextId),s,r]}function Nx(t,e){return e?`${t}-${e}`:t}function Lr(t,e){if(t==="")return["",0,void 0];const n=e!=null&&e.parseNodeNameCache!=null;if(n){const o=e.parseNodeNameCache.get(t);if(o!=null)return o}const s=t.split(":");let r;if(s.length===1)r=[t,0,void 0];else{const o=s[0],i=s.length===3?s[1]:void 0,a=Number(s[s.length-1]);r=[o,a,i]}return n&&e.parseNodeNameCache.set(t,r),r}function ky(t,e,n){let s=$("pad",t,e,n);if(s==="explicit"){s=$("explicitPaddings",t,e,n);const r=[[0,0],[0,0],[0,0],[0,0]];for(let o=0;o<4;o++)r[o][0]=s[o*2],r[o][1]=s[o*2+1];return r}return s}function Ia(t){return t.kept?t:Aa(t)}/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lJ=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],uJ=Object.freeze(Object.defineProperty({__proto__:null,json:lJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cJ=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],dJ=Object.freeze(Object.defineProperty({__proto__:null,json:cJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hJ=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],pJ=Object.freeze(Object.defineProperty({__proto__:null,json:hJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fJ=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],mJ=Object.freeze(Object.defineProperty({__proto__:null,json:fJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gJ=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],yJ=Object.freeze(Object.defineProperty({__proto__:null,json:gJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xJ=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],wJ=Object.freeze(Object.defineProperty({__proto__:null,json:xJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vJ=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],bJ=Object.freeze(Object.defineProperty({__proto__:null,json:vJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SJ=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],CJ=Object.freeze(Object.defineProperty({__proto__:null,json:SJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kJ=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],IJ=Object.freeze(Object.defineProperty({__proto__:null,json:kJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $J=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],NJ=Object.freeze(Object.defineProperty({__proto__:null,json:$J},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TJ=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],EJ=Object.freeze(Object.defineProperty({__proto__:null,json:TJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RJ=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],DJ=Object.freeze(Object.defineProperty({__proto__:null,json:RJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AJ=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],_J=Object.freeze(Object.defineProperty({__proto__:null,json:AJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FJ=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],PJ=Object.freeze(Object.defineProperty({__proto__:null,json:FJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OJ=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],LJ=Object.freeze(Object.defineProperty({__proto__:null,json:OJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zJ=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],MJ=Object.freeze(Object.defineProperty({__proto__:null,json:zJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BJ=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],VJ=Object.freeze(Object.defineProperty({__proto__:null,json:BJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UJ=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],WJ=Object.freeze(Object.defineProperty({__proto__:null,json:UJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jJ=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],GJ=Object.freeze(Object.defineProperty({__proto__:null,json:jJ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kT{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[uJ,dJ,pJ,mJ,yJ,wJ,bJ,CJ,IJ,NJ,EJ,DJ,_J,PJ,LJ,MJ,VJ,WJ,GJ],n=[].concat(...e.map(s=>s.json));this.opMappers=n.reduce((s,r)=>(s[r.tfOpName]=r,s),{})}transformGraph(e,n={}){const s=e.node,r=[],o=[],i=[],a=s.reduce((m,g)=>(m[g.name]=this.mapNode(g),g.op.startsWith("Placeholder")?r.push(m[g.name]):g.op==="Const"?o.push(m[g.name]):(g.input==null||g.input.length===0)&&i.push(m[g.name]),m),{});let l=[];const u=[];let c={},d={};n!=null&&(c=this.mapSignatureEntries(n.inputs),d=this.mapSignatureEntries(n.outputs));const h=Object.keys(a);h.forEach(m=>{const g=a[m];g.inputNames.forEach((y,x)=>{const[v,,b]=ka(y),S=a[v];if(S.outputs!=null){const C=S.outputs.indexOf(b);if(C!==-1){const I=`${v}:${C}`;g.inputNames[x]=I}}g.inputs.push(S),S.children.push(g)})}),Object.keys(d).length===0?h.forEach(m=>{const g=a[m];g.children.length===0&&u.push(g)}):Object.keys(d).forEach(m=>{const[g]=ka(m),y=a[g];y!=null&&(y.signatureKey=d[m],u.push(y))}),Object.keys(c).length>0?Object.keys(c).forEach(m=>{const[g]=ka(m),y=a[g];y&&(y.signatureKey=c[m],l.push(y))}):l=r;let p={};e.library!=null&&e.library.function!=null&&(p=e.library.function.reduce((m,g)=>(m[g.signature.name]=this.mapFunction(g),m),{}));const f={nodes:a,inputs:l,outputs:u,weights:o,placeholders:r,signature:n,functions:p};return i.length>0&&(f.initNodes=i),f}mapSignatureEntries(e){return Object.keys(e||{}).reduce((n,s)=>(n[e[s].name]=s,n),{})}mapNode(e){const n=JO(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const s={name:e.name,op:e.op,category:n.category,inputNames:(e.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:n.outputs};return n.inputs!=null&&(s.inputParams=n.inputs.reduce((r,o)=>(r[o.name]={type:o.type,inputIndexStart:o.start,inputIndexEnd:o.end},r),{})),n.attrs!=null&&(s.attrParams=n.attrs.reduce((r,o)=>{const i=o.type;let a;switch(o.type){case"string":a=IS(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=IS(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"string[]":a=AS(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=AS(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"number":a=NS(e.attr,o.tfName,o.defaultValue||0),a===void 0&&o.tfDeprecatedName&&(a=NS(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"number[]":a=DS(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=DS(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"bool":a=$S(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=$S(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"bool[]":a=FS(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=FS(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"shape":a=RS(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=RS(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"shape[]":a=_S(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=_S(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"dtype":a=TS(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=TS(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"dtype[]":a=ES(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=ES(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"func":a=IT(e.attr,o.tfName,o.defaultValue),a===void 0&&o.tfDeprecatedName&&(a=IT(e.attr,o.tfDeprecatedName,o.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${o.type} for op: ${e.op}`)}return r[o.name]={value:a,type:i},r},{})),s}mapFunction(e){const n=e.nodeDef,s=[],r=[];let o={};n!=null&&(o=n.reduce((d,h)=>(d[h.name]=this.mapNode(h),h.op==="Const"&&r.push(d[h.name]),d),{}));const i=[],a=[];e.signature.inputArg.forEach(d=>{const[h]=ka(d.name),p={name:h,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:Kk(d.type),type:"dtype"}},children:[]};p.signatureKey=d.name,i.push(p),o[h]=p}),Object.keys(o).forEach(d=>{const h=o[d];h.inputNames.forEach((p,f)=>{const[m,,g]=ka(p),y=o[m];if(y.outputs!=null){const x=y.outputs.indexOf(g);if(x!==-1){const v=`${m}:${x}`;h.inputNames[f]=v}}h.inputs.push(y),y.children.push(h)})});const u=e.ret;e.signature.outputArg.forEach(d=>{const[h,p]=ka(u[d.name]),f=o[h];f!=null&&(f.defaultOutput=p,a.push(f))});const c=this.mapArgsToSignature(e);return{nodes:o,inputs:i,outputs:a,weights:r,placeholders:s,signature:c}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s),n),{}),outputs:e.signature.outputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s,e.ret),n),{})}}mapArgToTensorInfo(e,n){let s=e.name;return n!=null&&(s=n[s]),{name:s,dtype:e.type}}}function HJ(t){const e=re().global;if(typeof e.atob<"u")return e.atob(t);if(typeof Buffer<"u")return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function ZO(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):HJ(t);return e?n:n.toLowerCase()}function IS(t,e,n,s=!1){const r=t[e];return r!=null?ZO(r.s,s):n}function $S(t,e,n){const s=t[e];return s?s.b:n}function NS(t,e,n){const s=t[e]||{},r=s.i!=null?s.i:s.f!=null?s.f:n;return typeof r=="number"?r:parseInt(r,10)}function Kk(t){switch(typeof t=="string"&&(t=Fr[t]),t){case Fr.DT_FLOAT:case Fr.DT_HALF:return"float32";case Fr.DT_INT32:case Fr.DT_INT64:case Fr.DT_INT8:case Fr.DT_UINT8:return"int32";case Fr.DT_BOOL:return"bool";case Fr.DT_DOUBLE:return"float32";case Fr.DT_STRING:return"string";case Fr.DT_COMPLEX64:case Fr.DT_COMPLEX128:return"complex64";default:return null}}function IT(t,e,n){const s=t[e];return s&&s.func?s.func.name:n}function TS(t,e,n){const s=t[e];return s&&s.type?Kk(s.type):n}function ES(t,e,n){const s=t[e];return s&&s.list&&s.list.type?s.list.type.map(r=>Kk(r)):n}function eL(t){if(!t.unknownRank)return t.dim!=null?t.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function RS(t,e,n){const s=t[e];return s&&s.shape?eL(s.shape):n}function DS(t,e,n){const s=t[e];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(r=>typeof r=="number"?r:parseInt(r,10)):n}function AS(t,e,n,s=!1){const r=t[e];return r&&r.list&&r.list.s?r.list.s.map(o=>ZO(o,s)):n}function _S(t,e,n){const s=t[e];return s&&s.list&&s.list.shape?s.list.shape.map(r=>eL(r)):n}function FS(t,e,n){const s=t[e];return s&&s.list&&s.list.b?s.list.b:n}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KJ{constructor(e,n,s){this.node=e,this.tensorMap=n,this.context=s,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(r=>this.getInput(r)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((r,o)=>(r[o]=this.getAttr(o),r),{}))}getInput(e){return Fs(e,this.tensorMap,this.context)}getAttr(e,n){const s=this.node.rawAttrs[e];if(s.tensor!=null)return Fs(e,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return NS(this.node.rawAttrs,e,n);if(s.s!=null)return IS(this.node.rawAttrs,e,n);if(s.b!=null)return $S(this.node.rawAttrs,e,n);if(s.shape!=null)return RS(this.node.rawAttrs,e,n);if(s.type!=null)return TS(this.node.rawAttrs,e,n);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return DS(this.node.rawAttrs,e,n);if(s.list.s!=null)return AS(this.node.rawAttrs,e,n);if(s.list.shape!=null)return _S(this.node.rawAttrs,e,n);if(s.list.b!=null)return FS(this.node.rawAttrs,e,n);if(s.list.type!=null)return ES(this.node.rawAttrs,e,n)}return n}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ms=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:S3,abs:is,acos:z3,acosh:M3,add:me,addN:hH,all:E2,any:gx,argMax:Ku,argMin:B3,asin:V3,asinh:U3,atan:W3,atan2:j3,atanh:G3,avgPool:pw,avgPool3d:H3,basicLSTMCell:PH,batchNorm:Gm,batchNorm2d:K3,batchNorm3d:q3,batchNorm4d:X3,batchToSpaceND:fw,bincount:Y3,bitwiseAnd:jH,booleanMaskAsync:$K,broadcastArgs:HH,broadcastTo:ld,buffer:yt,cast:Ee,ceil:Q3,clipByValue:Ir,clone:Aa,complex:Il,concat:Pn,concat1d:J3,concat2d:Z3,concat3d:e_,concat4d:t_,conv1d:D2,conv2d:Tl,conv2dTranspose:_2,conv3d:n_,conv3dTranspose:r_,cos:mw,cosh:F2,cosineWindow:hk,cumprod:yx,cumsum:P2,denseBincount:cS,depthToSpace:o_,depthwiseConv2d:Hm,diag:m6,dilation2d:i_,div:Me,divNoNan:a_,dot:l_,dropout:F_,einsum:Mc,elu:Km,enclosingPowerOfTwo:P_,ensureShape:I6,equal:Ii,erf:O2,euclideanNorm:d_,exp:hr,expandDims:Zn,expm1:h_,eye:z2,fft:Ew,fill:Oh,floor:Xm,floorDiv:T2,fused:qK,gather:Ym,gatherND:OK,greater:eo,greaterEqual:Hl,ifft:Cf,imag:gw,image:cr,inTopKAsync:BK,irfft:ik,isFinite:p_,isInf:f_,isNaN:m_,leakyRelu:yw,less:vf,lessEqual:uc,linalg:W_,linspace:Q6,localResponseNormalization:g_,log:po,log1p:xw,logSigmoid:y_,logSoftmax:M2,logSumExp:ww,logicalAnd:aa,logicalNot:vw,logicalOr:B2,logicalXor:x_,losses:IX,lowerBound:p5,matMul:At,max:Go,maxPool:bw,maxPool3d:w_,maxPoolWithArgmax:y5,maximum:ja,mean:zn,meshgrid:v5,min:wf,minimum:Rl,mirrorPad:U2,mod:v_,moments:Sw,movingAverage:EK,mul:U,multiRNNCell:$5,multinomial:T5,neg:Sn,norm:qm,notEqual:Sd,oneHot:W2,ones:Ur,onesLike:fo,op:G,outerProduct:_5,pad:$i,pad1d:O5,pad2d:z5,pad3d:B5,pad4d:U5,pool:b_,pow:Ba,prelu:kw,print:L3,prod:S_,raggedGather:Y5,raggedRange:J5,raggedTensorToTensor:e8,rand:n8,randomGamma:S8,randomNormal:Q2,randomStandardNormal:I8,randomUniform:dc,randomUniformInt:T8,range:Cd,real:bf,reciprocal:k_,relu:pa,relu6:J2,reshape:q,reverse:Yo,reverse1d:P8,reverse2d:L8,reverse3d:M8,reverse4d:V8,rfft:Rw,round:Z2,rsqrt:ek,scalar:ot,scatterND:DK,searchSorted:V2,selu:tk,separableConv2d:nk,setdiff1dAsync:K8,sigmoid:uo,sign:I_,signal:kX,sin:sk,sinh:rk,slice:pt,slice1d:$w,slice2d:ok,slice3d:Nw,slice4d:Sf,softmax:Tw,softplus:Lh,spaceToBatchND:Cw,sparse:$X,sparseToDense:FK,spectral:CX,split:Hr,sqrt:zs,square:sn,squaredDifference:ak,squeeze:Ht,stack:qr,step:zh,stridedSlice:$_,string:NX,sub:Be,sum:Qe,tan:N_,tanh:Xu,tensor:bi,tensor1d:es,tensor2d:Ho,tensor3d:T_,tensor4d:pK,tensor5d:fK,tensor6d:mK,tensorScatterUpdate:yK,tile:Bo,topk:R_,transpose:Vt,truncatedNormal:uk,unique:D_,unsortedSegmentSum:ck,unstack:Qo,upperBound:CK,variable:A_,where:Hs,whereAsync:__,zeros:Gn,zerosLike:Ut},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qJ=(t,e,n,s=Ms)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[s.add($("a",t,e,n),$("b",t,e,n))];case"AddN":return[s.addN($("tensors",t,e,n))];case"FloorMod":case"Mod":return[s.mod($("a",t,e,n),$("b",t,e,n))];case"Mul":return[s.mul($("a",t,e,n),$("b",t,e,n))];case"RealDiv":case"Div":return[s.div($("a",t,e,n),$("b",t,e,n))];case"DivNoNan":return[s.divNoNan($("a",t,e,n),$("b",t,e,n))];case"FloorDiv":return[s.floorDiv($("a",t,e,n),$("b",t,e,n))];case"Sub":return[s.sub($("a",t,e,n),$("b",t,e,n))];case"Minimum":return[s.minimum($("a",t,e,n),$("b",t,e,n))];case"Maximum":return[s.maximum($("a",t,e,n),$("b",t,e,n))];case"Pow":return[s.pow($("a",t,e,n),$("b",t,e,n))];case"SquaredDifference":return[s.squaredDifference($("a",t,e,n),$("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XJ=(t,e,n,s=Ms)=>{switch(t.op){case"Abs":case"ComplexAbs":return[s.abs($("x",t,e,n))];case"Acos":return[s.acos($("x",t,e,n))];case"Acosh":return[s.acosh($("x",t,e,n))];case"Asin":return[s.asin($("x",t,e,n))];case"Asinh":return[s.asinh($("x",t,e,n))];case"Atan":return[s.atan($("x",t,e,n))];case"Atan2":return[s.atan2($("x",t,e,n),$("y",t,e,n))];case"Atanh":return[s.atanh($("x",t,e,n))];case"Ceil":return[s.ceil($("x",t,e,n))];case"Complex":return[s.complex($("real",t,e,n),$("imag",t,e,n))];case"Cos":return[s.cos($("x",t,e,n))];case"Cosh":return[s.cosh($("x",t,e,n))];case"Elu":return[s.elu($("x",t,e,n))];case"Erf":return[s.erf($("x",t,e,n))];case"Exp":return[s.exp($("x",t,e,n))];case"Expm1":return[s.expm1($("x",t,e,n))];case"Floor":return[s.floor($("x",t,e,n))];case"Log":return[s.log($("x",t,e,n))];case"Log1p":return[s.log1p($("x",t,e,n))];case"Imag":return[s.imag($("x",t,e,n))];case"Neg":return[s.neg($("x",t,e,n))];case"Reciprocal":return[s.reciprocal($("x",t,e,n))];case"Real":return[s.real($("x",t,e,n))];case"Relu":return[s.relu($("x",t,e,n))];case"Round":return[s.round($("x",t,e,n))];case"Selu":return[s.selu($("x",t,e,n))];case"Sigmoid":return[s.sigmoid($("x",t,e,n))];case"Sin":return[s.sin($("x",t,e,n))];case"Sign":return[s.sign($("x",t,e,n))];case"Sinh":return[s.sinh($("x",t,e,n))];case"Softplus":return[s.softplus($("x",t,e,n))];case"Sqrt":return[s.sqrt($("x",t,e,n))];case"Square":return[s.square($("x",t,e,n))];case"Tanh":return[s.tanh($("x",t,e,n))];case"Tan":return[s.tan($("x",t,e,n))];case"ClipByValue":return[s.clipByValue($("x",t,e,n),$("clipValueMin",t,e,n),$("clipValueMax",t,e,n))];case"Relu6":return[s.relu6($("x",t,e,n))];case"Rsqrt":return[s.rsqrt(Fs(t.inputNames[0],e,n))];case"LeakyRelu":return[s.leakyRelu($("x",t,e,n),$("alpha",t,e,n))];case"Prelu":return[s.prelu($("x",t,e,n),$("alpha",t,e,n))];case"IsNan":return[s.isNaN(Fs(t.inputNames[0],e,n))];case"IsInf":return[s.isInf(Fs(t.inputNames[0],e,n))];case"IsFinite":return[s.isFinite(Fs(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ao(t,e,n=""){if(!(typeof t=="number"||typeof e=="number")){A(t.length===e.length,()=>n+` Shapes ${t} and ${e} must match`);for(let s=0;s<t.length;s++){const r=t[s],o=e[s];A(r<0||o<0||r===o,()=>n+` Shapes ${t} and ${e} must match`)}}}function $T(t){return!(typeof t=="number"||t.some(e=>e<0))}function vp(t,e,n){let s=PS(t,n);const r=!$T(s);if(r&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(r&&e.forEach(o=>{s=PS(o.shape,s)}),!$T(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function PS(t,e){if(typeof t=="number")return e;if(typeof e=="number")return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let s=0;s<t.length;++s){const r=t[s],o=e[s];if(r>=0&&o>=0&&r!==o)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[s]=r>=0?r:o}return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YJ{constructor(e,n,s,r,o,i,a){this.name=e,this.dtype=n,this.maxSize=s,this.elementShape=r,this.identicalElementShapes=o,this.dynamicSize=i,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=ot(0),ks(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.tensor.id))&&n.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const n=this.tensors[e];if(n.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(n.cleared=!0),n.read=!0,n.tensor}readMany(e){return e.map(n=>this.read(n))}write(e,n){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const s=this.tensors[e]||{};if(n.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${n.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=n.shape),Ao(this.elementShape,n.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);s.tensor=n,ks(n),s.written=!0,this.tensors[e]=s}writeMany(e,n){if(e.length!==n.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${n.length}.`);e.forEach((s,r)=>this.write(s,n[r]))}gather(e,n){if(n&&n!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${n}`);if(e)e=e.slice(0,this.size());else{e=[];for(let r=0;r<this.size();r++)e.push(r)}if(e.length===0)return bi([],[0].concat(this.elementShape));const s=this.readMany(e);return Ao(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),qr(s,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return bi([],[0].concat(this.elementShape));const n=[];for(let r=0;r<this.size();r++)n.push(r);const s=this.readMany(n);return Ao(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),Pn(s,0)}scatter(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const s=Math.max(...e);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(e,Qo(n,0))}split(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);let s=0;const r=e.map(l=>(s+=l,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const o=s===0?0:n.size/s,i=[];ne(()=>{n=q(n,[1,s,o]);for(let l=0;l<e.length;++l){const c=[0,l===0?0:r[l-1],0],d=[1,e[l],o];i[l]=q(pt(n,c,d),this.elementShape)}return i});const a=[];for(let l=0;l<e.length;l++)a[l]=l;this.writeMany(a,i)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ju{get id(){return this.idTensor.id}constructor(e,n,s,r=-1){this.tensors=e,this.elementShape=n,this.elementDtype=s,e!=null&&e.forEach(o=>{if(s!==o.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${o.dtype}`);Ao(n,o.shape,"TensorList shape mismatch: "),ks(o)}),this.idTensor=ot(0),this.maxNumElements=r,ks(this.idTensor)}copy(){return new Ju([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.id))&&n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,n,s=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);Ao(e,this.elementShape,"TensorList shape mismatch: ");const r=vp(this.elementShape,this.tensors,e);return ne(()=>{const o=this.tensors.map(i=>q(i,r));return qr(o,0)})}popBack(e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const s=vp(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,Ao(r.shape,e,"TensorList shape mismatch: "),q(r,s)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(Ao(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");ks(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const n=new Ju([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=e;for(let s=0;s<Math.min(this.tensors.length,e);++s)n.tensors[s]=this.tensors[s];return n}getItem(e,n,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);Ao(this.tensors[e].shape,n,"TensorList shape mismatch: ");const r=vp(this.elementShape,this.tensors,n);return q(this.tensors[e],r)}setItem(e,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);Ao(this.elementShape,n.shape,"TensorList shape mismatch: "),ks(n),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=n}gather(e,n,s){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);Ao(this.elementShape,s,"TensorList shape mismatch: "),e=e.slice(0,this.size());const r=vp(this.elementShape,this.tensors,s);return e.length===0?bi([],[0].concat(r)):ne(()=>{const o=e.map(i=>q(this.tensors[i],r));return qr(o,0)})}concat(e,n){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);Ao(this.elementShape,n,"TensorList shape mismatch: ");const s=vp(this.elementShape,this.tensors,n);return this.size()===0?bi([],[0].concat(s)):ne(()=>{const r=this.tensors.map(o=>q(o,s));return Pn(r,0)})}}function QJ(t,e,n){const s=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);const r=t.shape.slice(1);Ao(r,e,"TensorList shape mismatch: ");const o=Qo(t);return new Ju(o,e,s)}function JJ(t,e,n,s){return new Ju([],t,e,s)}function ZJ(t,e,n,s){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const r=Math.max(...e);if(s!=null&&s!==-1&&r>=s)throw new Error(`Max index must be < array size (${r}  vs. ${s})`);const o=new Ju([],n,t.dtype,s),i=Qo(t,0);return e.forEach((a,l)=>{o.setItem(a,i[l])}),o}function eZ(t,e,n){let s=0;const r=e.map(c=>(s+=c,s));if(s!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${t.shape}`);const o=t.shape.slice(1),i=PS(o,n),a=s===0?0:t.size/s,l=ne(()=>{const c=[];t=q(t,[1,s,a]);for(let d=0;d<e.length;++d){const p=[0,d===0?0:r[d-1],0],f=[1,e[d],a];c[d]=q(pt(t,p,f),i)}return t.dispose(),c}),u=new Ju([],n,t.dtype,e.length);for(let c=0;c<l.length;c++)u.setItem(c,l[c]);return u}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tZ=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const s=$("thenBranch",t,e,n),r=$("elseBranch",t,e,n),o=$("cond",t,e,n),i=$("args",t,e,n);return(await o.data())[0]?n.functionMap[s].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap):n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const s=$("body",t,e,n),r=$("cond",t,e,n),o=$("args",t,e,n),i=await n.functionMap[r].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap),a=o.map(c=>c.id);let l=await i[0].data();i.forEach(c=>{!c.kept&&a.indexOf(c.id)===-1&&c.dispose()});let u=o;for(;l[0];){const c=u;u=await n.functionMap[s].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);const d=u.map(p=>p.id);c.forEach(p=>{!p.kept&&a.indexOf(p.id)===-1&&d.indexOf(p.id)===-1&&p.dispose()});const h=await n.functionMap[r].executeFunctionAsync(u,n.tensorArrayMap,n.tensorListMap);l=await h[0].data(),h.forEach(p=>{!p.kept&&a.indexOf(p.id)===-1&&d.indexOf(p.id)===-1&&p.dispose()})}return u}case"LoopCond":{const s=$("pred",t,e,n);return[Ia(s)]}case"Switch":{const s=$("pred",t,e,n);let r=$("data",t,e,n);return r.kept||(r=Ia(r)),(await s.data())[0]?[void 0,r]:[r,void 0]}case"Merge":{const s=t.inputNames.find(r=>Fs(r,e,n)!==void 0);if(s){const r=Fs(s,e,n);return[Ia(r)]}return}case"Enter":{const s=$("frameName",t,e,n),r=$("tensor",t,e,n);return n.enterFrame(s),[Ia(r)]}case"Exit":{const s=$("tensor",t,e,n);return n.exitFrame(),[Ia(s)]}case"NextIteration":{const s=$("tensor",t,e,n);return n.nextIteration(),[Ia(s)]}case"TensorArrayV3":{const s=$("size",t,e,n),r=$("dtype",t,e,n),o=$("elementShape",t,e,n),i=$("dynamicSize",t,e,n),a=$("clearAfterRead",t,e,n),l=$("identicalElementShapes",t,e,n),u=$("name",t,e,n),c=new YJ(u,r,s,o,l,i,a);return n.addTensorArray(c),[c.idTensor,ot(1)]}case"TensorArrayWriteV3":{const s=$("tensorArrayId",t,e,n),r=$("index",t,e,n),o=$("tensor",t,e,n),i=n.getTensorArray(s.id);return i.write(r,o),[i.idTensor]}case"TensorArrayReadV3":{const s=$("tensorArrayId",t,e,n),r=$("index",t,e,n);return[n.getTensorArray(s.id).read(r)]}case"TensorArrayGatherV3":{const s=$("tensorArrayId",t,e,n),r=$("indices",t,e,n),o=$("dtype",t,e,n);return[n.getTensorArray(s.id).gather(r,o)]}case"TensorArrayScatterV3":{const s=$("tensorArrayId",t,e,n),r=$("indices",t,e,n),o=$("tensor",t,e,n),i=n.getTensorArray(s.id);return i.scatter(r,o),[i.idTensor]}case"TensorArrayConcatV3":{const s=$("tensorArrayId",t,e,n),r=n.getTensorArray(s.id),o=$("dtype",t,e,n);return[r.concat(o)]}case"TensorArraySplitV3":{const s=$("tensorArrayId",t,e,n),r=$("tensor",t,e,n),o=$("lengths",t,e,n),i=n.getTensorArray(s.id);return i.split(o,r),[i.idTensor]}case"TensorArraySizeV3":{const s=$("tensorArrayId",t,e,n),r=n.getTensorArray(s.id);return[ot(r.size(),"int32")]}case"TensorArrayCloseV3":{const s=$("tensorArrayId",t,e,n),r=n.getTensorArray(s.id);return r.clearAndClose(),[r.idTensor]}case"TensorListSetItem":{const s=$("tensorListId",t,e,n),r=$("index",t,e,n),o=$("tensor",t,e,n),i=n.getTensorList(s.id);return i.setItem(r,o),[i.idTensor]}case"TensorListGetItem":{const s=$("tensorListId",t,e,n),r=$("index",t,e,n),o=$("elementShape",t,e,n),i=$("elementDType",t,e,n);return[n.getTensorList(s.id).getItem(r,o,i)]}case"TensorListScatterV2":case"TensorListScatter":{const s=$("indices",t,e,n),r=$("tensor",t,e,n),o=$("elementShape",t,e,n),i=$("numElements",t,e,n),a=ZJ(r,s,o,i);return n.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const s=$("elementShape",t,e,n),r=$("elementDType",t,e,n);let o;t.op==="TensorListReserve"?o="numElements":o="maxNumElements";const i=$(o,t,e,n),a=t.op==="TensorListReserve"?-1:i,l=JJ(s,r,i,a);return n.addTensorList(l),[l.idTensor]}case"TensorListGather":{const s=$("tensorListId",t,e,n),r=$("indices",t,e,n),o=$("elementShape",t,e,n),i=$("elementDType",t,e,n);return[n.getTensorList(s.id).gather(r,i,o)]}case"TensorListStack":{const s=$("tensorListId",t,e,n),r=$("elementShape",t,e,n),o=$("elementDType",t,e,n),i=$("numElements",t,e,n);return[n.getTensorList(s.id).stack(r,o,i)]}case"TensorListFromTensor":{const s=$("tensor",t,e,n),r=$("elementShape",t,e,n),o=$("elementDType",t,e,n),i=QJ(s,r,o);return n.addTensorList(i),[i.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const s=$("tensorListId",t,e,n),r=n.getTensorList(s.id),o=$("dtype",t,e,n),i=$("elementShape",t,e,n);return[r.concat(o,i)]}case"TensorListPushBack":{const s=$("tensorListId",t,e,n),r=$("tensor",t,e,n),o=n.getTensorList(s.id);return o.pushBack(r),[o.idTensor]}case"TensorListPopBack":{const s=$("tensorListId",t,e,n),r=$("elementShape",t,e,n),o=$("elementDType",t,e,n);return[n.getTensorList(s.id).popBack(r,o)]}case"TensorListSplit":{const s=$("tensor",t,e,n),r=$("elementShape",t,e,n),o=$("lengths",t,e,n),i=eZ(s,o,r);return n.addTensorList(i),[i.idTensor]}case"TensorListLength":{const s=$("tensorListId",t,e,n),r=n.getTensorList(s.id);return[ot(r.size(),"int32")]}case"TensorListResize":{const s=$("tensorListId",t,e,n),r=$("size",t,e,n),i=n.getTensorList(s.id).resize(r);return n.addTensorList(i),[i.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NT(t,e,n){const[s,r]=$("fusedOps",t,e,n),o=s==="biasadd",i=!o,a=r==="prelu",l=s==="fusedbatchnorm",u=$("numArgs",t,e,n);if(o){if(a&&u!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&o&&u!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const c=$("strides",t,e,n),d=ky(t,e,n),h=$("dataFormat",t,e,n).toUpperCase(),p=$("dilations",t,e,n);let[f,m]=$("args",t,e,n);i&&(m=f,f=void 0);const g=$("leakyreluAlpha",t,e,n);return{stride:c,pad:d,dataFormat:h,dilations:p,biasArg:f,preluArg:m,activationFunc:r,leakyreluAlpha:g}}const nZ=(t,e,n,s=Ms)=>{switch(t.op){case"Conv1D":{const r=$("stride",t,e,n),o=$("pad",t,e,n),i=$("dataFormat",t,e,n).toUpperCase(),a=$("dilation",t,e,n);return[s.conv1d($("x",t,e,n),$("filter",t,e,n),r,o,i,a)]}case"Conv2D":{const r=$("strides",t,e,n),o=ky(t,e,n),i=$("dataFormat",t,e,n).toUpperCase(),a=$("dilations",t,e,n);return[s.conv2d($("x",t,e,n),$("filter",t,e,n),[r[1],r[2]],o,i,[a[1],a[2]])]}case"_FusedConv2D":{const{stride:r,pad:o,dataFormat:i,dilations:a,biasArg:l,preluArg:u,activationFunc:c,leakyreluAlpha:d}=NT(t,e,n);return[s.fused.conv2d({x:$("x",t,e,n),filter:$("filter",t,e,n),strides:[r[1],r[2]],pad:o,dataFormat:i,dilations:[a[1],a[2]],bias:l,activation:c,preluActivationWeights:u,leakyreluAlpha:d})]}case"FusedDepthwiseConv2dNative":{const{stride:r,pad:o,dataFormat:i,dilations:a,biasArg:l,preluArg:u,activationFunc:c,leakyreluAlpha:d}=NT(t,e,n);return[s.fused.depthwiseConv2d({x:$("x",t,e,n),filter:$("filter",t,e,n),strides:[r[1],r[2]],pad:o,dataFormat:i,dilations:[a[1],a[2]],bias:l,activation:c,preluActivationWeights:u,leakyreluAlpha:d})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const r=$("outputShape",t,e,n),o=$("strides",t,e,n),i=ky(t,e,n);return[s.conv2dTranspose($("x",t,e,n),$("filter",t,e,n),r,[o[1],o[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const r=$("strides",t,e,n),o=ky(t,e,n),i=$("dilations",t,e,n),a=$("dataFormat",t,e,n).toUpperCase();return[s.depthwiseConv2d($("input",t,e,n),$("filter",t,e,n),[r[1],r[2]],o,a,[i[1],i[2]])]}case"Conv3D":{const r=$("strides",t,e,n),o=$("pad",t,e,n),i=$("dataFormat",t,e,n).toUpperCase(),a=$("dilations",t,e,n);return[s.conv3d($("x",t,e,n),$("filter",t,e,n),[r[1],r[2],r[3]],o,i,[a[1],a[2],a[3]])]}case"AvgPool":{const r=$("strides",t,e,n),o=$("pad",t,e,n),i=$("kernelSize",t,e,n);return[s.avgPool($("x",t,e,n),[i[1],i[2]],[r[1],r[2]],o)]}case"MaxPool":{const r=$("strides",t,e,n),o=$("pad",t,e,n),i=$("kernelSize",t,e,n);return[s.maxPool($("x",t,e,n),[i[1],i[2]],[r[1],r[2]],o)]}case"MaxPoolWithArgmax":{const r=$("strides",t,e,n),o=$("pad",t,e,n),i=$("kernelSize",t,e,n),a=$("includeBatchInIndex",t,e,n),{result:l,indexes:u}=s.maxPoolWithArgmax($("x",t,e,n),[i[1],i[2]],[r[1],r[2]],o,a);return[l,u]}case"AvgPool3D":{const r=$("strides",t,e,n),o=$("pad",t,e,n),i=$("kernelSize",t,e,n);return[s.avgPool3d($("x",t,e,n),[i[1],i[2],i[3]],[r[1],r[2],r[3]],o)]}case"MaxPool3D":{const r=$("strides",t,e,n),o=$("pad",t,e,n),i=$("kernelSize",t,e,n);return[s.maxPool3d($("x",t,e,n),[i[1],i[2],i[3]],[r[1],r[2],r[3]],o)]}case"Dilation2D":{const r=$("strides",t,e,n),o=$("pad",t,e,n),i=$("dilations",t,e,n),a=r[1],l=r[2],u=i[1],c=i[2];return[s.dilation2d($("x",t,e,n),$("filter",t,e,n),[a,l],o,[u,c],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sZ=(t,e,n,s=Ms)=>{switch(t.op){case"Fill":{const r=$("shape",t,e,n),o=$("dtype",t,e,n),i=$("value",t,e,n);return[s.fill(r,i,o)]}case"LinSpace":{const r=$("start",t,e,n),o=$("stop",t,e,n),i=$("num",t,e,n);return[s.linspace(r,o,i)]}case"Multinomial":{const r=$("logits",t,e,n),o=$("numSamples",t,e,n),i=$("seed",t,e,n);return[s.multinomial(r,o,i)]}case"OneHot":{const r=$("indices",t,e,n),o=$("depth",t,e,n),i=$("onValue",t,e,n),a=$("offValue",t,e,n),l=$("dtype",t,e,n);return[s.oneHot(r,o,i,a,l)]}case"Ones":return[s.ones($("shape",t,e,n),$("dtype",t,e,n))];case"OnesLike":return[s.onesLike($("x",t,e,n))];case"RandomStandardNormal":return[s.randomStandardNormal($("shape",t,e,n),$("dtype",t,e,n),$("seed",t,e,n))];case"RandomUniform":return[s.randomUniform($("shape",t,e,n),$("minval",t,e,n),$("maxval",t,e,n),$("dtype",t,e,n))];case"RandomUniformInt":return[s.randomUniformInt($("shape",t,e,n),$("minval",t,e,n),$("maxval",t,e,n),$("seed",t,e,n))];case"Range":{const r=$("start",t,e,n),o=$("stop",t,e,n),i=$("step",t,e,n);return[s.range(r,o,i,$("dtype",t,e,n))]}case"TruncatedNormal":{const r=$("shape",t,e,n),o=$("mean",t,e,n),i=$("stdDev",t,e,n),a=$("seed",t,e,n);return[s.truncatedNormal(r,o,i,$("dtype",t,e,n),a)]}case"Zeros":return[s.zeros($("shape",t,e,n),$("dtype",t,e,n))];case"ZerosLike":return[s.zerosLike($("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rv(t,e,n){const s=$("boxes",t,e,n),r=$("scores",t,e,n),o=$("maxOutputSize",t,e,n),i=$("iouThreshold",t,e,n),a=$("scoreThreshold",t,e,n),l=$("softNmsSigma",t,e,n);return{boxes:s,scores:r,maxOutputSize:o,iouThreshold:i,scoreThreshold:a,softNmsSigma:l}}const rZ=async(t,e,n,s,r=Ms)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:o,scores:i,maxOutputSize:a,iouThreshold:l,scoreThreshold:u,softNmsSigma:c}=Rv(t,e,n),d=await r.image.nonMaxSuppressionWithScoreAsync(o,i,a,l,u,c);return[d.selectedIndices,d.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:o,scores:i,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=Rv(t,e,n),c=$("padToMaxOutputSize",t,e,n),d=await r.image.nonMaxSuppressionPaddedAsync(o,i,a,l,u,c);return[d.selectedIndices,d.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:o,scores:i,maxOutputSize:a,iouThreshold:l,scoreThreshold:u}=Rv(t,e,n);return[await r.image.nonMaxSuppressionAsync(o,i,a,l,u)]}case"Where":{const o=r.cast($("condition",t,e,n),"bool"),i=[await r.whereAsync(o)];return o.dispose(),i}case"ListDiff":return r.setdiff1dAsync($("x",t,e,n),$("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oZ=(t,e,n,s=Ms)=>{switch(t.op){case"LowerBound":{const r=$("sortedSequence",t,e,n),o=$("values",t,e,n);return[s.lowerBound(r,o)]}case"TopKV2":{const r=$("x",t,e,n),o=$("k",t,e,n),i=$("sorted",t,e,n),a=s.topk(r,o,i);return[a.values,a.indices]}case"UpperBound":{const r=$("sortedSequence",t,e,n),o=$("values",t,e,n);return[s.upperBound(r,o)]}case"Unique":{const r=$("x",t,e,n),o=s.unique(r);return[o.values,o.indices]}case"UniqueV2":{const r=$("x",t,e,n),o=$("axis",t,e,n),i=s.unique(r,o);return[i.values,i.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iZ=(t,e,n,s=Ms)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const r=$("default",t,e,n);return[Fs(t.name,e,n)||r];case"Placeholder":return[Fs(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const c=$("x",t,e,n);return[Ia(c)]}case"IdentityN":return $("x",t,e,n).map(c=>Ia(c));case"Snapshot":const o=$("x",t,e,n);return[Ia(o)];case"Shape":return[s.tensor1d($("x",t,e,n).shape,"int32")];case"ShapeN":return $("x",t,e,n).map(c=>s.tensor1d(c.shape));case"Size":return[s.scalar($("x",t,e,n).size,"int32")];case"Rank":return[s.scalar($("x",t,e,n).rank,"int32")];case"NoOp":return[s.scalar(1)];case"Print":const i=$("x",t,e,n),a=$("data",t,e,n),l=$("message",t,e,n),u=$("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(let c=0;c<a.length;c++)console.log(Array.prototype.slice.call(a[c].dataSync()).slice(0,u));return[i];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aZ{get id(){return this.handle.id}constructor(e,n){this.keyDType=e,this.valueDType=n,this.handle=ot(0),this.tensorMap=new Map,ks(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return ot(this.size(),"int32")}async import(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),ne(()=>{const r=Qo(n),o=s.length,i=r.length;A(o===i,()=>`The number of elements doesn't match, keys has ${o} elements, the values has ${i} elements.`);for(let a=0;a<o;a++){const l=s[a],u=r[a];ks(u),this.tensorMap.set(l,u)}return this.handle})}async find(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return ne(()=>{const r=[];for(let o=0;o<s.length;o++){const i=s[o],a=this.findWithDefault(i,n);r.push(a)}return qr(r)})}findWithDefault(e,n){const s=this.tensorMap.get(e);return s??n}checkKeyAndValueTensor(e,n){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(n.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${n.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lZ=async(t,e,n,s)=>{switch(t.op){case"HashTable":case"HashTableV2":{const r=s.getHashTableHandleByName(t.name);if(r!=null)return[r];{const o=$("keyDType",t,e,n),i=$("valueDType",t,e,n),a=new aZ(o,i);return s.addHashTable(t.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{const r=$("tableHandle",t,e,n,s),o=$("keys",t,e,n),i=$("values",t,e,n);return[await s.getHashTableById(r.id).import(o,i)]}case"LookupTableFind":case"LookupTableFindV2":{const r=$("tableHandle",t,e,n,s),o=$("keys",t,e,n),i=$("defaultValue",t,e,n);return[await s.getHashTableById(r.id).find(o,i)]}case"LookupTableSize":case"LookupTableSizeV2":{const r=$("tableHandle",t,e,n,s);return[s.getHashTableById(r.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uZ=(t,e,n,s=Ms)=>{switch(t.op){case"ResizeBilinear":{const r=$("images",t,e,n),o=$("size",t,e,n),i=$("alignCorners",t,e,n),a=$("halfPixelCenters",t,e,n);return[s.image.resizeBilinear(r,[o[0],o[1]],i,a)]}case"ResizeNearestNeighbor":{const r=$("images",t,e,n),o=$("size",t,e,n),i=$("alignCorners",t,e,n),a=$("halfPixelCenters",t,e,n);return[s.image.resizeNearestNeighbor(r,[o[0],o[1]],i,a)]}case"CropAndResize":{const r=$("image",t,e,n),o=$("boxes",t,e,n),i=$("boxInd",t,e,n),a=$("cropSize",t,e,n),l=$("method",t,e,n),u=$("extrapolationValue",t,e,n);return[s.image.cropAndResize(r,o,i,a,l,u)]}case"ImageProjectiveTransformV3":{const r=$("images",t,e,n),o=$("transforms",t,e,n),i=$("outputShape",t,e,n),a=$("fillValue",t,e,n),l=$("interpolation",t,e,n),u=$("fillMode",t,e,n);return[s.image.transform(r,o,l.toLowerCase(),u.toLowerCase(),a,i)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cZ=(t,e,n,s=Ms)=>{switch(t.op){case"Equal":return[s.equal($("a",t,e,n),$("b",t,e,n))];case"NotEqual":return[s.notEqual($("a",t,e,n),$("b",t,e,n))];case"Greater":return[s.greater($("a",t,e,n),$("b",t,e,n))];case"GreaterEqual":return[s.greaterEqual($("a",t,e,n),$("b",t,e,n))];case"Less":return[s.less($("a",t,e,n),$("b",t,e,n))];case"LessEqual":return[s.lessEqual($("a",t,e,n),$("b",t,e,n))];case"LogicalAnd":return[s.logicalAnd($("a",t,e,n),$("b",t,e,n))];case"LogicalNot":return[s.logicalNot($("a",t,e,n))];case"LogicalOr":return[s.logicalOr($("a",t,e,n),$("b",t,e,n))];case"Select":case"SelectV2":return[s.where($("condition",t,e,n),$("a",t,e,n),$("b",t,e,n))];case"BitwiseAnd":return[s.bitwiseAnd($("a",t,e,n),$("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dZ=(t,e,n,s=Ms)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[s.matMul($("a",t,e,n),$("b",t,e,n),$("transposeA",t,e,n),$("transposeB",t,e,n))];case"Einsum":return[s.einsum($("equation",t,e,n),...$("tensors",t,e,n))];case"Transpose":return[s.transpose($("x",t,e,n),$("perm",t,e,n))];case"_FusedMatMul":const[r,o]=$("fusedOps",t,e,n),i=r==="biasadd",a=o==="prelu",l=$("numArgs",t,e,n),u=$("leakyreluAlpha",t,e,n);if(i){if(a&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[c,d]=$("args",t,e,n);return[s.fused.matMul({a:$("a",t,e,n),b:$("b",t,e,n),transposeA:$("transposeA",t,e,n),transposeB:$("transposeB",t,e,n),bias:c,activation:o,preluActivationWeights:d,leakyreluAlpha:u})];case"MatrixBandPart":return[s.linalg.bandPart($("a",t,e,n),$("numLower",t,e,n),$("numUpper",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hZ=(t,e,n,s=Ms)=>{switch(t.op){case"EuclideanNorm":return[s.euclideanNorm($("x",t,e,n),$("axis",t,e,n),$("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":return[s.batchNorm($("x",t,e,n),$("mean",t,e,n),$("variance",t,e,n),$("offset",t,e,n),$("scale",t,e,n),$("epsilon",t,e,n))];case"FusedBatchNormV3":return[s.batchNorm($("x",t,e,n),$("mean",t,e,n),$("variance",t,e,n),$("offset",t,e,n),$("scale",t,e,n),$("epsilon",t,e,n))];case"LRN":return[s.localResponseNormalization($("x",t,e,n),$("radius",t,e,n),$("bias",t,e,n),$("alpha",t,e,n),$("beta",t,e,n))];case"Softmax":return[s.softmax($("x",t,e,n))];case"LogSoftmax":return[s.logSoftmax($("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pZ=(t,e,n,s=Ms)=>{switch(t.op){case"RaggedGather":{const{outputNestedSplits:r,outputDenseValues:o}=s.raggedGather($("paramsNestedSplits",t,e,n),$("paramsDenseValues",t,e,n),$("indices",t,e,n),$("outputRaggedRank",t,e,n));return r.concat(o)}case"RaggedRange":{const{rtNestedSplits:r,rtDenseValues:o}=s.raggedRange($("starts",t,e,n),$("limits",t,e,n),$("splits",t,e,n));return[r,o]}case"RaggedTensorToTensor":return[s.raggedTensorToTensor($("shape",t,e,n),$("values",t,e,n),$("defaultValue",t,e,n),$("rowPartitionTensors",t,e,n),$("rowPartitionTypes",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fZ=(t,e,n,s=Ms)=>{switch(t.op){case"Max":{const a=$("axis",t,e,n),l=$("keepDims",t,e,n);return[s.max($("x",t,e,n),a,l)]}case"Mean":{const a=$("axis",t,e,n),l=$("keepDims",t,e,n);return[s.mean($("x",t,e,n),a,l)]}case"Min":{const a=$("axis",t,e,n),l=$("keepDims",t,e,n);return[s.min($("x",t,e,n),a,l)]}case"Sum":{const a=$("axis",t,e,n),l=$("keepDims",t,e,n);return[s.sum($("x",t,e,n),a,l)]}case"All":{const a=$("axis",t,e,n),l=$("keepDims",t,e,n);return[s.all($("x",t,e,n),a,l)]}case"Any":{const a=$("axis",t,e,n),l=$("keepDims",t,e,n);return[s.any($("x",t,e,n),a,l)]}case"ArgMax":{const a=$("axis",t,e,n);return[s.argMax($("x",t,e,n),a)]}case"ArgMin":{const a=$("axis",t,e,n);return[s.argMin($("x",t,e,n),a)]}case"Prod":{const a=$("axis",t,e,n),l=$("keepDims",t,e,n);return[s.prod($("x",t,e,n),a,l)]}case"Cumprod":{const a=$("axis",t,e,n),l=$("exclusive",t,e,n),u=$("reverse",t,e,n);return[s.cumprod($("x",t,e,n),a,l,u)]}case"Cumsum":{const a=$("axis",t,e,n),l=$("exclusive",t,e,n),u=$("reverse",t,e,n);return[s.cumsum($("x",t,e,n),a,l,u)]}case"Bincount":const r=$("x",t,e,n),o=$("weights",t,e,n),i=$("size",t,e,n);return[s.bincount(r,o,i)];case"DenseBincount":{const a=$("x",t,e,n),l=$("weights",t,e,n),u=$("size",t,e,n),c=$("binaryOutput",t,e,n);return[s.denseBincount(a,l,u,c)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mZ=(t,e,n,s=Ms)=>{switch(t.op){case"ConcatV2":case"Concat":{const r=$("n",t,e,n),o=$("axis",t,e,n);let i=$("tensors",t,e,n);return i=i.slice(0,r),[s.concat(i,o)]}case"Gather":{const r=$("x",t,e,n),o=$("indices",t,e,n);return[s.gather(r,s.cast(o,"int32"),0)]}case"GatherV2":{const r=$("axis",t,e,n),o=$("batchDims",t,e,n),i=$("x",t,e,n),a=$("indices",t,e,n);return[s.gather(i,s.cast(a,"int32"),r,o)]}case"Reverse":{const r=$("dims",t,e,n),o=[];for(let a=0;a<r.length;a++)r[a]&&o.push(a);const i=$("x",t,e,n);return[s.reverse(i,o)]}case"ReverseV2":{const r=$("axis",t,e,n),o=$("x",t,e,n);return[s.reverse(o,r)]}case"Slice":{const r=$("begin",t,e,n),o=$("size",t,e,n);return[s.slice($("x",t,e,n),r,o)]}case"StridedSlice":{const r=$("begin",t,e,n),o=$("end",t,e,n),i=$("strides",t,e,n),a=$("beginMask",t,e,n),l=$("endMask",t,e,n),u=$("ellipsisMask",t,e,n),c=$("newAxisMask",t,e,n),d=$("shrinkAxisMask",t,e,n),h=$("x",t,e,n);return[s.stridedSlice(h,r,o,i,a,l,u,c,d)]}case"Pack":return ne(()=>{const r=$("axis",t,e,n),o=$("tensors",t,e,n),i=o[0].shape,a=s.squeeze(o[0]).shape,l=o.map(u=>{const c=Ct(u.shape,i);if(!c&&!Ct(s.squeeze(u).shape,a))throw new Error("the input tensors shape does not match");return c?u:s.reshape(u,i)});return[s.stack(l,r)]});case"Unpack":{const r=$("axis",t,e,n),o=$("tensor",t,e,n);return s.unstack(o,r)}case"Tile":{const r=$("reps",t,e,n);return[s.tile($("x",t,e,n),r)]}case"Split":case"SplitV":{const r=$("axis",t,e,n),o=$("numOrSizeSplits",t,e,n),i=$("x",t,e,n);return s.split(i,o,r)}case"ScatterNd":{const r=$("indices",t,e,n),o=$("values",t,e,n),i=$("shape",t,e,n);return[s.scatterND(r,o,i)]}case"GatherNd":{const r=$("x",t,e,n),o=$("indices",t,e,n);return[s.gatherND(r,o)]}case"SparseToDense":{const r=$("sparseIndices",t,e,n),o=$("outputShape",t,e,n),i=$("sparseValues",t,e,n),a=$("defaultValue",t,e,n);return[s.sparseToDense(r,i,o,i.dtype===a.dtype?a:s.cast(a,i.dtype))]}case"TensorScatterUpdate":{const r=$("indices",t,e,n),o=$("values",t,e,n),i=$("tensor",t,e,n);return[s.tensorScatterUpdate(i,r,o)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gZ=(t,e,n,s=Ms)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:r,outputValues:o,emptyRowIndicator:i,reverseIndexMap:a}=s.sparse.sparseFillEmptyRows($("indices",t,e,n),$("values",t,e,n),$("denseShape",t,e,n),$("defaultValue",t,e,n));return[r,o,i,a]}case"SparseReshape":{const{outputIndices:r,outputShape:o}=s.sparse.sparseReshape($("inputIndices",t,e,n),$("inputShape",t,e,n),$("newShape",t,e,n));return[r,o]}case"SparseSegmentMean":return[s.sparse.sparseSegmentMean($("data",t,e,n),$("indices",t,e,n),$("segmentIds",t,e,n))];case"SparseSegmentSum":return[s.sparse.sparseSegmentSum($("data",t,e,n),$("indices",t,e,n),$("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yZ=(t,e,n,s=Ms)=>{switch(t.op){case"FFT":return[s.fft($("x",t,e,n))];case"IFFT":return[s.ifft($("x",t,e,n))];case"RFFT":return[s.rfft($("x",t,e,n))];case"IRFFT":return[s.irfft($("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xZ=(t,e,n,s=Ms)=>{switch(t.op){case"StaticRegexReplace":return[s.string.staticRegexReplace($("input",t,e,n),$("pattern",t,e,n),$("rewrite",t,e,n),$("replaceGlobal",t,e,n))];case"StringNGrams":{const{nGrams:r,nGramsSplits:o}=s.string.stringNGrams($("data",t,e,n),$("dataSplits",t,e,n),$("separator",t,e,n),$("nGramWidths",t,e,n),$("leftPad",t,e,n),$("rightPad",t,e,n),$("padWidth",t,e,n),$("preserveShortSequences",t,e,n));return[r,o]}case"StringSplit":{const{indices:r,values:o,shape:i}=s.string.stringSplit($("input",t,e,n),$("delimiter",t,e,n),$("skipEmpty",t,e,n));return[r,o,i]}case"StringToHashBucketFast":return[s.string.stringToHashBucketFast($("input",t,e,n),$("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wZ=(t,e,n,s=Ms)=>{switch(t.op){case"Cast":return[s.cast($("x",t,e,n),$("dtype",t,e,n))];case"ExpandDims":{const r=$("axis",t,e,n);return[s.expandDims($("x",t,e,n),r)]}case"Squeeze":{const r=$("axis",t,e,n);return[s.squeeze($("x",t,e,n),r)]}case"Reshape":return[s.reshape($("x",t,e,n),$("shape",t,e,n))];case"EnsureShape":return[s.ensureShape($("x",t,e,n),$("shape",t,e,n))];case"MirrorPad":return[s.mirrorPad($("x",t,e,n),$("padding",t,e,n),$("mode",t,e,n))];case"PadV2":case"Pad":return[s.pad($("x",t,e,n),$("padding",t,e,n),$("constantValue",t,e,n))];case"SpaceToBatchND":{const r=$("blockShape",t,e,n),o=$("paddings",t,e,n);return[s.spaceToBatchND($("x",t,e,n),r,o)]}case"BatchToSpaceND":{const r=$("blockShape",t,e,n),o=$("crops",t,e,n);return[s.batchToSpaceND($("x",t,e,n),r,o)]}case"DepthToSpace":{const r=$("blockSize",t,e,n),o=$("dataFormat",t,e,n).toUpperCase();return[s.depthToSpace($("x",t,e,n),r,o)]}case"BroadcastTo":return[s.broadcastTo($("x",t,e,n),$("shape",t,e,n))];case"BroadcastArgs":return[s.broadcastArgs($("s0",t,e,n),$("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TT(t,e,n,s,r=ne){const o=((i,a,l)=>{switch(i.category){case"arithmetic":return r(()=>qJ(i,a,l));case"basic_math":return r(()=>XJ(i,a,l));case"control":return tZ(i,a,l);case"convolution":return r(()=>nZ(i,a,l));case"creation":return r(()=>sZ(i,a,l));case"dynamic":return rZ(i,a,l);case"evaluation":return r(()=>oZ(i,a,l));case"image":return r(()=>uZ(i,a,l));case"graph":return r(()=>iZ(i,a,l));case"logical":return r(()=>cZ(i,a,l));case"matrices":return r(()=>dZ(i,a,l));case"normalization":return r(()=>hZ(i,a,l));case"ragged":return r(()=>pZ(i,a,l));case"reduction":return r(()=>fZ(i,a,l));case"slice_join":return r(()=>mZ(i,a,l));case"sparse":return r(()=>gZ(i,a,l));case"spectral":return r(()=>yZ(i,a,l));case"string":return r(()=>xZ(i,a,l));case"transformation":return r(()=>wZ(i,a,l));case"hash_table":return lZ(i,a,l,s);case"custom":const u=JO(i.op);if(u&&u.customExecutor)return u.customExecutor(new KJ(i,a,l));throw TypeError(`Custom op ${i.op} is not registered.`);default:throw TypeError(`Unknown op '${i.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return Uu(o)?o.then(i=>[].concat(i)):[].concat(o)}class ET{constructor(e={},n={},s={},r={},o){this.weightMap=e,this.tensorArrayMap=n,this.tensorListMap=s,this.functionMap=r,this.parseNodeNameCache=o,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,n){return{id:e,frameName:n,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let n=0;n<this.contexts.length-1;n++){const s=this.contexts.slice(0,this.contexts.length-n);e.push(this.contextIdforContexts(s))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(n=>n.id===0&&n.iterationId===0?"":`${n.frameName}-${n.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const n in this.tensorArrayMap)this.tensorArrayMap[n].clearAndClose(e);for(const n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RT(t,e,n,s){const r=new Set,o=[];let i=null,a=null;const l=new Set,u=new Set(Object.keys(t).map(h=>Lr(h)[0]));s=s||[];const c=new Set(s.map(h=>Lr(h.name)[0])),d=[...e];for(;d.length>0;){const h=d.pop();if((fu(h)||NZ(h)||TZ(h))&&i==null&&(i=h,a=i.children.map(p=>p.name).filter(p=>r.has(p))),r.add(h.name),n[h.name]==null&&!u.has(h.name)&&!c.has(h.name)){if(h.inputs.length===0){o.push(h.name);continue}h.inputs.forEach(p=>{l.has(p.name)||(l.add(p.name),d.push(p))})}}return{inputs:t,outputs:e,usedNodes:r,missingInputs:o,dynamicNode:i,syncInputs:a}}function vZ(t,e){const{usedNodes:n,inputs:s}=e,r=Object.keys(s).map(g=>Lr(g)[0]).map(g=>t.nodes[g]),o=t.initNodes||[],i=g=>n.has(typeof g=="string"?g:g.name);function a(g){return[...new Map(g.map(y=>[y.name,y])).values()]}const l=a([...r,...t.weights,...o]).filter(i),u=a([...l,...Object.values(t.nodes)]).filter(i),c=new Map(u.map(g=>[g.name,g])),d={};for(const g of u){d[g.name]=d[g.name]||0;for(const y of g.children)i(y)||(d[y.name]=Number.POSITIVE_INFINITY),d[y.name]=(d[y.name]||0)+1}const h=Object.entries(d).filter(([,g])=>g===0).map(([g])=>g),p=[...h];for(;h.length>0;){const g=h.pop(),y=c.get(g);for(const x of y.children.filter(i))--d[x.name]===0&&(p.push(x.name),h.push(x.name))}const f=p.map(g=>c.get(g)),m=bZ(f,l);return SZ(m,l),m}function bZ(t,e){const n=new Map(t.map(i=>[i.name,i])),s=e.map(i=>i.name),r=new Set(s);for(;s.length>0;){const i=s.pop(),a=n.get(i);for(const l of a.children)!n.has(l.name)||r.has(l.name)||(r.add(l.name),s.push(l.name))}return t.filter(i=>r.has(i.name))}class Qg extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}}function SZ(t,e){const n=new Map(t.map((a,l)=>[a.name,l])),s=new Set(e.map(a=>a.name)),r=a=>s.has(typeof a=="string"?a:a.name),o=new Set(t.map(a=>a.name)),i=a=>o.has(typeof a=="string"?a:a.name);for(const a of t){for(const l of a.children.filter(i)){if(!n.has(l.name))throw new Qg(`Child ${l.name} of node ${a.name} is unreachable.`);if(n.get(a.name)>n.get(l.name))throw new Qg(`Node ${a.name} is scheduled to run after its child ${l.name}.`)}if(!r(a))for(const l of a.inputs){if(!n.has(l.name))throw new Qg(`Input ${l.name} of node ${a.name} is unreachable.`);if(n.get(l.name)>n.get(a.name))throw new Qg(`Node ${a.name} is scheduled to run before its input ${l.name}.`)}}}function CZ(t){const e=new Map(t.map((a,l)=>[a.name,l])),n=Number.MAX_SAFE_INTEGER,s=t.map((a,l)=>fu(a)?n:l),r=a=>{const l=s[e.get(a.name)];return l??-1},o=t.map((a,l)=>a.children.map(r).reduce((u,c)=>Math.max(u,c),s[l])),i=new Map;for(let a=0;a<t.length;++a){const l=o[a];if(l===n)continue;const u=t[a],c=t[l];i.has(c.name)||i.set(c.name,[]),i.get(c.name).push(u)}return i}const kZ=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),IZ=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),$Z=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function fu(t){return kZ.has(t.op)}function NZ(t){return IZ.has(t.op)}function TZ(t){return $Z.has(t.op)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tx{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const n=Object.keys(e).map(s=>e[s].map(r=>r.id));this._weightIds=[].concat(...n),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const n=e.signatureKey||e.name;return e.defaultOutput?`${n}:${e.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((e,n)=>(e[n]=this._functions[n].signature,e),{})}constructor(e,n){this.graph=e,this.parent=n,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(s=>{this._functionExecutorMap[s]=new Tx(e.functions[s],this)})}getCompilationKey(e,n){const s=e.map(o=>o.name).sort(),r=n.map(o=>o.name).sort();return s.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}compile(e,n){const s=RT(e,n,this.weightMap,this._initNodes),{missingInputs:r,dynamicNode:o,syncInputs:i}=s;if(o!=null)throw new Error(`This execution contains the node '${o.name}', which has the dynamic op '${o.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${i}]`);if(r.length>0){const u=n.map(d=>d.name),c=Object.keys(e);throw new Error(`Cannot compute the outputs [${u}] from the provided inputs [${c}]. Missing the following inputs: [${r}]`)}const a=vZ(this.graph,s),l=CZ(a);return{orderedNodes:a,nodeLiveUntilMap:l}}cloneAndKeepTensor(e){if(e==null)return null;const n=e.clone();return ks(n),n}cloneTensorList(e){return e?e.map(s=>this.cloneAndKeepTensor(s)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([n,s])=>[n,this.cloneTensorList(s)]))}execute(e,n){this.disposeIntermediateTensors(),e=this.mapInputs(e);const s=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n);const r=s.map(h=>this.graph.nodes[Lr(h)[0]]),o=n.map(h=>Lr(h)[0]),i=new Set(o);let a=o.map(h=>this.graph.nodes[h]);a.length===0&&(a=this._outputs);const l=this.getCompilationKey(r,a);let u=this.compiledMap.get(l);u==null&&(u=this.compile(e,a),this.compiledMap.set(l,u));try{this.keepIntermediateTensors=re().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(h){this.keepIntermediateTensors=!1,console.warn(h.message)}const c={},d={};return ne(()=>{const h=new ET(this.weightMap,c,d,this.functionExecutorMap,this.parseNodeNameCache),p=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(y=>{const[x,v]=Lr(y,h),b=[];b[v]=e[y],p[x]=b,this.keepIntermediateTensors&&(this.clonedTensorsMap[x]=this.cloneTensorList(b))});const f=this.getFrozenTensorIds(p),{orderedNodes:m,nodeLiveUntilMap:g}=u;for(const y of m){if(p[y.name])continue;const x=TT(y,p,h,this._resourceManager);if(Uu(x))throw new Error(`The execution of the op '${y.op}' returned a promise. Please use model.executeAsync() instead.`);p[y.name]=x,this.keepIntermediateTensors&&(this.clonedTensorsMap[y.name]=this.cloneTensorList(x)),this.checkTensorForDisposalWithNodeLiveUntilInfo(y,p,h,f,i,g.get(y.name))}return this.parent==null&&h.dispose(f),n.map(y=>Fs(y,p,h))})}getFrozenTensorIds(e){const n=[].concat.apply([],Object.keys(e).map(s=>e[s]).map(s=>s.map(r=>r.id)));return new Set(n)}checkTensorForDisposal(e,n,s,r,o,i,a){if(!(fu(n)||i.has(e))){for(const l of s[e])l!=null&&(a[l.id]=(a[l.id]||0)+n.children.length);for(const l of n.inputs){if(fu(l))continue;const u=CT(l.name,s,r);if(u!=null)for(const c of u){if(!c||c.kept||o.has(c.id))continue;const d=a[c.id];d===1?(c.dispose(),delete a[c.id]):d!=null&&a[c.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,n,s,r,o,i){function a(l){return fu(l)||o.has(l.name)}if(!(fu(e)||i==null))for(const l of i){if(a(l))continue;const u=CT(l.name,n,s);for(const c of u)!c||c.kept||r.has(c.id)||c.dispose()}}async executeAsync(e,n){return this._executeAsync(e,n)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(const n of e)n&&!n.isDisposed&&n.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(e,n,s=!1,r={},o={}){this.disposeIntermediateTensors(),s||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=re().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(h){this.keepIntermediateTensors=!1,console.warn(h.message)}const i=new ET(this.weightMap,r,o,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));const a=await this.executeWithControlFlow(e,i,n,s),l=n.map(h=>Fs(h,a,i)),u=l.map(h=>h.id),c=Object.keys(e).map(h=>e[h].id),d=new Set([...u,...c,...this.weightIds]);return Object.values(a).forEach(h=>{h.forEach(p=>{p&&!p.isDisposed&&!d.has(p.id)&&p.dispose()})}),this.parent==null&&i.dispose(d),l}async executeFunctionAsync(e,n,s){const r=e.reduce((o,i,a)=>(o[this.inputs[a].name]=i,o),{});return this._executeAsync(r,this.outputNodes,!0,n,s)}async executeWithControlFlow(e,n,s,r){const o=Object.keys(e),i=o.map(b=>this.graph.nodes[Lr(b)[0]]),a=s.map(b=>Lr(b)[0]),l=new Set(a);let u=a.map(b=>this.graph.nodes[b]);u.length===0&&(u=this._outputs);const{usedNodes:c,missingInputs:d,dynamicNode:h,syncInputs:p}=RT(e,u,this.weightMap,this._initNodes),f=[...i,...this.graph.weights,...this._initNodes||[]].map(b=>({node:b,contexts:n.currentContext})),m=Object.assign({},this.weightMap);Object.keys(e).forEach(b=>{const[S,C]=Lr(b),I=[];I[C]=e[b],m[S]=I});const g={},y=this.getFrozenTensorIds(m),x={};for(;f.length>0;){const b=this.processStack(i,f,n,m,x,y,l,g,c);await Promise.all(b)}h==null&&!r&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const v=u.filter(b=>!fu(b)&&!Fs(b.name,m,n)).map(b=>b.name);if(v.length>0){let b="";throw h!=null&&(b=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${p}]`),new Error(`Cannot compute the outputs [${v}] from the provided inputs [${o}]. Consider providing the following inputs: [${d}]. ${b}`)}return m}processStack(e,n,s,r,o,i,a,l,u){const c=[];for(;n.length>0;){const d=n.pop();s.currentContext=d.contexts;let h="";if(d.node.op==="Enter"&&$("isConstant",d.node,r,s)&&([h]=ka(d.node.name,s)),r[d.node.name]==null){const p=TT(d.node,r,s,this._resourceManager);h||([h]=ka(d.node.name,s));const f=s.currentContext;Uu(p)?c.push(p.then(m=>(r[h]=m,this.keepIntermediateTensors&&(this.clonedTensorsMap[h]=this.cloneTensorList(m)),s.currentContext=f,this.checkTensorForDisposal(h,d.node,r,s,i,a,l),this.processChildNodes(d.node,n,s,r,o,u),m))):(r[h]=p,this.keepIntermediateTensors&&(this.clonedTensorsMap[h]=this.cloneTensorList(p)),this.checkTensorForDisposal(h,d.node,r,s,i,a,l),this.processChildNodes(d.node,n,s,r,o,u))}else this.processChildNodes(d.node,n,s,r,o,u)}return c}processChildNodes(e,n,s,r,o,i){e.children.forEach(a=>{const[l]=ka(a.name,s);o[l]||!i.has(a.name)||(a.op==="Merge"?a.inputNames.some(u=>!!Fs(u,r,s))&&(o[l]=!0,n.push({contexts:s.currentContext,node:a})):a.inputNames.every(u=>!!Fs(u,r,s))&&(o[l]=!0,n.push({contexts:s.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(n=>n.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(n=>{const s=e[n],[r]=Lr(n),o=this.graph.nodes[r];if(o.attrParams.shape&&o.attrParams.shape.value){const i=o.attrParams.shape.value,a=i.length===s.shape.length&&s.shape.every((l,u)=>i[u]===-1||i[u]===l);A(a,()=>`The shape of dict['${o.name}'] provided in model.execute(dict) must be [${i}], but was [${s.shape}]`)}o.attrParams.dtype&&o.attrParams.dtype.value&&A(s.dtype===o.attrParams.dtype.value,()=>`The dtype of dict['${o.name}'] provided in model.execute(dict) must be ${o.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(e){var n,s;const r={};for(const o in e){const i=(s=(n=this._signature)===null||n===void 0?void 0:n.inputs)===null||s===void 0?void 0:s[o];i!=null?r[i.name]=e[o]:r[o]=e[o]}return r}checkInputs(e){const n=Object.keys(e).filter(s=>{const[r]=Lr(s);return this.graph.nodes[r]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(e){return e.map(n=>{var s,r;const o=(r=(s=this._signature)===null||s===void 0?void 0:s.outputs)===null||r===void 0?void 0:r[n];return o!=null?o.name:n},{})}checkOutputs(e){e.forEach(n=>{const[s]=Lr(n);if(!this.graph.nodes[s])throw new Error(`The output '${n}' is not found in the graph`)})}}class EZ{constructor(e={},n={}){this.hashTableNameToHandle=e,this.hashTableMap=n}addHashTable(e,n){this.hashTableNameToHandle[e]=n.handle,this.hashTableMap[n.id]=n}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RZ="?tfjs-format=file",DZ="model.json";class AZ{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,n={},s=tF){this.modelUrl=e,this.loadOptions=n,this.version="n/a",this.io=s,n==null&&(this.loadOptions={}),this.resourceManager=new EZ}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const n=this.io.getLoadHandlers(e,this.loadOptions);if(n.length===0)n.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(n.length>1)throw new Error(`Found more than one (${n.length}) load handlers for URL '${[e]}'`);this.handler=n[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return Uu(e)?e.then(n=>n.getWeightStream==null?this.loadSync(n):this.loadStreaming(n)):this.loadSync(e)}loadSync(e){const n=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,n)}async loadStreaming(e){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");const n=await I3(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,n)}loadWithWeightMap(e,n){this.artifacts=e;const s=this.artifacts.modelTopology;let r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const o=this.artifacts.userDefinedMetadata;o.signature!=null&&(r=o.signature),o.structuredOutputKeys!=null&&(this.structuredOutputKeys=o.structuredOutputKeys)}if(this.signature=r,this.version=`${s.versions.producer}.${s.versions.minConsumer}`,this.executor=new Tx(kT.Instance.transformGraph(s,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(n),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const o=kT.Instance.transformGraph(e.modelInitializer);this.initializer=new Tx(o),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,n){if(typeof e=="string"){const s=this.io.getSaveHandlers(e);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${e}'`);e=s[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){const n=e instanceof Qt?[e]:e,s={};return n.forEach((r,o)=>s[this.structuredOutputKeys[o]]=r),s}return e}predict(e,n){const s=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(s)}async predictAsync(e,n){const s=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(s)}normalizeInputs(e){var n;if(!(e instanceof Qt)&&!Array.isArray(e)){const o=(n=this.signature)===null||n===void 0?void 0:n.inputs;if(o!=null)for(const i in o){const a=o[i];a.resourceId!=null&&(e[i]=this.resourceIdToCapturedInput[a.resourceId])}return e}e=Array.isArray(e)?e:[e];const s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-s} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce((o,i)=>{var a,l,u;const c=(u=(l=(a=this.signature)===null||a===void 0?void 0:a.inputs)===null||l===void 0?void 0:l[i])===null||u===void 0?void 0:u.resourceId;return c!=null?o[i]=this.resourceIdToCapturedInput[c]:o[i]=e[r++],o},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){const n=this.initializerSignature.outputs,s=Object.keys(n);for(let r=0;r<s.length;r++){const o=s[r],i=n[o];this.resourceIdToCapturedInput[i.resourceId]=e[r]}}}execute(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=this.executor.execute(e,n);return s.length>1?s:s[0]}async executeAsync(e,n){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=await this.executor.executeAsync(e,n);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((n,s)=>(n[s]=[e[s]],n),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&lt(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}async function Id(t,e={},n=tF){if(t==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof t=="string"&&(t=_Z(t));const s=new AZ(t,e,n);return await s.load(),s}function _Z(t){return t.endsWith("/")||(t=t+"/"),`${t}${DZ}${RZ}`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var DT;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(DT||(DT={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Je(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&A(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FZ=dk;class m1 extends p0{nextDataId(){return m1.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new a2(this,rr())}write(e,n,s){this.firstUse&&(this.firstUse=!1,re().get("IS_NODE")&&oo(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&Md(s[0])){const o=s.map(i=>Da(i));r=this.write(o,e,n)}else r=this.write(s,e,n);return{dataId:r,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,s,r,o){this.data.set(e,{values:n,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:s}=this.data.get(e);if(n==="complex64"){const r=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return Ni(r,o)}return by(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>ki(r));return yt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return yt(e.shape,e.dtype,n)}makeOutput(e,n,s){return rr().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=xr();return e(),{kernelMs:xr()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Je([e],"where");const n=this.readSync(e.dataId);return FZ(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}m1.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tL(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const PZ=t=>{const{x:e}=t.inputs,n=t.backend;Je(e,"abs");let s=new Float32Array(te(e.shape));const r=n.data.get(e.dataId).values;return s=tL(r),n.makeOutput(s,e.shape,e.dtype)},OZ={kernelName:Wf,backendName:"cpu",kernelFunc:PZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yn(t){return(e,n,s,r,o)=>{const i=ct(e,n),a=i.length,l=st(i),u=te(i),c=ps(o,u),d=e.length,h=n.length,p=st(e),f=st(n),m=El(e,i),g=El(n,i);if(m.length+g.length===0)for(let y=0;y<c.length;++y)c[y]=t(s[y%s.length],r[y%r.length]);else for(let y=0;y<c.length;++y){const x=Bd(y,a,l),v=x.slice(-d);m.forEach(I=>v[I]=0);const b=sa(v,d,p),S=x.slice(-h);g.forEach(I=>S[I]=0);const C=sa(S,h,f);c[y]=t(s[b],r[C])}return[c,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mr(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,o=n.data.get(s.dataId).values,i=n.data.get(r.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",o),imag:n.makeTensorInfo(r.shape,"float32",i)},a}const LZ={kernelName:b0,backendName:"cpu",kernelFunc:Mr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ex(t,e,n="float32"){if(n==="complex64"){const r=Ex(t,e,"float32"),o=Ex(t,e,"float32");return Mr({inputs:{real:r,imag:o},backend:t})}const s=Ls(te(e),n);return t.makeTensorInfo(e,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ua(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const zZ={kernelName:ah,backendName:"cpu",kernelFunc:ua};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zu(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.real,o=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,o)}const MZ={kernelName:X0,backendName:"cpu",kernelFunc:Zu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nL(t,e,n,s){if(s==="int32"){const r=Int32Array.from(t);return[e,"int32",r]}if(s==="bool"){const r=lc([0],n),[o,i]=Yn((a,l)=>a!==l?1:0)(e,[],t,r,"bool");return[i,"bool",o]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function Pl(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return ua({inputs:{x:r},backend:n});const c=Ex(n,r.shape,r.dtype),d=Pl({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),h=Mr({inputs:{real:d,imag:c},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),h}if(r.dtype==="complex64"){const c=Zu({inputs:{input:r},backend:n}),d=Pl({inputs:{x:c},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(c),d}if(!c2(r.dtype,o)){const c=ua({inputs:{x:r},backend:n});return{dataId:c.dataId,shape:c.shape,dtype:o}}const i=n.data.get(r.dataId).values,[a,l,u]=nL(i,r.shape,r.dtype,o);return n.makeTensorInfo(a,l,u)}const BZ={kernelName:qd,backendName:"cpu",kernelFunc:Pl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gs(t,e,n,s){return n==null?({inputs:r,backend:o})=>{const{a:i,b:a}=r,l=o;Je([i,a],t);const u=l.data.get(i.dataId).values,c=l.data.get(a.dataId).values,d=i.dtype==="string"?Ti(u):u,h=i.dtype==="string"?Ti(c):c,p=s||i.dtype,[f,m]=e(i.shape,a.shape,d,h,p);return l.makeTensorInfo(m,p,f)}:({inputs:r,backend:o})=>{const{a:i,b:a}=r,l=o;if(i.dtype==="complex64"||a.dtype==="complex64"){const u=Pl({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),c=l.data.get(u.dataId),d=c.complexTensorInfos.real,h=c.complexTensorInfos.imag,p=l.data.get(d.dataId).values,f=l.data.get(h.dataId).values,m=Pl({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(m.dataId),y=g.complexTensorInfos.real,x=g.complexTensorInfos.imag,v=l.data.get(y.dataId).values,b=l.data.get(x.dataId).values,[S,C,I]=n(i.shape,a.shape,p,f,v,b),T=l.makeTensorInfo(I,"float32",S),R=l.makeTensorInfo(I,"float32",C),_=Mr({inputs:{real:T,imag:R},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo(T),l.disposeIntermediateTensorInfo(R),_}else{const u=l.data.get(i.dataId).values,c=l.data.get(a.dataId).values,d=s||i.dtype,[h,p]=e(i.shape,a.shape,u,c,d);return l.makeTensorInfo(p,d,h)}}}function qk(t){return(e,n,s,r,o,i)=>{const a=ct(e,n),l=te(a),u=a.length,c=st(a),d=ps("float32",l),h=ps("float32",l),p=El(e,a),f=El(n,a),m=Ni(s,r),g=Ni(o,i),y=e.length,x=st(e),v=n.length,b=st(n);if(p.length+f.length===0)for(let S=0;S<d.length;S++){const C=S%m.length,I=S%g.length,T=t(m[C*2],m[C*2+1],g[I*2],g[I*2+1]);d[S]=T.real,h[S]=T.imag}else for(let S=0;S<d.length;S++){const C=Bd(S,u,c),I=C.slice(-y);p.forEach(z=>I[z]=0);const T=sa(I,y,x),R=C.slice(-v);f.forEach(z=>R[z]=0);const _=sa(R,v,b),P=t(m[T*2],m[T*2+1],g[_*2],g[_*2+1]);d[S]=P.real,h[S]=P.imag}return[d,h,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sL=Yn((t,e)=>t+e),VZ=qk((t,e,n,s)=>({real:t+n,imag:e+s})),$d=gs(ic,sL,VZ),UZ={kernelName:ic,backendName:"cpu",kernelFunc:$d};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xk(t,e,n,s,r){const o=te(s),i=Ls(r,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(o>0?i[l]+=e[a]:i[l]+=1)}return i}function rL(t,e,n,s=!1){const r=t.shape[0],o=t.shape[1],i=yt([r,n],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<o;l++){const u=t.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=n||(s?i.set(1,a,u):e.size>0?i.set(i.get(a,u)+e.get(a,l),a,u):i.set(i.get(a,u)+1,a,u))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oL=Yn((t,e)=>t&e),WZ=gs(w0,oL),jZ={kernelName:w0,backendName:"cpu",kernelFunc:WZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ma(t){return(e,n,s)=>{const r=Mn(n,e.length);for(let o=0;o<e.length;++o)r[o]=t(e[o],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tn(t,e,n){const s=ma(e);return Xl(t,s,n)}function Xl(t,e,n){return({inputs:s,attrs:r,backend:o})=>{const{x:i}=s;Je(i,t);const a=o,l=a.data.get(i.dataId).values;let u;if(i.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=Ti(l)}else u=l;const c=n||i.dtype,d=e(u,c,r);return a.makeTensorInfo(i.shape,c,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iL=ma(t=>Math.ceil(t)),GZ=Xl(Xd,iL),HZ={kernelName:Xd,backendName:"cpu",kernelFunc:GZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aL(t,e,n,s){const r=Mn(n,te(e));if(s&&n!=="string"){let o=0;t.forEach(i=>{const a=te(i.shape);r.set(i.vals,o),o+=a})}else{let o=0;t.forEach(i=>{const a=n==="string"?Ti(i.vals):i.vals;let l=0;for(let u=0;u<i.shape[0];++u){const c=u*e[1]+o;for(let d=0;d<i.shape[1];++d)r[c+d]=a[l++]}o+=i.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lL=Yn((t,e)=>t===e?1:0),uL=gs(om,lL,null,"bool"),KZ={kernelName:om,backendName:"cpu",kernelFunc:uL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cL=ma(t=>Math.exp(t)),dL=Xl(nh,cL,"float32"),qZ={kernelName:nh,backendName:"cpu",kernelFunc:dL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hL=ma(t=>Math.expm1(t)),XZ=Xl(sh,hL),YZ={kernelName:sh,backendName:"cpu",kernelFunc:XZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pL=ma(t=>Math.floor(t)),QZ=Xl(rh,pL),JZ={kernelName:rh,backendName:"cpu",kernelFunc:QZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fL=Yn((t,e)=>Math.floor(t/e)),ZZ=gs(oh,fL,null,"int32"),eee={kernelName:oh,backendName:"cpu",kernelFunc:ZZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mL(t,e,n,s,r,o,i,a,l){const u=yt([s,o],n);for(let c=0;c<s;c++){const d=[];let h=0;for(let p=0;p<r;p++){const f=t[c*r+p];h+=f*i[p],d.push(f)}if(h<0||h>=l/o)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let p=0;p<o;p++)u.values[c*o+p]=e.get(...e.indexToLoc(h*o+p))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gL(t,e,n){const s=yt(n,t.dtype);for(let r=0;r<s.size;++r){const i=s.indexToLoc(r).slice(),a=i[0],l=i[2],u=e.locToIndex([a,l]);i[2]=e.values[u];const c=t.locToIndex(i);0<=c&&c<t.values.length&&(s.values[r]=t.values[c])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yL=Yn((t,e)=>t>e?1:0),tee=gs(um,yL,null,"bool"),nee={kernelName:um,backendName:"cpu",kernelFunc:tee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xL=Yn((t,e)=>t>=e?1:0),see=gs(ih,xL,null,"bool"),ree={kernelName:ih,backendName:"cpu",kernelFunc:see};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wL=Yn((t,e)=>t<e?1:0),oee=gs(dm,wL,null,"bool"),iee={kernelName:dm,backendName:"cpu",kernelFunc:oee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vL=Yn((t,e)=>t<=e?1:0),aee=gs(hm,vL,null,"bool"),lee={kernelName:hm,backendName:"cpu",kernelFunc:aee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bL(t,e,n){const s=(e-t)/(n-1),r=Ls(n,"float32");r[0]=t;for(let o=1;o<r.length;o++)r[o]=r[o-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SL=ma(t=>Math.log(t)),uee=Xl(dh,SL),cee={kernelName:dh,backendName:"cpu",kernelFunc:uee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CL(t,e,n,s){const r=ps(s,te(n));for(let o=0;o<r.length;++o){const i=o*e;let a=t[i];for(let l=0;l<e;++l){const u=t[i+l];(Number.isNaN(u)||u>a)&&(a=u)}r[o]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kL=Yn((t,e)=>Math.max(t,e)),dee=gs(ph,kL),hee={kernelName:ph,backendName:"cpu",kernelFunc:dee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IL=Yn((t,e)=>Math.min(t,e)),pee=gs(fh,IL),fee={kernelName:fh,backendName:"cpu",kernelFunc:pee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yk=Yn((t,e)=>t*e),mee=qk((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n})),g1=gs(gh,Yk,mee),gee={kernelName:gh,backendName:"cpu",kernelFunc:g1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $L(t,e,n){const s=Ul(-1,n);return Yk([],e,s,t,n)}function yee(t){const{inputs:e,backend:n}=t,{x:s}=e;Je(s,"neg");const r=n.data.get(s.dataId).values,[o,i]=$L(r,s.shape,s.dtype);return n.makeTensorInfo(i,s.dtype,o)}const xee={kernelName:Cm,backendName:"cpu",kernelFunc:yee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NL=Yn((t,e)=>t!==e?1:0),wee=gs(km,NL,null,"bool"),vee={kernelName:km,backendName:"cpu",kernelFunc:wee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qk(t,e,n,s,r){const o=e.length,i=te(e),a=st(e),l=st(r),u=ps(n,te(r));for(let c=0;c<i;++c){const d=Bd(c,o,a),h=new Array(d.length);for(let f=0;f<h.length;f++)h[f]=d[s[f]];const p=sa(h,o,l);u[p]=t[c]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $r(t){const{inputs:e,attrs:n,backend:s}=t,{x:r}=e,{perm:o}=n;Je(r,"transpose");const i=r.shape.length,a=new Array(i);for(let d=0;d<a.length;d++)a[d]=r.shape[o[d]];const l=s.data.get(r.dataId).values,u=Qk(l,r.shape,r.dtype,o,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const bee={kernelName:Eu,backendName:"cpu",kernelFunc:$r};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TL(t,e,n,s){const[r,o]=qn(t,s),i=$s(e,"int32"),a=Ls(te(r),i),l=te(o);for(let u=0;u<a.length;++u){const c=u*l;let d=1;for(let h=0;h<l;++h)d*=n[c+h];a[u]=d}return{outVals:a,outShape:r,outDtype:i}}function See(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;Je(r,"prod");const a=r.shape.length,l=xt(o,r.shape),u=an(l,a);let c=l,d=r;const h=[];u!=null&&(d=$r({inputs:{x:r},backend:n,attrs:{perm:u}}),h.push(d),c=yn(c.length,a));const p=n.data.get(d.dataId).values,{outVals:f,outShape:m,outDtype:g}=TL(d.shape,d.dtype,p,c);let y=m;return i&&(y=Wn(m,l)),h.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(y,g,f)}const Cee={kernelName:Rm,backendName:"cpu",kernelFunc:See};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kee(t,e,n){t.forEach((s,r)=>{if(s<0||s>=n){const o=Bd(r,e.length,st(e)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${n})`)}})}function Iee(t,e){for(let n=0;n<t.length;++n){const s=t[n],r=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function $ee(t,e,n,s){const r=[];let o=0;const i=e.length-1+n.length,a=new Array(i).fill(null).map(()=>[0]);Iee(n,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const c=e[u+1];for(let d=1;d<l+1;++d)a[u].push(d*c)}for(let u=0;u<t.length;++u){let c=t[u],d=t[u]+1;for(let h=0;h<n.length;++h){const p=n[h],f=h+e.length-1;if(f>=0){const m=a[f],g=m[m.length-1]-p[c];for(let y=c;y<d;++y)a[f].push(p[y+1]+g)}c=p[c],d=p[d]}d!==c&&(r.push([c,d]),o+=d-c)}return{outSplits:a,valueSlices:r,numValues:o}}function Nee(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,r=Mn("int32",s);e.push(r),t[n].forEach((o,i)=>r[i]=o)}return e}function AT(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function Tee(t,e,n,s,r,o){const i=AT(e,2)[1],a=AT(o,2)[1];let l=0;for(const u of n)for(let c=u[0];c<u[1];++c){for(let d=0;d<s;++d)r[l*a+d]=t[c*i+d];++l}}function Eee(t,e,n,s,r){const o=e.slice();o[0]=r;const i=Mn(n,te(o)),a=t.length,l=a===0?0:a/e[0];return Tee(t,e,s,l,i,o),[i,o]}function EL(t,e,n,s,r,o,i,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(kee(o,i,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:c,valueSlices:d,numValues:h}=$ee(o,i,t,u),p=Nee(c),f=Eee(n,s,r,d,h);return[p,f[0],f[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _T=2147483647;function RL(t,e,n,s,r,o,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=i.length===0,c=[];a||c.push(e[0]),l||c.push(r[0]),u||c.push(i[0]);for(let g=1;g<c.length;++g)if(c[g]!==c[g-1])throw new Error("starts, limits, and deltas must have the same shape");const d=c.length===0?1:c[0],h=Mn("int32",d+1);h[0]=0;for(let g=0;g<d;++g){const y=a?t[0]:t[g],x=l?s[0]:s[g],v=u?o[0]:o[g];if(v===0)throw new Error("Requires delta != 0");let b;if(v>0&&x<y||v<0&&x>y)b=0;else if(b=Math.ceil(Math.abs((x-y)/v)),b>_T)throw new Error(`Requires ((limit - start) / delta) <= ${_T}`);h[g+1]=h[g]+b}const p=h[d],f=Mn(n,p);let m=0;for(let g=0;g<d;++g){const y=h[g+1]-h[g];let x=a?t[0]:t[g];const v=u?o[0]:o[g];for(let b=0;b<y;++b)f[m++]=x,x+=v}return[h,f]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Eo=gi;class Rx{constructor(e,n,s,r,o,i,a,l,u,c){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=r,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=pF(c),this.raggedRank=fF(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Eo.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Eo.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Eo.VALUE_ROWIDS:return Rx.getMaxWidthValueRowID(n);case Eo.ROW_SPLITS:return Rx.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${Eo[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let r=0;r<n-1;++r){const o=e[r+1]-e[r];o>s&&(s=o)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,r=e[0],o=0;for(let i=1;i<n;++i){const a=e[i];a!==r&&(r=a,o=Math.max(i-s,o),s=i)}return Math.max(n-s,o)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return PT(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;mF(s,n);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=hF(this.raggedRank,r,n);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,n,s){const r=Math.min(e,s),o=[];let i=0;for(let a=0;a<r;++a,i+=n)o.push(i);for(let a=r;a<e;++a)o.push(-1);return A(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,n,s,r){const o=e.length,i=[];for(let a=0;a<o-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),c=n[a];c===-1&&(u=0);for(let d=0;d<u;++d)i.push(c),c+=s;for(let d=0;d<l-u;++d)i.push(-1)}if(o>0&&i.length!==e[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,n,s,r){const o=e.length,i=[];if(o===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let u=n[l];i.push(u);for(let c=1;c<o;++c){const d=e[c];if(d===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=d,d>=n.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${n.length}`);u=n[d]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,n,s,r){const o=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case Eo.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,n,s,r);case Eo.ROW_SPLITS:if(o.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(o,n,s,r);default:throw new Error(`Unsupported partition type: ${Eo[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case Eo.FIRST_DIM_SIZE:return e[0];case Eo.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Eo.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Eo[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const o=PT(s,!1),i=Mn(this.valuesDType,te(o));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(n,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,i,o)}return[o,i]}setOutput(e,n,s,r){if(s.length===0)return;const o=this.values,i=s;let a=r.slice();a=a.slice(e+1);const l=te(a),u=n.length;let c=this.defaultValue;if(c.length!==l&&c.length!==1){const f=this.defaultValueShape;ne(()=>{const m=q(c,f);c=ld(m,a).dataSync()})}let d=0,h=0,p=0;for(let f=0;f<=u;++f){let m=f<u?n[f]:-1;if(m===p){++p;continue}if(h<p){const g=o.subarray(d*l),y=i.subarray(h*l),x=(p-h)*l;FT(y,g,x)}if(f>=u){const g=s.length;m=Math.floor(g/l)}if(m>p)if(this.defaultValue.length===1)i.subarray(p*l,m*l).fill(this.defaultValue[0]),p=m;else for(;m>p;){const g=i.slice(p*l);FT(g,c,l),++p}m<0?(d=f+1,h=p):(d=f,h=p,p=h+1)}}}function FT(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function PT(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function DL(t,e,n,s,r,o,i,a,l,u){return new Rx(t,e,n,s,r,o,i,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AL(t,e,n,s){const r=t===e,o=t<e&&n<0,i=e<t&&n>1;if(r||o||i)return Ls(0,s);const a=Math.abs(Math.ceil((e-t)/n)),l=Ls(a,s);e<t&&n===1&&(n=-1),l[0]=t;for(let u=1;u<l.length;u++)l[u]=l[u-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _L=ma(t=>1/Math.sqrt(t)),Ree=Xl(Sh,_L),Dee={kernelName:Sh,backendName:"cpu",kernelFunc:Ree};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ku(t,e,n,s,r,o,i,a,l,u){const c=[s/r,r],d=t.values,h=e.values;if(s===0)return yt(n,e.dtype);const p=l instanceof cs?l:yt(c,e.dtype);typeof l=="string"||typeof l=="number"?p.values.fill(l):typeof l=="boolean"&&p.values.fill(+l);for(let f=0;f<o;f++){const m=[];let g=0;for(let y=0;y<i;y++){const x=d[f*i+y];m.push(x),g+=x*a[y]}if(g<0||g>=s/r)throw new Error(`Invalid indices: ${m} does not index into ${n}`);for(let y=0;y<r;y++)u?p.values[g*r+y]+=h[f*r+y]:p.values[g*r+y]=e.rank===0?h[0]:h[f*r+y]}return p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aee=ma(t=>1/(1+Math.exp(-t))),FL=tn(Nh,t=>1/(1+Math.exp(-t))),_ee={kernelName:Nh,backendName:"cpu",kernelFunc:FL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PL(t,e,n,s,r){const o=vk(s,e,n),i=te(n),a=st(s);if(o){const d=bk(e,a);return r==="string"?t.slice(d,d+i):t.subarray(d,d+i)}const l=r==="string"?Ti(t):t,u=yt(s,r,l),c=yt(n,r);for(let d=0;d<c.size;++d){const h=c.indexToLoc(d),p=h.map((f,m)=>f+e[m]);c.set(u.get(...p),...h)}return r==="string"?FF(c.values):c.values}function ec(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,size:i}=s;Je(r,"slice");const[a,l]=Qm(r,o,i);zw(r,a,l);const u=n.data.get(r.dataId).values,c=PL(u,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,c)}const Fee={kernelName:Om,backendName:"cpu",kernelFunc:ec};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OL(t,e,n,s,r,o,i){const a=e[0],l=o[0],u=new Array(l),c=new Array(a),d=e[1];if(l===0){if(a!==0)throw new Error(SF(a));const g=Mn(n,0),y=Mn(r,0);return[g,[0,d],y,u,c]}let h=!0,p=0;const f=new Array(l).fill(0);for(let g=0;g<a;++g){const y=t[g*d];if(y<0)throw new Error(CF(g,y));if(y>=l)throw new Error(kF(g,y,l));++f[y],h=h&&y>=p,p=y}let m=!0;for(let g=0;g<l;++g){const y=f[g]===0;u[g]=y,m=m&&!y,f[g]=Math.max(f[g],1),g>0&&(f[g]+=f[g-1])}if(m&&h){const g=t,y=s;for(let x=0;x<a;++x)c[x]=x;return[g,[a,d],y,u,c]}else{const g=f[l-1],y=Mn(n,g*d),x=Mn(r,g),v=new Array(l).fill(0);for(let b=0;b<a;++b){const S=t[b*d],C=v[S],I=(S===0?0:f[S-1])+C;v[S]++;for(let T=0;T<d;++T)y[I*d+T]=t[b*d+T];x[I]=s[b],c[b]=I}for(let b=0;b<l;++b)if(v[b]===0){const C=b===0?0:f[b-1];y[C*d+0]=b;for(let I=1;I<d;++I)y[C*d+I]=0;x[C]=i}return[y,[g,d],x,u,c]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LL(t,e,n,s,r){const o=te(s),i=e[0],a=r.length,l=[];let u=1,c=-1;for(let g=0;g<a;++g){const y=r[g];if(y===-1){if(c!==-1)throw new Error(IF(c,g));c=g,l.push(1)}else{if(y<0)throw new Error($F(g,y));u*=y,l.push(y)}}if(c!==-1){if(u<=0)throw new Error(NF());const g=Math.trunc(o/u);if(u*g!==o)throw new Error(TF(s,l));l[c]=g}if(te(l)!==o)throw new Error(EF(s,l));const h=s.length,p=[];if(h>0){p[h-1]=1;for(let g=h-2;g>=0;--g)p[g]=p[g+1]*s[g+1]}const f=[];if(a>0){f[a-1]=1;for(let g=a-2;g>=0;--g)f[g]=f[g+1]*l[g+1]}const m=Mn(n,i*a);for(let g=0;g<i;++g){let y=0;for(let x=0;x<h;++x)y+=t[g*h+x]*p[x];for(let x=0;x<a;++x)m[g*a+x]=Math.trunc(y/f[x]),y%=f[x]}return[m,[i,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jk(t,e,n,s,r,o=!1,i=0){const a=s.length,l=[e[0],t.length/e[0]],u=l[1],d=a>0?r[a-1]+1:0;if(d<0)throw new Error(fS());const h=e.slice();h[0]=d;const p=h.reduce((v,b)=>v*b,1),f=Mn(n,p);if(a===0)return d>0&&f.fill(i),[f,h];if(d<=0)throw new Error(fS());let m=0,g=1,y=0,x=r[m];for(;;){let v=0;if(g<a){if(v=r[g],x===v){++g;continue}if(x>=v)throw new Error(RF())}if(x<0||x>=d)throw new Error(DF(x,d));x>y&&f.fill(i,y*u,x*u);for(let b=m;b<g;++b){const S=s[b];if(S<0||S>=l[0])throw new Error(AF(b,s[b],l[0]));for(let C=0;C<u;C++)f[x*u+C]+=t[S*u+C]}if(o)for(let b=0;b<u;b++)f[x*u+b]/=g-m;if(m=g,++g,y=x+1,x=v,g>a)break}return y<d&&f.fill(i,y*u,d*u),[f,h]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pee=ma(t=>Math.sqrt(t)),Oee=tn(Eh,t=>Math.sqrt(t)),Lee={kernelName:Eh,backendName:"cpu",kernelFunc:Oee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zL=Yn((t,e)=>{const n=t-e;return n*n}),zee=gs(Rh,zL),Mee={kernelName:Rh,backendName:"cpu",kernelFunc:zee};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ML=ma((t,e)=>{const{pattern:n,replaceGlobal:s,rewrite:r}=e;return t.replace(new RegExp(n,s?"g":""),r)}),Bee=Xl(ow,ML),Vee={kernelName:ow,backendName:"cpu",kernelFunc:Bee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BL(t,e,n,s){const r=yt(t,e.dtype);for(let o=0;o<r.size;o++){const i=r.indexToLoc(o),a=new Array(i.length);for(let l=0;l<a.length;l++)a[l]=i[l]*n[l]+s[l];r.set(e.get(...a),...i)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uee{constructor(e,n,s,r,o,i){this.separator=Da(e),this.nGramWidths=n,this.leftPad=Da(s),this.rightPad=Da(r),this.padWidth=o,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,r,o,i){for(let a=0;a<o;++a){const l=this.getPadWidth(i),u=Math.max(0,l-a),c=Math.max(0,l-(o-(a+1))),d=i-(u+c),h=n+(u>0?0:a-l);let p=0;p+=u*this.leftPad.length;for(let x=0;x<d;++x)p+=e[h+x].length;p+=c*this.rightPad.length;const f=u+c+d-1;p+=f*this.separator.length,s[r+a]=new Uint8Array(p);const m=s[r+a];let g=0;const y=x=>x.forEach(v=>m[g++]=v);for(let x=0;x<u;++x)y(this.leftPad),y(this.separator);for(let x=0;x<d-1;++x)y(e[h+x]),y(this.separator);if(d>0){y(e[h+d-1]);for(let x=0;x<c;++x)y(this.separator),y(this.rightPad)}else{for(let x=0;x<c-1;++x)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(e,n){const s=e.length,r=n.length;if(r>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let c=n[u]>=l;if(c=c&&n[u]<=s,!c)throw new Error(`Invalid split value ${n[u]}, must be in [${l}, ${s}]`);l=n[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const o=r-1,i=Mn("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=o;++u)i[u]=0;return[l,i]}i[0]=0;for(let l=1;l<=o;++l){const u=n[l]-n[l-1];let c=0;this.nGramWidths.forEach(d=>{c+=this.getNumNGrams(u,d)}),this.preserveShort&&u>0&&c===0&&(c=1),i[l]=i[l-1]+c}const a=new Array(i[o]);for(let l=0;l<o;++l){const u=n[l];let c=i[l];if(this.nGramWidths.forEach(d=>{const h=n[l+1]-n[l],p=this.getNumNGrams(h,d);this.createNGrams(e,u,a,c,p,d),c+=p}),this.preserveShort&&c===i[l]){const d=n[l+1]-n[l];if(d===0)continue;const h=d+2*this.padWidth;this.createNGrams(e,u,a,c,1,h)}}return[a,i]}}function VL(t,e,n,s,r,o,i,a){return new Uee(n,s,r,o,i,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wee(t,e,n,s){if(!t.length)return;if(e.length===0){for(let o=0;o<t.length;++o)s.push(t.subarray(o,o+1));return}if(e.length===1){const o=e[0];let i=t.indexOf(o);for(;i!==-1;){const a=t.subarray(0,i);(!n||a.length!==0)&&s.push(a),t=t.subarray(i+1),i=t.indexOf(o)}(!n||t.length!==0)&&s.push(t);return}let r=0;for(let o=0;o<t.length+1;o++)if(o===t.length||e.indexOf(t[o])!==-1){const i=t.subarray(r,o);(!n||i.length!==0)&&s.push(i),r=o+1}}function UL(t,e,n){const s=t.length,r=[];let o=0,i=0;const a=new Array(s);for(let h=0;h<s;++h){const p=r.length;Wee(t[h],e,n,r);const f=r.length-p;a[h]=f,o+=f,i=Math.max(i,f)}const l=Mn("int32",o*2),u=new Array(o),c=[s,i];let d=0;for(let h=0;h<s;++h)for(let p=0;p<a[h];++p)l[d*2]=h,l[d*2+1]=p,u[d]=r[d],++d;return[l,u,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WL(t,e){const n=Mn("int32",t.length);for(let s=0;s<t.length;++s)n[s]=oG(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jL=Yn((t,e)=>t-e),jee=qk((t,e,n,s)=>({real:t-n,imag:e-s})),Zk=gs(Dh,jL,jee),Gee={kernelName:Dh,backendName:"cpu",kernelFunc:Zk};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GL(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const s=yt(n,t.dtype);for(let r=0;r<s.values.length;++r){const o=s.indexToLoc(r),i=new Array(t.rank);for(let l=0;l<i.length;l++)i[l]=o[l]%t.shape[l];const a=t.locToIndex(i);s.values[r]=t.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dp=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function HL(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,l=e-n+1,u=Math.log(a),c=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*c*(a-c)/a)*Math.sign(l-a/2),h=Math.max(n,Math.floor(e-l*c/a+d)),p=Math.min(s,Math.floor(e+(a-l)*c/a+d));HL(t,e,h,p)}const r=t[e];let o=n,i=s;for(Oc(t,n,e),Dp(t[s],r)>0&&Oc(t,n,s);o<i;){for(Oc(t,o,i),o++,i--;Dp(t[o],r)<0;)o=o+1;for(;Dp(t[i],r)>0;)i=i-1}Dp(t[n],r)===0?Oc(t,n,i):(i=i+1,Oc(t,i,s)),i<=e&&(n=i+1),e<=i&&(s=i-1)}}function KL(t,e,n,s,r){const o=e[e.length-1],[i,a]=[t.length/o,o],l=ps(n,i*s),u=ps("int32",i*s);for(let d=0;d<i;d++){const h=d*a,p=t.subarray(h,h+a);let f=new Array(p.length);p.forEach((x,v)=>f[v]={value:x,index:v}),s<f.length&&(HL(f,s),f=f.slice(0,s)),r&&f.sort(Dp);const m=d*s,g=l.subarray(m,m+s),y=u.subarray(m,m+s);for(let x=0;x<s;x++)g[x]=f[x].value,y[x]=f[x].index}const c=e.slice();return c[c.length-1]=s,[yt(c,n,l),yt(c,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qL(t,e,n,s){const r=xt(e,n)[0],o=[1,n[0],1];for(let f=0;f<r;f++)o[0]*=n[f];o[1]=n[r];for(let f=r+1;f<n.length;f++)o[2]*=n[f];const i=new Map,a=new Int32Array(n[r]),l=new cs(o,s,t),u=[],c=o[0]===1&&o[2]===1;for(let f=0;f<n[r];f++){let m;if(c)m=t[f].toString();else{const y=[];for(let x=0;x<o[0];x++)for(let v=0;v<o[2];v++)y.push(l.get(x,f,v));m=y.join(",")}const g=i.get(m);if(g!=null)a[f]=g;else{const y=i.size;i.set(m,y),a[f]=y,u.push(f)}}const d=o.slice();d[1]=i.size;const h=new cs(d,s);u.forEach((f,m)=>{for(let g=0;g<o[0];g++)for(let y=0;y<o[2];y++)h.set(l.get(g,f,y),g,m,y)});const p=n.slice();return p[r]=d[1],{outputValues:h.values,outputShape:p,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XL=Object.freeze(Object.defineProperty({__proto__:null,addImpl:sL,bincountImpl:Xk,bincountReduceImpl:rL,bitwiseAndImpl:oL,castImpl:nL,ceilImpl:iL,concatImpl:aL,equalImpl:lL,expImpl:cL,expm1Impl:hL,floorDivImpl:fL,floorImpl:pL,gatherNdImpl:mL,gatherV2Impl:gL,greaterEqualImpl:xL,greaterImpl:yL,lessEqualImpl:vL,lessImpl:wL,linSpaceImpl:bL,logImpl:SL,maxImpl:CL,maximumImpl:kL,minimumImpl:IL,multiplyImpl:Yk,negImpl:$L,notEqualImpl:NL,prodImpl:TL,raggedGatherImpl:EL,raggedRangeImpl:RL,raggedTensorToTensorImpl:DL,rangeImpl:AL,rsqrtImpl:_L,scatterImpl:ku,sigmoidImpl:Aee,simpleAbsImpl:tL,sliceImpl:PL,sparseFillEmptyRowsImpl:OL,sparseReshapeImpl:LL,sparseSegmentReductionImpl:Jk,sqrtImpl:Pee,squaredDifferenceImpl:zL,staticRegexReplaceImpl:ML,stridedSliceImpl:BL,stringNGramsImpl:VL,stringSplitImpl:UL,stringToHashBucketFastImpl:WL,subImpl:jL,tileImpl:GL,topKImpl:KL,transposeImpl:Qk,uniqueImpl:qL},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */I2("cpu",()=>new m1,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YL=tn(eh,t=>t>=0?t:Math.exp(t)-1),Hee={kernelName:eh,backendName:"cpu",kernelFunc:YL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QL(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:o}=s;Je([r],"leakyRelu");const i=te(r.shape),a=n.data.get(r.dataId).values,l=ps("float32",i);for(let u=0;u<a.length;u++)l[u]=a[u]<0?o*a[u]:a[u];return n.makeTensorInfo(r.shape,"float32",l)}const Kee={kernelName:cm,backendName:"cpu",kernelFunc:QL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qee=Yn((t,e)=>t<0?e*t:t);function JL(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e;Je([s,r],"prelu");const o=n.data.get(s.dataId).values,i=n.data.get(r.dataId).values,[a,l]=qee(s.shape,r.shape,o,i,"float32");return n.makeTensorInfo(l,"float32",a)}const Xee={kernelName:Em,backendName:"cpu",kernelFunc:JL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZL=tn(wh,t=>Math.max(0,t)),Yee={kernelName:wh,backendName:"cpu",kernelFunc:ZL};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ez=tn(vh,t=>Math.min(Math.max(0,t),6)),Qee={kernelName:vh,backendName:"cpu",kernelFunc:ez};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dx(t,e,n,s,r){if(n==="linear")return ua({inputs:{x:e},backend:t});if(n==="relu")return ZL({inputs:{x:e},backend:t});if(n==="elu")return YL({inputs:{x:e},backend:t});if(n==="relu6")return ez({inputs:{x:e},backend:t});if(n==="prelu")return JL({inputs:{x:e,alpha:s},backend:t});if(n==="leakyrelu")return QL({inputs:{x:e},backend:t,attrs:{alpha:r}});if(n==="sigmoid")return FL({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mn(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:o}=s,i=te(r.shape),a=u2(o,i),l=te(a);A(i===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),n.incRef(r.dataId);const u=n.data.get(r.dataId);if(u.complexTensorInfos!=null){const c=u.complexTensorInfos.real,d=u.complexTensorInfos.imag;c.shape=a,d.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const Jee={kernelName:Dm,backendName:"cpu",kernelFunc:mn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tz(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;Je([r,o],"matMul");const l=r.shape.length,u=o.shape.length,c=i?r.shape[l-2]:r.shape[l-1],d=a?o.shape[u-1]:o.shape[u-2],h=i?r.shape[l-1]:r.shape[l-2],p=a?o.shape[u-2]:o.shape[u-1],f=r.shape.slice(0,-2),m=o.shape.slice(0,-2),g=te(f),y=te(m),v=ct(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([h,p]);A(c===d,()=>`Error in matMul: inner shapes (${c}) and (${d}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${i} and transposeB=${a} must match.`);const b=i?[g,c,h]:[g,h,c],S=a?[y,p,d]:[y,d,p],C=mn({inputs:{x:r},backend:n,attrs:{shape:b}}),I=mn({inputs:{x:o},backend:n,attrs:{shape:S}}),T=i?C.shape[1]:C.shape[2],R=i?C.shape[2]:C.shape[1],_=a?I.shape[1]:I.shape[2],P=Math.max(g,y),z=n.data.get(C.dataId).values,O=n.data.get(I.dataId).values,V=st(C.shape),H=st(I.shape),[Q,oe,j]=i?[V[0],1,V[1]]:[V[0],V[1],1],[ee,ie,le]=a?[1,H[1],H[0]]:[H[1],1,H[0]],fe=R*_,ge=yt([P,R,_],C.dtype),xe=ge.values,we=n.blockSize;for(let Ie=0;Ie<P;Ie++){const _e=Ie%g,qe=Ie%y;for(let Ze=0;Ze<R;Ze+=we){const dt=Math.min(Ze+we,R);for(let Ge=0;Ge<_;Ge+=we){const bt=Math.min(Ge+we,_);for(let ut=0;ut<T;ut+=we){const wt=Math.min(ut+we,T);for(let Nt=Ze;Nt<dt;Nt++)for(let Lt=Ge;Lt<bt;Lt++){let qt=0;for(let W=ut;W<wt;W++){const ae=z[_e*Q+Nt*oe+W*j],ue=O[W*ee+Lt*ie+qe*le];qt+=ae*ue}xe[Ie*fe+(Nt*_+Lt)]+=qt}}}}}return n.disposeIntermediateTensorInfo(C),n.disposeIntermediateTensorInfo(I),n.makeTensorInfo(v,ge.dtype,ge.values)}const Zee={kernelName:Xf,backendName:"cpu",kernelFunc:tz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ete(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:d}=s;let h,p,f;const m=[];h=tz({inputs:{a:r,b:o},attrs:{transposeA:l,transposeB:u},backend:n}),i&&(p=$d({inputs:{a:h,b:i},backend:n}),m.push(h),h=p),c&&(f=Dx(n,h,c,a,d),m.push(h),h=f);for(const y of m)n.disposeIntermediateTensorInfo(y);return h}const tte={kernelName:pf,backendName:"cpu",kernelFunc:ete};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nte=tn(Vd,t=>Math.acos(t)),ste={kernelName:Vd,backendName:"cpu",kernelFunc:nte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rte=tn(Ud,t=>Math.acosh(t)),ote={kernelName:Ud,backendName:"cpu",kernelFunc:rte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ite(t){const{inputs:e,backend:n}=t,s=e;Je(e,"addN");const r=s.map(a=>n.data.get(a.dataId).values),o=yt(s[0].shape,s[0].dtype),i=o.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<i.length;u++)i[u]+=l[u]}return n.makeTensorInfo(o.shape,o.dtype,o.values)}const ate={kernelName:jf,backendName:"cpu",kernelFunc:ite};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lte(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;Je(r,"all");const a=xt(o,r.shape);let l=a;const u=an(l,r.shape.length);let c=r;u!=null&&(c=$r({inputs:{x:r},backend:n,attrs:{perm:u}}),l=yn(l.length,r.shape.length)),ss("all",l,c.shape.length);const[d,h]=qn(c.shape,l),p=te(h),f=Ls(te(d),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){const x=y*p;let v=m[x];for(let b=0;b<p;++b){const S=m[x+b];v=v&&S}f[y]=v}u!=null&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(d,c.dtype,f);if(i){const y=Wn(d,a),x=mn({inputs:{x:g},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(g),x}return g}const ute={kernelName:f0,backendName:"cpu",kernelFunc:lte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cte(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;Je(r,"any");const a=xt(o,r.shape);let l=a;const u=an(l,r.shape.length);let c=r;u!=null&&(c=$r({inputs:{x:r},backend:n,attrs:{perm:u}}),l=yn(l.length,r.shape.length)),ss("any",l,c.shape.length);const[d,h]=qn(c.shape,l),p=te(h),f=Ls(te(d),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){const x=y*p;let v=m[x];for(let b=0;b<p;++b){const S=m[x+b];v=v||S}f[y]=v}u!=null&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(d,c.dtype,f);if(i){const y=Wn(d,a),x=mn({inputs:{x:g},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(g),x}return g}const dte={kernelName:m0,backendName:"cpu",kernelFunc:cte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hte(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;Je(r,"argMax");let i=xt(o,r.shape);const a=an(i,r.shape.length);let l=r;const u=[];a!=null&&(l=$r({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),i=yn(i.length,l.shape.length)),i=[i[0]],ss("argMax",i,l.shape.length);const[c,d]=qn(l.shape,i),h=te(c),p=Ls(h,"int32"),f=te(d),m=n.data.get(l.dataId).values;for(let g=0;g<p.length;++g){const y=g*f;let x=m[y],v=0;for(let b=0;b<f;++b){const S=m[y+b];S>x&&(x=S,v=b)}p[g]=v}return u.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(c,"int32",p)}const pte={kernelName:Gf,backendName:"cpu",kernelFunc:hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fte(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;Je(r,"argMin");let i=xt(o,r.shape);const a=an(i,r.shape.length);let l=r;const u=[];a!=null&&(l=$r({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),i=yn(i.length,l.shape.length)),i=[i[0]],ss("argMin",i,l.shape.length);const[c,d]=qn(l.shape,i),h=te(c),p=Ls(h,"int32"),f=te(d),m=n.data.get(l.dataId).values;for(let g=0;g<p.length;++g){const y=g*f;let x=m[y],v=0;for(let b=0;b<f;++b){const S=m[y+b];S<x&&(x=S,v=b)}p[g]=v}return u.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(c,"int32",p)}const mte={kernelName:Hf,backendName:"cpu",kernelFunc:fte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gte=tn(Wd,t=>Math.asin(t)),yte={kernelName:Wd,backendName:"cpu",kernelFunc:gte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xte=tn(jd,t=>Math.asinh(t)),wte={kernelName:jd,backendName:"cpu",kernelFunc:xte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vte=tn(Gd,t=>Math.atan(t)),bte={kernelName:Gd,backendName:"cpu",kernelFunc:vte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ste=Yn((t,e)=>Math.atan2(t,e)),Cte=gs(Kd,Ste),kte={kernelName:Kd,backendName:"cpu",kernelFunc:Cte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ite=tn(Hd,t=>Math.atanh(t)),$te={kernelName:Hd,backendName:"cpu",kernelFunc:Ite};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eI(t,e,n,s,r,o){const i=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,p=r.padInfo.left,f=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=yt(r.outShape,n),g=m.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3],x=r.outShape[2]*r.outShape[3],v=r.outShape[3];for(let b=0;b<r.batchSize;++b){const S=b*y,C=b*s[0];for(let I=0;I<r.inChannels;++I)for(let T=0;T<r.outHeight;++T){const R=T*i-h,_=Math.max(0,R),P=Math.min(r.inHeight,c+R),z=S+T*x;for(let O=0;O<r.outWidth;++O){const V=O*a-p,H=Math.max(0,V),Q=Math.min(r.inWidth,d+V);let oe=f,j=0,ee=0;for(let le=_;le<P;le+=l){const fe=C+le*s[1];for(let ge=H;ge<Q;ge+=u){const xe=fe+ge*s[2],we=t[xe+I];o==="max"&&we>oe?oe=we:o==="avg"&&(j+=we,ee++)}if(isNaN(oe))break}const ie=z+O*v+I;g[ie]=o==="avg"?j/ee:oe}}}return m}function nz(t,e,n,s,r=!1,o=!1){const i=yt(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,c=s.dilationWidth,d=s.effectiveFilterHeight,h=s.effectiveFilterWidth,p=s.padInfo.top,f=s.padInfo.left,m=yt(e,n,t);for(let g=0;g<s.batchSize;++g)for(let y=0;y<s.inChannels;++y)for(let x=0;x<s.outHeight;++x){const v=x*a-p;let b=v;for(;b<0;)b+=u;const S=Math.min(s.inHeight,d+v);for(let C=0;C<s.outWidth;++C){const I=C*l-f;let T=I;for(;T<0;)T+=c;const R=Math.min(s.inWidth,h+I);let _=Number.NEGATIVE_INFINITY,P=-1;for(let z=b;z<S;z+=u){const O=z-v;for(let V=T;V<R;V+=c){const H=V-I,Q=m.get(g,z,V,y);Q>_&&(_=Q,r?P=o?((g*s.inHeight+z)*s.inWidth+V)*s.inChannels+y:(z*s.inWidth+V)*s.inChannels+y:P=O*h+H)}}i.set(P,g,x,C,y)}}return i}function sz(t,e,n,s,r,o){const i=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,d=r.dilationWidth,h=r.effectiveFilterDepth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=r.padInfo.front,g=r.padInfo.top,y=r.padInfo.left,x=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=yt(r.outShape,n),b=v.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[2]*r.outShape[3]*r.outShape[4],I=r.outShape[3]*r.outShape[4],T=r.outShape[4];for(let R=0;R<r.batchSize;++R){const _=R*S,P=R*s[0];for(let z=0;z<r.inChannels;++z)for(let O=0;O<r.outDepth;++O){const V=O*i-m;let H=V;for(;H<0;)H+=u;const Q=Math.min(r.inDepth,h+V),oe=_+O*C;for(let j=0;j<r.outHeight;++j){const ee=j*a-g;let ie=ee;for(;ie<0;)ie+=c;const le=Math.min(r.inHeight,p+ee),fe=oe+j*I;for(let ge=0;ge<r.outWidth;++ge){const xe=ge*l-y;let we=xe;for(;we<0;)we+=d;const Ie=Math.min(r.inWidth,f+xe),_e=fe+ge*T;let qe=x,Ze=0,dt=0;for(let bt=H;bt<Q;bt+=u){const ut=P+bt*s[1];for(let wt=ie;wt<le;wt+=c){const Nt=ut+wt*s[2];for(let Lt=we;Lt<Ie;Lt+=d){const qt=Nt+Lt*s[3],W=t[qt+z];if(o==="max"&&W>qe?qe=W:o==="avg"&&(Ze+=W,dt++),isNaN(qe))break}if(isNaN(qe))break}if(isNaN(qe))break}const Ge=_e+z;b[Ge]=o==="avg"?Ze/Math.max(dt,1):qe}}}}return v}function Nte(t,e){const n=yt(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,o=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,f=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let g=0;g<e.inChannels;++g)for(let y=0;y<e.outDepth;++y){const x=y*s-h;let v=x;for(;v<0;)v+=i;const b=Math.min(e.inDepth,u+x);for(let S=0;S<e.outHeight;++S){const C=S*r-p;let I=C;for(;I<0;)I+=a;const T=Math.min(e.inHeight,c+C);for(let R=0;R<e.outWidth;++R){const _=R*o-f;let P=_;for(;P<0;)P+=l;const z=Math.min(e.inWidth,d+_);let O=Number.NEGATIVE_INFINITY,V=-1;for(let H=v;H<b;H+=i){const Q=H-x;for(let oe=I;oe<T;oe+=a){const j=oe-C;for(let ee=P;ee<z;ee+=l){const ie=ee-_,le=t.get(m,H,oe,ee,g);le>=O&&(O=le,V=Q*c*d+j*c+ie)}}}n.set(V,m,y,S,R,g)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tte(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Je(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;A(ms(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const c=qs(r.shape,o,i,u,a,l);let d;if(c.filterWidth===1&&c.filterHeight===1&&Ct(c.inShape,c.outShape))d=ua({inputs:{x:r},backend:n});else{const h=n.data.get(r.dataId).values,p=st(r.shape),f=eI(h,r.shape,r.dtype,p,c,"avg");d=n.makeTensorInfo(c.outShape,r.dtype,f.values)}return d}const Ete={kernelName:Kf,backendName:"cpu",kernelFunc:Tte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rte(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s;Je(r,"avgPool3d");const c=xo(r.shape,o,i,1,a,l,u),d=n.data.get(r.dataId).values,h=sz(d,r.shape,r.dtype,st(r.shape),c,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}const Dte={kernelName:qf,backendName:"cpu",kernelFunc:Rte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ate(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=s;Je([r,o],"avgPool3DGrad");const c=xo(o.shape,i,a,1,l,u),d=c.strideDepth,h=c.strideHeight,p=c.strideWidth,f=c.filterDepth,m=c.filterHeight,g=c.filterWidth,y=c.dilationDepth,x=c.dilationHeight,v=c.dilationWidth,b=c.effectiveFilterDepth,S=c.effectiveFilterHeight,C=c.effectiveFilterWidth,I=b-1-c.padInfo.front,T=C-1-c.padInfo.left,R=S-1-c.padInfo.top,_=yt(o.shape,"float32"),P=1/(f*m*g),z=n.bufferSync(r);for(let O=0;O<c.batchSize;++O)for(let V=0;V<c.inChannels;++V)for(let H=0;H<c.inDepth;++H)for(let Q=0;Q<c.inHeight;++Q)for(let oe=0;oe<c.inWidth;++oe){const j=H-I,ee=Q-R,ie=oe-T;let le=0;for(let fe=0;fe<b;fe+=y){const ge=(j+fe)/d;if(!(ge<0||ge>=c.outDepth||Math.floor(ge)!==ge))for(let xe=0;xe<S;xe+=x){const we=(ee+xe)/h;if(!(we<0||we>=c.outHeight||Math.floor(we)!==we))for(let Ie=0;Ie<C;Ie+=v){const _e=(ie+Ie)/p;if(_e<0||_e>=c.outWidth||Math.floor(_e)!==_e)continue;const qe=z.get(O,ge,we,_e,V);le+=qe}}}_.set(le*P,O,H,Q,oe,V)}return n.makeTensorInfo(_.shape,_.dtype,_.values)}const _te={kernelName:y0,backendName:"cpu",kernelFunc:Ate};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fte(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o;Je([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,c=qs(i.shape,a,l,1,u),d=c.strideHeight,h=c.strideWidth,p=c.filterHeight,f=c.filterWidth,m=c.dilationHeight,g=c.dilationWidth,y=c.effectiveFilterHeight,x=c.effectiveFilterWidth,v=x-1-c.padInfo.left,b=y-1-c.padInfo.top,S=yt(i.shape,"float32"),C=1/(p*f),I=n.data.get(r.dataId).values,T=yt(r.shape,"float32",I);for(let R=0;R<c.batchSize;++R)for(let _=0;_<c.inChannels;++_)for(let P=0;P<c.inHeight;++P)for(let z=0;z<c.inWidth;++z){const O=P-b,V=z-v;let H=0;for(let Q=0;Q<y;Q+=m){const oe=(O+Q)/d;if(!(oe<0||oe>=c.outHeight||Math.floor(oe)!==oe))for(let j=0;j<x;j+=g){const ee=(V+j)/h;if(ee<0||ee>=c.outWidth||Math.floor(ee)!==ee)continue;const ie=T.get(R,oe,ee,_);H+=ie}}S.set(H*C,R,P,z,_)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const Pte={kernelName:g0,backendName:"cpu",kernelFunc:Fte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ote(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,scale:o,offset:i,mean:a,variance:l}=e;A(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Je([r,a,l,o,i],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const c=n.data.get(r.dataId).values,d=n.data.get(a.dataId).values,h=n.data.get(l.dataId).values,p=o?n.data.get(o.dataId).values:new Float32Array([1]),f=i?n.data.get(i.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),g=f.length,y=p.length,x=h.length,v=d.length;let b=0,S=0,C=0,I=0;for(let T=0;T<c.length;++T)m[T]=f[b++]+(c[T]-d[S++])*p[C++]/Math.sqrt(h[I++]+u),b>=g&&(b=0),S>=v&&(S=0),C>=y&&(C=0),I>=x&&(I=0);return n.makeTensorInfo(r.shape,r.dtype,m)}const Lte={kernelName:am,backendName:"cpu",kernelFunc:Ote};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zte(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,crops:i}=s;Je([r],"batchToSpaceND");const a=o.reduce((y,x)=>y*x),l=hc(r.shape,o,a),u=pc(l.length,o.length),c=fc(r.shape,o,a),d=jw(i,o.length),h=Gw(c,i,o.length),p=mn({inputs:{x:r},backend:n,attrs:{shape:l}}),f=$r({inputs:{x:p},backend:n,attrs:{perm:u}}),m=mn({inputs:{x:f},backend:n,attrs:{shape:c}}),g=ec({inputs:{x:m},backend:n,attrs:{begin:d,size:h}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const Mte={kernelName:Yf,backendName:"cpu",kernelFunc:zte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bte(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i}=s,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,u=Xk(a,l,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,u)}const Vte={kernelName:x0,backendName:"cpu",kernelFunc:Bte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ute(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,o=n.data.get(s.dataId).values,i=n.data.get(r.dataId).values,a=ct(Array.from(o),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Wte={kernelName:v0,backendName:"cpu",kernelFunc:Ute};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jte=tn(Yd,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),Gte={kernelName:Yd,backendName:"cpu",kernelFunc:jte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hte=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(te(e.shape)),r=n.data.get(e.dataId),o=r.complexTensorInfos.real,i=r.complexTensorInfos.imag,a=n.data.get(o.dataId).values,l=n.data.get(i.dataId).values;for(let u=0;u<a.length;u++){const c=a[u],d=l[u];s[u]=Math.hypot(c,d)}return n.makeOutput(s,e.shape,"float32")},Kte={kernelName:Qf,backendName:"cpu",kernelFunc:Hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nd(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.imag,o=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,o)}const qte={kernelName:M0,backendName:"cpu",kernelFunc:Nd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Td(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,o=xt(r,e[0].shape)[0],i=e.map(m=>m.shape);Vw(i,o);let a=Sr(e.map(m=>m.shape),o);if(te(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(m=>te(m.shape)>0);if(l.length===1)return ua({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const m=l.map(b=>Zu({inputs:{input:b},backend:n})),g=l.map(b=>Nd({inputs:{input:b},backend:n})),y=Td({inputs:m,backend:n,attrs:{axis:o}}),x=Td({inputs:g,backend:n,attrs:{axis:o}}),v=Mr({inputs:{real:y,imag:x},backend:n});return m.forEach(b=>n.disposeIntermediateTensorInfo(b)),g.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(x),v}const u=l.map(m=>{const y=[-1,te(m.shape.slice(o))];return mn({inputs:{x:m},backend:n,attrs:{shape:y}})}),c=u.map(m=>({vals:n.data.get(m.dataId).values,shape:m.shape}));a=Sr(u.map(m=>m.shape),1);const d=u[0].shape[0]===1,h=aL(c,a,e[0].dtype,d),p=Sr(l.map(m=>m.shape),o),f=n.makeTensorInfo(p,e[0].dtype,h);return u.forEach(m=>n.disposeIntermediateTensorInfo(m)),f}const Xte={kernelName:Jf,backendName:"cpu",kernelFunc:Td};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rz(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=s;Je([r,o],"conv2d");const d=Zr(l),h=gn(r.shape,o.shape,i,u,a,c,!1,d),p=h.filterHeight,f=h.filterWidth,m=h.dilationHeight,g=h.dilationWidth,y=h.padInfo.left,x=h.padInfo.top,v=h.dataFormat==="channelsLast",b=new cs(h.outShape,r.dtype),S=st(r.shape),C=st(o.shape),I=S[0],T=v?S[1]:S[2],R=v?S[2]:1,_=v?1:S[1],P=b.strides[0],z=v?b.strides[1]:b.strides[2],O=v?b.strides[2]:1,V=v?1:b.strides[1],H=n.data.get(r.dataId).values,Q=n.data.get(o.dataId).values,oe=b.values;for(let j=0;j<h.batchSize;++j){const ee=j*I,ie=j*P;for(let le=0;le<h.outHeight;++le){const fe=ie+le*z,ge=le*h.strideHeight-x;for(let xe=0;xe<p;++xe){const we=ge+xe*m;if(we<0||we>=h.inHeight)continue;const Ie=xe*C[0],_e=ee+we*T;for(let qe=0;qe<h.outWidth;++qe){const Ze=fe+qe*O,dt=qe*h.strideWidth-y;for(let Ge=0;Ge<f;++Ge){const bt=dt+Ge*g;if(bt<0||bt>=h.inWidth)continue;const ut=Ie+Ge*C[1],wt=_e+bt*R;let Nt=ut;for(let Lt=0;Lt<h.inChannels;++Lt){const qt=H[wt+Lt*_];for(let W=0;W<h.outChannels;++W)oe[Ze+W*V]+=qt*Q[Nt+W];Nt+=h.outChannels}}}}}}return n.makeTensorInfo(b.shape,b.dtype,oe)}const Yte={kernelName:Zf,backendName:"cpu",kernelFunc:rz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qte(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=s;Je([r,o],"conv2dBackpropFilter");const d=Zr(l),h=gn(r.shape,c,i,1,a,u,!1,d),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:g}=h,y=h.dataFormat==="channelsLast",x=new cs(h.filterShape,"float32"),v=h.padInfo.left,b=h.padInfo.top,S=n.data.get(r.dataId).values,C=n.data.get(o.dataId).values,I=new cs(r.shape,r.dtype,S),T=new cs(o.shape,o.dtype,C);for(let R=0;R<m;++R){const _=Math.max(0,Math.ceil((b-R)/p)),P=Math.min(h.outHeight,(h.inHeight+b-R)/p);for(let z=0;z<g;++z){const O=Math.max(0,Math.ceil((v-z)/f)),V=Math.min(h.outWidth,(h.inWidth+v-z)/f);for(let H=0;H<h.inChannels;++H)for(let Q=0;Q<h.outChannels;++Q){let oe=0;for(let j=0;j<h.batchSize;++j)for(let ee=_;ee<P;++ee){const ie=R+ee*p-b;for(let le=O;le<V;++le){const fe=z+le*f-v;y?oe+=I.get(j,ie,fe,H)*T.get(j,ee,le,Q):oe+=I.get(j,H,ie,fe)*T.get(j,Q,ee,le)}}x.set(oe,R,z,H,Q)}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const Jte={kernelName:S0,backendName:"cpu",kernelFunc:Qte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zte(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=s;Je([r,o],"conv2dBackpropInput");const d=st(o.shape),h=st(r.shape);let p=Zr(u);const f=gn(i,o.shape,a,1,l,c,!1,p),m=new cs(f.inShape,"float32"),g=m.values,y=n.data.get(r.dataId).values,x=n.data.get(o.dataId).values,[v,b,S]=d,{batchSize:C,filterHeight:I,filterWidth:T,inChannels:R,inHeight:_,inWidth:P,outChannels:z,outHeight:O,outWidth:V,strideHeight:H,strideWidth:Q}=f;p=f.dataFormat;const oe=I-1-f.padInfo.top,j=T-1-f.padInfo.left,ee=p==="channelsLast",ie=m.strides[0],le=ee?m.strides[1]:m.strides[2],fe=ee?m.strides[2]:1,ge=ee?1:m.strides[1],xe=h[0],we=ee?h[1]:h[2],Ie=ee?h[2]:1,_e=ee?1:h[1];for(let qe=0;qe<C;++qe)for(let Ze=0;Ze<R;++Ze)for(let dt=0;dt<_;++dt){const Ge=dt-oe,bt=Math.max(0,Math.ceil(Ge/H)),ut=Math.min(O,(I+Ge)/H);for(let wt=0;wt<P;++wt){const Nt=wt-j,Lt=Math.max(0,Math.ceil(Nt/Q)),qt=Math.min(V,(T+Nt)/Q);let W=0;for(let ue=bt;ue<ut;++ue){const ve=ue*H-Ge;for(let Ce=Lt;Ce<qt;++Ce){const be=Ce*Q-Nt,Oe=xe*qe+we*ue+Ie*Ce,at=v*(I-1-ve)+b*(T-1-be)+S*Ze;for(let Tt=0;Tt<z;++Tt){const vt=y[Oe+_e*Tt],Jt=x[at+Tt];W+=vt*Jt}}}const ae=ie*qe+le*dt+fe*wt+ge*Ze;g[ae]=W}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const ene={kernelName:em,backendName:"cpu",kernelFunc:Zte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tne(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s;Je([r,o],"conv3d");const u=Oi(r.shape,o.shape,i,l,a),{filterDepth:c,filterHeight:d,filterWidth:h,dilationDepth:p,dilationHeight:f,dilationWidth:m,padInfo:g}=u,y=g.front,x=g.left,v=g.top,b=new cs(u.outShape,r.dtype),S=n.data.get(r.dataId).values,C=n.data.get(o.dataId).values,I=b.values,T=st(r.shape),R=st(o.shape);for(let _=0;_<u.batchSize;++_){const P=_*T[0],z=_*b.strides[0];for(let O=0;O<u.outDepth;++O){const V=z+O*b.strides[1],H=O*u.strideDepth-y;for(let Q=0;Q<c;++Q){const oe=H+Q*p;if(oe<0||oe>=u.inDepth)continue;const j=Q*R[0],ee=P+oe*T[1];for(let ie=0;ie<u.outHeight;++ie){const le=V+ie*b.strides[2],fe=ie*u.strideHeight-v;for(let ge=0;ge<d;++ge){const xe=fe+ge*f;if(xe<0||xe>=u.inHeight)continue;const we=j+ge*R[1],Ie=ee+xe*T[2];for(let _e=0;_e<u.outWidth;++_e){const qe=le+_e*u.outChannels,Ze=_e*u.strideWidth-x;for(let dt=0;dt<h;++dt){const Ge=Ze+dt*m;if(Ge<0||Ge>=u.inWidth)continue;const bt=we+dt*R[2],ut=Ie+Ge*u.inChannels;let wt=bt;for(let Nt=0;Nt<u.inChannels;++Nt){const Lt=S[ut+Nt];for(let qt=0;qt<u.outChannels;++qt)I[qe+qt]+=Lt*C[wt+qt];wt+=u.outChannels}}}}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const nne={kernelName:tm,backendName:"cpu",kernelFunc:tne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sne(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:l}=s;Je([r,o],"conv3dBackpropFilterV2");const u=st(r.shape),c=st(o.shape),d=Oi(r.shape,l,i,1,a),h=d.strideDepth,p=d.strideHeight,f=d.strideWidth,m=d.filterDepth,g=d.filterHeight,y=d.filterWidth,x=new cs(d.filterShape,"float32"),v=x.values,[b,S,C,I]=x.strides,T=n.data.get(o.dataId).values,[R,_,P,z]=c,O=n.data.get(r.dataId).values,[V,H,Q,oe]=u,j=d.padInfo.front,ee=d.padInfo.left,ie=d.padInfo.top;for(let le=0;le<m;++le){const fe=Math.max(0,Math.ceil((j-le)/h)),ge=Math.min(d.outDepth,(d.inDepth+j-le)/h),xe=le*b;for(let we=0;we<g;++we){const Ie=Math.max(0,Math.ceil((ie-we)/p)),_e=Math.min(d.outHeight,(d.inHeight+ie-we)/p),qe=we*S+xe;for(let Ze=0;Ze<y;++Ze){const dt=Math.max(0,Math.ceil((ee-Ze)/f)),Ge=Math.min(d.outWidth,(d.inWidth+ee-Ze)/f),bt=Ze*C+qe;for(let ut=0;ut<d.inChannels;++ut){const wt=ut*I+bt;for(let Nt=0;Nt<d.outChannels;++Nt){let Lt=0;for(let qt=0;qt<d.batchSize;++qt){const W=qt*V,ae=qt*R;for(let ue=fe;ue<ge;++ue){const Ce=(le+ue*h-j)*H+W,be=ue*_+ae;for(let Oe=Ie;Oe<_e;++Oe){const Tt=(we+Oe*p-ie)*Q+Ce,vt=Oe*P+be;for(let Jt=dt;Jt<Ge;++Jt){const Ts=(Ze+Jt*f-ee)*oe+Tt,Js=Jt*z+vt;Lt+=O[Ts+ut]*T[Js+Nt]}}}}v[wt+Nt]=Lt}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const rne={kernelName:C0,backendName:"cpu",kernelFunc:sne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function one(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:l}=s;Je([r],"conv3dBackpropInputV2");const u=st(r.shape),c=st(o.shape),d=Oi(l,o.shape,a,1,i),h=new cs(d.inShape,"float32"),p=h.values,[f,m,g,y]=h.strides,x=n.data.get(r.dataId).values,[v,b,S,C]=u,I=n.data.get(o.dataId).values,[T,R,_,P]=c,{batchSize:z,filterDepth:O,filterHeight:V,filterWidth:H,inChannels:Q,inDepth:oe,inHeight:j,inWidth:ee,outChannels:ie,outDepth:le,outHeight:fe,outWidth:ge,strideDepth:xe,strideHeight:we,strideWidth:Ie}=d,_e=O-1-d.padInfo.front,qe=V-1-d.padInfo.top,Ze=H-1-d.padInfo.left;for(let dt=0;dt<z;++dt)for(let Ge=0;Ge<Q;++Ge)for(let bt=0;bt<oe;++bt){const ut=bt-_e,wt=Math.max(0,Math.ceil(ut/xe)),Nt=Math.min(le,(O+ut)/xe);for(let Lt=0;Lt<j;++Lt){const qt=Lt-qe,W=Math.max(0,Math.ceil(qt/we)),ae=Math.min(fe,(V+qt)/we);for(let ue=0;ue<ee;++ue){const ve=ue-Ze,Ce=Math.max(0,Math.ceil(ve/Ie)),be=Math.min(ge,(H+ve)/Ie);let Oe=0;for(let at=wt;at<Nt;++at){const Tt=at*xe-ut;for(let vt=W;vt<ae;++vt){const Jt=vt*we-qt;for(let Qs=Ce;Qs<be;++Qs){const Ts=Qs*Ie-ve,Js=v*dt+b*at+S*vt+C*Qs,Zs=T*(O-1-Tt)+R*(V-1-Jt)+_*(H-1-Ts)+P*Ge;for(let Es=0;Es<ie;++Es){const to=x[Js+Es],bo=I[Zs+Es];Oe+=to*bo}}}}p[f*dt+m*bt+g*Lt+y*ue+Ge]=Oe}}}return n.makeTensorInfo(h.shape,h.dtype,h.values)}const ine={kernelName:k0,backendName:"cpu",kernelFunc:one};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ane=tn(Qd,t=>Math.cos(t)),lne={kernelName:Qd,backendName:"cpu",kernelFunc:ane};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const une=tn(Jd,t=>Math.cosh(t)),cne={kernelName:Jd,backendName:"cpu",kernelFunc:une};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dne(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[c,d,h,p]=r.shape,f=o.shape[0],[m,g]=a,y=yt([f,m,g,p],"float32"),x=n.data.get(o.dataId).values,v=n.data.get(i.dataId).values,b=n.data.get(r.dataId).values,S=st(r.shape),C=st(y.shape);for(let I=0;I<f;I++){const T=I*4,R=x[T],_=x[T+1],P=x[T+2],z=x[T+3],O=v[I];if(O>=c)continue;const V=m>1?(P-R)*(d-1)/(m-1):0,H=g>1?(z-_)*(h-1)/(g-1):0;for(let Q=0;Q<m;Q++){const oe=m>1?R*(d-1)+Q*V:.5*(R+P)*(d-1);if(oe<0||oe>d-1){for(let j=0;j<g;j++)for(let ee=0;ee<p;ee++){const ie=ee+j*C[2]+Q*C[1]+I*C[0];y.values[ie]=u}continue}if(l==="bilinear"){const j=Math.floor(oe),ee=Math.ceil(oe),ie=oe-j;for(let le=0;le<g;le++){const fe=g>1?_*(h-1)+le*H:.5*(_+z)*(h-1);if(fe<0||fe>h-1){for(let Ie=0;Ie<p;Ie++){const _e=Ie+le*C[2]+Q*C[1]+I*C[0];y.values[_e]=u}continue}const ge=Math.floor(fe),xe=Math.ceil(fe),we=fe-ge;for(let Ie=0;Ie<p;Ie++){let _e=Ie+ge*S[2]+j*S[1]+O*S[0];const qe=b[_e];_e=Ie+xe*S[2]+j*S[1]+O*S[0];const Ze=b[_e];_e=Ie+ge*S[2]+ee*S[1]+O*S[0];const dt=b[_e];_e=Ie+xe*S[2]+ee*S[1]+O*S[0];const Ge=b[_e],bt=qe+(Ze-qe)*we,ut=dt+(Ge-dt)*we;_e=Ie+le*C[2]+Q*C[1]+I*C[0],y.values[_e]=bt+(ut-bt)*ie}}}else for(let j=0;j<g;++j){const ee=g>1?_*(h-1)+j*H:.5*(_+z)*(h-1);if(ee<0||ee>h-1){for(let fe=0;fe<p;fe++){const ge=fe+j*C[2]+Q*C[1]+I*C[0];y.values[ge]=u}continue}const ie=Math.round(ee),le=Math.round(oe);for(let fe=0;fe<p;fe++){const ge=fe+ie*S[2]+le*S[1]+O*S[0],xe=fe+j*C[2]+Q*C[1]+I*C[0];y.values[xe]=b[ge]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const hne={kernelName:$0,backendName:"cpu",kernelFunc:dne};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pne(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;Je(r,"cumprod");const l=an([o],r.shape.length);let u=r;l!=null&&(u=$r({inputs:{x:r},backend:n,attrs:{perm:l}}));const c=yn(1,r.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const d=$s(u.dtype,"int32"),h=d2(te(u.shape),d),p=n.data.get(u.dataId).values,f=u.shape[u.shape.length-1],m=a?(y,x)=>y+f-x-1:(y,x)=>y+x;for(let y=0;y<p.length;y+=f)for(let x=0;x<f;x++){const v=m(y,x);if(x===0)h[v]=i?1:p[v];else{const b=m(y,x-1);h[v]=i?p[b]*h[b]:p[v]*h[b]}}const g=n.makeTensorInfo(u.shape,d,h);if(l!=null){const y=ha(l),x=$r({inputs:{x:g},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(u),x}return g}const fne={kernelName:I0,backendName:"cpu",kernelFunc:pne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mne(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;Je(r,"cumsum");const l=an([o],r.shape.length);let u=r;l!=null&&(u=$r({inputs:{x:r},backend:n,attrs:{perm:l}}));const c=yn(1,r.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);const d=$s(u.dtype,"int32"),h=Ls(te(u.shape),d),p=n.data.get(u.dataId).values,f=u.shape[u.shape.length-1],m=a?(y,x)=>y+f-x-1:(y,x)=>y+x;for(let y=0;y<p.length;y+=f)for(let x=0;x<f;x++){const v=m(y,x);if(x===0)h[v]=i?0:p[v];else{const b=m(y,x-1);h[v]=i?p[b]+h[b]:p[v]+h[b]}}const g=n.makeTensorInfo(u.shape,d,h);if(l!=null){const y=ha(l),x=$r({inputs:{x:g},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(u),x}return g}const gne={kernelName:nm,backendName:"cpu",kernelFunc:mne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yne(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const l=n.data.get(r.dataId).values,u=n.data.get(o.dataId).values,c=Xk(l,u,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,c)}else if(r.shape.length===2){const l=n.bufferSync(r),u=n.bufferSync(o),c=rL(l,u,i,a);return n.makeTensorInfo(c.shape,o.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const xne={kernelName:N0,backendName:"cpu",kernelFunc:yne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wne(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:o,dataFormat:i}=s;A(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],c=r.shape[3],d=l*o,h=u*o,p=c/(o*o),f=n.data.get(r.dataId).values,m=new Float32Array(a*d*h*p);let g=0;for(let y=0;y<a;++y)for(let x=0;x<d;++x){const v=Math.floor(x/o),b=x%o;for(let S=0;S<h;++S){const C=Math.floor(S/o),I=S%o,T=(b*o+I)*p;for(let R=0;R<p;++R){const P=R+T+c*(C+u*(v+l*y));m[g++]=f[P]}}}return n.makeTensorInfo([a,d,h,p],r.dtype,m)}const vne={kernelName:T0,backendName:"cpu",kernelFunc:wne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oz(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=s;Je([r,o],"depthwiseConv2DNative");const c=st(r.shape),d=st(o.shape);let h=l;h==null&&(h=[1,1]),A(ms(i,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);const p=gn(r.shape,o.shape,i,h,a,u,!0),{filterHeight:f,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:x}=p,v=x.left,b=x.top,S=p.outChannels/p.inChannels,C=new cs(p.outShape,r.dtype),I=n.data.get(r.dataId).values,T=n.data.get(o.dataId).values,R=C.values;for(let _=0;_<p.batchSize;++_){const P=_*c[0],z=_*C.strides[0];for(let O=0;O<p.outHeight;++O){const V=z+O*C.strides[1],H=O*p.strideHeight-b;for(let Q=0;Q<f;++Q){const oe=H+Q*g;if(oe<0||oe>=p.inHeight)continue;const j=Q*d[0],ee=P+oe*c[1];for(let ie=0;ie<p.outWidth;++ie){const le=V+ie*C.strides[2],fe=ie*p.strideWidth-v;for(let ge=0;ge<m;++ge){const xe=fe+ge*y;if(xe<0||xe>=p.inWidth)continue;const we=j+ge*d[1],Ie=ee+xe*p.inChannels;let _e=le,qe=we;for(let Ze=0;Ze<p.inChannels;++Ze){const dt=I[Ie+Ze];for(let Ge=0;Ge<S;++Ge)R[_e+Ge]+=dt*T[qe+Ge];_e+=S,qe+=S}}}}}}return n.makeTensorInfo(C.shape,C.dtype,C.values)}const bne={kernelName:sm,backendName:"cpu",kernelFunc:oz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sne(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=s;Je([r,o],"depthwiseConv2dNativeBackpropFilter");const d=gn(r.shape,c,i,a,l,u,!0),{strideHeight:h,strideWidth:p,filterHeight:f,filterWidth:m}=d,g=new cs(d.filterShape,"float32"),y=d.padInfo.left,x=d.padInfo.top,v=d.outChannels/d.inChannels,b=n.data.get(r.dataId).values,S=new cs(r.shape,r.dtype,b),C=n.data.get(o.dataId).values,I=new cs(o.shape,o.dtype,C);for(let T=0;T<f;++T){const R=Math.max(0,Math.ceil((x-T)/h)),_=Math.min(d.outHeight,(d.inHeight+x-T)/h);for(let P=0;P<m;++P){const z=Math.max(0,Math.ceil((y-P)/p)),O=Math.min(d.outWidth,(d.inWidth+y-P)/p);for(let V=0;V<d.outChannels;++V){const H=Math.trunc(V/v),Q=V%v;let oe=0;for(let j=0;j<d.batchSize;++j)for(let ee=R;ee<_;++ee){const ie=T+ee*h-x;for(let le=z;le<O;++le){const fe=P+le*p-y;oe+=S.get(j,ie,fe,H)*I.get(j,ee,le,V)}}g.set(oe,T,P,H,Q)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const Cne={kernelName:E0,backendName:"cpu",kernelFunc:Sne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kne(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=s;Je([r,o],"depthwiseConv2DNativeBackpropInput");const d=st(r.shape),h=st(o.shape),p=gn(c,o.shape,i,a,l,u,!0),f=new cs(p.inShape,"float32"),m=f.values,[g,y,x]=f.strides,v=n.data.get(r.dataId).values,[b,S,C]=d,I=n.data.get(o.dataId).values,[T,R,_]=h,{batchSize:P,filterHeight:z,filterWidth:O,inChannels:V,inHeight:H,inWidth:Q,outChannels:oe,outHeight:j,outWidth:ee,strideHeight:ie,strideWidth:le}=p,fe=z-1-p.padInfo.top,ge=O-1-p.padInfo.left,xe=oe/V;for(let we=0;we<P;++we)for(let Ie=0;Ie<V;++Ie)for(let _e=0;_e<H;++_e){const qe=_e-fe,Ze=Math.max(0,Math.ceil(qe/ie)),dt=Math.min(j,(z+qe)/ie);for(let Ge=0;Ge<Q;++Ge){const bt=Ge-ge,ut=Math.max(0,Math.ceil(bt/le)),wt=Math.min(ee,(O+bt)/le);let Nt=0;for(let Lt=Ze;Lt<dt;++Lt){const qt=Lt*ie-qe;for(let W=ut;W<wt;++W){const ae=W*le-bt,ue=b*we+S*Lt+C*W,ve=T*(z-1-qt)+R*(O-1-ae)+_*Ie;for(let Ce=0;Ce<xe;++Ce){const be=Ie*xe+Ce,Oe=v[ue+be],at=I[ve+Ce];Nt+=Oe*at}}}m[g*we+y*_e+x*Ge+Ie]=Nt}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}const Ine={kernelName:R0,backendName:"cpu",kernelFunc:kne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ne(t){const{inputs:e,backend:n}=t,{x:s}=e,r=te(s.shape),o=n.data.get(s.dataId).values,i=yt([r,r],s.dtype),a=i.values;for(let u=0;u<o.length;u++)a[u*r+u]=o[u];const l=[...s.shape,...s.shape];return n.makeTensorInfo(l,i.dtype,i.values)}const Nne={kernelName:D0,backendName:"cpu",kernelFunc:$ne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tne={kernelName:rm,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r}=t,{strides:o,pad:i,dilations:a}=n,l=e,u=l.data.get(s.dataId).values,c=s.shape.length,d=l.data.get(r.dataId).values,h=r.shape.length,{batchSize:p,inHeight:f,inWidth:m,inChannels:g,outHeight:y,outWidth:x,padInfo:v,strideHeight:b,strideWidth:S,filterHeight:C,filterWidth:I,dilationHeight:T,dilationWidth:R,outShape:_}=Gl(s.shape,r.shape,o,i,"NHWC",a),P=te(_),z=_.length,O=Mn(s.dtype,P);for(let H=0;H<p;++H)for(let Q=0;Q<y;++Q){const oe=Q*b-v.top;for(let j=0;j<x;++j){const ee=j*S-v.left;for(let ie=0;ie<g;++ie){let le=Number.MIN_SAFE_INTEGER;for(let ge=0;ge<C;++ge){const xe=oe+ge*T;if(xe>=0&&xe<f)for(let we=0;we<I;++we){const Ie=ee+we*R;if(Ie>=0&&Ie<m){const _e=sa([H,xe,Ie,ie],c,st(s.shape)),qe=sa([ge,we,ie],h,st(r.shape)),Ze=u[_e]+d[qe];Ze>le&&(le=Ze)}}}const fe=sa([H,Q,j,ie],z,st(_));O[fe]=le}}}return{dataId:l.write(lc(O,s.dtype),_,s.dtype),shape:_,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ene={kernelName:ux,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:o}=t,{strides:i,pad:a,dilations:l}=n,u=e,c=jo(s.shape,u.data.get(s.dataId).values),d=jo(r.shape,u.data.get(r.dataId).values),{batchSize:h,inHeight:p,inWidth:f,inChannels:m,outHeight:g,outWidth:y,padInfo:x,strideHeight:v,strideWidth:b,filterHeight:S,filterWidth:C,dilationHeight:I,dilationWidth:T,outShape:R}=Gl(s.shape,r.shape,i,a,"NHWC",l);A(o.rank===R.length,()=>`Error in ${ux}, dy must have the same rank as output ${R.length}, but got ${o.rank}`);const _=jo(R,u.data.get(o.dataId).values),P=e3(r.shape,r.dtype);for(let O=0;O<h;++O)for(let V=0;V<g;++V){const H=V*v-x.top;for(let Q=0;Q<y;++Q){const oe=Q*b-x.left;for(let j=0;j<m;++j){let ee=Number.MIN_SAFE_INTEGER,ie=0,le=0;for(let fe=0;fe<S;++fe){const ge=H+fe*I;if(ge>=0&&ge<p)for(let xe=0;xe<C;++xe){const we=oe+xe*T;if(we>=0&&we<f){const Ie=c[O][ge][we][j]+d[fe][xe][j];Ie>ee&&(ee=Ie,ie=fe,le=xe)}}}P[ie][le][j]+=_[O][V][Q][j]}}}return{dataId:u.write(lc(P,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rne={kernelName:lx,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:o}=t,{strides:i,pad:a,dilations:l}=n,u=e,c=jo(s.shape,u.data.get(s.dataId).values),d=jo(r.shape,u.data.get(r.dataId).values),{batchSize:h,inHeight:p,inWidth:f,inChannels:m,outHeight:g,outWidth:y,padInfo:x,strideHeight:v,strideWidth:b,filterHeight:S,filterWidth:C,dilationHeight:I,dilationWidth:T,outShape:R}=Gl(s.shape,r.shape,i,a,"NHWC",l);A(o.rank===R.length,()=>`Error in ${lx}, dy must have the same rank as output ${R.length}, but got ${o.rank}`);const _=jo(R,u.data.get(o.dataId).values),P=e3(s.shape,s.dtype);for(let O=0;O<h;++O)for(let V=0;V<g;++V){const H=V*v-x.top;for(let Q=0;Q<y;++Q){const oe=Q*b-x.left;for(let j=0;j<m;++j){let ee=Number.MIN_SAFE_INTEGER,ie=H<0?0:H,le=oe<0?0:oe;for(let fe=0;fe<S;++fe){const ge=H+fe*I;if(ge>=0&&ge<p)for(let xe=0;xe<C;++xe){const we=oe+xe*T;if(we>=0&&we<f){const Ie=c[O][ge][we][j]+d[fe][xe][j];Ie>ee&&(ee=Ie,ie=ge,le=we)}}}P[O][ie][le][j]+=_[O][V][Q][j]}}}return{dataId:u.write(lc(P,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dne(t){const{inputs:e,backend:n,attrs:s}=t,{image:r}=e,{canvas:o,options:i}=s,{contextOptions:a,imageOptions:l}=i||{},u=(l==null?void 0:l.alpha)||1,c=(a==null?void 0:a.contextType)||"2d";if(c!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=o.getContext(c,(a==null?void 0:a.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${c} type.`);const[h,p]=r.shape.slice(0,2),f=r.shape.length===2?1:r.shape[2],m=n.data.get(r.dataId).values,g=r.dtype==="float32"?255:1,y=new Uint8ClampedArray(p*h*4);for(let v=0;v<h*p;++v){const b=[0,0,0,255*u];for(let C=0;C<f;C++){const I=m[v*f+C];if(r.dtype==="float32"){if(I<0||I>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${I}.`)}else if(r.dtype==="int32"&&(I<0||I>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${I}.`);f===1?(b[0]=I*g,b[1]=I*g,b[2]=I*g):b[C]=I*g}const S=v*4;y[S+0]=Math.round(b[0]),y[S+1]=Math.round(b[1]),y[S+2]=Math.round(b[2]),y[S+3]=Math.round(b[3])}o.width=p,o.height=h;const x=new ImageData(y,p,h);return d.putImageData(x,0,0),r}const Ane={kernelName:p2,backendName:"cpu",kernelFunc:Dne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lg(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;Je(r,"sum");let a;r.dtype==="bool"?a=Pl({inputs:{x:r},backend:n,attrs:{dtype:"int32"}}):a=ua({inputs:{x:r},backend:n});const l=a.shape.length,u=xt(o,a.shape),c=an(u,l);let d=u,h=a;c!=null&&(h=$r({inputs:{x:a},backend:n,attrs:{perm:c}}),d=yn(d.length,l)),ss("sum",d,h.shape.length);const[p,f]=qn(h.shape,d),m=$s(h.dtype,"int32");let g=Ex(n,p,m);const y=te(f),x=n.data.get(g.dataId).values,v=n.data.get(h.dataId).values;for(let b=0;b<x.length;++b){const S=b*y;let C=0;for(let I=0;I<y;++I)C+=v[S+I];x[b]=C}if(i){const b=Wn(g.shape,u),S=g;g=mn({inputs:{x:g},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(S)}return n.disposeIntermediateTensorInfo(a),c!=null&&n.disposeIntermediateTensorInfo(h),g}const _ne={kernelName:Lm,backendName:"cpu",kernelFunc:lg};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fne(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:l}=Jw(r,o.length);e1(i.length,l,o);const{path:u,steps:c}=t1(a,l),d=c.length;let h=null,p=i.length;const f=[];for(let m=0;m<d;++m){for(const g of c[m]){const{permutationIndices:y,expandDims:x}=Zw(p,l[g]);let v;n1(y)?v=o[g]:(v=$r({inputs:{x:o[g]},backend:n,attrs:{perm:y}}),f.push(v));const b=v.shape.slice();for(let S=0;S<x.length;++S)b.splice(x[S],0,1);Ct(v.shape,b)||(v=mn({inputs:{x:v},backend:n,attrs:{shape:b}}),f.push(v)),h===null?h=v:(h=g1({inputs:{a:v,b:h},backend:n}),f.push(h))}m<d-1&&(u[m]>=0&&(h=lg({inputs:{x:h},backend:n,attrs:{axis:u[m]-(i.length-p),keepDims:!1}}),f.push(h)),p--)}for(const m of f)m!==h&&n.disposeIntermediateTensorInfo(m);return h}const Pne={kernelName:A0,backendName:"cpu",kernelFunc:Fne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function One(t){const{inputs:e,backend:n}=t,{dy:s,y:r}=e;Je([s,r],"eluGrad");const o=new Float32Array(te(r.shape)),i=n.data.get(r.dataId).values,a=n.data.get(s.dataId).values;for(let l=0;l<i.length;++l){const u=i[l];u>=0?o[l]=a[l]:o[l]=a[l]*(u+1)}return n.makeTensorInfo(r.shape,"float32",o)}const Lne={kernelName:_0,backendName:"cpu",kernelFunc:One};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zne=Hw,Mne=Kw,Bne=qw,Vne=Xw,Une=Yw,Wne=Qw,jne=tn(th,t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+zne*n);return e*(1-((((Wne*s+Une)*s+Vne)*s+Bne)*s+Mne)*s*Math.exp(-n*n))}),Gne={kernelName:th,backendName:"cpu",kernelFunc:jne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ax(t){const{inputs:e,backend:n,attrs:s}=t,{input:r}=e,{dim:o}=s,i=r.shape.length,a=r.shape.slice();let l=o;return o<0&&(A(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+o+1),a.splice(l,0,1),mn({inputs:{x:r},backend:n,attrs:{shape:a}})}const Hne={kernelName:im,backendName:"cpu",kernelFunc:Ax};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kne=Yn((t,e)=>t/e),tI=gs(Zd,Kne),OS={kernelName:Zd,backendName:"cpu",kernelFunc:tI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iz(t,e,n){const s=t.shape,r=s[0],o=s[1],i=n.data.get(t.dataId),a=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,u=[r,o],c=te(u),d=ps("float32",c),h=ps("float32",c);for(let g=0;g<r;g++){const y=ec({inputs:{x:a},backend:n,attrs:{begin:[g,0],size:[1,o]}}),x=ec({inputs:{x:l},backend:n,attrs:{begin:[g,0],size:[1,o]}}),v=Mr({inputs:{real:y,imag:x},backend:n}),{real:b,imag:S}=qne(v,e,n),C=Ni(b,S);for(let I=0;I<o;I++){const T=Ck(C,I);d[g*o+I]=T.real,h[g*o+I]=T.imag}n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(v)}const p=n.makeTensorInfo(u,"float32",d),f=n.makeTensorInfo(u,"float32",h),m=Mr({inputs:{real:p,imag:f},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}function qne(t,e,n){const s=te(t.shape),r=n.data.get(t.dataId),o=n.data.get(r.complexTensorInfos.real.dataId).values,i=n.data.get(r.complexTensorInfos.imag.dataId).values;if(Xne(s)){const a=LS(o,i,s,e,n),l=[t.shape[0],t.shape[1]];if(e){const u=n.makeTensorInfo(l,"float32",a.real),c=n.makeTensorInfo(l,"float32",a.imag),d=n.makeTensorInfo([],"float32",Ul(s,"float32")),h=ua({inputs:{x:d},backend:n}),p=OS.kernelFunc({inputs:{a:u,b:d},backend:n}),f=OS.kernelFunc({inputs:{a:c,b:h},backend:n}),m=n.data.get(p.dataId).values,g=n.data.get(f.dataId).values;return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),{real:m,imag:g}}return a}else{const a=Ni(o,i),l=Yne(a,s,e);return gF(l)}}function Xne(t){return(t&t-1)===0}function LS(t,e,n,s,r){if(n===1)return{real:t,imag:e};const o=Ni(t,e),i=n/2,a=yF(o),l=a.real,u=a.imag,c=[l.length],d=r.makeTensorInfo(c,"float32",l),h=r.makeTensorInfo(c,"float32",u),p=Mr({inputs:{real:d,imag:h},backend:r}),f=xF(o),m=f.real,g=f.imag,y=[m.length],x=r.makeTensorInfo(y,"float32",m),v=r.makeTensorInfo(y,"float32",g),b=Mr({inputs:{real:x,imag:v},backend:r}),S=LS(l,u,i,s,r),C=S.real,I=S.imag,T=[C.length],R=r.makeTensorInfo(T,"float32",C),_=r.makeTensorInfo(T,"float32",I),P=Mr({inputs:{real:R,imag:_},backend:r}),z=LS(m,g,i,s,r),O=z.real,V=z.imag,H=[O.length],Q=r.makeTensorInfo(H,"float32",O),oe=r.makeTensorInfo(H,"float32",V),j=Mr({inputs:{real:Q,imag:oe},backend:r}),ee=vF(n,s),ie=[ee.real.length],le=r.makeTensorInfo(ie,"float32",ee.real),fe=r.makeTensorInfo(ie,"float32",ee.imag),ge=Mr({inputs:{real:le,imag:fe},backend:r}),xe=g1({inputs:{a:ge,b:j},backend:r}),we=$d({inputs:{a:P,b:xe},backend:r}),Ie=Zk({inputs:{a:P,b:xe},backend:r}),_e=Zu({inputs:{input:we},backend:r}),qe=Zu({inputs:{input:Ie},backend:r}),Ze=Nd({inputs:{input:we},backend:r}),dt=Nd({inputs:{input:Ie},backend:r}),Ge=Td({inputs:[_e,qe],backend:r,attrs:{axis:0}}),bt=Td({inputs:[Ze,dt],backend:r,attrs:{axis:0}}),ut=r.data.get(Ge.dataId).values,wt=r.data.get(bt.dataId).values;return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(R),r.disposeIntermediateTensorInfo(_),r.disposeIntermediateTensorInfo(P),r.disposeIntermediateTensorInfo(Q),r.disposeIntermediateTensorInfo(oe),r.disposeIntermediateTensorInfo(j),r.disposeIntermediateTensorInfo(le),r.disposeIntermediateTensorInfo(fe),r.disposeIntermediateTensorInfo(ge),r.disposeIntermediateTensorInfo(xe),r.disposeIntermediateTensorInfo(we),r.disposeIntermediateTensorInfo(Ie),r.disposeIntermediateTensorInfo(_e),r.disposeIntermediateTensorInfo(Ze),r.disposeIntermediateTensorInfo(qe),r.disposeIntermediateTensorInfo(dt),r.disposeIntermediateTensorInfo(Ge),r.disposeIntermediateTensorInfo(bt),{real:ut,imag:wt}}function Yne(t,e,n){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let o=0,i=0;for(let a=0;a<e;a++){const l=bF(r*a,e,n),u=Ck(t,a);o+=u.real*l.real-u.imag*l.imag,i+=u.real*l.imag+u.imag*l.real}n&&(o/=e,i/=e),wF(s,o,i,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qne(t){const{inputs:e,backend:n}=t,{input:s}=e,r=te(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=mn({inputs:{x:s},backend:n,attrs:{shape:[i,o]}}),l=iz(a,!1,n),u=mn({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const Jne={kernelName:F0,backendName:"cpu",kernelFunc:Qne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nI(t){const{backend:e,attrs:n}=t,{shape:s,value:r,dtype:o}=n,i=o||oc(r),a=Mn(i,te(s));return ese(a,r,i),e.makeTensorInfo(s,i,a)}const Zne={kernelName:P0,backendName:"cpu",kernelFunc:nI};function ese(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tse={kernelName:O0,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,r=n,o=ps(s.dtype,te(s.shape)),[i,a,l,u]=s.shape,c=r.data.get(s.dataId).values;for(let h=0;h<i;h++){const p=h*l*a*u;for(let f=0;f<a;f++){const m=f*(l*u);for(let g=0;g<l;g++){const y=g*u;for(let x=0;x<u;x++){const v=Math.round(l-g-1),b=p+m+y+x;let S=c[b];if(v>=0&&v<l){const C=v*u,I=p+m+C+x;S=c[I]}o[b]=S}}}}return{dataId:r.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=s;let m=rz({inputs:{x:r,filter:o},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h}});if(i){const g=m;if(c==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const y=mn({inputs:{x:i},backend:n,attrs:{shape:[i.shape[0],1,1]}});m=$d({inputs:{a:m,b:y},backend:n}),n.disposeIntermediateTensorInfo(y)}else m=$d({inputs:{a:m,b:i},backend:n});n.disposeIntermediateTensorInfo(g)}if(p){const g=m;if(c==="NCHW"&&p==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=mn({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});m=Dx(n,m,p,y,f),n.disposeIntermediateTensorInfo(y)}else m=Dx(n,m,p,a,f);n.disposeIntermediateTensorInfo(g)}return m}const sse={kernelName:ff,backendName:"cpu",kernelFunc:nse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=s;let m=oz({inputs:{x:r,filter:o},backend:n,attrs:{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h}});if(i){const g=m;m=$d({inputs:{a:m,b:i},backend:n}),n.disposeIntermediateTensorInfo(g)}if(p){const g=m;m=Dx(n,m,p,a,f),n.disposeIntermediateTensorInfo(g)}return m}const ose={kernelName:mf,backendName:"cpu",kernelFunc:rse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ise(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,o=te(s.shape),i=r.shape,a=i[i.length-1],[l,u,c,d]=Lw(s,r);if(u===0)return n.makeTensorInfo(l,s.dtype,[]);const h=n.data.get(r.dataId).values,p=n.bufferSync(s),f=mL(h,p,s.dtype,u,a,c,d,s.shape,o);return n.makeTensorInfo(l,s.dtype,f.values)}const ase={kernelName:L0,backendName:"cpu",kernelFunc:ise};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:o}=e,{axis:i,batchDims:a}=s;Je([r,o],"gatherV2");const l=xt(i,r.shape)[0],u=n.data.get(o.dataId).values,c=r.shape[l];for(let b=0;b<u.length;++b){const S=u[b];A(S<=c-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${c-1}]`)}let d=a;a==null&&(d=0);const h=te(o.shape),p=r1(r,o,l,d),f=mn({inputs:{x:r},backend:n,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),m=mn({inputs:{x:o},backend:n,attrs:{shape:[p.batchSize,h/p.batchSize]}}),g=[p.batchSize,p.outerSize,h/p.batchSize,p.sliceSize],y=n.bufferSync(m),x=n.bufferSync(f),v=gL(x,y,g);return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(p.outputShape,v.dtype,v.values)}const use={kernelName:lm,backendName:"cpu",kernelFunc:lse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cse(t){const{inputs:e,backend:n}=t,{input:s}=e,r=te(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=mn({inputs:{x:s},backend:n,attrs:{shape:[i,o]}}),l=iz(a,!0,n),u=mn({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}const dse={kernelName:z0,backendName:"cpu",kernelFunc:cse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hse=tn(lh,t=>Number.isFinite(t)?1:0,"bool"),pse={kernelName:lh,backendName:"cpu",kernelFunc:hse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fse=tn(uh,t=>Math.abs(t)===1/0?1:0,"bool"),mse={kernelName:uh,backendName:"cpu",kernelFunc:fse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gse=tn(ch,t=>Number.isNaN(t)?1:0,"bool"),yse={kernelName:ch,backendName:"cpu",kernelFunc:gse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xse(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:o}=n,i=bL(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const wse={kernelName:B0,backendName:"cpu",kernelFunc:xse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vse=tn(hh,t=>Math.log1p(t)),bse={kernelName:hh,backendName:"cpu",kernelFunc:vse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sse=Yn((t,e)=>t&&e),Cse=gs(pm,Sse,null,"bool"),kse={kernelName:pm,backendName:"cpu",kernelFunc:Cse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ise=tn(fm,t=>t?0:1,"bool"),$se={kernelName:fm,backendName:"cpu",kernelFunc:Ise};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nse=Yn((t,e)=>t||e),Tse=gs(mm,Nse,null,"bool"),Ese={kernelName:mm,backendName:"cpu",kernelFunc:Tse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:l}=s;Je(r,"LRN");const u=r.shape[3],c=u-1,d=n.data.get(r.dataId).values,h=te(r.shape),p=new Float32Array(h);function f(m){const g=m%u;let y=m-g+Math.max(0,g-o);const x=m-g+Math.min(g+o,c);let v=0;for(;y<=x;y++){const b=d[y];v+=b*b}return v}for(let m=0;m<h;m++){const g=f(m),y=d[m]*Math.pow(i+a*g,-l);p[m]=y}return n.makeTensorInfo(r.shape,r.dtype,p)}const Dse={kernelName:gm,backendName:"cpu",kernelFunc:Rse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ase(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=s;Je(i,"LRNGrad");const d=te(i.shape),h=i.shape[3],p=n.data.get(i.dataId).values,f=n.data.get(r.dataId).values,m=n.data.get(o.dataId).values,g=new Float32Array(d),y=d;for(let x=0;x<y;x++){const v=x%h,b=x-v+Math.max(0,v-a),S=x-v+Math.min(h,v+a+1);let C=0;for(let I=b;I<S;I++)C+=Math.pow(f[I],2);C=u*C+l;for(let I=b;I<S;I++){let T=-2*u*c*f[I]*m[x]/C;x===I&&(T+=Math.pow(C,-c)),T*=p[x],g[I]+=T}}return n.makeTensorInfo(i.shape,r.dtype,g)}const _se={kernelName:V0,backendName:"cpu",kernelFunc:Ase};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function az(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=n;let l=r.shape;const u=l.length,c=xt(o,l);let d=c;const h=an(d,u);let p=a.data.get(r.dataId).values;if(h!=null){const b=new Array(u);for(let S=0;S<b.length;S++)b[S]=l[h[S]];p=Qk(p,l,r.dtype,h,b),d=yn(d.length,u),l=b}Je(r,"max"),ss("max",d,u);const[f,m]=qn(l,d),g=te(m),y=CL(p,g,f,r.dtype),x=a.write(y,f,r.dtype);let v=f;return i&&(v=Wn(f,c)),{dataId:x,shape:v,dtype:r.dtype}}const Fse={kernelName:ym,backendName:"cpu",kernelFunc:az};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Je(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;A(ms(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const c=qs(r.shape,o,i,u,a,l);let d;if(c.filterWidth===1&&c.filterHeight===1&&Ct(c.inShape,c.outShape))d=ua({inputs:{x:r},backend:n});else{const h=n.data.get(r.dataId).values,p=st(r.shape),f=eI(h,r.shape,r.dtype,p,c,"max");d=n.makeTensorInfo(c.outShape,r.dtype,f.values)}return d}const Ose={kernelName:xm,backendName:"cpu",kernelFunc:Pse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s;Je(r,"maxPool3d");const c=xo(r.shape,o,i,1,a,l,u),d=n.data.get(r.dataId).values,h=sz(d,r.shape,r.dtype,st(r.shape),c,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}const zse={kernelName:wm,backendName:"cpu",kernelFunc:Lse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mse(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=s;Je([r,o],"maxPool3DGrad");const c=xo(o.shape,i,a,1,l,u),d=n.bufferSync(o),h=Nte(d,c),p=c.strideDepth,f=c.strideHeight,m=c.strideWidth,g=c.dilationDepth,y=c.dilationHeight,x=c.dilationWidth,v=c.effectiveFilterDepth,b=c.effectiveFilterHeight,S=c.effectiveFilterWidth,C=v-1-c.padInfo.front,I=S-1-c.padInfo.left,T=b-1-c.padInfo.top,R=yt(o.shape,"float32"),_=n.bufferSync(r);for(let P=0;P<c.batchSize;++P)for(let z=0;z<c.inChannels;++z)for(let O=0;O<c.inDepth;++O)for(let V=0;V<c.inHeight;++V)for(let H=0;H<c.inWidth;++H){const Q=O-C,oe=V-T,j=H-I;let ee=0;for(let ie=0;ie<v;ie+=g){const le=(Q+ie)/p;if(!(le<0||le>=c.outDepth||Math.floor(le)!==le))for(let fe=0;fe<b;fe+=y){const ge=(oe+fe)/f;if(!(ge<0||ge>=c.outHeight||Math.floor(ge)!==ge))for(let xe=0;xe<S;xe+=x){const we=(j+xe)/m;if(we<0||we>=c.outWidth||Math.floor(we)!==we)continue;const Ie=v*b*S-1-h.get(P,le,ge,we,z),_e=ie*b*S+fe*S+xe,qe=Ie===_e?1:0;if(qe===0)continue;const Ze=_.get(P,le,ge,we,z);ee+=Ze*qe}}}R.set(ee,P,O,V,H,z)}return n.makeTensorInfo(R.shape,R.dtype,R.values)}const Bse={kernelName:W0,backendName:"cpu",kernelFunc:Mse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vse(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o,output:i}=e,a=o;Je([o,i],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:d}=s,h=qs(a.shape,l,u,1,c,d),p=n.data.get(a.dataId).values,f=yt(h.outShape,a.dtype,nz(p,a.shape,a.dtype,h).values),m=h.strideHeight,g=h.strideWidth,y=h.dilationHeight,x=h.dilationWidth,v=h.effectiveFilterHeight,b=h.effectiveFilterWidth,S=b-1-h.padInfo.left,C=v-1-h.padInfo.top,I=yt(a.shape,"float32"),T=n.data.get(r.dataId).values,R=yt(r.shape,"float32",T);for(let _=0;_<h.batchSize;++_)for(let P=0;P<h.inChannels;++P)for(let z=0;z<h.inHeight;++z)for(let O=0;O<h.inWidth;++O){const V=z-C,H=O-S;let Q=0;for(let oe=0;oe<v;oe+=y){const j=(V+oe)/m;if(!(j<0||j>=h.outHeight||Math.floor(j)!==j))for(let ee=0;ee<b;ee+=x){const ie=(H+ee)/g;if(ie<0||ie>=h.outWidth||Math.floor(ie)!==ie)continue;const le=v*b-1-f.get(_,j,ie,P),fe=oe*b+ee,ge=le===fe?1:0;if(ge===0)continue;const xe=R.get(_,j,ie,P);Q+=xe*ge}}I.set(Q,_,z,O,P)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}const Use={kernelName:U0,backendName:"cpu",kernelFunc:Vse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wse(t,e,n,s,r){const o=st(e),i=eI(t,e,n,o,r,"max"),a=nz(t,e,n,r,!0,s);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jse={kernelName:j0,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,l=n;Je(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,c=qs(s.shape,r,o,[1,1],i),[d,h]=Wse(u,s.shape,s.dtype,a,c),p=l.write(d,c.outShape,s.dtype),f=l.write(h,c.outShape,s.dtype);return[{dataId:p,shape:c.outShape,dtype:s.dtype},{dataId:f,shape:c.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=xt(o,r.shape),u=qn(r.shape,a)[1],c=te(u),d=[],h=n.makeTensorInfo([],"float32",new Float32Array([c]));d.push(h);const p=Pl({inputs:{x:r},backend:n,attrs:{dtype:"float32"}});d.push(p);const f=tI({inputs:{a:p,b:h},backend:n});d.push(f);const m=lg({inputs:{x:f},backend:n,attrs:{axis:o,keepDims:i}});return d.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const Hse={kernelName:vm,backendName:"cpu",kernelFunc:Gse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;Je(r,"min");const a=xt(o,r.shape);let l=a;const u=an(l,r.shape.length);let c=r;u!=null&&(c=$r({inputs:{x:r},backend:n,attrs:{perm:u}}),l=yn(l.length,r.shape.length)),ss("min",l,c.shape.length);const[d,h]=qn(c.shape,l),p=te(h),f=Ls(te(d),c.dtype),m=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){const x=y*p;let v=m[x];for(let b=0;b<p;++b){const S=m[x+b];(Number.isNaN(S)||S<v)&&(v=S)}f[y]=v}u!=null&&n.disposeIntermediateTensorInfo(c);const g=n.makeTensorInfo(d,c.dtype,f);if(i){const y=Wn(d,a),x=mn({inputs:{x:g},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(g),x}return g}const qse={kernelName:bm,backendName:"cpu",kernelFunc:Kse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:o,mode:i}=s;Je(r,"mirrorPad");const a=o.map((v,b)=>v[0]+r.shape[b]+v[1]),l=o.map(v=>v[0]),u=o.map((v,b)=>v[0]+r.shape[b]),c=i==="reflect"?0:1,d=n.data.get(r.dataId).values,h=r.shape.length,p=st(r.shape),f=te(a),m=a.length,g=st(a),y=ps(r.dtype,f);for(let v=0;v<f;v++){let b=Bd(v,m,g);for(let C=0;C<m;C++)b[C]<l[C]?b[C]=l[C]*2-b[C]-c:b[C]>=u[C]&&(b[C]=(u[C]-1)*2-b[C]+c);b=b.map((C,I)=>C-l[I]);const S=sa(b,h,p);y[v]=d[S]}return{dataId:n.write(y,a,r.dtype),shape:a,dtype:r.dtype}}const Yse={kernelName:Sm,backendName:"cpu",kernelFunc:Xse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qse=Yn((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),Jse=gs(mh,Qse),Zse={kernelName:mh,backendName:"cpu",kernelFunc:Jse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lz(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:o}=s,i=r.shape.length;let a=o;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const l=xt([a],r.shape),u=az({inputs:{x:r},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),c=Wn(u.shape,l),d=mn({inputs:{x:u},backend:n,attrs:{shape:c}}),h=Zk({inputs:{a:r,b:d},backend:n}),p=dL({inputs:{x:h},backend:n}),f=lg({inputs:{x:p},backend:n,attrs:{axis:l,keepDims:!1}}),m=mn({inputs:{x:f},backend:n,attrs:{shape:c}}),g=tI({inputs:{a:p,b:m},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const ere={kernelName:Bm,backendName:"cpu",kernelFunc:lz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tre(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s;Je(r,"multinomial");const l=a?r:lz({inputs:{logits:r},backend:n,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],d=n.data.get(l.dataId).values,h=[u,o],p=Ls(te(h),"int32");for(let f=0;f<u;++f){const m=f*c,g=new Float32Array(c-1);g[0]=d[m];for(let v=1;v<g.length;++v)g[v]=g[v-1]+d[m+v];const y=Iw.alea(i.toString()),x=f*o;for(let v=0;v<o;++v){const b=y();p[x+v]=g.length;for(let S=0;S<g.length;S++)if(b<g[S]){p[x+v]=S;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(h,"int32",p)}const nre={kernelName:G0,backendName:"cpu",kernelFunc:tre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sre=Pw;function rre(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s;Je(r,"NonMaxSuppression");const u=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,{selectedIndices:d}=sre(u,c,i,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const ore={kernelName:H0,backendName:"cpu",kernelFunc:rre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ire=fk;function are(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;Je(r,"NonMaxSuppressionPadded");const c=n.data.get(r.dataId).values,d=n.data.get(o.dataId).values,{selectedIndices:h,validOutputs:p}=ire(c,d,i,a,l,u);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}const lre={kernelName:f2,backendName:"cpu",kernelFunc:are};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ure=Ow;function cre(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;Je(r,"NonMaxSuppressionWithScore");const c=n.data.get(r.dataId).values,d=n.data.get(o.dataId).values,h=i,p=a,f=l,m=u,{selectedIndices:g,selectedScores:y}=ure(c,d,h,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const dre={kernelName:K0,backendName:"cpu",kernelFunc:cre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hre(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:l}=s;Je(r,"oneHot");const u=te(r.shape),c=new Float32Array(u*i);c.fill(l);const d=n.data.get(r.dataId).values;for(let h=0;h<u;++h)d[h]>=0&&d[h]<i&&(c[h*i+d[h]]=a);return n.makeTensorInfo([...r.shape,i],o,c)}const pre={kernelName:$m,backendName:"cpu",kernelFunc:hre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _x(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Zu({inputs:{input:s},backend:n}),o=_x({inputs:{x:r},backend:n}),i=Nd({inputs:{input:s},backend:n}),a=_x({inputs:{x:i},backend:n}),l=Mr({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return nI({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const fre={kernelName:Wm,backendName:"cpu",kernelFunc:_x};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uz(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Zu({inputs:{input:s},backend:n}),o=uz({inputs:{x:r},backend:n}),i=Nd({inputs:{input:s},backend:n}),a=_x({inputs:{x:i},backend:n}),l=Mr({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return nI({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const mre={kernelName:Im,backendName:"cpu",kernelFunc:uz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cz(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return Ax({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(c=>{Er(o,c.shape,"All tensors passed to stack must have matching shapes"),A(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const d=Ax({inputs:{input:c},backend:n,attrs:{dim:r}});return a.push(d),d}),u=Td({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),u}const gre={kernelName:Nm,backendName:"cpu",kernelFunc:cz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yre(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:o,constantValue:i}=s;Je(r,"pad");const a=o.map((x,v)=>x[0]+r.shape[v]+x[1]),l=o.map(x=>x[0]),u=n.data.get(r.dataId).values,c=te(r.shape),d=r.shape.length,h=st(r.shape),p=te(a),f=a.length,m=st(a),g=ps(r.dtype,p);i!==0&&g.fill(i);for(let x=0;x<c;x++){const b=Bd(x,d,h).map((C,I)=>C+l[I]),S=sa(b,f,m);g[S]=u[x]}return{dataId:n.write(g,a,r.dtype),shape:a,dtype:r.dtype}}const dz={kernelName:Tm,backendName:"cpu",kernelFunc:yre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xre=Yn((t,e)=>Math.pow(t,e)),wre=gs(yh,xre),vre={kernelName:yh,backendName:"cpu",kernelFunc:wre};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bre(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,a=r.map(g=>n.data.get(g.dataId).values),l=r.map(g=>g.shape),u=n.data.get(o.dataId).values,c=n.data.get(i.dataId).values,[d,h,p]=EL(a,l,u,o.shape,o.dtype,c,i.shape),f=d.map(g=>n.makeTensorInfo([g.length],"int32",g)),m=n.makeTensorInfo(p,o.dtype,h);return f.concat([m])}const Sre={kernelName:m2,backendName:"cpu",kernelFunc:bre};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cre(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:o}=e,i=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,[u,c]=RL(i,s.shape,s.dtype,a,r.shape,l,o.shape),d=n.makeTensorInfo([u.length],"int32",u),h=n.makeTensorInfo([c.length],s.dtype,c);return[d,h]}const kre={kernelName:g2,backendName:"cpu",kernelFunc:Cre};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ire(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,d=n.data.get(i.dataId).values,h=a.map(g=>n.data.get(g.dataId).values),p=a.map(g=>g.shape),[f,m]=DL(u,r.shape,c,o.shape,o.dtype,d,i.shape,h,p,l);return n.makeTensorInfo(f,o.dtype,m)}const $re={kernelName:y2,backendName:"cpu",kernelFunc:Ire};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nre(t){const{backend:e,attrs:n}=t,{start:s,stop:r,dtype:o,step:i}=n,a=AL(s,r,i,o);return e.makeTensorInfo([a.length],o,a)}const Tre={kernelName:q0,backendName:"cpu",kernelFunc:Nre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ere=tn(xh,t=>1/t),Rre={kernelName:xh,backendName:"cpu",kernelFunc:Ere};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dre(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;Je(r,"resizeBilinear");const l=st(r.shape),[u,c]=a,[d,h,p,f]=r.shape,m=n.data.get(r.dataId).values,g=new Float32Array(te([d,u,c,f])),y=[o&&u>1?h-1:h,o&&c>1?p-1:p],x=[o&&u>1?u-1:u,o&&c>1?c-1:c];let v=0;const b=y[0]/x[0],S=y[1]/x[1];for(let C=0;C<d;C++)for(let I=0;I<u;I++){let T;i?T=b*(I+.5)-.5:T=b*I;const R=Math.max(0,Math.floor(T)),_=T-R,P=Math.min(h-1,Math.ceil(T)),z=C*l[0]+R*l[1],O=C*l[0]+P*l[1];for(let V=0;V<c;V++){let H;i?H=S*(V+.5)-.5:H=S*V;const Q=Math.max(0,Math.floor(H)),oe=H-Q,j=Math.min(p-1,Math.ceil(H)),ee=z+Q*l[2],ie=O+Q*l[2],le=z+j*l[2],fe=O+j*l[2];for(let ge=0;ge<f;ge++){const xe=m[ee+ge],we=m[ie+ge],Ie=m[le+ge],_e=m[fe+ge],qe=xe+(Ie-xe)*oe,Ze=we+(_e-we)*oe,dt=qe+(Ze-qe)*_;g[v++]=dt}}}return n.makeTensorInfo([d,u,c,f],"float32",g)}const Are={kernelName:_m,backendName:"cpu",kernelFunc:Dre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _re(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s;Je([o,r],"resizeBilinearGrad");const a=st(r.shape),[l,u,c,d]=r.shape,[,h,p]=o.shape,f=new Float32Array(l*u*c*d),m=[i&&h>1?u-1:u,i&&p>1?c-1:c],g=[i&&h>1?h-1:h,i&&p>1?p-1:p],y=m[0]/g[0],x=m[1]/g[1],v=n.data.get(o.dataId).values;let b=0;for(let S=0;S<l;S++){const C=S*a[0];for(let I=0;I<h;I++){const T=I*y,R=Math.floor(T),_=Math.min(Math.ceil(T),u-1),P=C+R*a[1],z=C+_*a[1],O=T-R,V=1-O;for(let H=0;H<p;H++){const Q=H*x,oe=Math.floor(Q),j=Math.min(Math.ceil(Q),c-1),ee=Q-oe,ie=1-ee,le=P+oe*a[2],fe=P+j*a[2],ge=z+oe*a[2],xe=z+j*a[2],we=V*ie,Ie=V*ee,_e=O*ie,qe=O*ee;for(let Ze=0;Ze<d;Ze++){const dt=v[b++];f[le+Ze]+=dt*we,f[fe+Ze]+=dt*Ie,f[ge+Ze]+=dt*_e,f[xe+Ze]+=dt*qe}}}}return n.makeTensorInfo([l,c,u,d],"float32",f)}const Fre={kernelName:Q0,backendName:"cpu",kernelFunc:_re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pre(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;Je(r,"resizeNearestNeighbor");const l=st(r.shape),[u,c]=a,[d,h,p,f]=r.shape,m=n.data.get(r.dataId).values,g=new Float32Array(d*u*c*f),y=[o&&u>1?h-1:h,o&&c>1?p-1:p],x=[o&&u>1?u-1:u,o&&c>1?c-1:c],v=y[0]/x[0],b=y[1]/x[1];let S=0;for(let C=0;C<d;C++){const I=C*l[0];for(let T=0;T<u;T++){const R=i?v*(T+.5):v*T;let _=Math.min(h-1,o?Math.round(R):Math.floor(R));i&&(_=Math.max(0,_));const P=I+_*l[1];for(let z=0;z<c;z++){const O=i?b*(z+.5):b*z;let V=Math.min(p-1,o?Math.round(O):Math.floor(O));i&&(V=Math.max(0,V));const H=P+V*l[2];for(let Q=0;Q<f;Q++){const oe=m[H+Q];g[S++]=oe}}}}return n.makeTensorInfo([d,u,c,f],r.dtype,g)}const Ore={kernelName:Am,backendName:"cpu",kernelFunc:Pre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lre(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s;Je([o,r],"resizeNearestNeighborGrad");const a=st(r.shape),l=st(o.shape),[u,c,d,h]=r.shape,[,p,f]=o.shape,m=new Float32Array(u*c*d*h),g=n.data.get(o.dataId).values,y=[i&&p>1?c-1:c,i&&f>1?d-1:d],x=[i&&p>1?p-1:p,i&&f>1?f-1:f],v=y[0]/x[0],b=y[1]/x[1],S=1/v,C=1/b,I=Math.ceil(S)*2+2,T=Math.ceil(C)*2+2;for(let R=0;R<u;R++){const _=R*a[0];for(let P=0;P<c;P++){const z=_+P*a[1],O=Math.floor(P*S),V=Math.floor(O-I/2);for(let H=0;H<d;H++){const Q=z+H*a[2],oe=Math.floor(H*C),j=Math.floor(oe-T/2);for(let ee=0;ee<h;ee++){let ie=0;for(let le=0;le<I;le++){const fe=le+V;if(fe<0||fe>=p)continue;const ge=_+fe*l[1],xe=fe*v,we=Math.min(c-1,i?Math.round(xe):Math.floor(xe));if(P===we)for(let Ie=0;Ie<T;Ie++){const _e=Ie+j;if(_e<0||_e>=f)continue;const qe=ge+_e*l[2],Ze=_e*b,dt=Math.min(d-1,i?Math.round(Ze):Math.floor(Ze));H===dt&&(ie+=g[qe+ee])}}m[Q+ee]=ie}}}}return n.makeTensorInfo(r.shape,r.dtype,m)}const zre={kernelName:Y0,backendName:"cpu",kernelFunc:Lre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mre(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:o}=s;Je(r,"reverse");const i=r.shape.length,a=xt(o,r.shape);if(i===0)return ua({inputs:{x:r},backend:n});const l=new cs(r.shape,r.dtype),u=n.bufferSync(r);for(let c=0;c<l.size;c++){const d=l.indexToLoc(c),h=d.slice();a.forEach(p=>h[p]=r.shape[p]-1-h[p]),l.set(u.get(...h),...d)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const Bre={kernelName:Fm,backendName:"cpu",kernelFunc:Mre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vre={kernelName:cw,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:o,center:i}=e,a=n,l=ps(s.dtype,te(s.shape)),[u,c,d,h]=s.shape,[p,f]=Ww(i,c,d),m=255,g=Math.sin(r),y=Math.cos(r),x=a.data.get(s.dataId).values;for(let b=0;b<u;b++){const S=b*d*c*h;for(let C=0;C<c;C++){const I=C*(d*h);for(let T=0;T<d;T++){const R=T*h;for(let _=0;_<h;_++){const P=[u,C,T,_],z=P[2],O=P[1];let V=(z-p)*y-(O-f)*g,H=(z-p)*g+(O-f)*y;V=Math.round(V+p),H=Math.round(H+f);let Q=o;if(typeof o!="number"&&(_===3?Q=m:Q=o[_]),V>=0&&V<d&&H>=0&&H<c){const j=H*(d*h),ee=V*h,ie=S+j+ee+_;Q=x[ie]}const oe=S+I+R+_;l[oe]=Q}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ure=tn(bh,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),Wre={kernelName:bh,backendName:"cpu",kernelFunc:Ure};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jre(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:d}=fa(o,r,i),h=!0,p=n.bufferSync(r),f=n.bufferSync(o),m=ku(p,f,i,d,u,l,a,c,0,h);return n.makeTensorInfo(i,m.dtype,m.values)}const Gre={kernelName:J0,backendName:"cpu",kernelFunc:jre};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hre(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<e?n=r+1:s=r;return s}function Kre(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<=e?n=r+1:s=r;return s}function qre(t,e,n,s,r,o){const i=Mn("int32",n*r);for(let a=0;a<n;++a){const l=t.slice(a*s,(a+1)*s),u=a*r;for(let c=0;c<r;++c)i[u+c]=o==="left"?Hre(l,e[c+u]):Kre(l,e[c+u])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xre(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:o}=e,{side:i}=s,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,u=qre(a,l,r.shape[0],r.shape[1],o.shape[1],i);return n.makeTensorInfo(o.shape,"int32",u)}const Yre={kernelName:ew,backendName:"cpu",kernelFunc:Xre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qre(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:o}=e;Je([s,r,o],"select");const i=s.shape.length,a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,u=n.data.get(o.dataId).values,c=$s(r.dtype,o.dtype),d=Ls(te(r.shape),c);let h=0;const p=i===0||i>1||r.shape.length===1?1:te(r.shape.slice(1));for(let f=0;f<a.length;f++)for(let m=0;m<p;m++)a[f]===1?d[h++]=l[f]:d[h++]=u[f];return n.makeTensorInfo(r.shape,c,d)}const Jre={kernelName:Pm,backendName:"cpu",kernelFunc:Qre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zre=Jm,eoe=Zm,toe=tn(Ch,t=>t>=0?eoe*t:Zre*(Math.exp(t)-1)),noe={kernelName:Ch,backendName:"cpu",kernelFunc:toe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const soe=tn($h,t=>t<0?-1:t>0?1:0),roe={kernelName:$h,backendName:"cpu",kernelFunc:soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ooe=tn(kh,t=>Math.sin(t)),ioe={kernelName:kh,backendName:"cpu",kernelFunc:ooe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aoe=tn(Ih,t=>Math.sinh(t)),loe={kernelName:Ih,backendName:"cpu",kernelFunc:aoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uoe=11920928955078125e-23,OT=Math.log(uoe)+2,coe=tn(Th,t=>{const e=t>-OT,n=t<OT,s=Math.exp(t);let r;return n?r=s:e?r=t:r=Math.log(1+s),r}),doe={kernelName:Th,backendName:"cpu",kernelFunc:coe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hoe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,paddings:i}=s;Je([r],"spaceToBatchND");const a=te(o),l=[[0,0]];l.push(...i);for(let C=1+o.length;C<r.shape.length;++C)l.push([0,0]);const u=dz.kernelFunc({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),c=hc(u.shape,o,a,!1),d=pc(c.length,o.length,!1),h=fc(u.shape,o,a,!1),m=mn({inputs:{x:u},backend:n,attrs:{shape:c}}),x=$r({inputs:{x:m},backend:n,attrs:{perm:d}}),S=mn({inputs:{x},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(x),S}const poe={kernelName:zm,backendName:"cpu",kernelFunc:hoe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function foe(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,u=n.data.get(o.dataId).values,c=n.data.get(i.dataId).values[0],[d,h,p,f,m]=OL(a,s.shape,s.dtype,l,r.dtype,u,c);return[n.makeTensorInfo(h,s.dtype,d),n.makeTensorInfo([h[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(g=>Number(g)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const moe={kernelName:x2,backendName:"cpu",kernelFunc:foe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function goe(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(n.data.get(r.dataId).values),a=n.data.get(s.dataId).values,l=Array.from(n.data.get(o.dataId).values),[u,c,d]=LL(a,s.shape,s.dtype,i,l);return[n.makeTensorInfo(c,s.dtype,u),n.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const yoe={kernelName:w2,backendName:"cpu",kernelFunc:goe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xoe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,[u,c]=Jk(i,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(c,s.dtype,u)}const woe={kernelName:tw,backendName:"cpu",kernelFunc:xoe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function voe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,[u,c]=Jk(i,s.shape,s.dtype,a,l);return n.makeTensorInfo(c,s.dtype,u)}const boe={kernelName:nw,backendName:"cpu",kernelFunc:voe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Soe(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:c,strides:d,outputSize:h}=fa(o,r,a),p=!1,f=n.bufferSync(r);let m;switch(o.dtype){case"bool":{const g=n.bufferSync(o),y=!!n.data.get(i.dataId).values[0];m=ku(f,g,a,h,c,u,l,d,y,p);break}case"float32":{const g=n.bufferSync(o),y=n.data.get(i.dataId).values[0];m=ku(f,g,a,h,c,u,l,d,y,p);break}case"int32":{const g=n.bufferSync(o),y=n.data.get(i.dataId).values[0];m=ku(f,g,a,h,c,u,l,d,y,p);break}case"string":{const g=n.bufferSync(o),y=ki(n.data.get(i.dataId).values[0]);m=ku(f,g,a,h,c,u,l,d,y,p);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return n.makeTensorInfo(a,m.dtype,m.values)}const Coe={kernelName:sw,backendName:"cpu",kernelFunc:Soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function koe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=xt(i,r.shape)[0],l=s1(r,o,a),u=new Array(r.shape.length).fill(0),c=r.shape.slice();return l.map(d=>{const h=[...c];h[a]=d;const p=ec({inputs:{x:r},backend:n,attrs:{begin:u,size:h}});return u[a]+=d,p})}const Ioe={kernelName:Mm,backendName:"cpu",kernelFunc:koe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $oe={kernelName:rw,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;Je(n,"square");const r=s.data.get(n.dataId).values,o=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];o[a]=l*l}return{dataId:s.write(o,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Noe=tn(Ph,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),Toe={kernelName:Ph,backendName:"cpu",kernelFunc:Noe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eoe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:d,shrinkAxisMask:h}=s;Je(r,"stridedSlice");const{finalShapeSparse:p,finalShape:f,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:x,end:v,strides:b}=Bw(r.shape,o,i,a,l,u,c,d,h);let S;if(m)S=mn({inputs:{x:r},backend:n,attrs:{shape:f}});else if(g||y){A(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const C=Mw(x,v,b),I=ec({inputs:{x:r},backend:n,attrs:{begin:x,size:C}});S=mn({inputs:{x:I},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(I)}else{const C=n.bufferSync(r),I=BL(p,C,b,x);S=n.makeTensorInfo(f,I.dtype,I.values)}return S}const Roe={kernelName:iw,backendName:"cpu",kernelFunc:Eoe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Doe(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:c,dataSplits:d}=e,h=n.data.get(c.dataId).values,p=n.data.get(d.dataId).values,[f,m]=VL(h,p,r,o,i,a,l,u);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(d.shape,"int32",m)]}const Aoe={kernelName:aw,backendName:"cpu",kernelFunc:Doe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _oe(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.data.get(o.dataId).values,l=n.data.get(i.dataId).values[0],[u,c,d]=UL(a,l,r),h=c.length;return[n.makeTensorInfo([h,2],"int32",u),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const Foe={kernelName:v2,backendName:"cpu",kernelFunc:_oe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Poe(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=n.data.get(o.dataId).values,a=WL(i,r);return n.makeTensorInfo(o.shape,"int32",a)}const Ooe={kernelName:b2,backendName:"cpu",kernelFunc:Poe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Loe=tn(Ah,t=>Math.tan(t)),zoe={kernelName:Ah,backendName:"cpu",kernelFunc:Loe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Moe=tn(_h,t=>Math.tanh(t)),Boe={kernelName:_h,backendName:"cpu",kernelFunc:Moe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Voe(t){const{inputs:e,backend:n}=t,{tensor:s,indices:r,updates:o}=e,{sliceRank:i,numUpdates:a,sliceSize:l,strides:u,outputSize:c}=fa(o,r,s.shape),d=!1,h=n.bufferSync(r),p=n.bufferSync(o),f=n.bufferSync(s),m=ku(h,p,s.shape,c,l,a,i,u,f,d);return n.makeTensorInfo(s.shape,m.dtype,m.values)}const Uoe={kernelName:Z0,backendName:"cpu",kernelFunc:Voe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Woe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:o}=s;Je(r,"tile");const i=GL(n.bufferSync(r),o);return n.makeTensorInfo(i.shape,i.dtype,i.values)}const joe={kernelName:Fh,backendName:"cpu",kernelFunc:Woe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Goe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:o,sorted:i}=s;Je(r,"topk");const a=n.data.get(r.dataId).values,[l,u]=KL(a,r.shape,r.dtype,o,i);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}const Hoe={kernelName:lw,backendName:"cpu",kernelFunc:Goe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Koe(t){const{inputs:e,attrs:n,backend:s}=t,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=n,[c,d,h,p]=r.shape,[f,m]=u??[d,h],g=[c,f,m,p],y=st(r.shape),x=y[0],v=y[1],b=y[2],S=st(g),C=S[0],I=S[1],T=S[2],R=ps(r.dtype,te(g));R.fill(l);const _=s.data.get(r.dataId).values,P=s.data.get(o.dataId).values;for(let O=0;O<c;++O){const V=o.shape[0]===1?P:P.subarray(O*8,O*8+8);for(let H=0;H<f;++H)for(let Q=0;Q<m;++Q)for(let oe=0;oe<p;++oe){let j;const ee=V[6]*Q+V[7]*H+1;if(ee===0)continue;const ie=(V[0]*Q+V[1]*H+V[2])/ee,le=(V[3]*Q+V[4]*H+V[5])/ee,fe=LT(ie,h,a),ge=LT(le,d,a);switch(i){case"nearest":j=Zoe(_,d,h,x,v,b,O,ge,fe,oe,l);break;case"bilinear":j=eie(_,d,h,x,v,b,O,ge,fe,oe,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const xe=O*C+H*I+Q*T+oe;R[xe]=j}return s.makeTensorInfo(g,r.dtype,R)}return{dataId:s.write(R,g,r.dtype),shape:r.shape,dtype:r.dtype}}const qoe={kernelName:uw,backendName:"cpu",kernelFunc:Koe};function LT(t,e,n){switch(n){case"reflect":return Xoe(t,e);case"wrap":return Yoe(t,e);case"nearest":return Joe(t,e);case"constant":default:return Qoe(t)}}function Xoe(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=2*e;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-e?n+s:-n-1}else if(n>e-1)if(e<=1)n=0;else{const s=2*e;n-=s*Math.trunc(n/s),n>=e&&(n=s-n-1)}return Vu(0,n,e-1)}function Yoe(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=e-1;n+=e*(Math.trunc(-n/s)+1)}else if(n>e-1)if(e<=1)n=0;else{const s=e-1;n-=e*Math.trunc(n/s)}return Vu(0,n,e-1)}function Qoe(t,e){return t}function Joe(t,e){return Vu(0,t,e-1)}function Ap(t,e,n,s,r,o,i,a,l,u,c){const d=i*s+a*r+l*o+u;return 0<=a&&a<e&&0<=l&&l<n?t[d]:c}function Zoe(t,e,n,s,r,o,i,a,l,u,c){const d=Math.round(a),h=Math.round(l);return Ap(t,e,n,s,r,o,i,d,h,u,c)}function eie(t,e,n,s,r,o,i,a,l,u,c){const d=Math.floor(a),h=Math.floor(l),p=d+1,f=h+1,m=(f-l)*Ap(t,e,n,s,r,o,i,d,h,u,c)+(l-h)*Ap(t,e,n,s,r,o,i,d,f,u,c),g=(f-l)*Ap(t,e,n,s,r,o,i,p,h,u,c)+(l-h)*Ap(t,e,n,s,r,o,i,p,f,u,c);return(p-a)*m+(a-d)*g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tie(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:o}=e;Je(o,"unique");const i=s.data.get(o.dataId).values,{outputValues:a,outputShape:l,indices:u}=qL(i,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const nie={kernelName:S2,backendName:"cpu",kernelFunc:tie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sie(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r.shape.length,a=r.shape[o],l=new Array(i-1);let u=0;for(let p=0;p<i;p++)p!==o&&(l[u++]=r.shape[p]);const c=new Array(i).fill(0),d=r.shape.slice();d[o]=1;const h=new Array(a);for(let p=0;p<h.length;p++){c[o]=p;const f=ec({inputs:{x:r},backend:n,attrs:{begin:c,size:d}});h[p]=mn({inputs:{x:f},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(f)}return h}const rie={kernelName:Vm,backendName:"cpu",kernelFunc:sie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oie(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:o}=e,{numSegments:i}=s;Je(r,"unsortedSegmentSum");const a=r.shape.length,l=o.shape.length,u=[],c=[],d=a-l;let h=o;for(let f=0;f<d;++f){const m=Ax({inputs:{input:h},backend:n,attrs:{dim:f+1}});h=m,c.push(m)}for(let f=0;f<i;++f){const m=Ul(f,"int32"),g=n.makeTensorInfo([],"int32",m),y=uL({inputs:{a:g,b:h},backend:n}),x=Pl({inputs:{x:y},backend:n,attrs:{dtype:"float32"}}),v=g1({inputs:{a:x,b:r},backend:n}),b=lg({inputs:{x:v},backend:n,attrs:{axis:0,keepDims:!1}});u.push(b),c.push(g),c.push(y),c.push(x),c.push(v),c.push(b)}const p=cz({inputs:u,backend:n,attrs:{axis:0}});return c.forEach(f=>n.disposeIntermediateTensorInfo(f)),p}const iie={kernelName:Um,backendName:"cpu",kernelFunc:oie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aie=[tte,OZ,ste,ote,UZ,ate,ute,dte,pte,mte,yte,wte,bte,kte,$te,Ete,Dte,_te,Pte,Zee,Lte,Mte,Vte,jZ,Wte,BZ,HZ,Gte,LZ,Kte,Xte,Yte,Jte,ene,nne,rne,ine,lne,cne,hne,fne,gne,xne,vne,bne,Cne,Ine,Nne,Tne,Ene,Rne,Ane,Pne,Hee,Lne,KZ,Gne,qZ,Hne,YZ,Jne,Zne,tse,JZ,eee,sse,ose,ase,use,nee,ree,zZ,dse,qte,pse,mse,yse,Kee,iee,lee,wse,cee,bse,kse,$se,Ese,Dse,_se,Fse,hee,Ose,zse,Bse,Use,jse,Hse,qse,fee,Yse,Zse,nre,gee,xee,ore,lre,dre,vee,pre,mre,gre,dz,vre,Xee,Cee,Sre,kre,$re,Tre,MZ,OS,Rre,Yee,Qee,Jee,Are,Fre,Ore,zre,Bre,Vre,Wre,Dee,Gre,Yre,Jre,noe,_ee,roe,ioe,loe,Fee,ere,doe,poe,moe,yoe,woe,boe,Coe,Ioe,Lee,$oe,Mee,Vee,Toe,Roe,Aoe,Foe,Ooe,Gee,_ne,zoe,Boe,Uoe,joe,Hoe,qoe,bee,nie,rie,iie,fre];for(const t of aie)C2(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mu={},Jg={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function lie(t,e){mu[t]=e}function Di(t,e){if(!(t in mu)||e!=null){const s=cie(t,e);if(s!==null)mu[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=mu[t];return n==null||n.isContextLost()?(delete mu[t],Di(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),mu[t])}function uie(t){if(!re().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function cie(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??uie(t);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete mu[t]},!1),re().getBool("SOFTWARE_WEBGL_ENABLED")&&(Jg.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",Jg)||n.getContext("experimental-webgl",Jg):n.getContext("webgl2",Jg)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Tf;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(Tf||(Tf={}));var ao;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(ao||(ao={}));var Ps;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Ps||(Ps={}));function ug(t,e){return[e,t]}function die(t,e){return t*e}function Zg(t){const e=te(t),n=Math.ceil(e/4);return Kb(n)}function Uh(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function hie(t,e){const[n,s]=Uh(t,e);return n*s*4}function sI(t,e){const n=t;let s,r,o,i,a,l,u,c,d,h;return re().getNumber("WEBGL_VERSION")===2?(s=n.R32F,r=n.R16F,o=n.RGBA16F,i=n.RGBA32F,a=n.RED,u=4,c=1,d=n.HALF_FLOAT,h=n.FLOAT,l=n.RGBA8):(s=t.RGBA,r=t.RGBA,o=t.RGBA,i=n.RGBA,a=t.RGBA,u=4,c=4,d=e!=null?e.HALF_FLOAT_OES:null,h=t.FLOAT,l=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:d,textureTypeFloat:h}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ue(t,e){const n=e();return re().getBool("DEBUG")&&pie(t),n}function pie(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+yie(t,e))}const fie=596e-10,mie=65504;function gie(t){return!!(re().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||fie<Math.abs(t)&&Math.abs(t)<mie)}function yie(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function ey(t,e){return Ha(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function xie(t,e){const n=Ha(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Ue(t,()=>t.shaderSource(n,e)),Ue(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function wie(t,e){const n=Ha(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Ue(t,()=>t.shaderSource(n,e)),Ue(t,()=>t.compileShader(n)),re().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw hz(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const vie=/ERROR: [0-9]+:([0-9]+):/g;function hz(t,e){const n=vie.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],r=t.split(`
`),o=r.length.toString().length+2,i=r.map((d,h)=>od((h+1).toString(),o)+d);let a=0;for(let d=0;d<i.length;d++)a=Math.max(i[d].length,a);const l=i.slice(0,s-1),u=i.slice(s-1,s),c=i.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${od(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function bie(t){return Ha(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function Sie(t,e){if(Ue(t,()=>t.linkProgram(e)),!re().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Dv(t,e){if(Ue(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function Cie(t,e){const n=Ha(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Ue(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),Ue(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function kie(t,e){const n=Ha(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Ue(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),Ue(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function Iie(t){return Ha(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function $ie(t,e){const n=re().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,r=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function Nie(t){return Ha(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function zT(t,e,n,s,r,o,i){const a=t.getAttribLocation(e,n);return a===-1?!1:(Ue(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),Ue(t,()=>t.vertexAttribPointer(a,r,t.FLOAT,!1,o,i)),Ue(t,()=>t.enableVertexAttribArray(a)),!0)}function Tie(t,e,n){_ie(t,n),Ue(t,()=>t.activeTexture(t.TEXTURE0+n)),Ue(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function Eie(t,e,n){return Ha(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function Rie(t,e,n){return t.getUniformLocation(e,n)}function Die(t,e,n,s){Ue(t,()=>Tie(t,e,s)),Ue(t,()=>t.uniform1i(n,s))}function Av(t,e,n){Ue(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),Ue(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function MT(t,e){Ue(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),Ue(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function ty(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Aie(t,e))}function Aie(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Ha(t,e,n){const s=Ue(t,()=>e());if(s==null)throw new Error(n);return s}function _ie(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const r=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Ed(t,e=2){return te(t.slice(0,t.length-e))}function Rd(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function ny(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Ed(t),...Rd(t)]),e}function Fie(t,e=!1){let n=re().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=re().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&re().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((a,l)=>l>=t.length-2?l2(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=Vl(t).newShape);let r=te(t),o=null;t.length<=1&&r<=n?o=[1,r]:t.length===2&&t[0]<=n&&t[1]<=n?o=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?o=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?o=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?o=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(o=[t[0],t[1]*t[2]*t[3]]);const i=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||i)if(e){const a=Ed(t);let l=2,u=2;t.length&&([l,u]=Rd(t)),r=a*(l/2)*(u/2),o=Kb(r).map(c=>c*2)}else o=Kb(r);return o}function sy(t){return t%2===0}function Fx(t,e){if(t=t.slice(-2),e=e.slice(-2),Ct(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],s=e[e.length-1];if(n===s||sy(n)&&sy(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&sy(t[0])&&sy(e[0])}let _v,Fv;function Pie(t){if(_v==null){const e=Di(t);_v=e.getParameter(e.MAX_TEXTURE_SIZE)}return _v}function Oie(t){if(Fv==null){const e=Di(t);Fv=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Fv)}function Lie(t){if(t===0)return 0;let e;const n=Di(t);return Uo(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:Uo(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function Uo(t,e){return t.getExtension(e)!=null}function BT(t){try{if(Di(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function zie(t){if(t===0)return!1;const e=Di(t);if(t===1){if(!Uo(e,"OES_texture_float"))return!1}else if(!Uo(e,"EXT_color_buffer_float"))return!1;return zS(e)}function Mie(t){if(t===0)return!1;const e=Di(t);if(t===1){if(!Uo(e,"OES_texture_float")||!Uo(e,"WEBGL_color_buffer_float"))return!1}else{if(Uo(e,"EXT_color_buffer_float"))return zS(e);const s="EXT_color_buffer_half_float";if(Uo(e,s)){const r=e.getExtension(s);return Bie(e,r)}return!1}return zS(e)}function zS(t){const e=sI(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(o),i}function Bie(t,e){const n=sI(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(i),a}function Vie(t){return t!==2?!1:Di(t).fenceSync!=null}function cg(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&A(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tt=re();tt.registerFlag("HAS_WEBGL",()=>tt.getNumber("WEBGL_VERSION")>0);tt.registerFlag("WEBGL_VERSION",()=>BT(2)?2:BT(1)?1:0);tt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);tt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>tt.get("WEBGL_VERSION")===2);tt.registerFlag("WEBGL_CPU_FORWARD",()=>!0);tt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);tt.registerFlag("WEBGL_PACK",()=>tt.getBool("HAS_WEBGL"));tt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_CLIP",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_REDUCE",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_LAZILY_UNPACK",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_CONV_IM2COL",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>tt.getBool("WEBGL_PACK"));tt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>Pie(tt.getNumber("WEBGL_VERSION")));tt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>Oie(tt.getNumber("WEBGL_VERSION")));tt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=tt.getNumber("WEBGL_VERSION");return t===0?0:Lie(t)});tt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>tt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!w3());tt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>zie(tt.getNumber("WEBGL_VERSION")));tt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>tt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:tt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));tt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Mie(tt.getNumber("WEBGL_VERSION")));tt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Vie(tt.getNumber("WEBGL_VERSION")));tt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>tt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);tt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});tt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>w3()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});tt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);tt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);tt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);tt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);tt.registerFlag("WEBGL_EXP_CONV",()=>!1);tt.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>tt.getBool("IS_TEST"));tt.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);tt.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);tt.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);tt.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mr(){let t,e,n,s,r,o,i,a,l,u;return re().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",r="texture",o="outputColor",i="out vec4 outputColor;",a=re().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",r="texture2D",o="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:r,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yc(t,e,n="index"){const s=st(e);return s.map((r,o)=>{const i=`int ${t[o]} = ${n} / ${r}`,a=o===s.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${r}`:`index -= ${t[o]} * ${r}`;return`${i}; ${a};`}).join("")}function y1(t,e,n="index"){const s=st(e);return s.map((r,o)=>{const i=`int ${t[o]} = ${n} / outShapeStrides[${o}]`,a=o===s.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * outShapeStrides[${o}]`:`index -= ${t[o]} * outShapeStrides[${o}]`;return`${i}; ${a};`}).join("")}function Uie(t,e){const n=t.length,s=t.map(o=>`${e}[${o}]`),r=new Array(n-1);r[n-2]=s[n-1];for(let o=n-3;o>=0;--o)r[o]=`(${r[o+1]} * ${s[o+1]})`;return r}function Wie(t,e,n="index"){const s=t.map((o,i)=>i),r=Uie(s,e);return r.map((o,i)=>{const a=`int ${t[i]} = ${n} / ${r[i]}`,l=i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${r[i]}`:`index -= ${t[i]} * ${r[i]}`;return`${a}; ${l};`}).join("")}function rI(t){const e=st(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function oI(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const pz=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:fz}=a7;function jie(t,e,n){const s=[];if(t.forEach(p=>{const f=te(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?s.push(`uniform float ${p.name}${f>1?`[${f}]`:""};`):(s.push(`uniform sampler2D ${p.name};`),s.push(`uniform int offset${p.name};`)),n.enableShapeUniforms){const{uniformShape:m}=iI(n.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(m.length){case 1:s.push(`uniform int ${p.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${p.name}Shape;`);break}s.push(`uniform ivec2 ${p.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(p=>{s.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});const r=s.join(`
`),o=t.map(p=>Gie(p,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),i=e.texShape,a=mr(),l=qie(a);let u,c,d=Qie(a);return e.isPacked?(u=Hie(e.logicalShape,i,n.enableShapeUniforms),c=Yie(a)):(u=Kie(e.logicalShape,i,n.enableShapeUniforms),c=Xie(a)),n.packedInputs&&(d+=tae),[d,l,c,r,u,o,n.userCode].join(`
`)}function Wh(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return pae(t,e);case 1:return mae(t,e);case 2:return yae(t,e);case 3:return wae(t,e);case 4:return bae(t,e);case 5:return Sae(t);case 6:return Cae(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function mz(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return hae(t);case 1:return fae(t,e);case 2:return gae(t,e);case 3:return xae(t,e);default:return vae(t,e)}}function Gie(t,e,n=!1,s){let r="";n?r+=mz(t,s):r+=Wh(t,s);const o=t.shapeInfo.logicalShape,i=e.logicalShape;return o.length<=i.length&&(n?r+=kae(t,e):r+=Iae(t,e)),r}function Hie(t,e,n){switch(t.length){case 0:return gz();case 1:return nae(t,e,n);case 2:return cae(t,e,n);case 3:return rae(t,e,n);default:return iae(t,e,n)}}function Kie(t,e,n){switch(t.length){case 0:return gz();case 1:return sae(t,e,n);case 2:return dae(t,e,n);case 3:return oae(t,e,n);case 4:return aae(t,e,n);case 5:return lae(t,e);case 6:return uae(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function qie(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function Xie(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function Yie(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function Qie(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Jie}
    ${Zie}
    ${eae}
  `}const Jie=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Zie=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,eae=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,tae=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function gz(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function nae(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function sae(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function rae(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),o=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function oae(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${y1(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=yc(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function iae(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2);let i=o,a="",l="b, r, c";for(let u=2;u<t.length-1;u++)i*=t[t.length-u-1],a=`
      int b${u} = index / ${i};
      index -= b${u} * ${i};
    `+a,l=`b${u}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${l});
    }
  `}function aae(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${y1(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=yc(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function lae(t,e){const n=yc(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function uae(t,e){const n=yc(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function cae(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Ct(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function dae(t,e,n){return Ct(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function xc(t){return`offset${t}`}function hae(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=mr();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function pae(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[r,o]=t.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const i=xc(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${i});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${i});
      return sampleTexture(${n}, uv);
    }
  `}function fae(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,o=mr();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${n}, uv);
    }
  `;const i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${o.texture2D}(${n}, uv);
    }
  `}function mae(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${jh(t)}
      }
    `;const r=t.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=xc(n);return i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${n}, uv);
      }
    `:o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function gae(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t.shapeInfo.texShape,i=o[0],a=o[1],l=mr();if(o!=null&&Ct(n,o))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function yae(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t.shapeInfo.texShape;if(o!=null&&Ct(n,o)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const h=o[0],p=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:a}=Vl(n),l=i;if(l.length<n.length){const h=Gh(t,l),p=["row","col"];return`
      ${Wh(h,e)}
      float ${r}(int row, int col) {
        return ${r}(${Hh(p,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${jh(t)}
      }
    `;const u=o[0],c=o[1],d=xc(s);return c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${d};
    vec2 uv = uvFromFlat(${u}, ${c}, index);
    return sampleTexture(${s}, uv);
  }
`}function xae(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(n[0]===1){const h=n.slice(1),p=[1,2],f=Gh(t,h),m=["b","row","col"];return`
        ${mz(f,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Hh(m,p)});
        }
      `}const a=mr();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=i[0],u=i[1],c=Math.ceil(n[2]/2),d=c*Math.ceil(n[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${d}, ${c}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function wae(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n[1]*n[2],i=n[2],{newShape:a,keptDims:l}=Vl(n),u=a;if(u.length<n.length){const m=Gh(t,u),g=["row","col","depth"];return`
        ${Wh(m,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Hh(g,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${jh(t)}
      }
    `;const c=t.shapeInfo.texShape,d=c[0],h=c[1],p=t.shapeInfo.flatOffset;if(h===o&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${h}.0, ${d}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(h===i&&p==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `;const f=xc(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${f};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${f};
        vec2 uv = uvFromFlat(${d}, ${h}, index);
        return sampleTexture(${s}, uv);
      }
  `}function vae(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=mr();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);
    }
  `;const o=t.shapeInfo.logicalShape,i=o.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],c=l[1],d=Math.ceil(o[i-1]/2);let h=d*Math.ceil(o[i-2]/2),p="int b, int row, int col",f=`b * ${h} + (row / 2) * ${d} + (col / 2)`;for(let m=2;m<i-1;m++)p=`int b${m}, `+p,h*=o[i-m-1],f=`b${m} * ${h} + `+f;return`
    vec4 ${s}(${p}) {
      int index = ${f};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${u});
      return ${r.texture2D}(${n}, uv);
    }
  `}function bae(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n[3],i=n[2]*o,a=n[1]*i,{newShape:l,keptDims:u}=Vl(n);if(l.length<n.length){const x=Gh(t,l),v=["row","col","depth","depth2"];return`
      ${Wh(x,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Hh(v,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${o}, 1)));
        ${jh(t)}
      }
    `;const c=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,h=d[0],p=d[1],f=`int stride2 = ${s}Shape[3];`,m=`int stride1 = ${s}Shape[2] * stride2;`,g=`int stride0 = ${s}Shape[1] * stride1;`;if(p===a&&c==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${f}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${h}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(p===o&&c==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${h}.0);
        return sampleTexture(${s}, uv);
      }
    `;const y=xc(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${f}
      ${m}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${y});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${h}, ${p}, index + ${y});
      return sampleTexture(${s}, uv);
    }
  `}function Sae(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[4],o=e[3]*r,i=e[2]*o,a=e[1]*i,{newShape:l,keptDims:u}=Vl(e);if(l.length<e.length){const m=Gh(t,l),g=["row","col","depth","depth2","depth3"];return`
      ${Wh(m)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Hh(g,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${o}, ${r})) +
          depth3;
        ${jh(t)}
      }
    `;const c=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,h=d[0],p=d[1];if(p===a&&c==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===r&&c==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;const f=xc(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${o} +
          depth2 * ${r} + depth3 + ${f};
      vec2 uv = uvFromFlat(${h}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Cae(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:o}=Vl(e);if(r.length<e.length){const g=Gh(t,r),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${Wh(g)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Hh(y,o)});
      }
    `}const i=e[5],a=e[4]*i,l=e[3]*a,u=e[2]*l,c=e[1]*u;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${jh(t)}
      }
    `;const d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,p=h[0],f=h[1];if(f===c&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===i&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;const m=xc(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${m};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function jh(t){const e=t.name,n=te(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function kae(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",o=t.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=fz(t.shapeInfo.logicalShape,e.logicalShape),l=on(i),u=i-o;let c;const d=["x","y","z","w","u","v"];o===0?c="":i<2&&a.length>=1?c="coords = 0;":c=a.map(x=>`coords.${d[x+u]} = 0;`).join(`
`);let h="";i<2&&o>0?h="coords":h=t.shapeInfo.logicalShape.map((x,v)=>`coords.${d[v+u]}`).join(", ");let p="return outputValue;";const m=te(t.shapeInfo.logicalShape)===1,y=te(e.logicalShape)===1;if(o===1&&!m&&!y)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!y)i===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(a.length){const x=o-2,v=o-1;a.indexOf(x)>-1&&a.indexOf(v)>-1?p="return vec4(outputValue.x);":a.indexOf(x)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(v)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${s}(${h});
      ${p}
    }
  `}function Iae(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",o=e.texShape,i=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&Ct(i,o))return`
      float ${r}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const u=on(l),c=fz(t.shapeInfo.logicalShape,e.logicalShape),d=l-a;let h;const p=["x","y","z","w","u","v"];a===0?h="":l<2&&c.length>=1?h="coords = 0;":h=c.map(m=>`coords.${p[m+d]} = 0;`).join(`
`);let f="";return l<2&&a>0?f="coords":f=t.shapeInfo.logicalShape.map((m,g)=>`coords.${p[g+d]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${h}
      return get${s}(${f});
    }
  `}function on(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function iI(t,e,n){const{newShape:s,keptDims:r}=Vl(e),o=e.length,i=t&&o===3&&e[0]===1,a=i?e.slice(1):s,l=!t&&o>1&&!Ct(e,n)&&s.length<o||i;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function Gh(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Hh(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ae(t,e,n,s){const r=n.map((c,d)=>{const h={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(h.flatOffset=c.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:h}}),o=r.map(c=>c.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=jie(r,i,e),l=wie(t.gl,a),u=t.createProgram(l);return re().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:o,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:o,outShapeInfo:i},yz(t,e,u)))}function yz(t,e,n){const s=[],r=[];let o,i,a,l=null,u=null;u=t.getUniformLocation(n,"NAN",!1),re().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const c=!1;for(const d of e.variableNames){const h={name:d,uniform:t.getUniformLocation(n,d,c),offset:t.getUniformLocation(n,`offset${d}`,c)};e.enableShapeUniforms&&(h.shape=t.getUniformLocation(n,`${d}Shape`,c),h.texShape=t.getUniformLocation(n,`${d}TexShape`,c)),s.push(h)}if(e.enableShapeUniforms&&(o=t.getUniformLocation(n,"outShape",c),a=t.getUniformLocation(n,"outShapeStrides",c),i=t.getUniformLocation(n,"outTexShape",c)),e.customUniforms)for(const d of e.customUniforms)r.push(t.getUniformLocation(n,d.name,c));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:i}}function VT(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const r=n.logicalShape,o=e[s],i=o.shape;if(!Ct(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(n.isUniform&&o.isUniform)return;const a=n.texShape,l=o.isUniform?null:o.texData.texShape;if(!Ct(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function Nae(t,e,n,s,r){e.program.enableShapeUniforms||(VT(e.inShapeInfos,n),VT([e.outShapeInfo],[s]));const o=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):t.setOutputMatrixTexture(o.texture,i[0],i[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),re().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const u=n[l],{uniform:c,offset:d,shape:h,texShape:p}=e.variablesLocations[l];if(h){const{uniformShape:f}=iI(e.program.packedInputs,u.shape,u.texData.texShape);switch(f.length){case 1:t.gl.uniform1iv(h,new Int32Array(f));break;case 2:t.gl.uniform2iv(h,new Int32Array(f));break;case 3:t.gl.uniform3iv(h,new Int32Array(f));break;case 4:t.gl.uniform4iv(h,new Int32Array(f));break}}if(p&&t.gl.uniform2i(p,u.texData.texShape[0],u.texData.texShape[1]),c!=null){if(u.isUniform){if(te(u.shape)<2)t.gl.uniform1f(c,u.uniformValues[0]);else{let f=u.uniformValues;f instanceof Float32Array||(f=new Float32Array(f)),t.gl.uniform1fv(c,f)}continue}u.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,u.texData.slice.flatOffset),t.setInputMatrixTexture(u.texData.texture.texture,c,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=st(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],c=e.customUniformLocations[l],d=r[l];if(u.type==="float")t.gl.uniform1fv(c,d);else if(u.type==="vec2")t.gl.uniform2fv(c,d);else if(u.type==="vec3")t.gl.uniform3fv(c,d);else if(u.type==="vec4")t.gl.uniform4fv(c,d);else if(u.type==="int")t.gl.uniform1iv(c,d);else if(u.type==="ivec2")t.gl.uniform2iv(c,d);else if(u.type==="ivec3")t.gl.uniform3iv(c,d);else if(u.type==="ivec4")t.gl.uniform4iv(c,d);else throw Error(`uniform type ${u.type} is not supported yet.`)}t.executeProgram()}function Tae(t,e,n){let s="";e.concat(n).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!i.isUniform){const l=i.texData.texShape,{useSqueezeShape:u,uniformShape:c,keptDims:d}=iI(t.packedInputs,i.shape,l);let h="",p="",f="";if(c.length===1&&t.packedInputs){const S=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];h=`${S[0]>1}_${S[1]>1}`}else if(c.length===2&&!t.packedInputs)p=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!t.packedInputs){const S=st(c);f=`${S[0]===l[1]}_${S[S.length-1]===l[1]}`}const m=i.shape.length,g=c.length===2&&Ct(i.shape,l),y=te(i.shape)===1,x=El(i.shape,n.shape),v=!t.packedInputs&&m===n.shape.length&&Ct(l,n.texData.texShape),b=t.packedInputs||c.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${m}_${v}_${u?d:""}_${c.length}_${y}_${x}_${g}_${h}_${p}_${f}_${b}_${a}`}else{const l=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${l}_${a}`}});const r=t.userCode;let o=t.constructor.name;return o+="_"+s+"_"+r+`${re().getNumber("WEBGL_VERSION")}`,o}function Ys(t){return re().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eae{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Tf.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=mr();this.outputShape=e,this.enableShapeUniforms=Ys(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?y1(["r","c","d"],e):yc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rae{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Tf.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=mr();this.outputShape=e,this.enableShapeUniforms=Ys(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?y1(["r","c","d"],e):yc(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dae{constructor(e){this.variableNames=["A"],this.outTexUsage=ao.DOWNLOAD;const n=mr();this.outputShape=e,this.userCode=`
      ${pz}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aae{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ao.DOWNLOAD;const n=mr();this.outputShape=e,this.userCode=`
      ${pz}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ae={R:0,G:1,B:2,A:3};class UT{constructor(e,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=mr();this.outputShape=e,this.enableShapeUniforms=Ys(this.outputShape.length);let o="result";n&&(o="floor(result * 255. + 0.5)");let i="";for(let a=0;a<s.length;a++){const l=s[a];i+=`
          if(offset == ${a}) {
            result = values[${_ae[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?oI():rI(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${i}
        }
        ${r.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fae{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=mr();this.outputShape=e,this.enableShapeUniforms=Ys(this.outputShape.length);let r="",o="result";n&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const l=i*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?oI():rI(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pae(t){const e=mr(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return xie(t,n)}function Oae(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return Cie(t,e)}function Lae(t){const e=new Uint16Array([0,1,2,2,1,3]);return kie(t,e)}function dg(t,e,n,s,r,o){$ie(e,n);const i=Iie(t),a=t.TEXTURE_2D;return Ue(t,()=>t.bindTexture(a,i)),Ue(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),Ue(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),Ue(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),Ue(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),re().getNumber("WEBGL_VERSION")===1?Ue(t,()=>t.texImage2D(a,0,s,e,n,0,r,o,null)):Ue(t,()=>t.texStorage2D(a,1,s,e,n)),Ue(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:i,texShape:[n,e]}}function xz(t){return t.internalFormatFloat}function zae(t,e,n,s){const[r,o]=ug(e,n);return dg(t,r,o,xz(s),s.textureFormatFloat,t.FLOAT)}function wz(t){return t.internalFormatHalfFloat}function Mae(t,e,n,s){const[r,o]=ug(e,n);return dg(t,r,o,wz(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function vz(t){return t.downloadTextureFormat}function Bae(t,e,n,s){const[r,o]=ug(e,n);return dg(t,r,o,vz(s),t.RGBA,t.UNSIGNED_BYTE)}function bz(t){return t.internalFormatPackedFloat}function Vae(t,e,n,s){const[r,o]=Uh(e,n);return dg(t,r,o,bz(s),t.RGBA,t.FLOAT)}function Sz(t){return t.internalFormatPackedHalfFloat}function Uae(t,e,n,s){const[r,o]=Uh(e,n);return dg(t,r,o,Sz(s),t.RGBA,s.textureTypeHalfFloat)}function Wae(t,e,n){return Ue(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),zT(t,e,"clipSpacePos",n,3,20,0)&&zT(t,e,"uv",n,2,20,12)}function jae(t,e,n,s,r,o){Ue(t,()=>t.bindTexture(t.TEXTURE_2D,e));let i,a,l;r instanceof Uint8Array?(i=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(i=new Float32Array(n*s*4),a=t.FLOAT,l=o.internalFormatPackedFloat),i.set(r),re().getNumber("WEBGL_VERSION")===2?Ue(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,a,i)):Ue(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,s,0,t.RGBA,a,i)),Ue(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function Gae(t,e,n){Ue(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?re().getNumber("WEBGL_VERSION")===2?Ue(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):Ue(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):re().getNumber("WEBGL_VERSION")===2?Ue(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):Ue(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),Ue(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function Hae(t,e,n,s){const r=t.createBuffer();Ue(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,r));const a=4*4*e*n;return Ue(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),Ue(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),Ue(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),r}function Kae(t,e,n){const s=t,r=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function qae(t,e,n,s){const[r,o]=ug(e,n),i=4,a=new Uint8Array(die(e*n,i));return Ue(t,()=>t.readPixels(0,0,r,o,s.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function Xae(t,e,n,s,r,o,i,a){const l=t,u=new Float32Array(hie(o,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function Yae(t,e,n){const s=new Float32Array(e*n*4);return Ue(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pv{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=re().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,lie(n,e)):this.gl=Di(n),e=this.gl,re().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>Ue(o,()=>o.createVertexArray()),this.bindVertexArray=i=>Ue(o,()=>o.bindVertexArray(i)),this.deleteVertexArray=i=>Ue(o,()=>o.deleteVertexArray(i)),this.getVertexArray=()=>Ue(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Ue(e,()=>o.createVertexArrayOES()),this.bindVertexArray=i=>Ue(e,()=>o.bindVertexArrayOES(i)),this.deleteVertexArray=i=>Ue(e,()=>o.deleteVertexArrayOES(i)),this.getVertexArray=()=>Ue(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),re().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=ey(this.gl,o),Uo(this.gl,i))this.textureHalfFloatExtension=ey(this.gl,i);else if(re().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Uo(this.gl,r))this.colorBufferHalfFloatExtension=ey(this.gl,r);else if(re().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Uo(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Uo(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Oae(this.gl),this.indexBuffer=Lae(this.gl),this.framebuffer=Nie(this.gl),this.textureConfig=sI(this.gl,this.textureHalfFloatExtension)}get debug(){return re().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Ue(e,()=>e.finish()),Ue(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Ue(e,()=>e.deleteFramebuffer(this.framebuffer)),Ue(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Ue(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Ue(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),zae(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),Mae(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),Bae(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),Gae(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,r){this.throwIfDisposed(),jae(this.gl,e,n,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),Uae(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),Vae(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(MT(this.gl,this.framebuffer),this.outputTexture=null),Ue(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>qae(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,r,o,i){return Xae(this.gl,e,n,s,r,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return Kae(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const r=Hae(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(re().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const i=r.clientWaitSync(o,0,0);return i===r.ALREADY_SIGNALED||i===r.CONDITION_SATISFIED},n=o}else re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>Yae(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=Pae(n));const s=bie(n);Ue(n,()=>n.attachShader(s,this.vertexShader)),Ue(n,()=>n.attachShader(s,e)),Sie(n,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&Dv(n,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;Ue(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Wae(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Ue(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Dv(this.gl,this.program),Ue(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?Eie(this.gl,e,n):Rie(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),Ue(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),Die(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[r,o]=Uh(n,s);this.setOutputMatrixTextureDriver(e,r,o)}setOutputMatrixWriteRegion(e,n,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,n)}setOutputPackedMatrixWriteRegion(e,n,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Dv(this.gl,this.program),ty(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Ue(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Ue(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=ey(this.gl,re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await SN(()=>this.disposed||this.isQueryAvailable(e,re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=Qae(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in re().platform&&(s=re().platform.setTimeoutCustom.bind(re().platform)),SN(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Av(this.gl,e,this.framebuffer),this.debug&&ty(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Av(this.gl,this.outputTexture,this.framebuffer),this.debug&&ty(this.gl)):MT(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const r=this.gl;Av(r,e,this.framebuffer),this.debug&&ty(r),this.outputTexture=e,Ue(r,()=>r.viewport(0,0,n,s)),Ue(r,()=>r.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,r){this.throwIfDisposed(),Ue(this.gl,()=>this.gl.scissor(e,n,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function Qae(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:Jae,bincountImpl:Cz,bincountReduceImpl:Zae,bitwiseAndImpl:ele,castImpl:tle,ceilImpl:nle,concatImpl:sle,equalImpl:rle,expImpl:ole,expm1Impl:ile,floorImpl:ale,gatherNdImpl:lle,gatherV2Impl:ule,greaterImpl:cle,greaterEqualImpl:dle,lessImpl:hle,lessEqualImpl:ple,linSpaceImpl:fle,logImpl:mle,maxImpl:gle,maximumImpl:yle,minimumImpl:xle,multiplyImpl:wle,negImpl:vle,notEqualImpl:ble,prodImpl:Sle,raggedGatherImpl:Cle,raggedRangeImpl:kle,raggedTensorToTensorImpl:Ile,rangeImpl:$le,rsqrtImpl:Nle,scatterImpl:Tle,sigmoidImpl:Ele,simpleAbsImpl:kz,sliceImpl:Rle,sparseFillEmptyRowsImpl:Dle,sparseReshapeImpl:Ale,sparseSegmentReductionImpl:Iz,sqrtImpl:_le,staticRegexReplaceImpl:Fle,stridedSliceImpl:Ple,stringNGramsImpl:Ole,stringSplitImpl:Lle,stringToHashBucketFastImpl:zle,subImpl:Mle,tileImpl:Ble,topKImpl:Vle,transposeImpl:aI,uniqueImpl:Ule}=XL;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $z(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function lr(t,e){return e===1?[t]:$z(t,e)}function Wle(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jle{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Ys(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=lr("rc",this.rank),s=on(this.rank),r=this.getOutOfBoundsCondition(n),o=this.getSetup(n),i=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)o=`${e[e.length-1-i]},`+o;n.push(o)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nz{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Ys(this.outputShape.length);let s="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${Gle(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?oI():rI(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function Gle(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?Wie(["r","c","d"],"inputShape"):yc(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Hle=class{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,s){const r=jT(n,s),o=GT(e,r,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=WT(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const l=this.freeTextures[o].pop();return this.usedTextures[o].push(l),l}let a;return r===Ps.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Ps.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Ps.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Ps.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Ps.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,n,s,r){if(this.freeTextures==null)return;const o=jT(s,r),i=GT(n,o,r);i in this.freeTextures||(this.freeTextures[i]=[]);const a=WT(n,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=re().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[i],c=u&&u.indexOf(e);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[c]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function Kle(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function WT(t,e,n,s,r){const o=qle(e,s);let i;if(r){const[l,u]=Uh(t[0],t[1]);i=l*u}else{const[l,u]=ug(t[0],t[1]);i=l*u}const a=Kle(n,o);return i*a}function qle(t,e){switch(t){case Ps.PACKED_2X2_FLOAT32:return bz(e);case Ps.PACKED_2X2_FLOAT16:return Sz(e);case Ps.UNPACKED_FLOAT32:return xz(e);case Ps.UNPACKED_FLOAT16:return wz(e);case Ps.PACKED_4X1_UNSIGNED_BYTE:return vz(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function Xle(t){return re().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Ps.PACKED_2X2_FLOAT32:Ps.UNPACKED_FLOAT32:t?Ps.PACKED_2X2_FLOAT16:Ps.UNPACKED_FLOAT16}function jT(t,e){if(t===ao.UPLOAD)return Ps.PACKED_2X2_FLOAT32;if(t===ao.RENDER||t==null)return Xle(e);if(t===ao.DOWNLOAD||t===ao.PIXELS)return Ps.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function GT(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let ea=class{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Ys(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}};const Zo="if (isnan(x)) return x;",Yle="return x;",HT="return abs(x);",Qle="return (x >= 0.0) ? x : (exp(x) - 1.0);",Jle=Zo+`
  return (x < 0.0) ? 0.0 : x;
`,Zle=Zo+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,tl="return x;",eue="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tue="return x;",nue=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,sue=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,rue=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,oue="return 1.0 / (1.0 + exp(-1.0 * x));";class cl{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Ys(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iue{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Ys(this.outputShape.length);const n=e.length,s=lr("rc",n),r=on(n),o=Wle(n,s),i=s.slice(-2),a=n<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aue=dk,lue=1e-7,uue=1e-4,ry={};function cue(t){return t in ry||(ry[t]={}),ry[t]}const due=re().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),hue=600;function pue(){return re().global.screen==null?1024:re().global.screen.height*re().global.screen.width*window.devicePixelRatio*hue/1024/1024}class x1 extends p0{nextDataId(){return x1.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!re().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof Pv)n=e;else{const s=Di(re().getNumber("WEBGL_VERSION"),e);n=new Pv(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Di(re().getNumber("WEBGL_VERSION"));n=new Pv(s),this.binaryCache=cue(re().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Hle(this.gpgpu),this.numMBBeforeWarning=pue(),this.texData=new a2(this,rr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,s,r,o,i){const a=this.makeTensorInfo(n,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,o]},l.texShape=[r,o];const u=ny(n),c=new UT(u,!1,i),d=this.runWebGLProgram(c,[a],s,[[r,o]]);return d.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,n,s){if((re().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||re().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:n,dtype:s,values:e,usage:ao.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,r,o){if(re().getBool("DEBUG")&&this.checkNumericalProblems(n),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:n,usage:ao.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:o,slice:i,shape:a,isPacked:l}=n;if(i!=null){let h;l?h=new cl(a,tl):h=new ea(a,tl);const p=this.runWebGLProgram(h,[{dataId:e,shape:a,dtype:r}],r),f=this.readSync(p.dataId);return this.disposeIntermediateTensorInfo(p),f}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let c;u&&(c=xr());let d;if(r==="complex64"){const h=this.readSync(o.real.dataId),p=this.readSync(o.imag.dataId);d=Ni(h,p)}else d=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=xr()-c),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const f=this.pendingRead.get(e);return new Promise(m=>f.push(m))}const n=this.texData.get(e),{values:s,shape:r,slice:o,dtype:i,complexTensorInfos:a,isPacked:l}=n;if(o!=null){let f;l?f=new cl(r,tl):f=new ea(r,tl);const m=this.runWebGLProgram(f,[{dataId:e,shape:r,dtype:i}],i),g=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(s!=null)return this.convertAndCacheOnCPU(e);if(re().getBool("DEBUG")&&!re().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&re().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,c;if(i!=="complex64"&&re().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(e);const f=this.texData.get(c.dataId);u=this.gpgpu.createBufferFromTexture(f.texture.texture,...Zg(r))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(i==="complex64"){const f=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=f[0],g=f[1];d=Ni(m,g)}else if(u==null)d=this.getValuesFromTexture(e);else{const f=te(r);d=this.gpgpu.downloadFloat32MatrixFromBuffer(u,f)}if(c!=null&&this.disposeIntermediateTensorInfo(c),u!=null){const f=this.gpgpu.gl;Ue(f,()=>f.deleteBuffer(u))}const h=this.convertAndCacheOnCPU(e,d),p=this.pendingRead.get(e);return this.pendingRead.delete(e),p.forEach(f=>f(h)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&rr().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e,n={}){const s=this.texData.get(e),{values:r,shape:o,slice:i,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let p;l?p=new cl(o,tl):p=new ea(o,tl);const f=this.runWebGLProgram(p,[{dataId:e,shape:o,dtype:a}],a),m=this.readToGPU(f,n);return this.disposeIntermediateTensorInfo(f),m}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(e,n.customTexShape),d=rr().makeTensorFromTensorInfo(c),h=this.texData.get(c.dataId);return Object.assign({tensorRef:d},h.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>ki(r));return yt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return yt(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!gie(s))throw re().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:r}=this.texData.get(e),o=te(n);if(re().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const h=this.decode(e),p=this.texData.get(h.dataId),f=this.gpgpu.downloadMatrixFromPackedTexture(p.texture.texture,...Zg(n)).subarray(0,o);return this.disposeIntermediateTensorInfo(h),f}const i=re().getBool("WEBGL_PACK")&&r===!0,a=i?ny(n):n,l=i?new Aae(a):new Dae(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),c=this.texData.get(u.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(u),d}timerAvailable(){return re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const o=Ma(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),i=Ma(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(o);a.kernelMs=JA(l),a.getExtraProfileInfo=()=>l.map((u,c)=>({name:i[c],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:xr(),endMs:null}}endTimer(e){return re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=xr(),e)}async getQueryTime(e){if(re().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:r,usage:o,isPacked:i,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(n,r,o,i)));const c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=due){return re().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&te(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){oo("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return aue(e.shape,n)}packedUnaryOp(e,n,s){const r=new cl(e.shape,n),o=this.compileAndRun(r,[e],s);return rr().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=kz(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(re().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,HT,e.dtype);const n=new ea(e.shape,HT),s=this.compileAndRun(n,[e]);return rr().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&Md(s[0])){const o=s.map(i=>Da(i));r=this.write(o,e,n)}else r=this.write(s,e,n);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:n}}makeOutput(e,n,s){return rr().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new iue(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new jle(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const s=[Ed(e.shape),...Rd(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},o=[Ed(n),...Rd(n)],i=new Nz(o,s),a=!0,l=[s],u=this.runWebGLProgram(i,[r],e.dtype,l,a);return{dataId:u.dataId,shape:n,dtype:u.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:r,shape:o,dtype:i}=s;if(n!=null){const h=te(o),p=n[0]*n[1]*4;A(h<=p,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=ny(o);let l;r?l=new Rae(a):l=new Eae(a);const u=!0,c=[n??Zg(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],i,c,u,n);return{dtype:i,shape:o,dataId:d.dataId}}runWebGLProgram(e,n,s,r,o=!1,i){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Tf.DENSE){const y=i??Zg(e.outputShape);l.texShape=y.map(x=>x*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),te(a.shape)===0)return l.values=ps(a.dtype,0),a;const u=[],c=n.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let x=this.texData.get(y.dataId);if(x.texture==null){if(!e.packedInputs&&te(y.shape)<=re().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:x.values};e.packedInputs&&(x.isPacked=!0,x.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!x.isPacked!=!!e.packedInputs)y=x.isPacked?this.unpackTensor(y):this.packTensor(y),u.push(y),x=this.texData.get(y.dataId);else if(x.isPacked&&!Fx(x.shape,y.shape)){const v=y,b=y.shape;y.shape=x.shape,y=this.packedReshape(y,b),u.push(y),x=this.texData.get(y.dataId),v.shape=b}return{shape:y.shape,texData:x,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},h=Tae(e,c,d),p=this.getAndSaveBinary(h,()=>$ae(this.gpgpu,e,c,d)),f=this.activeTimers!=null;let m;f&&(m=this.startTimer()),re().get("ENGINE_COMPILE_ONLY")||Nae(this.gpgpu,p,c,d,r),u.forEach(y=>this.disposeIntermediateTensorInfo(y)),f&&(m=this.endTimer(m),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(m)}));const g=re().getNumber("WEBGL_FLUSH_THRESHOLD");if(g>0){const y=xr();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!re().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(e,n,s,r,o=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,r,o)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(re().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ne(()=>{if(!re().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=re().getBool("DEBUG");re().set("DEBUG",!1);const n=this.abs(ot(1e-8)).dataSync()[0];if(re().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?lue:uue}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:r,values:o,texture:i,usage:a,isPacked:l}=n;if(i!=null)return;const u=this.activeTimers!=null;let c;u&&(c=xr());let d=n.texShape;if(d==null&&(d=Fie(s,l),n.texShape=d),o!=null){const h=ny(s);let p,f=d[1],m=d[0];const g=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(l||!g)&&([f,m]=Uh(d[0],d[1])),l?p=new Fae(h,g):p=new UT(h,g);const y=g?[m,f]:d,x=this.makeTensorInfo(y,r),v=this.texData.get(x.dataId);g?v.usage=ao.PIXELS:v.usage=ao.UPLOAD,v.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),f,m,o);const b=[[m,f]],C=this.runWebGLProgram(p,[x],r,b,!0),I=this.texData.get(C.dataId);n.texShape=I.texShape,n.isPacked=I.isPacked,n.usage=I.usage,re().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(n.texture=I.texture,n.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(x),u&&(this.uploadWaitMs+=xr()-c)}else{const h=this.acquireTexture(d,a,r,l);n.texture=h}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:r}=s;return n!=null&&(s.values=fue(n,r)),s.values}acquireTexture(e,n,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,r)}computeBytes(e,n){return e[0]*e[1]*ax(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(n),r(!0)}catch(o){throw o}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await dF(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(hz(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:r,nanLoc:o,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:l}=yz(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=o,e.outShapeLocation=i,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,s){e.channels=e.channels||"RGBA";const{texture:r,height:o,width:i,channels:a}=e,l=rr().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,n,s,o,i,a);return rr().makeTensorFromDataId(u,n,s,l)}}x1.nextDataId=0;function fue(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */v3()&&I2("webgl",()=>new x1,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lI=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;let tc=class{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=ct(n,s),this.enableShapeUniforms=Ys(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wc=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Kh{constructor(e,n,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ct(n,s);const o=this.outputShape.length;this.enableShapeUniforms=Ys(o);let i="";if(r)if(o===0||te(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${on(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=lr("coords",o);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yr(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const mue={kernelName:ah,backendName:"webgl",kernelFunc:Yr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yl(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,o=n.makeTensorInfo(s.shape,"complex64"),i=n.texData.get(o.dataId),a=Yr({inputs:{x:s},backend:n}),l=Yr({inputs:{x:r},backend:n});return i.complexTensorInfos={real:a,imag:l},o}const gue={kernelName:b0,backendName:"webgl",kernelFunc:Yl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tz="return (a < 0.) ? b * a : a;",Ez=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function yue(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:o}=s,i=n.makeTensorInfo([],"float32",Ul(o,"float32")),a=re().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Kh(Ez,r.shape,i.shape):new tc(Tz,r.shape,i.shape),l=n.runWebGLProgram(a,[r,i],"float32");return n.disposeIntermediateTensorInfo(i),l}const xue={kernelName:cm,backendName:"webgl",kernelFunc:yue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rz="return (a < 0.) ? b * a : a;",Dz=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function wue(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e,o=re().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Kh(Dz,s.shape,r.shape):new tc(Rz,s.shape,r.shape);return n.runWebGLProgram(o,[s,r],"float32")}const vue={kernelName:Em,backendName:"webgl",kernelFunc:wue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qh="if (isnan(x)) return x;";function Wt({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:r,backend:o})=>{const{x:i}=r,a=o,l=s||i.dtype;if(a.shouldExecuteOnCPU([i])&&n!=null){const d=a.texData.get(i.dataId),h=n(d.values,l);return a.makeTensorInfo(i.shape,l,h)}const u=re().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let c;return u?c=new cl(i.shape,e):c=new ea(i.shape,t),a.runWebGLProgram(c,[i],l)}}function Bs({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:o}){return({inputs:i,backend:a})=>{const{a:l,b:u}=i,c=a;if(s&&l.dtype==="complex64"){const f=c.texData.get(l.dataId),m=c.texData.get(u.dataId),[g,y]=[[f.complexTensorInfos.real,m.complexTensorInfos.real],[f.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(v=>{const[b,S]=v,C={dataId:b.dataId,dtype:b.dtype,shape:l.shape},I={dataId:S.dataId,dtype:S.dtype,shape:u.shape},T=new tc(t,l.shape,u.shape);return c.runWebGLProgram(T,[C,I],$s(b.dtype,S.dtype))}),x=Yl({inputs:{real:g,imag:y},backend:c});return c.disposeIntermediateTensorInfo(g),c.disposeIntermediateTensorInfo(y),x}const d=o||$s(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||c.shouldExecuteOnCPU([l,u]))&&r!=null){const f=c.texData.get(l.dataId).values,m=c.texData.get(u.dataId).values,g=l.dtype==="string"?Ti(f):f,y=l.dtype==="string"?Ti(m):m,[x,v]=r(l.shape,u.shape,g,y,d),b=c.makeTensorInfo(v,d),S=c.texData.get(b.dataId);return S.values=x,b}const h=re().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let p;return h?p=new Kh(e,l.shape,u.shape,n):p=new tc(t,l.shape,u.shape),c.runWebGLProgram(p,[l,u],d)}}function Ef(t,e=!1){if(t==="linear")return e?tue:Yle;if(t==="relu")return e?sue:Jle;if(t==="elu")return e?nue:Qle;if(t==="relu6")return e?rue:Zle;if(t==="prelu")return e?Dz:Rz;if(t==="leakyrelu")return e?Ez:Tz;if(t==="sigmoid")return e?oue:eue;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Az=class{constructor(e,n,s,r=!1,o=!1,i=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=Ys(this.outputShape.length);const c=r?e[1]:e[2],d=Math.ceil(c/2),h=r?"i * 2, rc.y":"rc.y, i * 2",p=o?"rc.z, i * 2":"i * 2, rc.z",f=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",y="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const x=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let v="rc.x",b="rc.x";e[0]<n[0]?v=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(b=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${v};
        int batchB = ${b};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${h});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${f[0]} * ${m[0]});
          result += (${f[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${x}

        ${y}

        setOutput(result);
      }
    `}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KT={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};let qT=class{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ct(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XT="return a * b;";function uI(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,o=$s(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),u=new qT(KT.REAL,s.shape,r.shape),c=new qT(KT.IMAG,s.shape,r.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],h=n.runWebGLProgram(u,d,"float32"),p=n.runWebGLProgram(c,d,"float32"),f=Yl({inputs:{real:h,imag:p},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),f}if(n.shouldExecuteOnCPU([s,r])){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),[u,c]=wle(s.shape,r.shape,a.values,l.values,o),d=n.makeTensorInfo(c,o),h=n.texData.get(d.dataId);return h.values=u,d}let i;return re().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Kh(XT,s.shape,r.shape):i=new tc(XT,s.shape,r.shape),n.runWebGLProgram(i,[s,r],o)}const bue={kernelName:gh,backendName:"webgl",kernelFunc:uI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sue(t,e,n){const s=[Ed(t.shape),...Rd(t.shape)],r={dtype:t.dtype,shape:s,dataId:t.dataId},o=[Ed(e),...Rd(e)],i=new Nz(o,s),a=!0,l=[s],u=n.runWebGLProgram(i,[r],t.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ae(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:o}=s,i=n,a=te(r.shape),l=u2(o,a),u=te(l);A(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const c=i.texData.get(r.dataId);return c.isPacked&&!Fx(r.shape,l)&&!(c.texture!==null&&Fx(c.shape,l))?Sue(r,l,i):(i.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const Cue={kernelName:Dm,backendName:"webgl",kernelFunc:Ae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YT{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(n!=null){const d=1/n;u=`sumValue += dot(values * ${wd(d)?d.toPrecision(2):d}, ones);`}let c="";o%s>0&&(c=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let kue=class{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?u="sumValue":n==="prod"?u="prodValue":n==="all"?u="allValue":n==="any"&&(u="anyValue");const c=Math.floor(s/4)*4,d=s%4;let h=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";n==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):n==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let f="";o%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${c};
        if (${d===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${u});
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iue(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=Uw(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function vc(t,e,n,s){const r=Iue(t.shape);let o=t;for(let i=0;i<r.length;i++){const{inSize:a,windowSize:l,outSize:u}=r[i];let c,d;n==="mean"?c=i===0?new YT({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},a):new YT({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u}):c=new kue({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},n),d=o,o=s.runWebGLProgram(c,[o],e),d.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(d)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let $ue=class{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[n[i]];this.outputShape=s,this.rank=s.length;const r=on(this.rank),o=Nue(n);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}};function Nue(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<t.length;r++)s[t[r]]=n[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tue{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let c=0;c<s.length;c++)s[c]=e[n[c]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=on(this.rank),o=$z("rc",this.rank),i=new Array(this.rank);for(let c=0;c<n.length;c++)i[n[c]]=o[c];const a=`vec2(${i.slice(-2).join()})`,l=`++${o[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w1(t,e,n){const s=re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Tue(t.shape,e):new $ue(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eue(t,e,n,s){const r=e,o=t.shape.length,i=xt(r,t.shape);let a=i;const l=an(a,o),u=l!=null;let c=t;u&&(c=w1(t,l,s),a=yn(a.length,o)),ss("sum",a,o);const[d,h]=qn(c.shape,a);let p=d;n&&(p=Wn(d,i));const f=te(h),g=te(t.shape)/f,y=Ae({inputs:{x:c},attrs:{shape:[g,f]},backend:s}),x=hw(t.dtype),v=vc(y,x,"sum",s),b=Ae({inputs:{x:v},attrs:{shape:p},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(v),u&&s.disposeIntermediateTensorInfo(c),b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v1(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;return Eue(r,o,i,n)}const Rue={kernelName:Lm,backendName:"webgl",kernelFunc:v1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pr(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{perm:o}=s,i=n,a=r.shape.length,l=new Array(a);for(let c=0;c<l.length;c++)l[c]=r.shape[o[c]];let u;if(i.shouldExecuteOnCPU([r])){const d=i.texData.get(r.dataId).values,h=aI(d,r.shape,r.dtype,o,l);u=i.makeTensorInfo(l,r.dtype);const p=i.texData.get(u.dataId);p.values=h}else u=w1(r,o,i);return u}const Due={kernelName:Eu,backendName:"webgl",kernelFunc:pr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _z=1e3;function Px({a:t,b:e,transposeA:n,transposeB:s,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:l=null}){const u=t.shape.length,c=e.shape.length,d=n?t.shape[u-2]:t.shape[u-1],h=s?e.shape[c-1]:e.shape[c-2],p=n?t.shape[u-1]:t.shape[u-2],f=s?e.shape[c-2]:e.shape[c-1],m=t.shape.slice(0,-2),g=e.shape.slice(0,-2),y=te(m),x=te(g),b=ct(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,f]);A(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const S=n?[y,d,p]:[y,p,d],C=s?[x,f,h]:[x,h,f],I=Ae({inputs:{x:t},backend:r,attrs:{shape:S}}),T=Ae({inputs:{x:e},backend:r,attrs:{shape:C}}),R=[I,T],_=Math.max(y,x),P=n?I.shape[1]:I.shape[2],z=o!=null,O=i!=null,V=l==="leakyrelu",H=l!=null?Ef(l,!0):null,Q=z||O||V||H!=null;let oe;if((p===1||f===1)&&P>_z&&Q===!1){let ee=I,ie=T;n&&(ee=pr({inputs:{x:I},backend:r,attrs:{perm:[0,2,1]}}),R.push(ee)),s&&(ie=pr({inputs:{x:T},backend:r,attrs:{perm:[0,2,1]}}),R.push(ie));const le=f!==1,fe=f===1;let ge=ee;le&&(ge=Ae({inputs:{x:ee},backend:r,attrs:{shape:[_,P,1]}}),R.push(ge));const xe=f===1?2:1;let we=ie;fe&&(we=Ae({inputs:{x:ie},backend:r,attrs:{shape:[_,1,P]}}),R.push(we));const Ie=uI({inputs:{a:ge,b:we},backend:r});oe=v1({inputs:{x:Ie},backend:r,attrs:{axis:xe,keepDims:!0}}),R.push(Ie)}else{const ee=$s(t.dtype,e.dtype),ie=new Az(S,C,[_,p,f],n,s,z,H,O,V),le=[I,T];if(o!=null&&le.push(o),O&&le.push(i),V){const fe=r.makeTensorInfo([],"float32",Ul(a,"float32"));le.push(fe),R.push(fe)}oe=r.runWebGLProgram(ie,le,ee)}const j=Ae({inputs:{x:oe},backend:r,attrs:{shape:b}});R.push(oe);for(const ee of R)r.disposeIntermediateTensorInfo(ee);return j}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aue(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:d}=s;return Px({a:r,b:o,transposeA:l,transposeB:u,backend:n,bias:i,preluActivationWeights:a,leakyreluAlpha:d,activation:c})}const _ue={kernelName:pf,backendName:"webgl",kernelFunc:Aue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QT="return abs(x);";function Fue(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=n.texData.get(s.dataId),i=kz(o.values);return n.makeTensorInfo(s.shape,s.dtype,i)}let r;return re().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new cl(s.shape,QT):r=new ea(s.shape,QT),n.runWebGLProgram(r,[s],s.dtype)}const Pue={kernelName:Wf,backendName:"webgl",kernelFunc:Fue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oue=Zo+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Lue=Wt({opSnippet:Oue}),zue={kernelName:Vd,backendName:"webgl",kernelFunc:Lue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mue=Zo+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Bue=Wt({opSnippet:Mue}),Vue={kernelName:Ud,backendName:"webgl",kernelFunc:Bue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JT="return a + b;",Uue=Bs({opSnippet:JT,packedOpSnippet:JT,supportsComplex:!0,cpuKernelImpl:Jae}),Wue={kernelName:ic,backendName:"webgl",kernelFunc:Uue};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jue{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Gue=class{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iy(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return Yr({inputs:{x:s[0]},backend:n});if(s.length>re().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=Iy({inputs:s.slice(0,l),backend:n}),c=Iy({inputs:s.slice(l),backend:n});return Iy({inputs:[u,c],backend:n})}const r=s.map(l=>l.dtype).reduce((l,u)=>$s(l,u)),o=s.map(l=>l.shape),a=re().getBool("WEBGL_PACK")?new Gue(s[0].shape,o):new jue(s[0].shape,o);return n.runWebGLProgram(a,s,r)}const Hue={kernelName:jf,backendName:"webgl",kernelFunc:Iy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kue(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=xt(o,r.shape);let u=l;const c=an(u,a);let d=r;c!=null&&(d=pr({inputs:{x:r},backend:n,attrs:{perm:c}}),u=yn(u.length,a)),ss("all",u,a);const[h,p]=qn(d.shape,u),f=te(p),m=Ae({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}}),g=vc(m,m.dtype,"all",n);let y;if(i){const x=Wn(h,l);y=Ae({inputs:{x:g},backend:n,attrs:{shape:x}})}else y=Ae({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),c!=null&&n.disposeIntermediateTensorInfo(d),y}const que={kernelName:f0,backendName:"webgl",kernelFunc:Kue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xue(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=xt(o,r.shape);let u=l;const c=an(u,a);let d=r;c!=null&&(d=pr({inputs:{x:r},backend:n,attrs:{perm:c}}),u=yn(u.length,a)),ss("any",u,a);const[h,p]=qn(d.shape,u),f=te(p),m=Ae({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}}),g=vc(m,m.dtype,"any",n);let y;if(i){const x=Wn(h,l);y=Ae({inputs:{x:g},backend:n,attrs:{shape:x}})}else y=Ae({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),c!=null&&n.disposeIntermediateTensorInfo(d),y}const Yue={kernelName:m0,backendName:"webgl",kernelFunc:Xue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Que=class{constructor(e,n,s){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:i}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const a=n==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jue{constructor(e,n,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,A(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],i=Math.ceil(o/n);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=on(l),c=lr("coords",l);let d,h;if(i===1){h=l+1;const T=on(h);d=`
        ${T} sourceLocR = ${T}(${c.join()}, 0);
        ++${c[l-1]};
        ${T} sourceLocG = ${T}(${c.join()}, 0);
        ++${c[l-2]};
        ${T} sourceLocA = ${T}(${c.join()}, 0);
        --${c[l-1]};
        ${T} sourceLocB = ${T}(${c.join()}, 0);
        --${c[l-2]};`}else h=l,d=`
        ${u} sourceLocR = coords;
        ++${c[l-1]};
        ${u} sourceLocG = coords;
        ++${c[l-2]};
        ${u} sourceLocA = coords;
        --${c[l-1]};
        ${u} sourceLocB = coords;
        --${c[l-2]};`;const p=["x","y","z","w","u","v"].slice(0,h),f="."+p[h-1],m=p.map(T=>"int "+T),g=lr("sourceLocR",h-1).concat("inIdx.r"),y=lr("sourceLocG",h-1).concat("inIdx.g"),x=lr("sourceLocB",h-1).concat("inIdx.b"),v=lr("sourceLocA",h-1).concat("inIdx.a"),b=s==="max"?"greaterThan":"lessThan",S=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${v.join()})));`,C=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${x.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,I=r?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${I}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${c[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${c[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},
          sourceLocB${f}, sourceLocA${f}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${b}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fz(t,e,n,s=null){let r=e.shape[0],o=e.shape[1];s!=null&&(r=s.shape[0],o=s.shape[1]);const i=Uw(o),a={windowSize:i,inSize:o,batchSize:r,outSize:Math.ceil(o/i)},l=new Que(a,n,s==null),u=[e];s!=null&&u.push(s);const c=t.runWebGLProgram(l,u,"int32");if(c.shape[1]===1)return c;const d=Fz(t,e,n,c);return t.disposeIntermediateTensorInfo(c),d}function Pz(t,e,n,s=null){const r=s!=null?s.shape:e.shape,o=r[r.length-1],i=Uw(o),a=new Jue(r,i,n,s==null),l=s==null?[e]:[e,s],u=t.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const c=Pz(t,e,n,u);return t.disposeIntermediateTensorInfo(u),c}return u}function Oz(t,e,n,s){const r=[n];if(ss("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!re().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],i=t.texData.get(e.dataId),a=i!==null&&i.isPacked;let l=e;a&&(l=t.unpackTensor(e),o.push(l));const[u,c]=qn(l.shape,r),d=te(c),h=Ae({inputs:{x:l},backend:t,attrs:{shape:[-1,d]}});o.push(h);const p=Fz(t,h,s);o.push(p);const f=Ae({inputs:{x:p},backend:t,attrs:{shape:u}});return o.forEach(m=>t.disposeIntermediateTensorInfo(m)),f}return Pz(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zue(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;let i=xt(o,r.shape);const a=an(i,r.shape.length);let l=r;const u=[];a!=null&&(l=pr({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),i=yn(i.length,l.shape.length)),ss("argMax",[i[0]],l.shape.length);const c=Oz(n,l,i[0],"max");return u.forEach(d=>n.disposeIntermediateTensorInfo(d)),c}const ece={kernelName:Gf,backendName:"webgl",kernelFunc:Zue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;let i=xt(o,r.shape);const a=an(i,r.shape.length);let l=r;const u=[];a!=null&&(l=pr({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),i=yn(i.length,l.shape.length)),ss("argMin",[i[0]],l.shape.length);const c=Oz(n,l,i[0],"min");return u.forEach(d=>n.disposeIntermediateTensorInfo(d)),c}const nce={kernelName:Hf,backendName:"webgl",kernelFunc:tce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sce=Zo+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,rce=Wt({opSnippet:sce}),oce={kernelName:Wd,backendName:"webgl",kernelFunc:rce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ice=Zo+"return log(x + sqrt(x * x + 1.0));",ace=Wt({opSnippet:ice}),lce={kernelName:jd,backendName:"webgl",kernelFunc:ace};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uce=Zo+`
  return atan(x);
`,cce=Wt({opSnippet:uce}),dce={kernelName:Gd,backendName:"webgl",kernelFunc:cce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hce=lI+`
  return atan(a, b);
`,pce=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+wc+`
  return result;
`,fce=Bs({opSnippet:hce,packedOpSnippet:pce}),mce={kernelName:Kd,backendName:"webgl",kernelFunc:fce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gce=Zo+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,yce=Wt({opSnippet:gce}),xce={kernelName:Hd,backendName:"webgl",kernelFunc:yce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Rf=class{constructor(e,n,s,r=!1,o=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;const m=n==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,y=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let x="0.0";if(m||(x="-1.0 / 1e-20"),s){const T=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${p}, ${f});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${T} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?g:y:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const v="max";let b=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(b="avgValue / max(count, 1.0)");const S=Math.floor(i/4)*4,C=i%4,I=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${v}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${p}, ${f});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${I}
          }

          int xC = xCCorner + ${S};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${I}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${I}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${I}
          }
        }
        setOutput(${b});
      }
    `}},cI=class{constructor(e,n,s,r=!1,o=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,c=e.dilationDepth,d=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,f=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=e.padInfo.front,y=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;const v=n==="avg";let b="0.0";if(v||(b="-1.0 / 1e-20"),s){const _=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${g}, ${y}, ${x});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${f};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${_} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${f} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let C=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(C="avgValue / max(count, 1.0)");const I=Math.floor(i/4)*4,T=i%4,R=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${g}, ${y}, ${x});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${I}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${R}
            }

            int xC = xCCorner + ${I};
            if (${T===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${T===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${T===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${R}
            }
          }
        }
        setOutput(${C});
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;cg(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;A(ms(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const c=qs(r.shape,o,i,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&Ct(c.inShape,c.outShape))return Yr({inputs:{x:r},backend:n});const d=new Rf(c,"avg",!1);return n.runWebGLProgram(d,[r],"float32")}const vce={kernelName:Kf,backendName:"webgl",kernelFunc:wce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s,c=[1,1,1],d=xo(r.shape,o,i,c,a,l,u),h=new cI(d,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}const Sce={kernelName:qf,backendName:"webgl",kernelFunc:bce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Cce=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=l-1-e.padInfo.top,d=u-1-e.padInfo.left,h=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${d});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},kce=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=d-1-e.padInfo.front,m=h-1-e.padInfo.top,g=p-1-e.padInfo.left,y=1/(n*s*r);this.userCode=`
      const ivec3 pads = ivec3(${f}, ${m}, ${g});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ice(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=s,d=[1,1,1],h=xo(i.shape,a,l,d,u,c),p=new kce(h);return n.runWebGLProgram(p,[r],i.dtype)}const $ce={kernelName:y0,backendName:"webgl",kernelFunc:Ice};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nce(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o;cg([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,c=qs(i.shape,a,l,1,u),d=new Cce(c);return n.runWebGLProgram(d,[r],i.dtype)}const Tce={kernelName:g0,backendName:"webgl",kernelFunc:Nce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ece(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;return Px({a:r,b:o,transposeA:i,transposeB:a,backend:n})}const Rce={kernelName:Xf,backendName:"webgl",kernelFunc:Ece};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Dce=class{constructor(e,n,s,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],ct(e,n),ct(e,s);let a="0.0";r!=null&&(ct(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";o!=null&&(ct(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ace{constructor(e,n,s,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ct(e,n),ct(e,s);let a="vec4(0.0)";r!=null&&(ct(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";o!=null&&(ct(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ce=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:r,variance:o,offset:i,scale:a}=t;A(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A(i==null||r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const u=[s,r,o];let c=null;i!=null&&(c=i.shape,u.push(i));let d=null;a!=null&&(d=a.shape,u.push(a));const h=re().getBool("WEBGL_PACK_NORMALIZATION")?new Ace(s.shape,r.shape,o.shape,c,d,l):new Dce(s.shape,r.shape,o.shape,c,d,l);return e.runWebGLProgram(h,u,u[0].dtype)},Fce={kernelName:am,backendName:"webgl",kernelFunc:_ce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Pce=class{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=on(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=Oce(this.rank);let r;const o=e.map((i,a)=>`sourceLoc.${MS[a]} = start[${a}] + coords.${MS[a]};`);r=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}};const MS=["x","y","z","w","u","v"];function Oce(t){if(t===1)return"sourceLoc";if(t<=6)return MS.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lce{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=on(this.rank),s=lr("coords",this.rank),r=lr("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${o})`,a=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${i};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${i};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((c,d)=>`start[${d}]`).join()});`:e.map((c,d)=>`${r[d]} = ${s[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zce(t,e,n,s){const r=s.texData.get(t.dataId),o=s.makeTensorInfo(n,t.dtype),i=s.texData.get(o.dataId);Object.assign(i,r),i.refCount=1,i.shape=n,i.dtype=t.dtype;let a=bk(e,st(t.shape));r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};const l=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,l+1),o}function Xh(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,size:i}=s,[a,l]=Qm(r,o,i);if(zw(r,a,l),te(l)===0)return n.makeTensorInfo(l,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||r.dtype==="string"){const d=n.texData.get(r.dataId),h=Rle(d.values,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,h)}const{isPacked:u}=n.texData.get(r.dataId),c=vk(r.shape,a,l);if(u||!c){const d=re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Lce(l):new Pce(l),h=[a];return n.runWebGLProgram(d,[r],r.dtype,h)}return n.uploadToGPU(r.dataId),zce(r,a,l,n)}const Mce={kernelName:Om,backendName:"webgl",kernelFunc:Xh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bce=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,crops:i}=s;A(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((x,v)=>x*v),l=hc(r.shape,o,a),u=pc(l.length,o.length),c=fc(r.shape,o,a),d=jw(i,o.length),h=Gw(c,i,o.length),p=[],f=Ae({inputs:{x:r},backend:n,attrs:{shape:l}}),m=pr({inputs:{x:f},backend:n,attrs:{perm:u}}),g=Ae({inputs:{x:m},backend:n,attrs:{shape:c}}),y=Xh({inputs:{x:g},backend:n,attrs:{begin:d,size:h}});return p.push(f),p.push(m),p.push(g),p.forEach(x=>n.disposeIntermediateTensorInfo(x)),y},Vce={kernelName:Yf,backendName:"webgl",kernelFunc:Bce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i}=s,a=n.readSync(r.dataId),l=n.readSync(o.dataId),u=Cz(a,l,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,u)}const Wce={kernelName:x0,backendName:"webgl",kernelFunc:Uce};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jce=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,Gce=`
  return float(int(a.r) & int(b.r));
`;function Hce(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,o=re().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=re().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,r])||i===1){const l=n.texData.get(s.dataId).values,u=n.texData.get(r.dataId).values,[c,d]=ele(s.shape,r.shape,l,u,s.dtype),h=n.makeTensorInfo(d,s.dtype),p=n.texData.get(h.dataId);return p.values=c,h}let a;return o?a=new Kh(jce,s.shape,r.shape,!1):a=new tc(Gce,s.shape,r.shape),n.runWebGLProgram(a,[s,r],s.dtype)}const Kce={kernelName:w0,backendName:"webgl",kernelFunc:Hce};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qce(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,o=n.readSync(s.dataId),i=n.readSync(r.dataId),a=ct(Array.from(o),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Xce={kernelName:v0,backendName:"webgl",kernelFunc:qce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yce="return float(a != b);",Lz=Bs({opSnippet:Yce,cpuKernelImpl:ble,dtype:"bool"}),Qce={kernelName:km,backendName:"webgl",kernelFunc:Lz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hg(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return Yr({inputs:{x:r.complexTensorInfos.real},backend:n})}const Jce={kernelName:X0,backendName:"webgl",kernelFunc:hg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zce="return float(int(x));";function ede(t,e){const n=new ea(t.shape,Zce),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BS(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return Yr({inputs:{x:r},backend:n});const i=Gn(r.shape),a=BS({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),l=Yl({inputs:{real:a,imag:i},backend:n});return i.dispose(),n.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const i=hg({inputs:{input:r},backend:n}),a=BS({inputs:{x:i},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(i),a}if(!c2(r.dtype,o)){const i=Yr({inputs:{x:r},backend:n});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(n.shouldExecuteOnCPU([r])){const i=n.texData.get(r.dataId).values,[a,l,u]=tle(i,r.shape,r.dtype,o);return n.makeTensorInfo(a,l,u)}if(o==="int32")return ede(r,n);if(o==="bool"){const i=n.makeTensorInfo([],"bool",ps("bool",1)),l=Lz({inputs:{a:r,b:i},backend:n});return n.disposeIntermediateTensorInfo(i),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const tde={kernelName:qd,backendName:"webgl",kernelFunc:BS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZT="return ceil(x);",nde=Wt({opSnippet:ZT,packedOpSnippet:ZT,cpuKernelImpl:nle}),sde={kernelName:Xd,backendName:"webgl",kernelFunc:nde};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let rde=class{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ode{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ide(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{clipValueMin:o,clipValueMax:i}=s;let a;re().getBool("WEBGL_PACK_CLIP")?a=new ode(r.shape):a=new rde(r.shape);const l=[[o],[i]];return n.runWebGLProgram(a,[r],r.dtype,l)}const ade={kernelName:Yd,backendName:"webgl",kernelFunc:ide};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let lde=class{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eE(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function ude(t){const{inputs:e,backend:n}=t,{x:s}=e,r=n.texData.get(s.dataId),o=new lde(s.shape),i=[eE(s,r.complexTensorInfos.real),eE(s,r.complexTensorInfos.imag)];return n.runWebGLProgram(o,i,i[0].dtype)}const cde={kernelName:Qf,backendName:"webgl",kernelFunc:ude};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let dde=class{constructor(e){this.outputShape=[],this.outputShape=Sr(e,1),this.variableNames=e.map((i,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let i=1;i<n.length;i++)n[i]=n[i-1]+e[i][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<n.length;i++){const a=n[i-1];s.push(`else if (yC < ${n[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const r=n.length,o=n[n.length-1];s.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hde{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Sr(e,n);const s=this.outputShape,r=s.length,o=on(r),i=lr("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((m,g)=>`T${g}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let m=1;m<l.length;m++)l[m]=l[m-1]+e[m][n];const u=a[n],c=a.slice(-2),d=a.join();let h=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${c.join()}));
        }`;for(let m=1;m<l.length;m++){const g=l[m-1];h+=`
        if (${u} < ${l[m]}  && ${u} >= ${l[m-1]}) {
          return getChannel(
            getT${m}(${oy(a,u,g)}),
            vec2(${oy(c,u,g)}));
        }`}const p=l.length,f=l[l.length-1];h+=`
        return getChannel(
          getT${p}(${oy(a,u,f)}),
          vec2(${oy(c,u,f)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${h}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[r-1]} = ${i[r-1]} + 1;
        if (${i[r-1]} < ${s[r-1]}) {
          result.g = getValue(${i});
        }

        ${i[r-2]} = ${i[r-2]} + 1;
        if (${i[r-2]} < ${s[r-2]}) {
          result.a = getValue(${i});
        }

        ${i[r-1]} = ${i[r-1]} - 1;
        if (${i[r-2]} < ${s[r-2]} &&
            ${i[r-1]} < ${s[r-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function oy(t,e,n){const s=t.indexOf(e);return t.map((o,i)=>i===s?`${o} - ${n}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b1(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return Yr({inputs:{x:r.complexTensorInfos.imag},backend:n})}const pde={kernelName:M0,backendName:"webgl",kernelFunc:b1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _p(t,e,n){const s=t[0].dtype;if(s==="complex64"){const p=t.map(x=>hg({inputs:{input:x},backend:n})),f=t.map(x=>b1({inputs:{input:x},backend:n})),m=_p(p,e,n),g=_p(f,e,n),y=Yl({inputs:{real:m,imag:g},backend:n});return p.forEach(x=>n.disposeIntermediateTensorInfo(x)),f.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),y}let r=n.shouldExecuteOnCPU(t);if(s==="string"&&(r=!0),r){const p=t.map(b=>{const C=[-1,te(b.shape.slice(e))];return Ae({inputs:{x:b},backend:n,attrs:{shape:C}})}),f=p.map(b=>({vals:n.readSync(b.dataId),shape:b.shape})),m=Sr(p.map(b=>b.shape),1),g=p[0].shape[0]===1,y=sle(f,m,s,g),x=Sr(t.map(b=>b.shape),e),v=n.makeTensorInfo(x,s,y);return p.forEach(b=>n.disposeIntermediateTensorInfo(b)),v}const o=t.filter(p=>te(p.shape)>0),i=re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const p=i?new ea(t[0].shape,tl):new cl(t[0].shape,tl);return n.runWebGLProgram(p,t,s)}const a=re().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const p=[];for(let m=0;m<o.length;m+=a){const g=o.slice(m,m+a);p.push(_p(g,e,n))}const f=_p(p,e,n);for(const m of p)n.disposeIntermediateTensorInfo(m);return f}if(i){const p=new hde(o.map(f=>f.shape),e);return n.runWebGLProgram(p,o,s)}const{tensors2D:l,outShape:u}=fde(o,e,n),c=new dde(l.map(p=>p.shape)),d=n.runWebGLProgram(c,l,s);l.forEach(p=>n.disposeIntermediateTensorInfo(p));const h=Ae({inputs:{x:d},attrs:{shape:u},backend:n});return n.disposeIntermediateTensorInfo(d),h}function fde(t,e,n){const s=Sr(t.map(o=>o.shape),e);return{tensors2D:t.map(o=>Ae({inputs:{x:o},attrs:{shape:[-1,te(o.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zz(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,o=xt(r,e[0].shape)[0],i=e.map(u=>u.shape);Vw(i,o);const a=Sr(e.map(u=>u.shape),o);if(te(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>te(u.shape)>0);return l.length===1?Yr({inputs:{x:l[0]},backend:n}):_p(l,o,n)}const mde={kernelName:Jf,backendName:"webgl",kernelFunc:zz};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mz{constructor(e,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,d=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,f=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,g=e.dataFormat==="channelsLast",y=g?1:2,x=g?2:3,v=g?3:1;let b="",S="";s&&(r?b=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?b=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:b=`
          float activation(float x) {
            ${s}
          }
        `,S="result = activation(result);");const C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${b}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${v}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${x}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${f}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${f}) *
                    getW(wR, wC, ${f}, d2);
              } else {
                dotProd +=
                    getX(batch, ${f}, xR, xC) *
                    getW(wR, wC, ${f}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2),
                getW(wR, wC, ${f} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1),
                  getX(batch, xR, xC, ${f} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC),
                  getX(batch, ${f} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${S}
        setOutput(result);
      }
    `}}class gde{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,d=e.filterDepth,h=e.filterHeight,p=e.filterWidth,f=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${i}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${f}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${f}) *
                  getW(wF, wR, wC, ${f}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1),
                  getX(batch, xF, xR, xC, ${f} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2),
                  getW(wF, wR, wC, ${f} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bz{constructor(e,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ys(this.outputShape.length);const i=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,c=e.filterWidth,d=c;let h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<c;g++)h+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;h+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<c;g++)h+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(d+1)/2;g++){const y=g*2;if(h+=`
           xC = xCCorner + ${y*l};
           `,a===1){if(y<c&&(i%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,l===1&&y>0?h+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<c)){const x=i%2===0?l2(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${x};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,l>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:h+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):x===1?h+=`
                     xC${y+1} = xTexelC${y};
                     `:h+=`
                     xCOffset = xC + ${x};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<c&&(i%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<c&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<c&&(h+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<c&&(h+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<c&&(h+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;let p="",f="";s&&(r?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:p=`vec4 activation(vec4 x) {
           ${s}
         }`,f="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${f}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yde{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Ys(this.outputShape.length);const{dataFormat:s}=n,r=mr(),o=s==="channelsLast",i=o?1:2,a=o?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let c=0;c<=1;c++)for(let d=0;d<=1;d++)u+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${c};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ox(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function Vz({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const l=t.shape,u=s.texData.get(t.dataId),c=n.inChannels,d=l[0]*l[1]*l[2],h=n.outChannels,p=n.dataFormat==="channelsLast",f=!1,m=!1;let g;const y=[];if(o!=null){const b=Ox(o.shape,p);b!=null&&(o=Ae({inputs:{x:o},backend:s,attrs:{shape:b}}),y.push(o))}if(r!=null){const b=Ox(r.shape,p);b!=null&&(r=Ae({inputs:{x:r},backend:s,attrs:{shape:b}}),y.push(r))}if(!((d===1||h===1)&&c>_z)&&u.isPacked&&p&&u.texture!=null&&l[2]%2!==0&&Ct(u.shape.slice(-3),l.slice(-3))){const b=l[0]*l[1]*(l[2]+1),S={dataId:t.dataId,shape:[1,b,n.inChannels],dtype:t.dtype},C=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,A(Fx(u.shape,S.shape),()=>`packed reshape ${u.shape} to ${S.shape} isn't free`);const I=Ae({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(I);const T=Px({a:S,b:I,backend:s,transposeA:f,transposeB:m,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),R=s.texData.get(T.dataId);A(R.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=C,R.shape=n.outShape,g=Yr({inputs:{x:T},backend:s}),g.shape=n.outShape,y.push(T)}else{const b=n.outHeight*n.outWidth,S=Ae({inputs:{x:t},backend:s,attrs:{shape:p?[n.batchSize,b,n.inChannels]:[n.batchSize,n.inChannels,b]}}),C=Ae({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),I=Px({a:p?S:C,b:p?C:S,transposeA:!p,transposeB:m,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i});g=Ae({inputs:{x:I},backend:s,attrs:{shape:n.outShape}}),y.push(S),y.push(C),y.push(I)}for(const b of y)s.disposeIntermediateTensorInfo(b);return g}function Uz({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:c,outWidth:d,outHeight:h,dataFormat:p}=n,f=p==="channelsLast",m=l*u*c,g=h*d,y=[n.batchSize,m,g],x=!0,v=!1,b=[];if(o!=null){const j=Ox(o.shape,f);j!=null&&(o=Ae({inputs:{x:o},backend:s,attrs:{shape:j}}),b.push(o))}if(r!=null){const j=Ox(r.shape,f);j!=null&&(r=Ae({inputs:{x:r},backend:s,attrs:{shape:j}}),b.push(r))}const S=Ae({inputs:{x:e},backend:s,attrs:{shape:[1,m,te(e.shape)/m]}});b.push(S);const C=new yde(y,n),I=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],T=s.runWebGLProgram(C,[t],"float32",I),R=Ae({inputs:{x:T},backend:s,attrs:{shape:y}});b.push(T),b.push(R);const _=r!=null,P=o!=null,z=a==="leakyrelu",O=a?Ef(a,!0):null,V=new Az(f?R.shape:S.shape,f?S.shape:R.shape,f?[n.batchSize,g,n.outChannels]:[n.batchSize,n.outChannels,g],x,v,_,O,P,z),H=f?[R,S]:[S,R];if(r&&H.push(r),P&&H.push(o),z){const j=s.makeTensorInfo([],"float32",Ul(i,"float32"));H.push(j),b.push(j)}const Q=s.runWebGLProgram(V,H,"float32"),oe=Ae({inputs:{x:Q},backend:s,attrs:{shape:n.outShape}});b.push(Q);for(const j of b)s.disposeIntermediateTensorInfo(j);return oe}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xde(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=s,d=Zr(l),h=gn(r.shape,o.shape,i,u,a,c,!1,d);let p;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))p=Vz({x:r,filter:o,convInfo:h,backend:n});else if(h.strideWidth<=2&&d==="channelsLast"&&re().getBool("WEBGL_EXP_CONV")){const m=new Bz(h),g=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];p=n.runWebGLProgram(m,[r,o],"float32",g)}else if(re().getBool("WEBGL_CONV_IM2COL"))p=Uz({x:r,filter:o,convInfo:h,backend:n});else{const m=new Mz(h);p=n.runWebGLProgram(m,[r,o],"float32")}const f=Ae({inputs:{x:p},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(p),f}const wde={kernelName:Zf,backendName:"webgl",kernelFunc:xde};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let vde=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}},bde=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=s-1-e.padInfo.left,u=i?1:2,c=i?2:3,d=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},Sde=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},Cde=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,u=s-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kde(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=s,d=Zr(l),h=gn(r.shape,c,i,1,a,u,!1,d),p=new vde(h);return n.runWebGLProgram(p,[r,o],"float32")}const Ide={kernelName:S0,backendName:"webgl",kernelFunc:kde};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $de{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Ys(this.outputShape.length);const n=e.filterHeight,s=e.filterWidth,r=n-1-e.padInfo.top,o=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nde(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=s,d=Zr(u),h=gn(i,o.shape,a,1,l,c,!1,d);if(re().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const p=[[h.strideHeight,h.strideWidth]],f=new $de(h);return n.runWebGLProgram(f,[r,o],"float32",p)}else{const p=new bde(h);return n.runWebGLProgram(p,[r,o],"float32")}}const Tde={kernelName:em,backendName:"webgl",kernelFunc:Nde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ede(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s,u=Oi(r.shape,o.shape,i,l,a),c=new gde(u);return n.runWebGLProgram(c,[r,o],"float32")}const Rde={kernelName:tm,backendName:"webgl",kernelFunc:Ede};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dde(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:l}=s,u=Oi(r.shape,l,i,1,a),c=new Sde(u);return n.runWebGLProgram(c,[r,o],"float32")}const Ade={kernelName:C0,backendName:"webgl",kernelFunc:Dde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _de(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:l}=s,u=Oi(l,o.shape,a,1,i),c=new Cde(u);return n.runWebGLProgram(c,[r,o],"float32")}const Fde={kernelName:k0,backendName:"webgl",kernelFunc:_de};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pde=qh+`
  return cos(x);
`,Ode=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${wc}
  return result;
`,Lde=Wt({opSnippet:Pde,packedOpSnippet:Ode}),zde={kernelName:Qd,backendName:"webgl",kernelFunc:Lde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mde=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Bde=Wt({opSnippet:Mde}),Vde={kernelName:Jd,backendName:"webgl",kernelFunc:Bde};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Ude=class{constructor(e,n,s,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,l,u]=e,[c]=n,[d,h]=s;this.outputShape=[c,d,h,u];const p=r==="bilinear"?1:0,[f,m]=[`${a-1}.0`,`${l-1}.0`],[g,y,x]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${f}`],[v,b,S]=h>1?[`${(l-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${v});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${b};

        float in_y = ${x};
        if( in_y < 0.0 || in_y > ${f} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wde=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=s,c=new Ude(r.shape,o.shape,a,l,u);return n.runWebGLProgram(c,[r,o,i],"float32")},jde={kernelName:$0,backendName:"webgl",kernelFunc:Wde};var Df;(function(t){t.Prod="*",t.Sum="+"})(Df||(Df={}));let tE=class{constructor(e,n,s,r){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===Df.Prod?"1.0":"0.0",a=s?i:`getX(${nE(o,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",c="";s?(u=r?`end != ${l-1}`:"end != 0",c=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",c=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${on(o)} coords = getOutputCoords();
        int end = ${sE(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${c};
          ${sE(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${nE(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}};function nE(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function sE(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wz(t,e,n,s,r,o){const i=e.shape.length,a=an([s],i);let l=e;a!=null&&(l=pr({inputs:{x:e},backend:n,attrs:{perm:a}}));const u=yn(1,i)[0];if(u!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const c=l.shape[u];let d=Yr({inputs:{x:l},backend:n});for(let h=0;h<=Math.ceil(Math.log2(c))-1;h++){const p=new tE(t,l.shape,!1,o),f=[[h]],m=d;d=n.runWebGLProgram(p,[d],d.dtype,f),n.disposeIntermediateTensorInfo(m)}if(r){const h=new tE(t,l.shape,r,o),p=d;d=n.runWebGLProgram(h,[d],d.dtype),n.disposeIntermediateTensorInfo(p)}if(a!=null){const h=ha(a),p=pr({inputs:{x:d},backend:n,attrs:{perm:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),p}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gde(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return Wz(Df.Prod,r,n,o,i,a)}const Hde={kernelName:I0,backendName:"webgl",kernelFunc:Gde};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kde(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return Wz(Df.Sum,r,n,o,i,a)}const qde={kernelName:nm,backendName:"webgl",kernelFunc:Kde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xde(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const l=n.readSync(r.dataId),u=n.readSync(o.dataId),c=Cz(l,u,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,c)}else if(r.shape.length===2){const l=n.bufferSync(r),u=n.bufferSync(o),c=Zae(l,u,i,a);return n.makeTensorInfo(c.shape,o.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Yde={kernelName:N0,backendName:"webgl",kernelFunc:Xde};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Qde=class{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jde(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:o,dataFormat:i}=s,a=r.shape[0],l=i==="NHWC"?r.shape[1]:r.shape[2],u=i==="NHWC"?r.shape[2]:r.shape[3],c=i==="NHWC"?r.shape[3]:r.shape[1],d=l*o,h=u*o,p=c/(o*o),f=i==="NHWC"?[a,d,h,p]:[a,p,d,h],m=new Qde(f,o,i);return n.runWebGLProgram(m,[r],r.dtype)}const Zde={kernelName:T0,backendName:"webgl",kernelFunc:Jde};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let jz=class{constructor(e,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ys(this.outputShape.length);const i=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",c="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,c="result = activation(result);");const d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${c}
        setOutput(result);
      }
    `}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gz{constructor(e,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ys(this.outputShape.length);const i=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,d=e.filterWidth,h=d;let p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<d;y++)p+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;p+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let y=0;y<d;y++)p+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(h+1)/2;y++){const x=y*2;if(p+=`
          xC = xCCorner + ${x*u};
          `,l===1){if(x<d&&(a%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }
              `,u===1&&x>0?p+=`
                xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                  } else {
                    xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xC${x} = xTexelC${x};
                `,x+1<d)){const v=a%2===0?l2(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${v};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                    xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${x+1}.zw = vec2(0.0);
                    }
                    xTexelC${x+1}Ready = 1;
                  }
                  `,u>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                    } else {
                     xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                    }
                    `:p+=`
                    xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                    `):v===1?p+=`
                    xC${x+1} = xTexelC${x};
                    `:p+=`
                    xCOffset = xC + ${v};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                      xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${x+1}.zw = vec2(0.0);
                      }
                      xTexelC${x+1}Ready = 1;
                    }

                    xC${x+1} = xTexelC${x+1};
                    `}}else x<d&&(a%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.0);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
              `,x+1<d&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(
                  xTexelC${x}.xy, xTexelC${x+1}.xy);
              `,x+1<d&&(p+=`
                  xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                `)));x<d&&(p+=`
            wTexel = getW(r, ${x}, d1, q);
            dotProd += xC${x} * vec4(wTexel.xz, wTexel.xz);
          `,x+1<d&&(p+=`
              wTexel = getW(r, ${x+1}, d1, q);
              dotProd += xC${x+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let f="",m="";s&&(r?f=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?f=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:f=`vec4 activation(vec4 x) {
          ${s}
        }`,m="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${f}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ehe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=s;let c=l;c==null&&(c=[1,1]),A(ms(i,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const d=gn(r.shape,o.shape,i,c,a,u,!0);let h;re().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?h=new Gz(d):h=new jz(d);const p=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(h,[r,o],"float32",p)}const the={kernelName:sm,backendName:"webgl",kernelFunc:ehe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let nhe=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},she=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=n-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rhe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=s,d=gn(r.shape,c,i,a,l,u,!0),h=new nhe(d);return n.runWebGLProgram(h,[r,o],"float32")}const ohe={kernelName:E0,backendName:"webgl",kernelFunc:rhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ihe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=s,d=gn(c,o.shape,i,a,l,u,!0),h=new she(d);return n.runWebGLProgram(h,[r,o],"float32")}const ahe={kernelName:R0,backendName:"webgl",kernelFunc:ihe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let lhe=class{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uhe(t){const{inputs:e,backend:n}=t,{x:s}=e,r=[...s.shape,...s.shape],o=te(s.shape),i=Ae({inputs:{x:s},backend:n,attrs:{shape:[o]}}),a=new lhe(o),l=n.runWebGLProgram(a,[i],i.dtype),u=Ae({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),u}const che={kernelName:D0,backendName:"webgl",kernelFunc:uhe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let dhe=class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:r,strideHeight:o,strideWidth:i,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:c}=e,{top:d,left:h}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${i});
      const ivec2 pads = ivec2(${d}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hhe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s,u=Gl(r.shape,o.shape,i,a,"NHWC",l);let c;const d=new dhe(u);c=n.runWebGLProgram(d,[r,o],"float32");const h=Ae({inputs:{x:c},backend:n,attrs:{shape:u.outShape}});return n.disposeIntermediateTensorInfo(c),h}const phe={kernelName:rm,backendName:"webgl",kernelFunc:hhe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fhe(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:l}=Jw(r,o.length);e1(i.length,l,o);const{path:u,steps:c}=t1(a,l),d=c.length;let h=null,p=i.length;const f=[];for(let m=0;m<d;++m){for(const g of c[m]){const{permutationIndices:y,expandDims:x}=Zw(p,l[g]);let v;n1(y)?v=o[g]:(v=pr({inputs:{x:o[g]},backend:n,attrs:{perm:y}}),f.push(v));const b=v.shape.slice();for(let S=0;S<x.length;++S)b.splice(x[S],0,1);Ct(v.shape,b)||(v=Ae({inputs:{x:v},backend:n,attrs:{shape:b}}),f.push(v)),h===null?h=v:(h=uI({inputs:{a:v,b:h},backend:n}),f.push(h))}m<d-1&&(u[m]>=0&&(h=v1({inputs:{x:h},backend:n,attrs:{axis:u[m]-(i.length-p),keepDims:!1}}),f.push(h)),p--)}for(const m of f)m!==h&&n.disposeIntermediateTensorInfo(m);return h}const mhe={kernelName:A0,backendName:"webgl",kernelFunc:fhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ghe="return (x >= 0.0) ? x : (exp(x) - 1.0);",yhe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,xhe=Wt({opSnippet:ghe,packedOpSnippet:yhe}),whe={kernelName:eh,backendName:"webgl",kernelFunc:xhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vhe="return (b >= 0.0) ? a : a * (b + 1.0);",bhe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,She=t=>{const{inputs:e,backend:n}=t,{dy:s,y:r}=e,o=re().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Kh(bhe,s.shape,r.shape):new tc(vhe,s.shape,r.shape);return n.runWebGLProgram(o,[s,r],s.dtype)},Che={kernelName:_0,backendName:"webgl",kernelFunc:She};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const khe=`
  return vec4(equal(a, b));
`,Ihe="return float(a == b);",$he=Bs({opSnippet:Ihe,packedOpSnippet:khe,dtype:"bool",cpuKernelImpl:rle}),Nhe={kernelName:om,backendName:"webgl",kernelFunc:$he};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const The=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${Hw};
  float a1 = ${Kw};
  float a2 = ${qw};
  float a3 = ${Xw};
  float a4 = ${Yw};
  float a5 = ${Qw};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Ehe=Wt({opSnippet:The}),Rhe={kernelName:th,backendName:"webgl",kernelFunc:Ehe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dhe=qh+`
  return exp(x);
`,Ahe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Hz=Wt({opSnippet:Dhe,packedOpSnippet:Ahe,cpuKernelImpl:ole,dtype:"float32"}),_he={kernelName:nh,backendName:"webgl",kernelFunc:Hz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VS(t){const{inputs:e,attrs:n,backend:s}=t,{dim:r}=n,{input:o}=e,i=o.shape.length,a=o.shape.slice();let l=r;return r<0&&(A(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+r+1),a.splice(l,0,1),Ae({inputs:{x:o},backend:s,attrs:{shape:a}})}const Fhe={kernelName:im,backendName:"webgl",kernelFunc:VS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rE="return exp(x) - 1.0;",Phe=Wt({opSnippet:rE,packedOpSnippet:rE,cpuKernelImpl:ile}),Ohe={kernelName:sh,backendName:"webgl",kernelFunc:Phe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let oE=class{constructor(e,n,s){this.variableNames=["real","imag"];const r=n[1];this.outputShape=n;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kz(t,e,n){const s=n.texData.get(t.dataId),r=te(t.shape),o=t.shape[t.shape.length-1],i=r/o,a=Ae({inputs:{x:t},backend:n,attrs:{shape:[i,o]}}),l=a.shape,u=new oE("real",l,e),c=new oE("imag",l,e),d=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],h=n.runWebGLProgram(u,d,"float32"),p=n.runWebGLProgram(c,d,"float32"),f=Yl({inputs:{real:h,imag:p},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p);const m=Ae({inputs:{x:f},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(f),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lhe(t){const{inputs:e,backend:n}=t,{input:s}=e;return Kz(s,!1,n)}const zhe={kernelName:F0,backendName:"webgl",kernelFunc:Lhe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Mhe=class{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pg(t){const{backend:e,attrs:n}=t,{shape:s,value:r}=n;let{dtype:o}=n;if(o=o||oc(r),o==="string"){const i=Mn(o,te(s));return i.fill(r),e.makeTensorInfo(s,o,i)}else{const i=new Mhe(s,r),a=[[r]];return e.runWebGLProgram(i,[],o,a)}}const Bhe={kernelName:P0,backendName:"webgl",kernelFunc:pg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Vhe=class{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uhe={kernelName:O0,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,r=new Vhe(n.shape);return s.runWebGLProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iE="return floor(x);",Whe=Wt({opSnippet:iE,packedOpSnippet:iE,cpuKernelImpl:ale}),jhe={kernelName:rh,backendName:"webgl",kernelFunc:Whe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ghe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Hhe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Khe=Bs({opSnippet:Ghe,packedOpSnippet:Hhe,dtype:"int32"}),qhe={kernelName:oh,backendName:"webgl",kernelFunc:Khe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Xhe=class{constructor(e){this.variableNames=["A"];const n=mr(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yhe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=mr(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qhe={kernelName:cx,backendName:"webgl",kernelFunc:Jhe};let Ac,Ov=re().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function Jhe(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:r}=e;const{numChannels:o}=s,i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],c=[u,l],d=[u,l,o];if(a||i){const m=re().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Ac==null||m!==Ov)&&(Ov=m,Ac=document.createElement("canvas").getContext("2d",{willReadFrequently:Ov})),Ac.canvas.width=l,Ac.canvas.height=u,Ac.drawImage(r,0,0,l,u),r=Ac.canvas}const h=n.makeTensorInfo(c,"int32");n.texData.get(h.dataId).usage=ao.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),r);const p=re().getBool("WEBGL_PACK")?new Yhe(d):new Xhe(d),f=n.runWebGLProgram(p,[h],"int32");return n.disposeData(h.dataId),f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zhe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=s,m=Zr(c),g=gn(r.shape,o.shape,l,d,u,h,!1,m);let y;const x=[],v=i!=null,b=a!=null,S=p==="leakyrelu",C=()=>{const T=[r,o],R=(_,P)=>{if(P==="NCHW"&&_.shape.length===1&&_.shape[0]!==1){const z=Ae({inputs:{x:_},backend:n,attrs:{shape:[_.shape[0],1,1]}});return x.push(z),z}return _};if(v&&T.push(R(i,c)),b&&T.push(R(a,c)),S){const _=n.makeTensorInfo([],"float32",Ul(f,"float32"));T.push(_),x.push(_)}return T};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))y=Vz({x:r,filter:o,convInfo:g,backend:n,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else if(g.strideWidth<=2&&m==="channelsLast"&&re().getBool("WEBGL_EXP_CONV")){const T=p?Ef(p,!0):null,R=new Bz(g,v,T,b,S),_=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],P=C();y=n.runWebGLProgram(R,P,"float32",_)}else if(re().getBool("WEBGL_CONV_IM2COL"))y=Uz({x:r,filter:o,convInfo:g,backend:n,bias:i,activation:p,preluActivationWeights:a,leakyreluAlpha:f});else{const T=p?Ef(p,!1):null,R=new Mz(g,v,T,b,S),_=C();y=n.runWebGLProgram(R,_,"float32")}const I=Ae({inputs:{x:y},backend:n,attrs:{shape:g.outShape}});return x.push(y),x.forEach(T=>n.disposeIntermediateTensorInfo(T)),I}const epe={kernelName:ff,backendName:"webgl",kernelFunc:Zhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:c,dimRoundingMode:d,activation:h,leakyreluAlpha:p}=s,f=[];let m=c;m==null&&(m=[1,1]),A(ms(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const g=gn(r.shape,o.shape,l,m,u,d,!0),y=re().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,x=h?Ef(h,y):null,v=[r,o],b=i!=null,S=a!=null,C=h==="leakyrelu";if(b&&v.push(i),S&&v.push(a),C){const _=n.makeTensorInfo([],"float32",Ul(p,"float32"));v.push(_),f.push(_)}let I;y?I=new Gz(g,b,x,S,C):I=new jz(g,b,x,S,C);const T=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],R=n.runWebGLProgram(I,v,"float32",T);return f.forEach(_=>n.disposeIntermediateTensorInfo(_)),R}const npe={kernelName:mf,backendName:"webgl",kernelFunc:tpe};let spe=class{constructor(e,n,s,r){this.sliceDim=e,this.strides=n,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const o=on(s.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rpe(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,o=r.shape,i=o[o.length-1],a=te(s.shape),[l,u,c,d]=Lw(s,r),h=Ae({inputs:{x:r},backend:n,attrs:{shape:[u,i]}}),p=Ae({inputs:{x:s},backend:n,attrs:{shape:[te(s.shape)/c,c]}});if(n.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const y=n.readSync(r.dataId),x=n.bufferSync(s),v=lle(y,x,s.dtype,u,i,c,d,s.shape,a);return n.makeTensorInfo(l,s.dtype,v.values)}const f=new spe(i,d,[u,c],s.shape),m=n.runWebGLProgram(f,[p,h],p.dtype),g=Ae({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const ope={kernelName:L0,backendName:"webgl",kernelFunc:rpe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let ipe=class{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=on(this.rank),r=ape(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}};function ape(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<t.length;r++)r===2?s.push("index"):s.push(`${n[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qz(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:o}=e,{axis:i,batchDims:a}=s,l=xt(i,r.shape)[0];if(re().get("DEBUG")){const x=n.readSync(o.dataId),v=r.shape[l];for(let b=0;b<x.length;++b){const S=x[b];A(S<=v-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${v-1}]`)}}const u=r1(r,o,l,a),c=te(o.shape),d=[],h=Ae({inputs:{x:r},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),p=Ae({inputs:{x:o},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});d.push(h),d.push(p);const f=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const x=n.bufferSync(p),v=n.bufferSync(h),b=ule(v,x,f);return d.forEach(S=>n.disposeIntermediateTensorInfo(S)),n.makeTensorInfo(u.outputShape,b.dtype,b.values)}const m=new ipe(h.shape,f),g=n.runWebGLProgram(m,[h,p],h.dtype);d.push(g);const y=Ae({inputs:{x:g},backend:n,attrs:{shape:u.outputShape}});return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),y}const lpe={kernelName:lm,backendName:"webgl",kernelFunc:qz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const upe="return float(a > b);",cpe=`
  return vec4(greaterThan(a, b));
`,dpe=Bs({opSnippet:upe,packedOpSnippet:cpe,cpuKernelImpl:cle,dtype:"bool"}),hpe={kernelName:um,backendName:"webgl",kernelFunc:dpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ppe="return float(a >= b);",fpe=`
  return vec4(greaterThanEqual(a, b));
`,mpe=Bs({opSnippet:ppe,packedOpSnippet:fpe,dtype:"bool",cpuKernelImpl:dle}),gpe={kernelName:ih,backendName:"webgl",kernelFunc:mpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ype(t){const{inputs:e,backend:n}=t,{input:s}=e;return Kz(s,!0,n)}const xpe={kernelName:z0,backendName:"webgl",kernelFunc:ype};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wpe="return float(!isnan(x) && !isinf(x));",vpe=Wt({opSnippet:wpe,dtype:"bool"}),bpe={kernelName:lh,backendName:"webgl",kernelFunc:vpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Spe="return float(isinf(x));",Cpe=Wt({opSnippet:Spe,dtype:"bool"}),kpe={kernelName:uh,backendName:"webgl",kernelFunc:Cpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ipe="return float(isnan(x));",$pe=Wt({opSnippet:Ipe,dtype:"bool"}),Npe={kernelName:ch,backendName:"webgl",kernelFunc:$pe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tpe="return float(a < b);",Epe=`
  return vec4(lessThan(a, b));
`,Rpe=Bs({opSnippet:Tpe,packedOpSnippet:Epe,cpuKernelImpl:hle,dtype:"bool"}),Dpe={kernelName:dm,backendName:"webgl",kernelFunc:Rpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ape="return float(a <= b);",_pe=`
  return vec4(lessThanEqual(a, b));
`,Fpe=Bs({opSnippet:Ape,packedOpSnippet:_pe,cpuKernelImpl:ple,dtype:"bool"}),Ppe={kernelName:hm,backendName:"webgl",kernelFunc:Fpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ope(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:o}=n,i=fle(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const Lpe={kernelName:B0,backendName:"webgl",kernelFunc:Ope};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zpe=qh+`
  return x < 0.0 ? 0./0. : log(x);
`,Mpe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,Bpe=Wt({opSnippet:zpe,packedOpSnippet:Mpe,cpuKernelImpl:mle}),Vpe={kernelName:dh,backendName:"webgl",kernelFunc:Bpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Upe=qh+`
  return log(1.0 + x);
`,Wpe=Wt({opSnippet:Upe}),jpe={kernelName:hh,backendName:"webgl",kernelFunc:Wpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gpe="return float(a >= 1.0 && b >= 1.0);",Hpe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Kpe=Bs({opSnippet:Gpe,packedOpSnippet:Hpe,dtype:"bool"}),qpe={kernelName:pm,backendName:"webgl",kernelFunc:Kpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xpe="return float(!(x >= 1.0));",Ype=Wt({opSnippet:Xpe}),Qpe={kernelName:fm,backendName:"webgl",kernelFunc:Ype};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jpe="return float(a >= 1.0 || b >= 1.0);",Zpe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,efe=Bs({opSnippet:Jpe,packedOpSnippet:Zpe,dtype:"bool"}),tfe={kernelName:mm,backendName:"webgl",kernelFunc:efe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let nfe=class{constructor(e,n,s,r,o){this.variableNames=["x"],this.outputShape=[];const i=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${u})`:o===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sfe{constructor(e,n,s,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=n,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${u})`:o===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rfe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:l}=s,u=re().getBool("WEBGL_PACK_NORMALIZATION")?new sfe(r.shape,o,i,a,l):new nfe(r.shape,o,i,a,l);return n.runWebGLProgram(u,[r],r.dtype)},ofe={kernelName:gm,backendName:"webgl",kernelFunc:rfe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let ife=class{constructor(e,n,s,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const afe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=s,d=new ife(r.shape,a,l,u,c);return n.runWebGLProgram(d,[r,o,i],r.dtype)},lfe={kernelName:V0,backendName:"webgl",kernelFunc:afe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ufe(t,e,n,s){const r=te(e),i=te(t.shape)/r,a=Ae({inputs:{x:t},attrs:{shape:[i,r]},backend:s}),l=vc(a,t.dtype,"max",s),u=Ae({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xz(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=r.shape.length,l=xt(o,r.shape);let u=l;const c=an(u,a),d=c!=null,h=n.shouldExecuteOnCPU([r]);let p=r;if(d){if(h){const v=n.texData.get(p.dataId).values,b=new Array(a);for(let I=0;I<b.length;I++)b[I]=r.shape[c[I]];const S=aI(v,r.shape,r.dtype,c,b);p=n.makeTensorInfo(b,r.dtype);const C=n.texData.get(p.dataId);C.values=S}else p=w1(r,c,n);u=yn(u.length,a)}ss("max",u,a);const[f,m]=qn(p.shape,u);let g=f;i&&(g=Wn(f,l));let y;if(h){const v=n.texData.get(p.dataId).values,b=gle(v,te(m),g,r.dtype);y=n.makeTensorInfo(g,r.dtype);const S=n.texData.get(y.dataId);S.values=b}else y=ufe(p,m,g,n);return d&&n.disposeIntermediateTensorInfo(p),y}const cfe={kernelName:ym,backendName:"webgl",kernelFunc:Xz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dfe=lI+`
  return max(a, b);
`,hfe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+wc+`
  return result;
`,pfe=Bs({opSnippet:dfe,packedOpSnippet:hfe,cpuKernelImpl:yle}),ffe={kernelName:ph,backendName:"webgl",kernelFunc:pfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mfe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;cg(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;A(ms(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const c=qs(r.shape,o,i,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&Ct(c.inShape,c.outShape))return Yr({inputs:{x:r},backend:n});const d=new Rf(c,"max",!1);return n.runWebGLProgram(d,[r],r.dtype)}const gfe={kernelName:xm,backendName:"webgl",kernelFunc:mfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yfe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dataFormat:l,dimRoundingMode:u}=s,c=[1,1,1],d=xo(r.shape,o,i,c,a,u,l),h=new cI(d,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}const xfe={kernelName:wm,backendName:"webgl",kernelFunc:yfe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let wfe=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,l=i-1-e.padInfo.left,u=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},vfe=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,d=l-1-e.padInfo.front,h=u-1-e.padInfo.top,p=c-1-e.padInfo.left,f=l*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${h}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${f} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bfe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=s,d=[1,1,1],h=xo(i.shape,a,l,d,u,c),p=new cI(h,"max",!0),f=n.runWebGLProgram(p,[i],i.dtype),m=new vfe(h),g=n.runWebGLProgram(m,[r,f],i.dtype);return n.disposeIntermediateTensorInfo(f),g}const Sfe={kernelName:W0,backendName:"webgl",kernelFunc:bfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cfe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o,output:i}=e,a=o;cg([o,i],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:d}=s,h=qs(a.shape,l,u,1,c,d),p=!0,f=new Rf(h,"max",p),m=n.runWebGLProgram(f,[a],a.dtype),g=new wfe(h),y=n.runWebGLProgram(g,[r,m],a.dtype);return n.disposeIntermediateTensorInfo(m),y}const kfe={kernelName:U0,backendName:"webgl",kernelFunc:Cfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ife(t,e,n,s){let r=new Rf(n,"max",!1);const o=s.runWebGLProgram(r,[t],"float32");r=new Rf(n,"max",!0,!0,e);const i=s.runWebGLProgram(r,[t],"float32");return[o,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $fe={kernelName:j0,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,l=n;A(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];A(ms(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=qs(s.shape,r,o,u,i),[d,h]=Ife(s,a,c,l);return[d,h]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nfe(t,e,n,s){const r=te(e),i=te(t.shape)/r,a=Ae({inputs:{x:t},attrs:{shape:[i,r]},backend:s}),l=vc(a,"float32","mean",s),u=Ae({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tfe={kernelName:vm,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:r,axis:o}=e,i=n,a=s.shape.length,l=xt(o,s.shape);let u=l;const c=an(u,a),d=c!=null,h=i.shouldExecuteOnCPU([s]),p=[];let f=s;if(d){if(h){const b=i.texData.get(f.dataId).values,S=new Array(a);for(let T=0;T<S.length;T++)S[T]=s.shape[c[T]];const C=aI(b,s.shape,s.dtype,c,S);f=i.makeTensorInfo(S,s.dtype);const I=i.texData.get(f.dataId);I.values=C}else f=w1(s,c,i);p.push(f),u=yn(u.length,a)}ss("sum",u,a);const[m,g]=qn(f.shape,u);let y=m;r&&(y=Wn(m,l));const x=Nfe(f,g,y,i);for(const v of p)i.disposeIntermediateTensorInfo(v);return x}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Efe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=xt(o,r.shape);let u=l;const c=an(u,a);let d=r;c!=null&&(d=pr({inputs:{x:r},backend:n,attrs:{perm:c}}),u=yn(u.length,r.shape.length)),ss("min",u,a);const[h,p]=qn(d.shape,u),f=te(p),m=Ae({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}}),g=vc(m,m.dtype,"min",n);let y;if(i){const x=Wn(h,l);y=Ae({inputs:{x:g},backend:n,attrs:{shape:x}})}else y=Ae({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),c!=null&&n.disposeIntermediateTensorInfo(d),y}const Rfe={kernelName:bm,backendName:"webgl",kernelFunc:Efe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dfe=lI+`
  return min(a, b);
`,Afe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+wc+`
  return result;
`,_fe=Bs({opSnippet:Dfe,packedOpSnippet:Afe,cpuKernelImpl:xle}),Ffe={kernelName:fh,backendName:"webgl",kernelFunc:_fe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Pfe=class{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((c,d)=>c[0]+e[d]+c[1]);const r=e.length,o=on(r),i=n.map(c=>c[0]).join(","),a=n.map((c,d)=>c[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ofe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((f,m)=>f[0]+e[m]+f[1]);const r=e.length,o=on(r),i=n.map(f=>f[0]).join(","),a=n.map((f,m)=>f[0]+e[m]).join(","),l=lr("rc",r),u=lr("source",r),c=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${u.slice(-2).join()})`,h=s==="reflect"?0:1;let p="";if(r===1){const f=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;p=`
        ${o} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${u.join()}), ${d});
        ${l[r-1]} += 1;
        if(${c}) {
          ${f}
          result[1] = getChannel(getX(${u.join()}), ${d});
        }
      `}else{const f=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;p=`
        ${o} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${u.join()}), ${d});
        ${l[r-1]} += 1;
        if(${c}) {
          ${f}
          result[1] = getChannel(getX(${u.join()}), ${d});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${f}
          result[2] = getChannel(getX(${u.join()}), ${d});
          ${l[r-1]} += 1;
          if(${c}) {
            ${f}
            result[3] = getChannel(getX(${u.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lfe=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:r,mode:o}=n,i=re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ofe(s.shape,r,o):new Pfe(s.shape,r,o);return e.runWebGLProgram(i,[s],s.dtype)},zfe={kernelName:Sm,backendName:"webgl",kernelFunc:Lfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mfe=`if (b == 0.0) return NAN;
  return mod(a, b);`,Bfe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+wc+`
  return result;
`,Vfe=Bs({opSnippet:Mfe,packedOpSnippet:Bfe}),Ufe={kernelName:mh,backendName:"webgl",kernelFunc:Vfe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Wfe=class{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jfe=`
if (a == b) {
  return 1.0;
};
return a / b;`,Gfe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,Yz=Bs({opSnippet:jfe,packedOpSnippet:Gfe,checkOutOfBounds:!0}),Hfe={kernelName:Zd,backendName:"webgl",kernelFunc:Yz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aE="return a - b;",Qz=Bs({opSnippet:aE,packedOpSnippet:aE,supportsComplex:!0,cpuKernelImpl:Mle}),Kfe={kernelName:Dh,backendName:"webgl",kernelFunc:Qz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jz(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:o}=s,i=xt([o],r.shape),a=Xz({inputs:{x:r},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),l=Wn(a.shape,i),u=Ae({inputs:{x:a},backend:n,attrs:{shape:l}}),c=Qz({inputs:{a:r,b:u},backend:n}),d=Hz({inputs:{x:c},backend:n}),h=v1({inputs:{x:d},backend:n,attrs:{axis:i,keepDims:!1}}),p=Ae({inputs:{x:h},backend:n,attrs:{shape:l}}),f=Yz({inputs:{a:d,b:p},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),f}const qfe={kernelName:Bm,backendName:"webgl",kernelFunc:Jz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xfe(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s,l=a?r:Jz({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),u=l.shape[0],c=l.shape[1],d=new Wfe(u,c,o),h=[[i]],p=n.runWebGLProgram(d,[l],"int32",h);return a||n.disposeIntermediateTensorInfo(l),p}const Yfe={kernelName:G0,backendName:"webgl",kernelFunc:Xfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qfe=Zo+`
  return -x;
`,Jfe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Zfe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const o=n.texData.get(s.dataId),[i,a]=vle(o.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,i)}let r;return re().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new cl(s.shape,Jfe):r=new ea(s.shape,Qfe),n.runWebGLProgram(r,[s],s.dtype)}const eme={kernelName:Cm,backendName:"webgl",kernelFunc:Zfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tme=Pw;function nme(t){oo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s,u=n.readSync(r.dataId),c=n.readSync(o.dataId),{selectedIndices:d}=tme(u,c,i,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const sme={kernelName:H0,backendName:"webgl",kernelFunc:nme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rme=fk;function ome(t){oo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,c=n.readSync(r.dataId),d=n.readSync(o.dataId),{selectedIndices:h,validOutputs:p}=rme(c,d,i,a,l,u);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}const ime={kernelName:f2,backendName:"webgl",kernelFunc:ome};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ame=Ow;function lme(t){oo("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,c=n.readSync(r.dataId),d=n.readSync(o.dataId),h=i,p=a,f=l,m=u,{selectedIndices:g,selectedScores:y}=ame(c,d,h,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const ume={kernelName:K0,backendName:"webgl",kernelFunc:lme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let cme=class{constructor(e,n,s,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dme=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:l}=s,u=te(r.shape),c=new cme(u,i,a,l),d=Ae({inputs:{x:r},backend:n,attrs:{shape:[u]}}),h=n.runWebGLProgram(c,[d],o);n.disposeIntermediateTensorInfo(d);const p=[...r.shape,i],f=Ae({inputs:{x:h},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(h),f},hme={kernelName:$m,backendName:"webgl",kernelFunc:dme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lx(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const r=hg({inputs:{input:s},backend:n}),o=Lx({inputs:{x:r},backend:n}),i=b1({inputs:{input:s},backend:n}),a=Lx({inputs:{x:i},backend:n}),l=Yl({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return pg({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const pme={kernelName:Wm,backendName:"webgl",kernelFunc:Lx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zz(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=hg({inputs:{input:s},backend:n}),o=Zz({inputs:{x:r},backend:n}),i=b1({inputs:{input:s},backend:n}),a=Lx({inputs:{x:i},backend:n}),l=Yl({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return pg({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const fme={kernelName:Im,backendName:"webgl",kernelFunc:Zz};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mme(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return VS({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(c=>{Er(o,c.shape,"All tensors passed to stack must have matching shapes"),A(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const d=VS({inputs:{input:c},backend:n,attrs:{dim:r}});return a.push(d),d}),u=zz({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),u}const gme={kernelName:Nm,backendName:"webgl",kernelFunc:mme};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let yme=class{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((u,c)=>u[0]+e[c]+u[1]);const r=e.length,o=on(r),i=n.map(u=>u[0]).join(","),a=n.map((u,c)=>u[0]+e[c]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xme{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((m,g)=>m[0]+e[g]+m[1]);const r=e.length,o=on(r),i=n.map(m=>m[0]).join(","),a=n.map((m,g)=>m[0]+e[g]).join(","),l=lr("rc",r),u=lr("source",r),c=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${u.slice(-2).join()})`,h=[`${o} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${c}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${c}) {`],p=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let f="";for(let m=0,g=r===1?2:4;m<g;m++)f+=`
        ${h[m]}
        if (${p}) {
          result[${m}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${m}] = getChannel(getX(${u.join()}), ${d});
        }
      `;f+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eM=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:o,constantValue:i}=s;if(te(r.shape)===0){const u=o.map((c,d)=>c[0]+r.shape[d]+c[1]);return pg({backend:n,attrs:{shape:u,value:i,dtype:r.dtype}})}const a=re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new xme(r.shape,o,i):new yme(r.shape,o,i),l=[[i]];return n.runWebGLProgram(a,[r],r.dtype,l)},wme={kernelName:Tm,backendName:"webgl",kernelFunc:eM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vme=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,bme=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+wc+`
  return result;
`,Sme=Bs({opSnippet:vme,packedOpSnippet:bme}),Cme={kernelName:yh,backendName:"webgl",kernelFunc:Sme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kme(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=[],u=xt(o,r.shape);let c=u;const d=an(c,a);let h=r;d!=null&&(h=pr({inputs:{x:r},backend:n,attrs:{perm:d}}),c=yn(c.length,a),l.push(h)),ss("prod",c,a);let p;if(n.shouldExecuteOnCPU([h])){const f=n.texData.get(h.dataId).values,{outVals:m,outShape:g,outDtype:y}=Sle(h.shape,h.dtype,f,c);p=n.makeTensorInfo(g,y,m)}else{const[f,m]=qn(h.shape,c),g=te(m),y=Ae({inputs:{x:h},backend:n,attrs:{shape:[-1,g]}}),x=hw(r.dtype),v=vc(y,x,"prod",n);p=Ae({inputs:{x:v},backend:n,attrs:{shape:f}}),l.push(y),l.push(v)}if(i){l.push(p);const f=Wn(p.shape,u);p=Ae({inputs:{x:p},backend:n,attrs:{shape:f}})}return l.forEach(f=>n.disposeIntermediateTensorInfo(f)),p}const Ime={kernelName:Rm,backendName:"webgl",kernelFunc:kme};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $me(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,l=r.map(y=>n.readSync(y.dataId)),u=r.map(y=>y.shape),c=n.readSync(o.dataId),d=n.readSync(i.dataId),[h,p,f]=Cle(l,u,c,o.shape,o.dtype,d,i.shape,a),m=h.map(y=>n.makeTensorInfo([y.length],"int32",y)),g=n.makeTensorInfo(f,o.dtype,p);return m.concat([g])}const Nme={kernelName:m2,backendName:"webgl",kernelFunc:$me};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tme(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:o}=e,i=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(o.dataId),[u,c]=kle(i,s.shape,s.dtype,a,r.shape,l,o.shape),d=n.makeTensorInfo([u.length],"int32",u),h=n.makeTensorInfo([c.length],s.dtype,c);return[d,h]}const Eme={kernelName:g2,backendName:"webgl",kernelFunc:Tme};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rme(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=n.readSync(r.dataId),c=n.readSync(o.dataId),d=n.readSync(i.dataId),h=a.map(g=>n.readSync(g.dataId)),p=a.map(g=>g.shape),[f,m]=Ile(u,r.shape,c,o.shape,o.dtype,d,i.shape,h,p,l);return n.makeTensorInfo(f,o.dtype,m)}const Dme={kernelName:y2,backendName:"webgl",kernelFunc:Rme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tM=t=>{const{backend:e,attrs:n}=t,{start:s,stop:r,step:o,dtype:i}=n,a=$le(s,r,o,i);return e.makeTensorInfo([a.length],i,a)},Ame={kernelName:q0,backendName:"webgl",kernelFunc:tM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _me="return 1.0 / x;",Fme=Wt({opSnippet:_me}),Pme={kernelName:xh,backendName:"webgl",kernelFunc:Fme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ome=Zo+`
  return (x < 0.0) ? 0.0 : x;
`,Lme=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,zme=Wt({opSnippet:Ome,packedOpSnippet:Lme}),Mme={kernelName:wh,backendName:"webgl",kernelFunc:zme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bme=Zo+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Vme=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Ume=Wt({opSnippet:Bme,packedOpSnippet:Vme}),Wme={kernelName:vh,backendName:"webgl",kernelFunc:Ume};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let jme=class{constructor(e,n,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s];let h;o?h="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/d[0]},
          ${c[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gme{constructor(e,n,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s];let h;o?h="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/d[0]},
          ${c[1]/d[1]},
          ${c[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hme(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[l,u]=a,c=re().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Gme(r.shape,l,u,o,i):new jme(r.shape,l,u,o,i);return n.runWebGLProgram(c,[r],"float32")}const Kme={kernelName:_m,backendName:"webgl",kernelFunc:Hme};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let qme=class{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,o]=n,[,i,a]=e,l=[s&&i>1?r-1:r,s&&a>1?o-1:o],u=[s&&i>1?i-1:i,s&&a>1?a-1:a],c=l[0]/u[0],d=l[1]/u[1],h=1/c,p=1/d,f=Math.ceil(h)*2+2,m=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${p});

        const int winHeight = int(${f});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xme(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s,a=new qme(o.shape,r.shape,i);return n.runWebGLProgram(a,[o],o.dtype)}const Yme={kernelName:Q0,backendName:"webgl",kernelFunc:Xme};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Qme=class{constructor(e,n,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s],h=r?"0.5":"0.0";let p;o?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/d[0]},
          ${c[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jme{constructor(e,n,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,n,s,u];const c=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s],h=r?"0.5":"0.0";let p;o?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/d[0]},
          ${c[1]/d[1]},
          ${c[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zme(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[l,u]=a,c=re().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Jme(r.shape,l,u,o,i):new Qme(r.shape,l,u,o,i);return n.runWebGLProgram(c,[r],r.dtype)}const ege={kernelName:Am,backendName:"webgl",kernelFunc:Zme};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let tge=class{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,o]=n,[,i,a]=e,l=[s&&i>1?r-1:r,s&&a>1?o-1:o],u=[s&&i>1?i-1:i,s&&a>1?a-1:a],c=l[0]/u[0],d=l[1]/u[1],h=1/c,p=1/d,f=Math.ceil(h)*2+2,m=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${p});

        const int winHeight = int(${f});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nge(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s,a=new tge(o.shape,r.shape,i);return n.runWebGLProgram(a,[o],o.dtype)}const sge={kernelName:Y0,backendName:"webgl",kernelFunc:nge};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let rge=class{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,o=e.map((a,l)=>r(l)).join(","),i=on(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oge{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=lr("rc",s),o=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=on(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${o}){
            result.g = ${u(r.slice())};
          }
          if(${i}) {
            result.b = ${c(r.slice())};
            if(${o}) {
              result.a = ${d(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(f){return h(f)}function u(f){return f[s-1]="("+f[s-1]+" + 1)",h(f)}function c(f){return f[s-2]="("+f[s-2]+" + 1)",h(f)}function d(f){return f[s-1]="("+f[s-1]+" + 1)",f[s-2]="("+f[s-2]+" + 1)",h(f)}function h(f){const m=e.map((x,v)=>p(v,f)),g=m.join(","),y=m.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${y}))`}function p(f,m){return n.indexOf(f)!==-1&&e[f]!==1?`${e[f]} - ${m[f]} - 1`:`${m[f]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ige(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:o}=s,i=r.shape.length,a=xt(o,r.shape);if(i===0)return Yr({inputs:{x:r},backend:n});const l=re().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new oge(r.shape,a):new rge(r.shape,a);return n.runWebGLProgram(l,[r],r.dtype)}const age={kernelName:Fm,backendName:"webgl",kernelFunc:ige};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let lge=class{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let o="";typeof n=="number"?o=`float outputValue = ${n.toFixed(2)};`:o=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uge={kernelName:cw,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:o,center:i}=e,a=n,l=new lge(s.shape,o),[u,c]=Ww(i,s.shape[1],s.shape[2]),d=[[u,c,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cge=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,dge=Wt({opSnippet:cge}),hge={kernelName:bh,backendName:"webgl",kernelFunc:dge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pge="return inversesqrt(x);",fge=Wt({opSnippet:pge,cpuKernelImpl:Nle}),mge={kernelName:Sh,backendName:"webgl",kernelFunc:fge};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let dI=class{constructor(e,n,s,r,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const u=on(o.length),c=on(i.length);let d="";s===1?d="i":s===2&&(d="i, j");const h=`getIndices(${d})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const f=`getUpdates(${p})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,y=n>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${o});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${f};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gge{constructor(e,n,s,r,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const u=on(o.length),c=on(i.length);let d="";s===1?d="i":s===2&&(d="i, j");const h=`getIndices(${d})`;let p="";r===1?p="i":r===2&&(p="i, coords[1]");const f=`getUpdates(${p})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,y=n>1?"strides[j]":"strides",x=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${o});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${x};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${f};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yge(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:d}=fa(o,r,i),h=[d/u,u];if(d===0)return n.makeTensorInfo(i,r.dtype);const p=Ae({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),f=Ae({inputs:{x:o},backend:n,attrs:{shape:[l,u]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let g;re().getBool("WEBGL_PACK")?g=new gge(l,a,p.shape.length,f.shape.length,c,h):g=new dI(l,a,p.shape.length,f.shape.length,c,h);const y=n.runWebGLProgram(g,[f,p,m],f.dtype),x=Ae({inputs:{x:y},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),x}const xge={kernelName:J0,backendName:"webgl",kernelFunc:yge};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let wge=class{constructor(e,n,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const o="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=re().getNumber("WEBGL_VERSION")===2?o:i,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vge(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:o}=e,{side:i}=s,a=new wge(r.shape[0],r.shape[1],o.shape[1],i),l=[[r.shape[1]]];return n.runWebGLProgram(a,[r,o],"int32",l)}const bge={kernelName:ew,backendName:"webgl",kernelFunc:vge};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Sge=class{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let r,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let c=0;c<n.length;c++)u.push(`${a[c]}`),c<e&&l.push(`${a[c]}`);r=l.join(),o=u.join()}const i=on(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cge(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:o}=e,i=new Sge(s.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(i,[s,r,o],$s(r.dtype,o.dtype))}const kge={kernelName:Pm,backendName:"webgl",kernelFunc:Cge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ige=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Jm};
  float scale = ${Zm};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,$ge=Wt({opSnippet:Ige}),Nge={kernelName:Ch,backendName:"webgl",kernelFunc:$ge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tge=qh+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Ege=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Rge=Wt({opSnippet:Tge,packedOpSnippet:Ege,cpuKernelImpl:Ele}),Dge={kernelName:Nh,backendName:"webgl",kernelFunc:Rge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Age=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,_ge=Wt({opSnippet:Age}),Fge={kernelName:$h,backendName:"webgl",kernelFunc:_ge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pge=qh+`
  return sin(x);
`,Oge=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${wc}
  return result;
`,Lge=Wt({opSnippet:Pge,packedOpSnippet:Oge}),zge={kernelName:kh,backendName:"webgl",kernelFunc:Lge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mge=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,Bge=Wt({opSnippet:Mge}),Vge={kernelName:Ih,backendName:"webgl",kernelFunc:Bge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uge=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,Wge=Wt({opSnippet:Uge}),jge={kernelName:Th,backendName:"webgl",kernelFunc:Wge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gge=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,paddings:i}=s;A(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((y,x)=>y*x),l=[[0,0]];l.push(...i);for(let y=1+o.length;y<r.shape.length;++y)l.push([0,0]);const u=[],c=eM({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),d=hc(c.shape,o,a,!1),h=pc(d.length,o.length,!1),p=fc(c.shape,o,a,!1),f=Ae({inputs:{x:c},backend:n,attrs:{shape:d}}),m=pr({inputs:{x:f},backend:n,attrs:{perm:h}}),g=Ae({inputs:{x:m},backend:n,attrs:{shape:p}});return u.push(c),u.push(f),u.push(m),u.forEach(y=>n.disposeIntermediateTensorInfo(y)),g},Hge={kernelName:zm,backendName:"webgl",kernelFunc:Gge};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kge(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=n.readSync(s.dataId),l=n.readSync(r.dataId),u=n.readSync(o.dataId),c=n.readSync(i.dataId)[0],[d,h,p,f,m]=Dle(a,s.shape,s.dtype,l,r.dtype,u,c);return[n.makeTensorInfo(h,s.dtype,d),n.makeTensorInfo([h[0]],r.dtype,p),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(g=>Number(g)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const qge={kernelName:x2,backendName:"webgl",kernelFunc:Kge};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xge(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(n.readSync(r.dataId)),a=n.readSync(s.dataId),l=Array.from(n.readSync(o.dataId)),[u,c,d]=Ale(a,s.shape,s.dtype,i,l);return[n.makeTensorInfo(c,s.dtype,u),n.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const Yge={kernelName:w2,backendName:"webgl",kernelFunc:Xge};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qge(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const i=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(o.dataId),[u,c]=Iz(i,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(c,s.dtype,u)}const Jge={kernelName:tw,backendName:"webgl",kernelFunc:Qge};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zge(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const i=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(o.dataId),[u,c]=Iz(i,s.shape,s.dtype,a,l);return n.makeTensorInfo(c,s.dtype,u)}const eye={kernelName:nw,backendName:"webgl",kernelFunc:Zge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tye(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:c,strides:d,outputSize:h}=fa(o,r,a),p=!1;if(o.dtype==="string"){const y=n.bufferSync(r),x=n.bufferSync(o),v=ki(n.readSync(i.dataId)[0]),b=Tle(y,x,a,h,c,u,l,d,v,p);return n.makeTensorInfo(a,b.dtype,b.values)}const f=new dI(u,l,r.shape.length,o.shape.length,d,[h,1],p),m=n.runWebGLProgram(f,[o,r,i],o.dtype),g=Ae({inputs:{x:m},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(m),g}const nye={kernelName:sw,backendName:"webgl",kernelFunc:tye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=xt(i,r.shape)[0],l=s1(r,o,a),u=r.shape.length,c=new Array(u).fill(0),d=r.shape.slice();return l.map(h=>{const p=[...d];p[a]=h;const f=Xh({inputs:{x:r},backend:n,attrs:{begin:c,size:p}});return c[a]+=h,f})}const rye={kernelName:Mm,backendName:"webgl",kernelFunc:sye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lE="return sqrt(x);",oye=Wt({opSnippet:lE,packedOpSnippet:lE,cpuKernelImpl:_le}),iye={kernelName:Eh,backendName:"webgl",kernelFunc:oye};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aye="return x * x;",lye=Wt({opSnippet:aye}),uye={kernelName:rw,backendName:"webgl",kernelFunc:lye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uE="return (a - b) * (a - b);",cye=Bs({opSnippet:uE,packedOpSnippet:uE}),dye={kernelName:Rh,backendName:"webgl",kernelFunc:cye};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const o=n.readSync(r.dataId),i=Ti(o),a=Fle(i,"string",s);return n.makeTensorInfo(r.shape,"string",a)}const pye={kernelName:ow,backendName:"webgl",kernelFunc:hye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fye({inputs:t,attrs:e,backend:n}){const{x:s}=t,r=Zo+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new ea(s.shape,r);return n.runWebGLProgram(o,[s],s.dtype)}const mye={kernelName:Ph,backendName:"webgl",kernelFunc:fye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let gye=class{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,o=on(s.length),i=on(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,c)=>(l++,s.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${l-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${n});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:d,shrinkAxisMask:h}=s,{finalShapeSparse:p,finalShape:f,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:x,end:v,strides:b}=Bw(r.shape,o,i,a,l,u,c,d,h);let S;if(m)S=Ae({inputs:{x:r},backend:n,attrs:{shape:f}});else if(g||y){A(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const I=Mw(x,v,b),T=Xh({inputs:{x:r},backend:n,attrs:{begin:x,size:I}});S=Ae({inputs:{x:T},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(T)}else if(n.shouldExecuteOnCPU([r])){const T=n.readSync(r.dataId),R=yt(r.shape,r.dtype,T),_=Ple(p,R,b,x);S=n.makeTensorInfo(f,r.dtype,_.values)}else{const T=new gye(x,b,p);S=n.runWebGLProgram(T,[r],r.dtype)}const C=Ae({inputs:{x:S},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(S),C}const xye={kernelName:iw,backendName:"webgl",kernelFunc:yye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wye(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:c,dataSplits:d}=e,h=n.readSync(c.dataId),p=n.readSync(d.dataId),[f,m]=Ole(h,p,r,o,i,a,l,u);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(d.shape,"int32",m)]}const vye={kernelName:aw,backendName:"webgl",kernelFunc:wye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bye(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.readSync(o.dataId),l=n.readSync(i.dataId)[0],[u,c,d]=Lle(a,l,r),h=c.length;return[n.makeTensorInfo([h,2],"int32",u),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const Sye={kernelName:v2,backendName:"webgl",kernelFunc:bye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cye(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=n.readSync(o.dataId),a=zle(i,r);return n.makeTensorInfo(o.shape,"int32",a)}const kye={kernelName:b2,backendName:"webgl",kernelFunc:Cye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iye="return tan(x);",$ye=Wt({opSnippet:Iye}),Nye={kernelName:Ah,backendName:"webgl",kernelFunc:$ye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tye=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Eye=Wt({opSnippet:Tye}),Rye={kernelName:_h,backendName:"webgl",kernelFunc:Eye};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dye(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:r,indices:o,updates:i}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:d}=fa(i,o,r.shape),h=[d/u,u];if(d===0)return n.makeTensorInfo(r.shape,o.dtype);const p=Ae({inputs:{x:o},backend:n,attrs:{shape:[l,a]}}),f=Ae({inputs:{x:i},backend:n,attrs:{shape:[l,u]}}),m=Ae({inputs:{x:r},backend:n,attrs:{shape:h}}),g=new dI(l,a,p.shape.length,f.shape.length,c,h,!1,!0),y=n.runWebGLProgram(g,[f,p,m],m.dtype),x=Ae({inputs:{x:y},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),x}const Aye={kernelName:Z0,backendName:"webgl",kernelFunc:Dye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let _ye=class{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[i]*n[i];this.outputShape=s,this.rank=s.length;const r=on(this.rank),o=Fye(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}};function Fye(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<t.length;r++)s.push(`imod(${n[r]}, ${t[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nM(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:o}=s;if(r.dtype==="string"||r.shape.length>5){const l=n.readSync(r.dataId),u=r.dtype==="string"?l.map(h=>ki(h)):l,c=yt(r.shape,r.dtype,u),d=Ble(c,o);return n.makeTensorInfo(d.shape,d.dtype,d.values)}const i=new _ye(r.shape,o);return n.runWebGLProgram(i,[r],r.dtype)}const Pye={kernelName:Fh,backendName:"webgl",kernelFunc:nM};let Oye=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}},Lye=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ou(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function cE(t){let e=1;for(;e<t;)e*=2;return e}function zye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:o,sorted:i}=s,a=re().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=re().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,c=u[u.length-1];if(n.shouldExecuteOnCPU([r])||c<a||o>l){const _=n.readSync(r.dataId),[P,z]=Vle(_,u,r.dtype,o,i);return[n.makeTensorInfo(P.shape,P.dtype,P.values),n.makeTensorInfo(z.shape,z.dtype,z.values)]}if(o===0)return u[u.length-1]=0,[n.makeTensorInfo(u,r.dtype,[]),n.makeTensorInfo(u,"int32",[])];if(c===1)return[r,pg({attrs:{shape:u,dtype:"int32",value:0},backend:n})];const d=n.texData.get(r.dataId),h=d!==null&&d.isPacked,p=h?n.unpackTensor(r):r,m=te(u)/c,g=Ae({inputs:{x:p},attrs:{shape:[m,c]},backend:n});h&&ou(n,p);const y=cE(o),x=cE(c);let v=null;const b=()=>v===null?[g,g]:[g,v],S=(_,P,z)=>{const O=b(),V=new Oye(z),Q=[[c],[v===null?1:0],[Number.NEGATIVE_INFINITY],[_],[P]],oe=v;v=n.runWebGLProgram(V,O,"int32",Q),ou(n,oe)};for(let _=1;_<y;_*=2){const P=_*2;for(let z=_;z>=1;z/=2)S(P,z,[m,x])}for(let _=x;_>y;_/=2){const P=b(),z=new Lye([m,_/2]),V=[[c],[v===null?1:0],[y]],H=v;v=n.runWebGLProgram(z,P,"int32",V),ou(n,H);const Q=y/2,oe=Q*2;for(let j=Q;j>=1;j/=2)S(oe,j,v.shape)}let C=v;v=Xh({inputs:{x:v},backend:n,attrs:{begin:0,size:[m,o]}}),ou(n,C);let I=qz({inputs:{x:g,indices:v},backend:n,attrs:{axis:1,batchDims:1}});ou(n,g);const T=u.slice(0,-1);T.push(o),C=v,v=Ae({inputs:{x:v},attrs:{shape:T},backend:n}),ou(n,C);const R=I;return I=Ae({inputs:{x:I},attrs:{shape:T},backend:n}),ou(n,R),[I,v]}const Mye={kernelName:lw,backendName:"webgl",kernelFunc:zye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Bye=class{constructor(e,n,s,r,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vye(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=s,[c,d,h,p]=r.shape,[f,m]=u??[d,h],g=[c,f,m,p],y=new Bye(d,h,i,a,l,g);return n.runWebGLProgram(y,[r,o],"float32")}const Uye={kernelName:uw,backendName:"webgl",kernelFunc:Vye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wye(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:o}=e;cg(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(o.dataId),{outputValues:a,outputShape:l,indices:u}=Ule(i,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const jye={kernelName:S2,backendName:"webgl",kernelFunc:Wye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gye(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r,a=i.shape.length,l=r.shape[o],u=new Array(a-1);let c=0;for(let m=0;m<a;m++)m!==o&&(u[c++]=i.shape[m]);const d=[],h=new Array(a).fill(0),p=i.shape.slice();p[o]=1;const f=new Array(l);for(let m=0;m<f.length;m++){h[o]=m;const g=Xh({inputs:{x:i},backend:n,attrs:{begin:h,size:p}}),y=Ae({inputs:{x:g},backend:n,attrs:{shape:u}});f[m]=y,d.push(g)}return d.forEach(m=>n.disposeIntermediateTensorInfo(m)),f}const Hye={kernelName:Vm,backendName:"webgl",kernelFunc:Gye};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kye{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/s);this.outputShape=[r,a];const l="0.0",u="sumValue",c=Math.floor(s/4)*4,d=s%4,h=`
        sumValue += dot(values, segFilter);
    `;let p="";o%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let f="";o%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${f}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${c};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:o}=e,{numSegments:i}=s,a=r.shape.length,l=[];let u=0;const c=an([u],a);let d=r;c!=null&&(d=pr({inputs:{x:r},backend:n,attrs:{perm:c}}),l.push(d),u=yn(1,a)[0]);const h=kk(d.shape,u,i),p=te([d.shape[u]]),f=Ae({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}});l.push(f);const m=hw(r.dtype),g=(b,S,C,I,T)=>{const R=b.shape[0],_=b.shape[1],P=_F(_,T),z={windowSize:P,inSize:_,batchSize:R,numSegments:T},O=new Kye(z,S),V=n.compileAndRun(O,[b,C],I);if(l.push(V),V.shape[1]===T)return V;const H=tM({backend:n,attrs:{start:0,stop:T,step:1,dtype:"float32"}}),Q=nM({inputs:{x:H},backend:n,attrs:{reps:[_/P]}});return l.push(H),l.push(Q),g(V,S,Q,I,T)},y=g(f,"unsortedSegmentSum",o,m,i),x=Ae({inputs:{x:y},backend:n,attrs:{shape:h}});let v=x;if(c!=null){l.push(x);const b=ha(c);v=pr({inputs:{x:v},backend:n,attrs:{perm:b}})}return l.forEach(b=>n.disposeIntermediateTensorInfo(b)),v}const Xye={kernelName:Um,backendName:"webgl",kernelFunc:qye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yye=[_ue,Pue,zue,Vue,Wue,Hue,que,Yue,ece,nce,oce,lce,dce,mce,xce,vce,Sce,$ce,Tce,Rce,Fce,Vce,Wce,Kce,Xce,tde,sde,ade,gue,cde,mde,wde,Ide,Tde,Rde,Ade,Fde,zde,Vde,jde,Hde,qde,Yde,Zde,the,ohe,ahe,che,phe,mhe,whe,Che,Nhe,Rhe,_he,Fhe,Ohe,zhe,Bhe,Uhe,jhe,qhe,Qhe,epe,npe,ope,lpe,hpe,gpe,mue,xpe,pde,bpe,kpe,Npe,xue,Dpe,Ppe,Lpe,Vpe,jpe,qpe,Qpe,tfe,ofe,lfe,cfe,ffe,gfe,xfe,Sfe,kfe,$fe,Tfe,Rfe,Ffe,zfe,Ufe,Yfe,bue,eme,sme,ime,ume,Qce,hme,fme,gme,wme,Cme,vue,Ime,Nme,Eme,Dme,Ame,Jce,Hfe,Pme,Mme,Wme,Cue,Kme,Yme,ege,sge,age,uge,hge,mge,xge,bge,kge,Nge,Dge,Fge,zge,Vge,Mce,qfe,jge,Hge,qge,Yge,Jge,eye,nye,rye,iye,uye,dye,pye,mye,xye,vye,Sye,kye,Kfe,Rue,Nye,Rye,Aye,Pye,Mye,Uye,Due,jye,Hye,Xye,pme];for(const t of Yye)C2(t);var Qye={};(function(){var t;function e(w){var k=0;return function(){return k<w.length?{done:!1,value:w[k++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(w,k,N){return w==Array.prototype||w==Object.prototype||(w[k]=N.value),w};function s(w){w=[typeof globalThis=="object"&&globalThis,w,typeof window=="object"&&window,typeof self=="object"&&self,typeof xi=="object"&&xi];for(var k=0;k<w.length;++k){var N=w[k];if(N&&N.Math==Math)return N}throw Error("Cannot find global object")}var r=s(this);function o(w,k){if(k)e:{var N=r;w=w.split(".");for(var D=0;D<w.length-1;D++){var L=w[D];if(!(L in N))break e;N=N[L]}w=w[w.length-1],D=N[w],k=k(D),k!=D&&k!=null&&n(N,w,{configurable:!0,writable:!0,value:k})}}o("Symbol",function(w){function k(B){if(this instanceof k)throw new TypeError("Symbol is not a constructor");return new N(D+(B||"")+"_"+L++,B)}function N(B,M){this.h=B,n(this,"description",{configurable:!0,writable:!0,value:M})}if(w)return w;N.prototype.toString=function(){return this.h};var D="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",L=0;return k}),o("Symbol.iterator",function(w){if(w)return w;w=Symbol("Symbol.iterator");for(var k="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),N=0;N<k.length;N++){var D=r[k[N]];typeof D=="function"&&typeof D.prototype[w]!="function"&&n(D.prototype,w,{configurable:!0,writable:!0,value:function(){return i(e(this))}})}return w});function i(w){return w={next:w},w[Symbol.iterator]=function(){return this},w}function a(w){var k=typeof Symbol<"u"&&Symbol.iterator&&w[Symbol.iterator];return k?k.call(w):{next:e(w)}}function l(w){if(!(w instanceof Array)){w=a(w);for(var k,N=[];!(k=w.next()).done;)N.push(k.value);w=N}return w}var u=typeof Object.assign=="function"?Object.assign:function(w,k){for(var N=1;N<arguments.length;N++){var D=arguments[N];if(D)for(var L in D)Object.prototype.hasOwnProperty.call(D,L)&&(w[L]=D[L])}return w};o("Object.assign",function(w){return w||u});var c=typeof Object.create=="function"?Object.create:function(w){function k(){}return k.prototype=w,new k},d;if(typeof Object.setPrototypeOf=="function")d=Object.setPrototypeOf;else{var h;e:{var p={a:!0},f={};try{f.__proto__=p,h=f.a;break e}catch{}h=!1}d=h?function(w,k){if(w.__proto__=k,w.__proto__!==k)throw new TypeError(w+" is not extensible");return w}:null}var m=d;function g(w,k){if(w.prototype=c(k.prototype),w.prototype.constructor=w,m)m(w,k);else for(var N in k)if(N!="prototype")if(Object.defineProperties){var D=Object.getOwnPropertyDescriptor(k,N);D&&Object.defineProperty(w,N,D)}else w[N]=k[N];w.za=k.prototype}function y(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function x(w){if(w.m)throw new TypeError("Generator is already running");w.m=!0}y.prototype.u=function(w){this.i=w};function v(w,k){w.l={ma:k,na:!0},w.h=w.s||w.v}y.prototype.return=function(w){this.l={return:w},this.h=this.v};function b(w,k,N){return w.h=N,{value:k}}function S(w){this.h=new y,this.i=w}function C(w,k){x(w.h);var N=w.h.j;return N?I(w,"return"in N?N.return:function(D){return{value:D,done:!0}},k,w.h.return):(w.h.return(k),T(w))}function I(w,k,N,D){try{var L=k.call(w.h.j,N);if(!(L instanceof Object))throw new TypeError("Iterator result "+L+" is not an object");if(!L.done)return w.h.m=!1,L;var B=L.value}catch(M){return w.h.j=null,v(w.h,M),T(w)}return w.h.j=null,D.call(w.h,B),T(w)}function T(w){for(;w.h.h;)try{var k=w.i(w.h);if(k)return w.h.m=!1,{value:k.value,done:!1}}catch(N){w.h.i=void 0,v(w.h,N)}if(w.h.m=!1,w.h.l){if(k=w.h.l,w.h.l=null,k.na)throw k.ma;return{value:k.return,done:!0}}return{value:void 0,done:!0}}function R(w){this.next=function(k){return x(w.h),w.h.j?k=I(w,w.h.j.next,k,w.h.u):(w.h.u(k),k=T(w)),k},this.throw=function(k){return x(w.h),w.h.j?k=I(w,w.h.j.throw,k,w.h.u):(v(w.h,k),k=T(w)),k},this.return=function(k){return C(w,k)},this[Symbol.iterator]=function(){return this}}function _(w){function k(D){return w.next(D)}function N(D){return w.throw(D)}return new Promise(function(D,L){function B(M){M.done?D(M.value):Promise.resolve(M.value).then(k,N).then(B,L)}B(w.next())})}function P(w){return _(new R(new S(w)))}o("Promise",function(w){function k(M){this.i=0,this.j=void 0,this.h=[],this.u=!1;var Z=this.l();try{M(Z.resolve,Z.reject)}catch(ce){Z.reject(ce)}}function N(){this.h=null}function D(M){return M instanceof k?M:new k(function(Z){Z(M)})}if(w)return w;N.prototype.i=function(M){if(this.h==null){this.h=[];var Z=this;this.j(function(){Z.m()})}this.h.push(M)};var L=r.setTimeout;N.prototype.j=function(M){L(M,0)},N.prototype.m=function(){for(;this.h&&this.h.length;){var M=this.h;this.h=[];for(var Z=0;Z<M.length;++Z){var ce=M[Z];M[Z]=null;try{ce()}catch(ke){this.l(ke)}}}this.h=null},N.prototype.l=function(M){this.j(function(){throw M})},k.prototype.l=function(){function M(ke){return function(Fe){ce||(ce=!0,ke.call(Z,Fe))}}var Z=this,ce=!1;return{resolve:M(this.I),reject:M(this.m)}},k.prototype.I=function(M){if(M===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(M instanceof k)this.L(M);else{e:switch(typeof M){case"object":var Z=M!=null;break e;case"function":Z=!0;break e;default:Z=!1}Z?this.F(M):this.s(M)}},k.prototype.F=function(M){var Z=void 0;try{Z=M.then}catch(ce){this.m(ce);return}typeof Z=="function"?this.M(Z,M):this.s(M)},k.prototype.m=function(M){this.v(2,M)},k.prototype.s=function(M){this.v(1,M)},k.prototype.v=function(M,Z){if(this.i!=0)throw Error("Cannot settle("+M+", "+Z+"): Promise already settled in state"+this.i);this.i=M,this.j=Z,this.i===2&&this.K(),this.H()},k.prototype.K=function(){var M=this;L(function(){if(M.D()){var Z=r.console;typeof Z<"u"&&Z.error(M.j)}},1)},k.prototype.D=function(){if(this.u)return!1;var M=r.CustomEvent,Z=r.Event,ce=r.dispatchEvent;return typeof ce>"u"?!0:(typeof M=="function"?M=new M("unhandledrejection",{cancelable:!0}):typeof Z=="function"?M=new Z("unhandledrejection",{cancelable:!0}):(M=r.document.createEvent("CustomEvent"),M.initCustomEvent("unhandledrejection",!1,!0,M)),M.promise=this,M.reason=this.j,ce(M))},k.prototype.H=function(){if(this.h!=null){for(var M=0;M<this.h.length;++M)B.i(this.h[M]);this.h=null}};var B=new N;return k.prototype.L=function(M){var Z=this.l();M.T(Z.resolve,Z.reject)},k.prototype.M=function(M,Z){var ce=this.l();try{M.call(Z,ce.resolve,ce.reject)}catch(ke){ce.reject(ke)}},k.prototype.then=function(M,Z){function ce(it,We){return typeof it=="function"?function(gt){try{ke(it(gt))}catch(Dt){Fe(Dt)}}:We}var ke,Fe,mt=new k(function(it,We){ke=it,Fe=We});return this.T(ce(M,ke),ce(Z,Fe)),mt},k.prototype.catch=function(M){return this.then(void 0,M)},k.prototype.T=function(M,Z){function ce(){switch(ke.i){case 1:M(ke.j);break;case 2:Z(ke.j);break;default:throw Error("Unexpected state: "+ke.i)}}var ke=this;this.h==null?B.i(ce):this.h.push(ce),this.u=!0},k.resolve=D,k.reject=function(M){return new k(function(Z,ce){ce(M)})},k.race=function(M){return new k(function(Z,ce){for(var ke=a(M),Fe=ke.next();!Fe.done;Fe=ke.next())D(Fe.value).T(Z,ce)})},k.all=function(M){var Z=a(M),ce=Z.next();return ce.done?D([]):new k(function(ke,Fe){function mt(gt){return function(Dt){it[gt]=Dt,We--,We==0&&ke(it)}}var it=[],We=0;do it.push(void 0),We++,D(ce.value).T(mt(it.length-1),Fe),ce=Z.next();while(!ce.done)})},k});function z(w,k){w instanceof String&&(w+="");var N=0,D=!1,L={next:function(){if(!D&&N<w.length){var B=N++;return{value:k(B,w[B]),done:!1}}return D=!0,{done:!0,value:void 0}}};return L[Symbol.iterator]=function(){return L},L}o("Array.prototype.keys",function(w){return w||function(){return z(this,function(k){return k})}}),o("Array.prototype.fill",function(w){return w||function(k,N,D){var L=this.length||0;for(0>N&&(N=Math.max(0,L+N)),(D==null||D>L)&&(D=L),D=Number(D),0>D&&(D=Math.max(0,L+D)),N=Number(N||0);N<D;N++)this[N]=k;return this}});function O(w){return w||Array.prototype.fill}o("Int8Array.prototype.fill",O),o("Uint8Array.prototype.fill",O),o("Uint8ClampedArray.prototype.fill",O),o("Int16Array.prototype.fill",O),o("Uint16Array.prototype.fill",O),o("Int32Array.prototype.fill",O),o("Uint32Array.prototype.fill",O),o("Float32Array.prototype.fill",O),o("Float64Array.prototype.fill",O),o("Object.is",function(w){return w||function(k,N){return k===N?k!==0||1/k===1/N:k!==k&&N!==N}}),o("Array.prototype.includes",function(w){return w||function(k,N){var D=this;D instanceof String&&(D=String(D));var L=D.length;for(N=N||0,0>N&&(N=Math.max(N+L,0));N<L;N++){var B=D[N];if(B===k||Object.is(B,k))return!0}return!1}}),o("String.prototype.includes",function(w){return w||function(k,N){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(k instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(k,N||0)!==-1}});var V=this||self;function H(w,k){w=w.split(".");var N=V;w[0]in N||typeof N.execScript>"u"||N.execScript("var "+w[0]);for(var D;w.length&&(D=w.shift());)w.length||k===void 0?N[D]&&N[D]!==Object.prototype[D]?N=N[D]:N=N[D]={}:N[D]=k}function Q(w){var k;e:{if((k=V.navigator)&&(k=k.userAgent))break e;k=""}return k.indexOf(w)!=-1}var oe=Array.prototype.map?function(w,k){return Array.prototype.map.call(w,k,void 0)}:function(w,k){for(var N=w.length,D=Array(N),L=typeof w=="string"?w.split(""):w,B=0;B<N;B++)B in L&&(D[B]=k.call(void 0,L[B],B,w));return D},j={},ee=null;function ie(w){var k=w.length,N=3*k/4;N%3?N=Math.floor(N):"=.".indexOf(w[k-1])!=-1&&(N="=.".indexOf(w[k-2])!=-1?N-2:N-1);var D=new Uint8Array(N),L=0;return le(w,function(B){D[L++]=B}),L!==N?D.subarray(0,L):D}function le(w,k){function N(ce){for(;D<w.length;){var ke=w.charAt(D++),Fe=ee[ke];if(Fe!=null)return Fe;if(!/^[\s\xa0]*$/.test(ke))throw Error("Unknown base64 encoding at char: "+ke)}return ce}fe();for(var D=0;;){var L=N(-1),B=N(0),M=N(64),Z=N(64);if(Z===64&&L===-1)break;k(L<<2|B>>4),M!=64&&(k(B<<4&240|M>>2),Z!=64&&k(M<<6&192|Z))}}function fe(){if(!ee){ee={};for(var w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),k=["+/=","+/","-_=","-_.","-_"],N=0;5>N;N++){var D=w.concat(k[N].split(""));j[N]=D;for(var L=0;L<D.length;L++){var B=D[L];ee[B]===void 0&&(ee[B]=L)}}}}var ge=typeof Uint8Array<"u",xe=!(Q("Trident")||Q("MSIE"))&&typeof V.btoa=="function";function we(w){if(!xe){var k;k===void 0&&(k=0),fe(),k=j[k];for(var N=Array(Math.floor(w.length/3)),D=k[64]||"",L=0,B=0;L<w.length-2;L+=3){var M=w[L],Z=w[L+1],ce=w[L+2],ke=k[M>>2];M=k[(M&3)<<4|Z>>4],Z=k[(Z&15)<<2|ce>>6],ce=k[ce&63],N[B++]=ke+M+Z+ce}switch(ke=0,ce=D,w.length-L){case 2:ke=w[L+1],ce=k[(ke&15)<<2]||D;case 1:w=w[L],N[B]=k[w>>2]+k[(w&3)<<4|ke>>4]+ce+D}return N.join("")}for(k="";10240<w.length;)k+=String.fromCharCode.apply(null,w.subarray(0,10240)),w=w.subarray(10240);return k+=String.fromCharCode.apply(null,w),btoa(k)}var Ie=RegExp("[-_.]","g");function _e(w){switch(w){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function qe(w){if(!xe)return ie(w);Ie.test(w)&&(w=w.replace(Ie,_e)),w=atob(w);for(var k=new Uint8Array(w.length),N=0;N<w.length;N++)k[N]=w.charCodeAt(N);return k}var Ze;function dt(){return Ze||(Ze=new Uint8Array(0))}var Ge={},bt=typeof Uint8Array.prototype.slice=="function",ut=0,wt=0;function Nt(w){var k=0>w;w=Math.abs(w);var N=w>>>0;w=Math.floor((w-N)/4294967296),k&&(N=a(qt(N,w)),k=N.next().value,w=N.next().value,N=k),ut=N>>>0,wt=w>>>0}var Lt=typeof BigInt=="function";function qt(w,k){return k=~k,w?w=~w+1:k+=1,[w,k]}function W(w,k){this.i=w>>>0,this.h=k>>>0}function ae(w){if(!w)return ue||(ue=new W(0,0));if(!/^-?\d+$/.test(w))return null;if(16>w.length)Nt(Number(w));else if(Lt)w=BigInt(w),ut=Number(w&BigInt(4294967295))>>>0,wt=Number(w>>BigInt(32)&BigInt(4294967295));else{var k=+(w[0]==="-");wt=ut=0;for(var N=w.length,D=k,L=(N-k)%6+k;L<=N;D=L,L+=6)D=Number(w.slice(D,L)),wt*=1e6,ut=1e6*ut+D,4294967296<=ut&&(wt+=ut/4294967296|0,ut%=4294967296);k&&(k=a(qt(ut,wt)),w=k.next().value,k=k.next().value,ut=w,wt=k)}return new W(ut,wt)}var ue;function ve(w,k){return Error("Invalid wire type: "+w+" (at position "+k+")")}function Ce(){return Error("Failed to read varint, encoding is invalid.")}function be(w,k){return Error("Tried to read past the end of the data "+k+" > "+w)}function Oe(){throw Error("Invalid UTF8")}function at(w,k){return k=String.fromCharCode.apply(null,k),w==null?k:w+k}var Tt=void 0,vt,Jt=typeof TextDecoder<"u",Qs,Ts=typeof TextEncoder<"u",Js;function Zs(w){if(w!==Ge)throw Error("illegal external caller")}function Es(w,k){if(Zs(k),this.V=w,w!=null&&w.length===0)throw Error("ByteString should be constructed with non-empty values")}function to(){return Js||(Js=new Es(null,Ge))}function bo(w){Zs(Ge);var k=w.V;return k=k==null||ge&&k!=null&&k instanceof Uint8Array?k:typeof k=="string"?qe(k):null,k==null?k:w.V=k}function Rr(w){if(typeof w=="string")return{buffer:qe(w),C:!1};if(Array.isArray(w))return{buffer:new Uint8Array(w),C:!1};if(w.constructor===Uint8Array)return{buffer:w,C:!1};if(w.constructor===ArrayBuffer)return{buffer:new Uint8Array(w),C:!1};if(w.constructor===Es)return{buffer:bo(w)||dt(),C:!0};if(w instanceof Uint8Array)return{buffer:new Uint8Array(w.buffer,w.byteOffset,w.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function ga(w,k){this.i=null,this.m=!1,this.h=this.j=this.l=0,Mi(this,w,k)}function Mi(w,k,N){N=N===void 0?{}:N,w.S=N.S===void 0?!1:N.S,k&&(k=Rr(k),w.i=k.buffer,w.m=k.C,w.l=0,w.j=w.i.length,w.h=w.l)}ga.prototype.reset=function(){this.h=this.l};function So(w,k){if(w.h=k,k>w.j)throw be(w.j,k)}function ei(w){var k=w.i,N=w.h,D=k[N++],L=D&127;if(D&128&&(D=k[N++],L|=(D&127)<<7,D&128&&(D=k[N++],L|=(D&127)<<14,D&128&&(D=k[N++],L|=(D&127)<<21,D&128&&(D=k[N++],L|=D<<28,D&128&&k[N++]&128&&k[N++]&128&&k[N++]&128&&k[N++]&128&&k[N++]&128)))))throw Ce();return So(w,N),L}function ti(w,k){if(0>k)throw Error("Tried to read a negative byte length: "+k);var N=w.h,D=N+k;if(D>w.j)throw be(k,w.j-N);return w.h=D,N}var Jl=[];function Bi(){this.h=[]}Bi.prototype.length=function(){return this.h.length},Bi.prototype.end=function(){var w=this.h;return this.h=[],w};function Zl(w,k,N){for(;0<N||127<k;)w.h.push(k&127|128),k=(k>>>7|N<<25)>>>0,N>>>=7;w.h.push(k)}function Dr(w,k){for(;127<k;)w.h.push(k&127|128),k>>>=7;w.h.push(k)}function ni(w,k){if(Jl.length){var N=Jl.pop();Mi(N,w,k),w=N}else w=new ga(w,k);this.h=w,this.j=this.h.h,this.i=this.l=-1,this.setOptions(k)}ni.prototype.setOptions=function(w){w=w===void 0?{}:w,this.ca=w.ca===void 0?!1:w.ca},ni.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function si(w){var k=w.h;if(k.h==k.j)return!1;w.j=w.h.h;var N=ei(w.h)>>>0;if(k=N>>>3,N&=7,!(0<=N&&5>=N))throw ve(N,w.j);if(1>k)throw Error("Invalid field number: "+k+" (at position "+w.j+")");return w.l=k,w.i=N,!0}function ya(w){switch(w.i){case 0:if(w.i!=0)ya(w);else e:{w=w.h;for(var k=w.h,N=k+10,D=w.i;k<N;)if(!(D[k++]&128)){So(w,k);break e}throw Ce()}break;case 1:w=w.h,So(w,w.h+8);break;case 2:w.i!=2?ya(w):(k=ei(w.h)>>>0,w=w.h,So(w,w.h+k));break;case 5:w=w.h,So(w,w.h+4);break;case 3:k=w.l;do{if(!si(w))throw Error("Unmatched start-group tag: stream EOF");if(w.i==4){if(w.l!=k)throw Error("Unmatched end-group tag");break}ya(w)}while(!0);break;default:throw ve(w.i,w.j)}}var Vi=[];function Y(){this.j=[],this.i=0,this.h=new Bi}function se(w,k){k.length!==0&&(w.j.push(k),w.i+=k.length)}function de(w,k){if(k=k.R){se(w,w.h.end());for(var N=0;N<k.length;N++)se(w,bo(k[N])||dt())}}var ye=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function ze(w,k){return ye?w[ye]|=k:w.A!==void 0?w.A|=k:(Object.defineProperties(w,{A:{value:k,configurable:!0,writable:!0,enumerable:!1}}),k)}function rt(w,k){ye?w[ye]&&(w[ye]&=~k):w.A!==void 0&&(w.A&=~k)}function He(w){var k;return ye?k=w[ye]:k=w.A,k??0}function Le(w,k){ye?w[ye]=k:w.A!==void 0?w.A=k:Object.defineProperties(w,{A:{value:k,configurable:!0,writable:!0,enumerable:!1}})}function Ke(w){return ze(w,1),w}function je(w,k){Le(k,(w|0)&-51)}function nt(w,k){Le(k,(w|18)&-41)}var St={};function Et(w){return w!==null&&typeof w=="object"&&!Array.isArray(w)&&w.constructor===Object}var hn,Xt=[];Le(Xt,23),hn=Object.freeze(Xt);function _t(w){if(He(w.o)&2)throw Error("Cannot mutate an immutable Message")}function ln(w){var k=w.length;(k=k?w[k-1]:void 0)&&Et(k)?k.g=1:(k={},w.push((k.g=1,k)))}function Co(w){var k=w.i+w.G;return w.B||(w.B=w.o[k]={})}function ys(w,k){return k===-1?null:k>=w.i?w.B?w.B[k]:void 0:w.o[k+w.G]}function On(w,k,N,D){_t(w),Rs(w,k,N,D)}function Rs(w,k,N,D){w.j&&(w.j=void 0),k>=w.i||D?Co(w)[k]=N:(w.o[k+w.G]=N,(w=w.B)&&k in w&&delete w[k])}function xa(w,k,N,D){var L=ys(w,k);Array.isArray(L)||(L=hn);var B=He(L);if(B&1||Ke(L),D)B&2||ze(L,2),N&1||Object.freeze(L);else{D=!(N&2);var M=B&2;N&1||!M?D&&B&16&&!M&&rt(L,16):(L=Ke(Array.prototype.slice.call(L)),Rs(w,k,L))}return L}function ri(w,k){var N=ys(w,k),D=N==null?N:typeof N=="number"||N==="NaN"||N==="Infinity"||N==="-Infinity"?Number(N):void 0;return D!=null&&D!==N&&Rs(w,k,D),D}function ko(w,k,N,D,L){w.h||(w.h={});var B=w.h[N],M=xa(w,N,3,L);if(!B){var Z=M;B=[];var ce=!!(He(w.o)&16);M=!!(He(Z)&2);var ke=Z;!L&&M&&(Z=Array.prototype.slice.call(Z));for(var Fe=M,mt=0;mt<Z.length;mt++){var it=Z[mt],We=k,gt=!1;if(gt=gt===void 0?!1:gt,it=Array.isArray(it)?new We(it):gt?new We:void 0,it!==void 0){We=it.o;var Dt=gt=He(We);M&&(Dt|=2),ce&&(Dt|=16),Dt!=gt&&Le(We,Dt),We=Dt,Fe=Fe||!!(2&We),B.push(it)}}return w.h[N]=B,ce=He(Z),k=ce|33,k=Fe?k&-9:k|8,ce!=k&&(Fe=Z,Object.isFrozen(Fe)&&(Fe=Array.prototype.slice.call(Fe)),Le(Fe,k),Z=Fe),ke!==Z&&Rs(w,N,Z),(L||D&&M)&&ze(B,2),D&&Object.freeze(B),B}return L||(L=Object.isFrozen(B),D&&!L?Object.freeze(B):!D&&L&&(B=Array.prototype.slice.call(B),w.h[N]=B)),B}function Ui(w,k,N){var D=!!(He(w.o)&2);if(k=ko(w,k,N,D,D),w=xa(w,N,3,D),!(D||He(w)&8)){for(D=0;D<k.length;D++){if(N=k[D],He(N.o)&2){var L=vg(N,!1);L.j=N}else L=N;N!==L&&(k[D]=L,w[D]=L.o)}ze(w,8)}return k}function Vs(w,k,N){if(N!=null&&typeof N!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof N+": "+N);On(w,k,N)}function Ft(w,k,N,D,L){_t(w);var B=ko(w,N,k,!1,!1);return N=D??new N,w=xa(w,k,2,!1),L!=null?(B.splice(L,0,N),w.splice(L,0,N.o)):(B.push(N),w.push(N.o)),N.C()&&rt(w,8),N}function nn(w,k){return w??k}function xs(w,k,N){return N=N===void 0?0:N,nn(ri(w,k),N)}var Io;function Rn(w){switch(typeof w){case"number":return isFinite(w)?w:String(w);case"object":if(w)if(Array.isArray(w)){if(He(w)&128)return w=Array.prototype.slice.call(w),ln(w),w}else{if(ge&&w!=null&&w instanceof Uint8Array)return we(w);if(w instanceof Es){var k=w.V;return k==null?"":typeof k=="string"?k:w.V=we(k)}}}return w}function oi(w,k,N,D){if(w!=null){if(Array.isArray(w))w=qa(w,k,N,D!==void 0);else if(Et(w)){var L={},B;for(B in w)L[B]=oi(w[B],k,N,D);w=L}else w=k(w,D);return w}}function qa(w,k,N,D){var L=He(w);D=D?!!(L&16):void 0,w=Array.prototype.slice.call(w);for(var B=0;B<w.length;B++)w[B]=oi(w[B],k,N,D);return N(L,w),w}function tp(w){return w.ja===St?w.toJSON():Rn(w)}function A1(w,k){w&128&&ln(k)}function yg(w,k,N){if(N=N===void 0?nt:N,w!=null){if(ge&&w instanceof Uint8Array)return w.length?new Es(new Uint8Array(w),Ge):to();if(Array.isArray(w)){var D=He(w);return D&2?w:k&&!(D&32)&&(D&16||D===0)?(Le(w,D|2),w):(w=qa(w,yg,D&4?nt:N,!0),k=He(w),k&4&&k&2&&Object.freeze(w),w)}return w.ja===St?wg(w):w}}function xg(w,k,N,D,L,B,M){if(w=w.h&&w.h[N]){if(D=He(w),D&2?D=w:(B=oe(w,wg),nt(D,B),Object.freeze(B),D=B),_t(k),M=D==null?hn:Ke([]),D!=null){for(B=!!D.length,w=0;w<D.length;w++){var Z=D[w];B=B&&!(He(Z.o)&2),M[w]=Z.o}B=(B?8:0)|1,w=He(M),(w&B)!==B&&(Object.isFrozen(M)&&(M=Array.prototype.slice.call(M)),Le(M,w|B)),k.h||(k.h={}),k.h[N]=D}else k.h&&(k.h[N]=void 0);Rs(k,N,M,L)}else On(k,N,yg(D,B,M),L)}function wg(w){return He(w.o)&2||(w=vg(w,!0),ze(w.o,2)),w}function vg(w,k){var N=w.o,D=[];ze(D,16);var L=w.constructor.h;if(L&&D.push(L),L=w.B,L){D.length=N.length,D.fill(void 0,D.length,N.length);var B={};D[D.length-1]=B}He(N)&128&&ln(D),k=k||w.C()?nt:je,B=w.constructor,Io=D,D=new B(D),Io=void 0,w.R&&(D.R=w.R.slice()),B=!!(He(N)&16);for(var M=L?N.length-1:N.length,Z=0;Z<M;Z++)xg(w,D,Z-w.G,N[Z],!1,B,k);if(L)for(var ce in L)xg(w,D,+ce,L[ce],!0,B,k);return D}function er(w,k,N){w==null&&(w=Io),Io=void 0;var D=this.constructor.i||0,L=0<D,B=this.constructor.h,M=!1;if(w==null){w=B?[B]:[];var Z=48,ce=!0;L&&(D=0,Z|=128),Le(w,Z)}else{if(!Array.isArray(w)||B&&B!==w[0])throw Error();var ke=Z=ze(w,0);if((ce=(16&ke)!==0)&&((M=(32&ke)!==0)||(ke|=32)),L){if(128&ke)D=0;else if(0<w.length){var Fe=w[w.length-1];if(Et(Fe)&&"g"in Fe){D=0,ke|=128,delete Fe.g;var mt=!0,it;for(it in Fe){mt=!1;break}mt&&w.pop()}}}else if(128&ke)throw Error();Z!==ke&&Le(w,ke)}this.G=(B?0:-1)-D,this.h=void 0,this.o=w;e:{if(B=this.o.length,D=B-1,B&&(B=this.o[D],Et(B))){this.B=B,this.i=D-this.G;break e}k!==void 0&&-1<k?(this.i=Math.max(k,D+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!L&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(N){k=ce&&!M&&!0,L=this.i;var We;for(ce=0;ce<N.length;ce++)M=N[ce],M<L?(M+=this.G,(D=w[M])?bg(D,k):w[M]=hn):(We||(We=Co(this)),(D=We[M])?bg(D,k):We[M]=hn)}}er.prototype.toJSON=function(){return qa(this.o,tp,A1)},er.prototype.C=function(){return!!(He(this.o)&2)};function bg(w,k){if(Array.isArray(w)){var N=He(w),D=1;!k||N&2||(D|=16),(N&D)!==D&&Le(w,N|D)}}er.prototype.ja=St,er.prototype.toString=function(){return this.o.toString()};function Sg(w,k,N){if(N){var D={},L;for(L in N){var B=N[L],M=B.ra;M||(D.J=B.xa||B.oa.W,B.ia?(D.aa=$o(B.ia),M=function(Z){return function(ce,ke,Fe){return Z.J(ce,ke,Fe,Z.aa)}}(D)):B.ka?(D.Z=Xa(B.da.P,B.ka),M=function(Z){return function(ce,ke,Fe){return Z.J(ce,ke,Fe,Z.Z)}}(D)):M=D.J,B.ra=M),M(k,w,B.da),D={J:D.J,aa:D.aa,Z:D.Z}}}de(k,w)}var kc=Symbol();function Cg(w,k,N){return w[kc]||(w[kc]=function(D,L){return k(D,L,N)})}function Ne(w){var k=w[kc];if(!k){var N=_1(w);k=function(D,L){return bI(D,L,N)},w[kc]=k}return k}function zt(w){var k=w.ia;if(k)return Ne(k);if(k=w.wa)return Cg(w.da.P,k,w.ka)}function pn(w){var k=zt(w),N=w.da,D=w.oa.U;return k?function(L,B){return D(L,B,N,k)}:function(L,B){return D(L,B,N)}}function Cn(w,k){var N=w[k];return typeof N=="function"&&N.length===0&&(N=N(),w[k]=N),Array.isArray(N)&&(rs in N||ii in N||0<N.length&&typeof N[0]=="function")?N:void 0}function Ds(w,k,N,D,L,B){k.P=w[0];var M=1;if(w.length>M&&typeof w[M]!="number"){var Z=w[M++];N(k,Z)}for(;M<w.length;){N=w[M++];for(var ce=M+1;ce<w.length&&typeof w[ce]!="number";)ce++;switch(Z=w[M++],ce-=M,ce){case 0:D(k,N,Z);break;case 1:(ce=Cn(w,M))?(M++,L(k,N,Z,ce)):D(k,N,Z,w[M++]);break;case 2:ce=M++,ce=Cn(w,ce),L(k,N,Z,ce,w[M++]);break;case 3:B(k,N,Z,w[M++],w[M++],w[M++]);break;case 4:B(k,N,Z,w[M++],w[M++],w[M++],w[M++]);break;default:throw Error("unexpected number of binary field arguments: "+ce)}}return k}var ws=Symbol();function $o(w){var k=w[ws];if(!k){var N=Zt(w);k=function(D,L){return SI(D,L,N)},w[ws]=k}return k}function Xa(w,k){var N=w[ws];return N||(N=function(D,L){return Sg(D,L,k)},w[ws]=N),N}var ii=Symbol();function eu(w,k){w.push(k)}function tu(w,k,N){w.push(k,N.W)}function nu(w,k,N,D){var L=$o(D),B=Zt(D).P,M=N.W;w.push(k,function(Z,ce,ke){return M(Z,ce,ke,B,L)})}function As(w,k,N,D,L,B){var M=Xa(D,B),Z=N.W;w.push(k,function(ce,ke,Fe){return Z(ce,ke,Fe,D,M)})}function Zt(w){var k=w[ii];return k||(k=Ds(w,w[ii]=[],eu,tu,nu,As),rs in w&&ii in w&&(w.length=0),k)}var rs=Symbol();function vB(w,k){w[0]=k}function bB(w,k,N,D){var L=N.U;w[k]=D?function(B,M,Z){return L(B,M,Z,D)}:L}function SB(w,k,N,D,L){var B=N.U,M=Ne(D),Z=_1(D).P;w[k]=function(ce,ke,Fe){return B(ce,ke,Fe,Z,M,L)}}function CB(w,k,N,D,L,B,M){var Z=N.U,ce=Cg(D,L,B);w[k]=function(ke,Fe,mt){return Z(ke,Fe,mt,D,ce,M)}}function _1(w){var k=w[rs];return k||(k=Ds(w,w[rs]={},vB,bB,SB,CB),rs in w&&ii in w&&(w.length=0),k)}function bI(w,k,N){for(;si(k)&&k.i!=4;){var D=k.l,L=N[D];if(!L){var B=N[0];B&&(B=B[D])&&(L=N[D]=pn(B))}if(!L||!L(k,w,D)){L=k,D=w,B=L.j,ya(L);var M=L;if(!M.ca){if(L=M.h.h-B,M.h.h=B,M=M.h,L==0)L=to();else{if(B=ti(M,L),M.S&&M.m)L=M.i.subarray(B,B+L);else{M=M.i;var Z=B;L=B+L,L=Z===L?dt():bt?M.slice(Z,L):new Uint8Array(M.subarray(Z,L))}L=L.length==0?to():new Es(L,Ge)}(B=D.R)?B.push(L):D.R=[L]}}}return w}function SI(w,k,N){for(var D=N.length,L=D%2==1,B=L?1:0;B<D;B+=2)(0,N[B+1])(k,w,N[B]);Sg(w,k,L?N[0]:void 0)}function np(w,k){return{U:w,W:k}}var ai=np(function(w,k,N){if(w.i!==5)return!1;w=w.h;var D=w.i,L=w.h,B=D[L],M=D[L+1],Z=D[L+2];return D=D[L+3],So(w,w.h+4),M=(B<<0|M<<8|Z<<16|D<<24)>>>0,w=2*(M>>31)+1,B=M>>>23&255,M&=8388607,On(k,N,B==255?M?NaN:1/0*w:B==0?w*Math.pow(2,-149)*M:w*Math.pow(2,B-150)*(M+Math.pow(2,23))),!0},function(w,k,N){if(k=ri(k,N),k!=null){Dr(w.h,8*N+5),w=w.h;var D=+k;D===0?0<1/D?ut=wt=0:(wt=0,ut=2147483648):isNaN(D)?(wt=0,ut=2147483647):(D=(N=0>D?-2147483648:0)?-D:D,34028234663852886e22<D?(wt=0,ut=(N|2139095040)>>>0):11754943508222875e-54>D?(D=Math.round(D/Math.pow(2,-149)),wt=0,ut=(N|D)>>>0):(k=Math.floor(Math.log(D)/Math.LN2),D*=Math.pow(2,-k),D=Math.round(8388608*D),16777216<=D&&++k,wt=0,ut=(N|k+127<<23|D&8388607)>>>0)),N=ut,w.h.push(N>>>0&255),w.h.push(N>>>8&255),w.h.push(N>>>16&255),w.h.push(N>>>24&255)}}),kB=np(function(w,k,N){if(w.i!==0)return!1;var D=w.h,L=0,B=w=0,M=D.i,Z=D.h;do{var ce=M[Z++];L|=(ce&127)<<B,B+=7}while(32>B&&ce&128);for(32<B&&(w|=(ce&127)>>4),B=3;32>B&&ce&128;B+=7)ce=M[Z++],w|=(ce&127)<<B;if(So(D,Z),128>ce)D=L>>>0,ce=w>>>0,(w=ce&2147483648)&&(D=~D+1>>>0,ce=~ce>>>0,D==0&&(ce=ce+1>>>0)),D=4294967296*ce+(D>>>0);else throw Ce();return On(k,N,w?-D:D),!0},function(w,k,N){k=ys(k,N),k!=null&&(typeof k=="string"&&ae(k),k!=null&&(Dr(w.h,8*N),typeof k=="number"?(w=w.h,Nt(k),Zl(w,ut,wt)):(N=ae(k),Zl(w.h,N.i,N.h))))}),IB=np(function(w,k,N){return w.i!==0?!1:(On(k,N,ei(w.h)),!0)},function(w,k,N){if(k=ys(k,N),k!=null&&k!=null)if(Dr(w.h,8*N),w=w.h,N=k,0<=N)Dr(w,N);else{for(k=0;9>k;k++)w.h.push(N&127|128),N>>=7;w.h.push(1)}}),CI=np(function(w,k,N){if(w.i!==2)return!1;var D=ei(w.h)>>>0;w=w.h;var L=ti(w,D);if(w=w.i,Jt){var B=w,M;(M=vt)||(M=vt=new TextDecoder("utf-8",{fatal:!0})),w=L+D,B=L===0&&w===B.length?B:B.subarray(L,w);try{var Z=M.decode(B)}catch(mt){if(Tt===void 0){try{M.decode(new Uint8Array([128]))}catch{}try{M.decode(new Uint8Array([97])),Tt=!0}catch{Tt=!1}}throw!Tt&&(vt=void 0),mt}}else{Z=L,D=Z+D,L=[];for(var ce=null,ke,Fe;Z<D;)ke=w[Z++],128>ke?L.push(ke):224>ke?Z>=D?Oe():(Fe=w[Z++],194>ke||(Fe&192)!==128?(Z--,Oe()):L.push((ke&31)<<6|Fe&63)):240>ke?Z>=D-1?Oe():(Fe=w[Z++],(Fe&192)!==128||ke===224&&160>Fe||ke===237&&160<=Fe||((B=w[Z++])&192)!==128?(Z--,Oe()):L.push((ke&15)<<12|(Fe&63)<<6|B&63)):244>=ke?Z>=D-2?Oe():(Fe=w[Z++],(Fe&192)!==128||(ke<<28)+(Fe-144)>>30||((B=w[Z++])&192)!==128||((M=w[Z++])&192)!==128?(Z--,Oe()):(ke=(ke&7)<<18|(Fe&63)<<12|(B&63)<<6|M&63,ke-=65536,L.push((ke>>10&1023)+55296,(ke&1023)+56320))):Oe(),8192<=L.length&&(ce=at(ce,L),L.length=0);Z=at(ce,L)}return On(k,N,Z),!0},function(w,k,N){if(k=ys(k,N),k!=null){var D=!1;if(D=D===void 0?!1:D,Ts){if(D&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(k))throw Error("Found an unpaired surrogate");k=(Qs||(Qs=new TextEncoder)).encode(k)}else{for(var L=0,B=new Uint8Array(3*k.length),M=0;M<k.length;M++){var Z=k.charCodeAt(M);if(128>Z)B[L++]=Z;else{if(2048>Z)B[L++]=Z>>6|192;else{if(55296<=Z&&57343>=Z){if(56319>=Z&&M<k.length){var ce=k.charCodeAt(++M);if(56320<=ce&&57343>=ce){Z=1024*(Z-55296)+ce-56320+65536,B[L++]=Z>>18|240,B[L++]=Z>>12&63|128,B[L++]=Z>>6&63|128,B[L++]=Z&63|128;continue}else M--}if(D)throw Error("Found an unpaired surrogate");Z=65533}B[L++]=Z>>12|224,B[L++]=Z>>6&63|128}B[L++]=Z&63|128}}k=L===B.length?B:B.subarray(0,L)}Dr(w.h,8*N+2),Dr(w.h,k.length),se(w,w.h.end()),se(w,k)}}),kI=np(function(w,k,N,D,L){if(w.i!==2)return!1;k=Ft(k,N,D),N=w.h.j,D=ei(w.h)>>>0;var B=w.h.h+D,M=B-N;if(0>=M&&(w.h.j=B,L(k,w,void 0,void 0,void 0),M=B-w.h.h),M)throw Error("Message parsing ended unexpectedly. Expected to read "+(D+" bytes, instead read "+(D-M)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return w.h.h=B,w.h.j=N,!0},function(w,k,N,D,L){if(k=Ui(k,D,N),k!=null)for(D=0;D<k.length;D++){var B=w;Dr(B.h,8*N+2);var M=B.h.end();se(B,M),M.push(B.i),B=M,L(k[D],w),M=w;var Z=B.pop();for(Z=M.i+M.h.length()-Z;127<Z;)B.push(Z&127|128),Z>>>=7,M.i++;B.push(Z),M.i++}});function F1(w){return function(k,N){e:{if(Vi.length){var D=Vi.pop();D.setOptions(N),Mi(D.h,k,N),k=D}else k=new ni(k,N);try{var L=_1(w),B=bI(new L.P,k,L);break e}finally{L=k.h,L.i=null,L.m=!1,L.l=0,L.j=0,L.h=0,L.S=!1,k.l=-1,k.i=-1,100>Vi.length&&Vi.push(k)}B=void 0}return B}}function P1(w){return function(){var k=new Y;SI(this,k,Zt(w)),se(k,k.h.end());for(var N=new Uint8Array(k.i),D=k.j,L=D.length,B=0,M=0;M<L;M++){var Z=D[M];N.set(Z,B),B+=Z.length}return k.j=[N],N}}function Ic(w){er.call(this,w)}g(Ic,er);var II=[Ic,1,IB,2,ai,3,CI,4,CI];Ic.prototype.l=P1(II);function O1(w){er.call(this,w,-1,$B)}g(O1,er),O1.prototype.addClassification=function(w,k){return Ft(this,1,Ic,w,k),this};var $B=[1],NB=F1([O1,1,kI,II]);function sp(w){er.call(this,w)}g(sp,er);var $I=[sp,1,ai,2,ai,3,ai,4,ai,5,ai];sp.prototype.l=P1($I);function NI(w){er.call(this,w,-1,TB)}g(NI,er);var TB=[1],EB=F1([NI,1,kI,$I]);function kg(w){er.call(this,w)}g(kg,er);var TI=[kg,1,ai,2,ai,3,ai,4,ai,5,ai,6,kB],RB=F1(TI);kg.prototype.l=P1(TI);function EI(w,k,N){if(N=w.createShader(N===0?w.VERTEX_SHADER:w.FRAGMENT_SHADER),w.shaderSource(N,k),w.compileShader(N),!w.getShaderParameter(N,w.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+w.getShaderInfoLog(N));return N}function DB(w){return Ui(w,Ic,1).map(function(k){var N=ys(k,1);return{index:N??0,qa:xs(k,2),label:ys(k,3)!=null?nn(ys(k,3),""):void 0,displayName:ys(k,4)!=null?nn(ys(k,4),""):void 0}})}function AB(w){return{x:xs(w,1),y:xs(w,2),z:xs(w,3),visibility:ri(w,4)!=null?xs(w,4):void 0}}function L1(w){return Ui(EB(w),sp,1).map(AB)}function z1(w,k){this.i=w,this.h=k,this.m=0}function RI(w,k,N){return _B(w,k),typeof w.h.canvas.transferToImageBitmap=="function"?Promise.resolve(w.h.canvas.transferToImageBitmap()):N?Promise.resolve(w.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(w.h.canvas):(w.j===void 0&&(w.j=document.createElement("canvas")),new Promise(function(D){w.j.height=w.h.canvas.height,w.j.width=w.h.canvas.width,w.j.getContext("2d",{}).drawImage(w.h.canvas,0,0,w.h.canvas.width,w.h.canvas.height),D(w.j)}))}function _B(w,k){var N=w.h;if(w.s===void 0){var D=EI(N,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),L=EI(N,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),B=N.createProgram();if(N.attachShader(B,D),N.attachShader(B,L),N.linkProgram(B),!N.getProgramParameter(B,N.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+N.getProgramInfoLog(B));D=w.s=B,N.useProgram(D),L=N.getUniformLocation(D,"sampler0"),w.l={O:N.getAttribLocation(D,"aVertex"),N:N.getAttribLocation(D,"aTex"),ya:L},w.v=N.createBuffer(),N.bindBuffer(N.ARRAY_BUFFER,w.v),N.enableVertexAttribArray(w.l.O),N.vertexAttribPointer(w.l.O,2,N.FLOAT,!1,0,0),N.bufferData(N.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),N.STATIC_DRAW),N.bindBuffer(N.ARRAY_BUFFER,null),w.u=N.createBuffer(),N.bindBuffer(N.ARRAY_BUFFER,w.u),N.enableVertexAttribArray(w.l.N),N.vertexAttribPointer(w.l.N,2,N.FLOAT,!1,0,0),N.bufferData(N.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),N.STATIC_DRAW),N.bindBuffer(N.ARRAY_BUFFER,null),N.uniform1i(L,0)}D=w.l,N.useProgram(w.s),N.canvas.width=k.width,N.canvas.height=k.height,N.viewport(0,0,k.width,k.height),N.activeTexture(N.TEXTURE0),w.i.bindTexture2d(k.glName),N.enableVertexAttribArray(D.O),N.bindBuffer(N.ARRAY_BUFFER,w.v),N.vertexAttribPointer(D.O,2,N.FLOAT,!1,0,0),N.enableVertexAttribArray(D.N),N.bindBuffer(N.ARRAY_BUFFER,w.u),N.vertexAttribPointer(D.N,2,N.FLOAT,!1,0,0),N.bindFramebuffer(N.DRAW_FRAMEBUFFER?N.DRAW_FRAMEBUFFER:N.FRAMEBUFFER,null),N.clearColor(0,0,0,0),N.clear(N.COLOR_BUFFER_BIT),N.colorMask(!0,!0,!0,!0),N.drawArrays(N.TRIANGLE_FAN,0,4),N.disableVertexAttribArray(D.O),N.disableVertexAttribArray(D.N),N.bindBuffer(N.ARRAY_BUFFER,null),w.i.bindTexture2d(0)}function FB(w){this.h=w}var PB=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function OB(w,k){return k+w}function DI(w,k){window[w]=k}function LB(w){var k=document.createElement("script");return k.setAttribute("src",w),k.setAttribute("crossorigin","anonymous"),new Promise(function(N){k.addEventListener("load",function(){N()},!1),k.addEventListener("error",function(){N()},!1),document.body.appendChild(k)})}function zB(){return P(function(w){switch(w.h){case 1:return w.s=2,b(w,WebAssembly.instantiate(PB),4);case 4:w.h=3,w.s=0;break;case 2:return w.s=0,w.l=null,w.return(!1);case 3:return w.return(!0)}})}function M1(w){if(this.h=w,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=w&&w.locateFile||OB,typeof window=="object")var k=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")k=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=k,w.options){k=a(Object.keys(w.options));for(var N=k.next();!N.done;N=k.next()){N=N.value;var D=w.options[N].default;D!==void 0&&(this.l[N]=typeof D=="function"?D():D)}}}t=M1.prototype,t.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function MB(w){var k,N,D,L,B,M,Z,ce,ke,Fe,mt;return P(function(it){switch(it.h){case 1:return w.ga?(k=w.h.files===void 0?[]:typeof w.h.files=="function"?w.h.files(w.l):w.h.files,b(it,zB(),2)):it.return();case 2:if(N=it.i,typeof window=="object")return DI("createMediapipeSolutionsWasm",{locateFile:w.locateFile}),DI("createMediapipeSolutionsPackedAssets",{locateFile:w.locateFile}),M=k.filter(function(We){return We.data!==void 0}),Z=k.filter(function(We){return We.data===void 0}),ce=Promise.all(M.map(function(We){var gt=Ig(w,We.url);if(We.path!==void 0){var Dt=We.path;gt=gt.then(function(kn){return w.overrideFile(Dt,kn),Promise.resolve(kn)})}return gt})),ke=Promise.all(Z.map(function(We){return We.simd===void 0||We.simd&&N||!We.simd&&!N?LB(w.locateFile(We.url,w.ha)):Promise.resolve()})).then(function(){var We,gt,Dt;return P(function(kn){if(kn.h==1)return We=window.createMediapipeSolutionsWasm,gt=window.createMediapipeSolutionsPackedAssets,Dt=w,b(kn,We(gt),2);Dt.i=kn.i,kn.h=0})}),Fe=function(){return P(function(We){return w.h.graph&&w.h.graph.url?We=b(We,Ig(w,w.h.graph.url),0):(We.h=0,We=void 0),We})}(),b(it,Promise.all([ke,ce,Fe]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return D=k.filter(function(We){return We.simd===void 0||We.simd&&N||!We.simd&&!N}).map(function(We){return w.locateFile(We.url,w.ha)}),importScripts.apply(null,l(D)),L=w,b(it,createMediapipeSolutionsWasm(Module),6);case 6:L.i=it.i,w.m=new OffscreenCanvas(1,1),w.i.canvas=w.m,B=w.i.GL.createContext(w.m,{antialias:!1,alpha:!1,va:typeof WebGL2RenderingContext<"u"?2:1}),w.i.GL.makeContextCurrent(B),it.h=4;break;case 7:if(w.m=document.createElement("canvas"),mt=w.m.getContext("webgl2",{}),!mt&&(mt=w.m.getContext("webgl",{}),!mt))return alert("Failed to create WebGL canvas context when passing video frame."),it.return();w.K=mt,w.i.canvas=w.m,w.i.createContext(w.m,!0,!0,{});case 4:w.j=new w.i.SolutionWasm,w.ga=!1,it.h=0}})}function BB(w){var k,N,D,L,B,M,Z,ce;return P(function(ke){if(ke.h==1){if(w.h.graph&&w.h.graph.url&&w.fa===w.h.graph.url)return ke.return();if(w.u=!0,!w.h.graph||!w.h.graph.url){ke.h=2;return}return w.fa=w.h.graph.url,b(ke,Ig(w,w.h.graph.url),3)}for(ke.h!=2&&(k=ke.i,w.j.loadGraph(k)),N=a(Object.keys(w.D)),D=N.next();!D.done;D=N.next())L=D.value,w.j.overrideFile(L,w.D[L]);if(w.D={},w.h.listeners)for(B=a(w.h.listeners),M=B.next();!M.done;M=B.next())Z=M.value,jB(w,Z);ce=w.l,w.l={},w.setOptions(ce),ke.h=0})}t.reset=function(){var w=this;return P(function(k){w.j&&(w.j.reset(),w.s={},w.v={}),k.h=0})},t.setOptions=function(w,k){var N=this;if(k=k||this.h.options){for(var D=[],L=[],B={},M=a(Object.keys(w)),Z=M.next();!Z.done;B={X:B.X,Y:B.Y},Z=M.next())if(Z=Z.value,!(Z in this.l&&this.l[Z]===w[Z])){this.l[Z]=w[Z];var ce=k[Z];ce!==void 0&&(ce.onChange&&(B.X=ce.onChange,B.Y=w[Z],D.push(function(ke){return function(){var Fe;return P(function(mt){if(mt.h==1)return b(mt,ke.X(ke.Y),2);Fe=mt.i,Fe===!0&&(N.u=!0),mt.h=0})}}(B))),ce.graphOptionXref&&(Z=Object.assign({},{calculatorName:"",calculatorIndex:0},ce.graphOptionXref,{valueNumber:ce.type===1?w[Z]:0,valueBoolean:ce.type===0?w[Z]:!1,valueString:ce.type===2?w[Z]:""}),L.push(Z)))}(D.length!==0||L.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(L),this.F=(this.F===void 0?[]:this.F).concat(D))}};function VB(w){var k,N,D,L,B,M,Z;return P(function(ce){switch(ce.h){case 1:if(!w.u)return ce.return();if(!w.F){ce.h=2;break}k=a(w.F),N=k.next();case 3:if(N.done){ce.h=5;break}return D=N.value,b(ce,D(),4);case 4:N=k.next(),ce.h=3;break;case 5:w.F=void 0;case 2:if(w.H){for(L=new w.i.GraphOptionChangeRequestList,B=a(w.H),M=B.next();!M.done;M=B.next())Z=M.value,L.push_back(Z);w.j.changeOptions(L),L.delete(),w.H=void 0}w.u=!1,ce.h=0}})}t.initialize=function(){var w=this;return P(function(k){return k.h==1?b(k,MB(w),2):k.h!=3?b(k,BB(w),3):b(k,VB(w),0)})};function Ig(w,k){var N,D;return P(function(L){return k in w.L?L.return(w.L[k]):(N=w.locateFile(k,""),D=fetch(N).then(function(B){return B.arrayBuffer()}),w.L[k]=D,L.return(D))})}t.overrideFile=function(w,k){this.j?this.j.overrideFile(w,k):this.D[w]=k},t.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},t.send=function(w,k){var N=this,D,L,B,M,Z,ce,ke,Fe,mt;return P(function(it){switch(it.h){case 1:return N.h.inputs?(D=1e3*(k??performance.now()),b(it,N.I,2)):it.return();case 2:return b(it,N.initialize(),3);case 3:for(L=new N.i.PacketDataList,B=a(Object.keys(w)),M=B.next();!M.done;M=B.next())if(Z=M.value,ce=N.h.inputs[Z]){e:{var We=w[Z];switch(ce.type){case"video":var gt=N.s[ce.stream];if(gt||(gt=new z1(N.i,N.K),N.s[ce.stream]=gt),gt.m===0&&(gt.m=gt.i.createTexture()),typeof HTMLVideoElement<"u"&&We instanceof HTMLVideoElement)var Dt=We.videoWidth,kn=We.videoHeight;else typeof HTMLImageElement<"u"&&We instanceof HTMLImageElement?(Dt=We.naturalWidth,kn=We.naturalHeight):(Dt=We.width,kn=We.height);kn={glName:gt.m,width:Dt,height:kn},Dt=gt.h,Dt.canvas.width=kn.width,Dt.canvas.height=kn.height,Dt.activeTexture(Dt.TEXTURE0),gt.i.bindTexture2d(gt.m),Dt.texImage2D(Dt.TEXTURE_2D,0,Dt.RGBA,Dt.RGBA,Dt.UNSIGNED_BYTE,We),gt.i.bindTexture2d(0),gt=kn;break e;case"detections":for(gt=N.s[ce.stream],gt||(gt=new FB(N.i),N.s[ce.stream]=gt),gt.data||(gt.data=new gt.h.DetectionListData),gt.data.reset(We.length),kn=0;kn<We.length;++kn){Dt=We[kn];var xn=gt.data,Us=xn.setBoundingBox,No=kn,Ar=Dt.la,Yt=new kg;if(Vs(Yt,1,Ar.sa),Vs(Yt,2,Ar.ta),Vs(Yt,3,Ar.height),Vs(Yt,4,Ar.width),Vs(Yt,5,Ar.rotation),On(Yt,6,Ar.pa),Ar=Yt.l(),Us.call(xn,No,Ar),Dt.ea)for(xn=0;xn<Dt.ea.length;++xn){Yt=Dt.ea[xn],Us=gt.data,No=Us.addNormalizedLandmark,Ar=kn,Yt=Object.assign({},Yt,{visibility:Yt.visibility?Yt.visibility:0});var Ws=new sp;Vs(Ws,1,Yt.x),Vs(Ws,2,Yt.y),Vs(Ws,3,Yt.z),Yt.visibility&&Vs(Ws,4,Yt.visibility),Yt=Ws.l(),No.call(Us,Ar,Yt)}if(Dt.ba)for(xn=0;xn<Dt.ba.length;++xn)Us=gt.data,No=Us.addClassification,Ar=kn,Yt=Dt.ba[xn],Ws=new Ic,Vs(Ws,2,Yt.qa),Yt.index&&On(Ws,1,Yt.index),Yt.label&&On(Ws,3,Yt.label),Yt.displayName&&On(Ws,4,Yt.displayName),Yt=Ws.l(),No.call(Us,Ar,Yt)}gt=gt.data;break e;default:gt={}}}switch(ke=gt,Fe=ce.stream,ce.type){case"video":L.pushTexture2d(Object.assign({},ke,{stream:Fe,timestamp:D}));break;case"detections":mt=ke,mt.stream=Fe,mt.timestamp=D,L.pushDetectionList(mt);break;default:throw Error("Unknown input config type: '"+ce.type+"'")}}return N.j.send(L),b(it,N.I,4);case 4:L.delete(),it.h=0}})};function UB(w,k,N){var D,L,B,M,Z,ce,ke,Fe,mt,it,We,gt,Dt,kn;return P(function(xn){switch(xn.h){case 1:if(!N)return xn.return(k);for(D={},L=0,B=a(Object.keys(N)),M=B.next();!M.done;M=B.next())Z=M.value,ce=N[Z],typeof ce!="string"&&ce.type==="texture"&&k[ce.stream]!==void 0&&++L;1<L&&(w.M=!1),ke=a(Object.keys(N)),M=ke.next();case 2:if(M.done){xn.h=4;break}if(Fe=M.value,mt=N[Fe],typeof mt=="string")return Dt=D,kn=Fe,b(xn,WB(w,Fe,k[mt]),14);if(it=k[mt.stream],mt.type==="detection_list"){if(it){for(var Us=it.getRectList(),No=it.getLandmarksList(),Ar=it.getClassificationsList(),Yt=[],Ws=0;Ws<Us.size();++Ws){var Ya=RB(Us.get(Ws)),GB=xs(Ya,1),HB=xs(Ya,2),KB=xs(Ya,3),qB=xs(Ya,4),XB=xs(Ya,5,0),$g=void 0;$g=$g===void 0?0:$g,Ya={la:{sa:GB,ta:HB,height:KB,width:qB,rotation:XB,pa:nn(ys(Ya,6),$g)},ea:L1(No.get(Ws)),ba:DB(NB(Ar.get(Ws)))},Yt.push(Ya)}Us=Yt}else Us=[];D[Fe]=Us,xn.h=7;break}if(mt.type==="proto_list"){if(it){for(Us=Array(it.size()),No=0;No<it.size();No++)Us[No]=it.get(No);it.delete()}else Us=[];D[Fe]=Us,xn.h=7;break}if(it===void 0){xn.h=3;break}if(mt.type==="float_list"){D[Fe]=it,xn.h=7;break}if(mt.type==="proto"){D[Fe]=it,xn.h=7;break}if(mt.type!=="texture")throw Error("Unknown output config type: '"+mt.type+"'");return We=w.v[Fe],We||(We=new z1(w.i,w.K),w.v[Fe]=We),b(xn,RI(We,it,w.M),13);case 13:gt=xn.i,D[Fe]=gt;case 7:mt.transform&&D[Fe]&&(D[Fe]=mt.transform(D[Fe])),xn.h=3;break;case 14:Dt[kn]=xn.i;case 3:M=ke.next(),xn.h=2;break;case 4:return xn.return(D)}})}function WB(w,k,N){var D;return P(function(L){return typeof N=="number"||N instanceof Uint8Array||N instanceof w.i.Uint8BlobList?L.return(N):N instanceof w.i.Texture2dDataOut?(D=w.v[k],D||(D=new z1(w.i,w.K),w.v[k]=D),L.return(RI(D,N,w.M))):L.return(void 0)})}function jB(w,k){for(var N=k.name||"$",D=[].concat(l(k.wants)),L=new w.i.StringList,B=a(k.wants),M=B.next();!M.done;M=B.next())L.push_back(M.value);B=w.i.PacketListener.implement({onResults:function(Z){for(var ce={},ke=0;ke<k.wants.length;++ke)ce[D[ke]]=Z.get(ke);var Fe=w.listeners[N];Fe&&(w.I=UB(w,ce,k.outs).then(function(mt){mt=Fe(mt);for(var it=0;it<k.wants.length;++it){var We=ce[D[it]];typeof We=="object"&&We.hasOwnProperty&&We.hasOwnProperty("delete")&&We.delete()}mt&&(w.I=mt)}))}}),w.j.attachMultiListener(L,B),L.delete()}t.onResults=function(w,k){this.listeners[k||"$"]=w},H("Solution",M1),H("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"});function AI(w){switch(w===void 0&&(w=0),w){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function _I(w){var k=this;w=w||{},this.h=new M1({locateFile:w.locateFile,files:function(N){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:AI(N.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:L1},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:L1},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(N){var D,L,B;return P(function(M){return M.h==1?(D=AI(N),L="third_party/mediapipe/modules/pose_landmark/"+D,b(M,Ig(k.h,D),2)):(B=M.i,k.h.overrideFile(L,B),M.return(!0))})}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}t=_I.prototype,t.reset=function(){this.h.reset()},t.close=function(){return this.h.close(),Promise.resolve()},t.onResults=function(w){this.h.onResults(w)},t.initialize=function(){var w=this;return P(function(k){return b(k,w.h.initialize(),0)})},t.send=function(w,k){var N=this;return P(function(D){return b(D,N.h.send(w,k),0)})},t.setOptions=function(w){this.h.setOptions(w)},H("Pose",_I),H("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),H("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),H("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),H("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),H("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),H("VERSION","0.5.1675469404")}).call(xi);/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vo=re();vo.registerFlag("WEBGPU_DEFERRED_SUBMIT_BATCH_SIZE",()=>15);vo.registerFlag("WEBGPU_CPU_FORWARD",()=>!0);vo.registerFlag("WEBGPU_MATMUL_PROGRAM_TYPE",()=>-1);vo.registerFlag("WEBGPU_USE_NAIVE_CONV2D_TRANSPOSE",()=>!0);vo.registerFlag("WEBGPU_USE_LOW_POWER_GPU",()=>!1);vo.registerFlag("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e3);vo.registerFlag("WEBGPU_USE_PROFILE_TOOL",()=>!1);vo.registerFlag("WEBGPU_IMPORT_EXTERNAL_TEXTURE",()=>!0);vo.registerFlag("WEBGPU_USE_NAIVE_CONV2D_DEBUG",()=>!1);vo.registerFlag("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL",()=>-1);vo.registerFlag("WEBGPU_CONV_SEPARATE_IM2COL_SHADER",()=>!1);vo.registerFlag("WEBGPU_PRINT_SHADER",()=>"");vo.registerFlag("WEBGPU_ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jye{constructor(e){e&&(this.vendor=e.vendor,this.architecture=e.architecture,this.intelGPUGeneration=this.getIntelGPUGeneration())}getIntelGPUGeneration(){if(this.isIntel()){if(this.architecture.startsWith("gen"))return Number(this.architecture.match(/\d+/));if(this.architecture.startsWith("xe"))return 12}return 0}isIntel(){return this.vendor==="intel"}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zye{constructor(e){this.device=e,this.numUsedBuffers=0,this.numFreeBuffers=0,this.freeBuffers=new Map,this.usedBuffers=new Map,this.numBytesUsed=0,this.numBytesAllocated=0}acquireBuffer(e,n,s=!1,r=!0){let o;const i=dE(e,n);return r?(this.freeBuffers.has(i)||this.freeBuffers.set(i,[]),this.freeBuffers.get(i).length>0?(o=this.freeBuffers.get(i).pop(),this.numFreeBuffers--):(o=this.device.createBuffer({size:e,usage:n,mappedAtCreation:s}),this.numBytesAllocated+=e)):(o=this.device.createBuffer({size:e,usage:n,mappedAtCreation:s}),this.numBytesAllocated+=e),this.usedBuffers.has(i)||this.usedBuffers.set(i,[]),this.usedBuffers.get(i).push(o),this.numUsedBuffers++,this.numBytesUsed+=e,o}releaseBuffer(e,n=!0){if(this.freeBuffers.size===0)return;const s=e.size,r=e.usage,o=dE(s,r),i=this.usedBuffers.get(o),a=i.indexOf(e);if(a<0)throw new Error("Cannot find the buffer in buffer manager");i[a]=i[i.length-1],i.pop(),this.numUsedBuffers--,this.numBytesUsed-=s,n?(this.freeBuffers.get(o).push(e),this.numFreeBuffers++):(e.destroy(),this.numBytesAllocated-=s)}getNumUsedBuffers(){return this.numUsedBuffers}getNumFreeBuffers(){return this.numFreeBuffers}dispose(){this.freeBuffers.forEach((e,n)=>{e.forEach(s=>{s.destroy()})}),this.usedBuffers.forEach((e,n)=>{e.forEach(s=>{s.destroy()})}),this.freeBuffers=new Map,this.usedBuffers=new Map,this.numUsedBuffers=0,this.numFreeBuffers=0,this.numBytesUsed=0,this.numBytesAllocated=0}}function dE(t,e){return`${t}_${e}`}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class exe{constructor(e){this.device=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures=new Map,this.usedTextures=new Map,this.numBytesUsed=0,this.numBytesAllocated=0}acquireTexture(e,n,s,r){const o=pE(s),i=e*n*o,a=hE(e,n,s,r);if(this.freeTextures.has(a)||this.freeTextures.set(a,[]),this.usedTextures.has(a)||this.usedTextures.set(a,[]),this.numBytesUsed+=i,this.numUsedTextures++,this.freeTextures.get(a).length>0){this.numFreeTextures--;const u=this.freeTextures.get(a).shift();return this.usedTextures.get(a).push(u),u}this.numBytesAllocated+=i;const l=this.device.createTexture({size:[e,n],format:s,usage:r});return this.usedTextures.get(a).push(l),l}releaseTexture(e){if(this.freeTextures.size===0)return;const n=e.width,s=e.height,r=e.format,o=e.usage,i=hE(n,s,r,o);this.freeTextures.has(i)||this.freeTextures.set(i,[]),this.freeTextures.get(i).push(e),this.numFreeTextures++,this.numUsedTextures--;const a=this.usedTextures.get(i),l=a.indexOf(e);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(l,1);const u=pE(r),c=n*s*u;this.numBytesUsed-=c}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){this.freeTextures.forEach((e,n)=>{e.forEach(s=>{s.destroy()})}),this.usedTextures.forEach((e,n)=>{e.forEach(s=>{s.destroy()})}),this.freeTextures=new Map,this.usedTextures=new Map,this.numUsedTextures=0,this.numFreeTextures=0,this.numBytesUsed=0,this.numBytesAllocated=0}}function hE(t,e,n,s){return`${t}_${e}_${n}_${s}`}function pE(t){if(t==="rgba8unorm")return 16;throw new Error(`${t} is not supported!`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function txe(t,e){if(Math.max(...t)>5)throw new Error("Cannot symbolically compute strides for rank > 6 tensor.");const n=t.length,s="xyzwuv",r=t.map(i=>`${e}.${s[i]}`),o=new Array(n-1);o[n-2]=r[n-1];for(let i=n-3;i>=0;--i)o[i]=`(${o[i+1]} * ${r[i+1]})`;return o}const Ql=(t,e,n)=>n==="int32"?`atomicAdd(${t}, bitcast<i32>(${e}));`:`
          {
            var oldValue = 0;
            loop {
              let newValueF32 = bitcast<f32>(oldValue) + (${e});
              let newValue = bitcast<i32>(newValueF32);
              let res = atomicCompareExchangeWeak(${t}, oldValue, newValue);
              if res.exchanged {
                break;
              }
              oldValue = res.old_value;
            }
          }`;/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Dd;(function(t){t[t.FROM_PIXELS=0]="FROM_PIXELS",t[t.DRAW=1]="DRAW"})(Dd||(Dd={}));const nxe=(t,e,n,s,r)=>{const o={dtype:s.dtype,shape:s.shape},i=rxe(n,o,e),a=t.createShaderModule({code:i,label:e.constructor.name});let l=re().get("WEBGPU_PRINT_SHADER");if(l!==""){l=l.toLowerCase();const u=l.split(",");(l==="all"||u.some(c=>e.shaderKey.toLowerCase().includes(c)))&&(console.group(e.shaderKey),console.debug(i),console.groupEnd())}return r?t.createComputePipelineAsync({compute:{module:a,entryPoint:"_start"},label:e.constructor.name,layout:"auto"}):t.createComputePipeline({compute:{module:a,entryPoint:"_start"},label:e.constructor.name,layout:"auto"})},kt=(t,e="f32")=>{switch(t){case 1:return`${e}`;case 2:return`vec2<${e}>`;case 3:return`vec3<${e}>`;case 4:return`vec4<${e}>`;default:throw new Error(`${t}-component ${e} is not supported.`)}};function Hn(t){if(t<=1)return"i32";if(t===2)return"vec2<i32>";if(t===3)return"vec3<i32>";if(t===4)return"vec4<i32>";if(t===5)return"vec5";if(t===6)return"vec6";throw Error(`GPU for rank ${t} is not yet supported`)}function Fa(t){if(t===0)return"x";if(t===1)return"y";if(t===2)return"z";if(t===3)return"w";if(t===4)return"u";if(t===5)return"v";throw Error(`Index ${t} is not yet supported`)}function Re(...t){let e;switch(t.length){case 0:e=`
        fn main()
      `;break;case 1:e=`
        fn main(${t[0]} : i32)
      `;break;default:throw Error("Unreachable")}return e}function fE(t,e){let n;return n=`
     ${sxe(e)}
      fn _start(@builtin(local_invocation_id) LocalId : vec3<u32>,
                @builtin(global_invocation_id) GlobalId : vec3<u32>,
                @builtin(local_invocation_index) LocalIndex: u32,
                @builtin(workgroup_id) WorkgroupId : vec3<u32>,
                @builtin(num_workgroups) NumWorkgroups : vec3<u32>) {
        localId = LocalId;
        localIndex = LocalIndex;
        globalId = GlobalId;
        numWorkgroups = NumWorkgroups;
        workgroupId = WorkgroupId;
        ${t?"main(getGlobalIndex());":"main();"};
      }
    `,n}function sxe(t){return`
  @compute @workgroup_size(${t.workgroupSize[0]}, ${t.workgroupSize[1]}, ${t.workgroupSize[2]})
`}function rxe(t,e,n){const s=[],r=n.workgroupSize[0]*n.workgroupSize[1]*n.workgroupSize[2];if(n.outputComponent=n.outputComponent?n.outputComponent:1,s.push(`

      var<private> localId: vec3<u32>;
      var<private> localIndex: u32;
      var<private> globalId: vec3<u32>;
      var<private> numWorkgroups: vec3<u32>;
      var<private> workgroupId: vec3<u32>;

      // Only used when the y/z dimension of workgroup size is 1.
      fn getGlobalIndex() -> i32 {
        ${sM(n)?"  return i32(globalId.x);":`  return i32((workgroupId.z * numWorkgroups.x * numWorkgroups.y +
                workgroupId.y * numWorkgroups.x + workgroupId.x) * ${r}u +
                localIndex);
        `}
      }
    `),n.pixelsOpType!=null){const f=n.pixelsOpType===Dd.FROM_PIXELS?`@group(0) @binding(0) var<storage, read_write> result: array<${gu(e.dtype,n.outputComponent)}>;`:`@group(0) @binding(1) var<storage, read> inBuf : array<${gu(t[0].dtype,n.outputComponent)}>;`,m=e.shape.length===3?"vec2<i32>":"i32";s.push(`
        struct Uniform {
          outShapeStrides : ${m},
          size            : i32,
          numChannels     : i32,
          alpha           : f32,
        };

        ${f}
        @group(0) @binding(2) var<uniform> uniforms: Uniform;
      `);const g=gE(n);return[mE,s.join(`
`),$y(e.shape),n.getUserCode(),fE(g,n)].join(`
`)}let o,i,a="struct Uniforms { NAN : f32, INFINITY : f32, ";n.variableNames.forEach((f,m)=>{const g=Hn(t[m].shape.length);a+=`${f.charAt(0).toLowerCase()+f.slice(1)}Shape : ${g}, `,o=t[m].shape.length-1,i=Hn(o),a+=`${f.charAt(0).toLowerCase()+f.slice(1)}ShapeStrides: ${i}, `});const l=Hn(e.shape.length);a+=`outShape : ${l}, `,o=e.shape.length-1,i=Hn(o),a+=`
         outShapeStrides: ${i}, `,n.size&&(a+="size : i32, "),n.uniforms&&(a+=n.uniforms),a+="};",a=pxe(a),s.push(a),n.atomic?s.push(`
      @group(0) @binding(0) var<storage, read_write> result: array<atomic<i32>>;
    `):s.push(`
      @group(0) @binding(0) var<storage, read_write> result: array<${gu(e.dtype,n.outputComponent)}>;
    `),n.variableNames.forEach((f,m)=>{s.push(`
      @group(0) @binding(${1+m}) var<storage, read> ${f}: array<${n.variableComponents?gu(t[m].dtype,n.variableComponents[m]):gu(t[m].dtype,n.outputComponent)}>;
        `)}),a!==""&&s.push(`
      @group(0) @binding(${1+n.variableNames.length}) var<uniform> uniforms: Uniforms;
      `);const u=cxe(e.shape,n.dispatchLayout),c=[mE,s.join(`
`)+ixe,$y(e.shape),u,dxe(e.shape.length)];n.atomic||c.push(hxe(e.shape,e.dtype,n.outputComponent)),n.variableNames.forEach((f,m)=>{c.push(`${$y(t[m].shape,f)}`)});const d=t.map((f,m)=>uxe(f,e.shape,n.variableComponents?n.variableComponents[m]:n.outputComponent,n.dispatchLayout.x.length===e.shape.length)).join(`
`);c.push(d),c.push(n.getUserCode());const h=gE(n);return c.push(fE(h,n)),c.join(`
`)}function oxe(t,e,n){let s=t.shaderKey;if(t.pixelsOpType!=null)return s;const r=[],o=[];e.forEach(c=>{r.push(c.shape),o.push(c.dtype)}),r.push(n.shape),o.push(n.dtype);const i=e.map(c=>El(c.shape,n.shape)),a=e.map(c=>Ct(c.shape,n.shape)).join("_"),l=i.map(c=>c.join("_")).join(";"),u=sM(t)?"flatDispatch":"";return s+="_"+(t.workgroupSize?t.workgroupSize.join(","):"")+r.map(c=>c.length).join(",")+o.join(",")+t.variableNames.join(",")+l+a+u,s}const mE=`
  struct vec5 {x: i32, y: i32, z: i32, w: i32, u: i32};
  struct vec6 {x: i32, y: i32, z: i32, w: i32, u: i32, v: i32};

  // Checks whether coordinates lie within the bounds of the shape.
  fn coordsInBounds2D(coord : vec2<i32>, shape : vec2<i32>) -> bool {
    return all(coord >= vec2<i32>(0)) && all(coord < shape);
  }
  fn coordsInBounds3D(coord : vec3<i32>, shape : vec3<i32>) -> bool {
    return all(coord >= vec3<i32>(0)) && all(coord < shape);
  }
  fn coordsInBounds4D(coord : vec4<i32>, shape : vec4<i32>) -> bool {
    return all(coord >= vec4<i32>(0)) && all(coord < shape);
  }

  fn getIndexFromCoords1D(coord : i32, shape : i32) -> i32 {
    return coord;
  }
  fn getIndexFromCoords2D(coords : vec2<i32>, shape : vec2<i32>) -> i32 {
    return dot(coords, vec2<i32>(shape.y, 1));
  }
  fn getIndexFromCoords3D(coords : vec3<i32>, shape : vec3<i32>) -> i32 {
    return dot(coords, vec3<i32>(shape.y * shape.z, shape.z, 1));
  }
  fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
    return dot(coords, vec4<i32>(
        shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
  }
  fn getIndexFromCoords5D(coords : vec5, shape : vec5) -> i32 {
    let shapeStrides: vec5 = vec5(shape.y * shape.z * shape.w * shape.u, shape.z * shape.w * shape.u, shape.w * shape.u, shape.u, 1);
    return coords.x*shapeStrides.x + coords.y*shapeStrides.y + coords.z*shapeStrides.z + coords.w*shapeStrides.w + coords.u*shapeStrides.u;
  }
  fn getIndexFromCoords6D(coords : vec6, shape : vec6) -> i32 {
    let shapeStrides: vec6 = vec6(shape.y * shape.z * shape.w * shape.u * shape.v, shape.z * shape.w * shape.u * shape.v, shape.w * shape.u * shape.v, shape.u * shape.v, shape.v, 1);
    return coords.x*shapeStrides.x + coords.y*shapeStrides.y + coords.z*shapeStrides.z + coords.w*shapeStrides.w + coords.u*shapeStrides.u + coords.v*shapeStrides.v;
  }

  // NaN defination in IEEE 754-1985 is :
  //   - sign = either 0 or 1.
  //   - biased exponent = all 1 bits.
  //   - fraction = anything except all 0 bits (since all 0 bits represents infinity).
  // https://en.wikipedia.org/wiki/IEEE_754-1985#Representation_of_non-numbers
  fn isnan(val: f32) -> bool {
    let floatToUint: u32 = bitcast<u32>(val);
    return (floatToUint & 0x7fffffffu) > 0x7f800000u;
  }
  fn isnanVec4(val : vec4<f32>) -> vec4<bool> {
    let floatToUint: vec4<u32> = bitcast<vec4<u32>>(val);
    return (floatToUint & vec4<u32>(0x7fffffffu)) > vec4<u32>(0x7f800000u);
  }
`,ixe=`
  fn isinf(val: f32) -> bool {
    return abs(val) == uniforms.INFINITY;
  }
`;function $y(t,e=""){const n=t.length,s=e!==""?`get${e.charAt(0).toUpperCase()+e.slice(1)}CoordsFromIndex`:"getCoordsFromIndex",r=e!==""?`${e.charAt(0).toLowerCase()+e.slice(1)}ShapeStrides`:"outShapeStrides";if(n<=1)return`fn ${s}(index : i32) -> i32 { return index; }`;const o=st(t),i=Hn(n),a=[];for(let u=0;u<n;u++)a.push(`d${u}`);if(o.length===1)return`    fn ${s}(index : i32) -> vec2<i32> {
      let d0 = index / uniforms.${r}; let d1 = index - d0 * uniforms.${r};
      return vec2<i32>(d0, d1);
    }`;let l;return l="var index2 = index;"+o.map((u,c)=>{const d=`let ${a[c]} = index2 / uniforms.${r}.${Fa(c)}`,h=c===o.length-1?`let ${a[c+1]} = index2 - ${a[c]} * uniforms.${r}.${Fa(c)}`:`index2 = index2 - ${a[c]} * uniforms.${r}.${Fa(c)}`;return`${d}; ${h};`}).join(""),`
    fn ${s}(index : i32) -> ${i} {
      ${l}
      return ${i}(${a.join(",")});
    }
  `}function axe(t,e){const n=t.name,s=t.shape.length,r=Hn(s),o="get"+n.charAt(0).toUpperCase()+n.slice(1),i=["d0","d1","d2","d3","d4","d5"].slice(0,s),a=i.map(c=>`${c} : i32`).join(", ");if(s<1)return`
      fn ${o}() -> ${kt(e)} {
        return ${kt(e)}(${n}[0]);
      }
    `;const l=`uniforms.${n.charAt(0).toLowerCase()+n.slice(1)}Shape`;let u=`${s}D`;return s===0&&(u="1D"),`
    fn ${o}(${a}) -> ${kt(e)} {
      return ${kt(e)}(${n}[getIndexFromCoords${u}(${r}(${i.join(",")}),
        ${l})${e===1?"":` / ${e}`}]);
    }
   `}function lxe(t,e,n,s){const r=t.name,o=r.charAt(0).toUpperCase()+r.slice(1),i="get"+o+"ByOutput",a=t.shape.length,l=e.length,u=Hn(l);if(Ct(t.shape,e)&&s)return`
    fn ${i}Index(globalIndex : i32) -> ${kt(n)} {
      return ${kt(n)}(${r}[globalIndex]);
    }

    fn ${i}Coords(coords : ${u}) -> ${kt(n)} {
      return ${kt(n)}(${r}[${l>1?"getOutputIndexFromCoords(coords)":"coords"}${n===1?"":` / ${n}`}]);
    }
    `;const c=El(t.shape,e),d=l-a;let h="";if(a===0)return`
    fn ${i}Index(globalIndex : i32) -> ${kt(n)}{
      return get${o}();
    }

    fn ${i}Coords(coords : ${u}) -> ${kt(n)}{
      return get${o}();
    }
  `;l<2&&c.length>=1?h="coords = 0;":h=c.map(g=>`coords.${Fa(g+d)} = 0;`).join(`
`);let p="";if(l<2&&a>0)p="coords";else if(l>1){const g=Hn(a),y=t.shape.map((x,v)=>`coords.${Fa(v+d)}`).join(", ");p=`${g}(${y})`}else p="coords";const f=`uniforms.${r.charAt(0).toLowerCase()+r.slice(1)}Shape`,m=`${a}D`;return`
  fn ${i}Index(globalIndex : i32) -> ${kt(n)} {
    var coords = getCoordsFromIndex(globalIndex);
    ${h}
    return ${kt(n)}(${r}[getIndexFromCoords${m}(${p}, ${f})${n===1?"":` / ${n}`}]);
  }

  fn ${i}Coords(coordsIn : ${u}) -> ${kt(n)} {
    var coords = coordsIn;
    ${h}
    return ${kt(n)}(${r}[getIndexFromCoords${m}(${p}, ${f})${n===1?"":` / ${n}`}]);
  }
`}function uxe(t,e,n,s){let r=axe(t,n);return t.shape.length<=e.length&&(r+=lxe(t,e,n,s)),r}function cxe(t,e){const{x:n,y:s=[],z:r=[]}=e,o=t.length,i=n.length+s.length+r.length;if(i!==o)return"";if(n.length===o)return`fn getOutputCoords() -> ${Hn(o)}{
    let globalIndex = getGlobalIndex();
    return getCoordsFromIndex(globalIndex);
  }
  `;let a="";const l=[n,s,r];for(let h=0;h<l.length;h++){const p=l[h];if(p.length!==0)if(p.length===1)a+=`let d${p[0]} = i32(globalId[${h}]);`;else{const f=txe(p,"uniforms.outShape");a+=`var index${h} = i32(globalId[${h}]);`;for(let m=0;m<f.length;m++)a+=`let d${p[m]} = index${h} / ${f[m]};`,m===f.length-1?a+=`let d${p[m+1]} = index${h} - d${p[m]} * ${f[m]};`:a+=`index${h} = index${h} - d${p[m]} * ${f[m]};`}}const u=[];for(let h=0;h<i;h++)u.push(`d${h}`);const c=Hn(i);let d=`fn getOutputCoords() -> ${c} {
  ${a}
`;return u.length===0?d+=`return ${c}(0); }`:d+=`return ${c}(${u.join(",")}); }`,d}function dxe(t){let e="";switch(t){case 0:case 1:e+=`
        fn getOutputIndexFromCoords(coords : i32) -> i32 {
          return coords;
        }
        `;break;case 2:e+=`
        fn getOutputIndexFromCoords(coords : vec2<i32>) -> i32 {
          return dot(coords, vec2<i32>(uniforms.outShapeStrides, 1));
        }
        `;break;case 3:e+=`
        fn getOutputIndexFromCoords(coords : vec3<i32>) -> i32 {
          return dot(coords, vec3<i32>(uniforms.outShapeStrides.x, uniforms.outShapeStrides.y, 1));
        }
        `;break;case 4:e+=`
        fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
          return dot(coords, vec4<i32>(
            uniforms.outShapeStrides.x, uniforms.outShapeStrides.y, uniforms.outShapeStrides.z, 1));
        }
        `;break;case 5:e+=`
        fn getOutputIndexFromCoords(coords : vec5) -> i32 {
          return coords.x * uniforms.outShapeStrides.x +
              coords.y * uniforms.outShapeStrides.y +
              coords.z * uniforms.outShapeStrides.z +
              coords.w * uniforms.outShapeStrides.w +
              coords.u;
        }
        `;break;case 6:e+=`
        fn getOutputIndexFromCoords(coords : vec6) -> i32 {
          return coords.x * uniforms.outShapeStrides.x +
              coords.y * uniforms.outShapeStrides.y +
              coords.z * uniforms.outShapeStrides.z +
              coords.w * uniforms.outShapeStrides.w +
              coords.u * uniforms.outShapeStrides.u +
              coords.v;
        }
        `;break;default:A(!1,()=>`Unsupported ${t}D shape`);break}return e}function sM(t){return t.dispatch[1]===1&&t.dispatch[2]===1}function gu(t,e=1){if(t==="float32")return kt(e,"f32");if(t==="int32"||t==="bool")return kt(e,"i32");throw new Error(`type ${t} is not supported.`)}function hxe(t,e,n){const s=t.length,r=gu(e,n);let o=`fn setOutputAtIndex(flatIndex : i32, value : ${kt(n)}) {
      result[flatIndex] = ${r}(value);
    }

    fn setOutputAtIndexI32(flatIndex : i32, value : ${kt(n,"i32")}) {
      result[flatIndex] = ${r}(value);
    }
    `;if(s>=2){const i=["d0","d1","d2","d3","d4","d5"].slice(0,s),a=Hn(s);o+=`
      fn setOutputAtCoords(${i.map(l=>`${l} : i32`).join(", ")}, value : ${kt(n)}) {
        let flatIndex = getOutputIndexFromCoords(${a}(${i.join(", ")}));
        setOutputAtIndex(flatIndex${n===1?"":` / ${n}`}, value);
      }
      fn setOutputAtCoordsI32(${i.map(l=>`${l} : i32`).join(", ")}, value : ${kt(n,"i32")}) {
        let flatIndex = getOutputIndexFromCoords(${a}(${i.join(", ")}));
        setOutputAtIndexI32(flatIndex${n===1?"":` / ${n}`}, value);
      }
    `}return o}function pxe(t){const e=/(\w+)\s*:\s*vec(5|6)/g;t=t.replace(e,s=>"@align(16) "+s);const n=/vec(5|6)\s*,\s*(\w+)/g;return t=t.replace(n,(s,r,o)=>`vec${r}, @align(16) ${o}`),t}function gE(t){return!(t.dispatchLayout.hasOwnProperty("y")&&t.dispatchLayout.y.length!==0||t.dispatchLayout.hasOwnProperty("z")&&t.dispatchLayout.z.length!==0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Au=t=>{let e=1;for(let n=0;n<t.length;n++)e*=t[n];return e};function De(t,e,n=[1,1,1],s=[1,1,1]){const[r,o,i]=[Math.ceil(Au(t.x.map(a=>e[a]))/(n[0]*s[0])),t.y?Math.ceil(Au(t.y.map(a=>e[a]))/(n[1]*s[1])):1,t.z?Math.ceil(Au(t.z.map(a=>e[a]))/(n[2]*s[2])):1];return[r,o,i]}function fxe(t,e,n,s=!1){const r=[8,8,1],o=[4,4,1];return s||(t<=8&&(o[1]=1),e<=16&&n<=16&&(r[0]=4)),{workgroupSize:r,elementsPerThread:o}}function rM(t,e,n=!1){if(n)return[8,8,1];const s=Au(t.x.map(o=>e[o])),r=Au(t.y.map(o=>e[o]));return s<=4?[4,16,1]:r<=4?[16,4,1]:[16,16,1]}function oM(t,e,n=!1){if(n)return[4,4,1];const s=Au(t.x.map(o=>e[o])),r=Au(t.y.map(o=>e[o]));return s<=4?[1,2,1]:r<=4?[2,1,1]:[2,2,1]}function Ve(t){return{x:t.map((e,n)=>n)}}function yE(t){if(t==="float32"||t==="int32"||t==="bool"||t==="string")return 4;if(t==="complex64")return 8;throw new Error(`Unknown dtype ${t}`)}function iM(){return!!(typeof globalThis<"u"&&globalThis.navigator&&globalThis.navigator.gpu)}function aM(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&A(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGPU backend.`)})}var Hi;(function(t){t[t.MatMulReduceProgram=0]="MatMulReduceProgram",t[t.MatMulSplitKProgram=1]="MatMulSplitKProgram",t[t.MatMulSmallOutputSizeProgram=2]="MatMulSmallOutputSizeProgram",t[t.MatMulPackedProgram=3]="MatMulPackedProgram",t[t.MatMulMax=4]="MatMulMax"})(Hi||(Hi={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mxe=re().getNumber("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD"),gxe=(t,e)=>{const n=t.limits.maxComputeWorkgroupsPerDimension,s=e.dispatchLayout,r=e.dispatch;if(r.every(i=>i<=n))return r;A(r[0]>n&&s.y===void 0&&s.z===void 0,()=>"Dispatch size exceeds WebGPU limits in Y or Z dimension.");let o=Math.ceil(Math.sqrt(r[0]));return o>n?(o=Math.ceil(Math.cbrt(r[0])),A(o<=n,()=>"Total dispatch size exceeds WebGPU maximum."),[o,o,o]):[o,o,1]};class Yh extends p0{nextDataId(){return Yh.nextDataId++}constructor(e,n){if(super(),this.commandQueueOwnedIds=new WeakSet,this.dispatchCountInPass=0,this.disposed=!1,this.downloadWaitMs=0,this.tensorDataPendingDisposal=[],this.queryResolveBuffer=null,this.querySet=null,this.querySetCount=2,this.stagingPendingDisposal=[],this.uniformPendingDisposal=[],this.uploadWaitMs=0,this.hasReadSyncWarned=!1,this.hasTimestampQueryWarned=!1,!iM())throw new Error("WebGPU is not supported on this device");this.pipelineCache={},this.device=e,this.queue=e.queue,this.commandEncoder=null,this.computePassEncoder=null,this.adapterInfo=new Jye(n),this.supportTimestampQuery=this.device.features.has("timestamp-query"),this.thresholdToIncreaseWorkgroups=this.adapterInfo.intelGPUGeneration>=12?16:8,this.bufferManager=new Zye(this.device),this.textureManager=new exe(this.device),this.tensorMap=new a2(this,rr()),re().getBool("WEBGPU_USE_PROFILE_TOOL")&&(this.dummyCanvas=document.createElement("canvas"),this.dummyCanvas.width=1,this.dummyCanvas.height=1,this.dummyContext=this.dummyCanvas.getContext("webgpu"),this.dummyContext.configure({device:e,format:"bgra8unorm"}),document.body.appendChild(this.dummyCanvas))}floatPrecision(){return 32}disposeData(e,n=!1){if(!this.tensorMap.has(e))return!0;const s=this.tensorMap.get(e);return n?s.refCount=0:s.refCount--,s.refCount>0?!1:(s.complexTensorInfos!=null&&(this.disposeData(s.complexTensorInfos.real.dataId),this.disposeData(s.complexTensorInfos.imag.dataId)),this.commandQueueOwnedIds.has(e)?(this.tensorDataPendingDisposal.push(e),!0):(this.releaseResource(e),this.tensorMap.delete(e),!0))}memory(){return{numBytesInGPU:this.bufferManager.numBytesUsed,numBytesAllocatedInGPU:this.bufferManager.numBytesAllocated,unreliable:!1}}releaseResource(e){const n=this.tensorMap.get(e);if(!(!n||!n.resource)){if(n.external){n.resource=null;return}n.resource instanceof GPUBuffer?this.bufferManager.releaseBuffer(n.resource):n.resource instanceof GPUTexture&&this.textureManager.releaseTexture(n.resource),n.resource=null}}refCount(e){return this.tensorMap.has(e)?this.tensorMap.get(e).refCount:0}incRef(e){const n=this.tensorMap.get(e);n.refCount++}decRef(e){if(this.tensorMap.has(e)){const n=this.tensorMap.get(e);n.refCount--}}write(e,n,s){if(s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.tensorMap.set(r,{dtype:s,shape:n,values:e,refCount:1}),r}move(e,n,s,r,o){if(r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.tensorMap.set(e,{dtype:r,shape:s,values:n,refCount:o})}submitQueue(){this.queue.submit([this.commandEncoder.finish()]),this.commandEncoder=null,this.dispatchCountInPass=0,this.commandQueueOwnedIds=new WeakSet,this.tensorDataPendingDisposal.forEach(e=>{this.releaseResource(e),this.tensorMap.delete(e)}),this.uniformPendingDisposal.forEach(e=>this.bufferManager.releaseBuffer(e)),this.stagingPendingDisposal.forEach(e=>this.bufferManager.releaseBuffer(e,!1)),this.tensorDataPendingDisposal=[],this.uniformPendingDisposal=[],this.stagingPendingDisposal=[]}ensureCommandEncoderReady(){this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder())}endComputePassEncoder(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}async checkCompileCompletionAsync(){let e;try{e=await Promise.all(Object.values(this.pipelineCache))}catch(n){throw new Error(n.message)}Object.keys(this.pipelineCache).map((n,s)=>{this.pipelineCache[n]=e[s]})}async getBufferData(e){if(re().getBool("WEBGPU_ENGINE_COMPILE_ONLY"))return console.warn("The data may be invalid since WEBGPU_ENGINE_COMPILE_ONLY is true, this can only be called when WEBGPU_ENGINE_COMPILE_ONLY is false"),null;const n=e.size,s=this.bufferManager.acquireBuffer(n,GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ);this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(e,0,s,0,n),this.submitQueue(),await s.mapAsync(GPUMapMode.READ);const r=s.getMappedRange().slice(0);return s.unmap(),s!=null&&this.bufferManager.releaseBuffer(s),re().getBool("WEBGPU_USE_PROFILE_TOOL")&&(A(this.dummyContext!==void 0,()=>"Fail to get context for profiling tool"),this.dummyContext.getCurrentTexture()),r}convertAndCacheOnCPU(e,n){const s=this.tensorMap.get(e);return s.values=n,s.values}readSync(e){const n=this.tensorMap.get(e),{values:s,complexTensorInfos:r}=n;if(s!=null||n.dtype==="string")return s;if(n.dtype==="complex64"){const m=this.readSync(r.real.dataId),g=this.readSync(r.imag.dataId),y=by(Ni(m,g).buffer,"float32");return this.convertAndCacheOnCPU(e,y),y}this.hasReadSyncWarned||(this.hasReadSyncWarned=!0,console.warn("The performance of synchronously reading data from GPU to CPU is poor on the webgpu backend, please use asynchronous APIs instead."));const o=["opaque","premultiplied"],i=n.resource,a=i.size;A(a%4===0,()=>"Because there is 4 bytes for one pixel, buffer size must be multiple of 4.");const l=a/4,u=new ArrayBuffer(a),c=256,d=256,h=o.map(m=>new OffscreenCanvas(c,d)),p=new OffscreenCanvas(c,d);this.endComputePassEncoder(),h.map((m,g)=>{const y=m.getContext("webgpu");return y.configure({device:this.device,format:"bgra8unorm",usage:GPUTextureUsage.COPY_DST,alphaMode:o[g]}),y.getCurrentTexture()}).map((m,g)=>{const y=c*4,x=(T,R,_)=>{this.ensureCommandEncoderReady(),this.commandEncoder.copyBufferToTexture({buffer:i,bytesPerRow:y,offset:_},{texture:m},{width:T,height:R}),this.submitQueue();const P=p.getContext("2d",{willReadFrequently:!0});P.clearRect(0,0,T,R),P.drawImage(h[g],0,0);const z=P.getImageData(0,0,T,R).data,O=o[g],V=new Uint8ClampedArray(u,_,T*R*4);for(let H=0;H<V.length;H+=4)if(O==="premultiplied")V[H+3]=z[H+3];else{const Q=z[H];V[H]=z[H+2],V[H+1]=z[H+1],V[H+2]=Q}},v=Math.floor(l/(c*d));let b=c,S=d,C=0;for(let T=0;T<v;T++)x(b,S,C),C+=c*d*4;const I=l%(c*d);S=Math.floor(I/c),S>0&&(x(b,S,C),C+=S*(c*4)),b=I%c,b>0&&x(b,1,C)});const f=by(u,n.dtype);return this.convertAndCacheOnCPU(e,f),f}async read(e){if(!this.tensorMap.has(e))throw new Error(`Tensor ${e} was not registered!`);const n=this.tensorMap.get(e),{values:s}=n;if(s!=null)return s;let r;if(n.dtype==="complex64"){const o=await Promise.all([this.read(n.complexTensorInfos.real.dataId),this.read(n.complexTensorInfos.imag.dataId)]),i=o[0],a=o[1];r=Ni(i,a)}else{const o=await this.getBufferData(n.resource);r=by(o,n.dtype)}return this.convertAndCacheOnCPU(e,r),r}copyBuffer(e){const n=e.size,s=e.usage,r=this.bufferManager.acquireBuffer(n,s);return this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(e,0,r,0,n),this.submitQueue(),r}createTensorFromGPUData(e,n,s){let r=e.buffer;if(s==="complex64")throw new Error("Cannot write to a complex64 dtype. ");const o={id:this.nextDataId()};this.tensorMap.set(o,{dtype:s,shape:n,values:null,refCount:1,external:e.zeroCopy});const i=this.tensorMap.get(o),a=yE(i.dtype)*te(i.shape);if(e.buffer.size<a)throw new Error(`GPUBuffer size(${e.buffer.size}) is smaller than tensor size(${a})!`);if((e.buffer.usage&(GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC))!==(GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC))throw new Error("GPUBuffer.usage should include GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC!");return e.zeroCopy!==!0&&(r=this.copyBuffer(r)),i.resource=r,rr().makeTensorFromDataId(o,n,s,this)}readToGPU(e){const n=this.tensorMap.get(e),{values:s,dtype:r,shape:o,resource:i}=n;if(r==="complex64")throw new Error("Does not support reading buffer for complex64 dtype.");if(i==null)throw s!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const a=i,l=a.size,u=a.usage,c=this.bufferManager.acquireBuffer(l,u);this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(i,0,c,0,l),this.submitQueue();const d=this.makeTensorInfo(o,r),h=rr().makeTensorFromTensorInfo(d),p=this.tensorMap.get(d.dataId);return p.resource=c,{tensorRef:h,buffer:c}}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>ki(r));return yt(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return yt(e.shape,e.dtype,n)}async time(e){!this.supportTimestampQuery&&!this.hasTimestampQueryWarned&&(console.warn("This device doesn't support timestamp-query extension. Start Chrome browser with flag --enable-dawn-features=allow_unsafe_apis to try it again. Otherwise, zero will be shown for the kernel time when profiling mode is enabled."),this.hasTimestampQueryWarned=!0);const n=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const o=Ma(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),i=Ma(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},l=await Promise.all(o);return a.kernelMs=JA(l),a.getExtraProfileInfo=()=>l.map((u,c)=>({name:i[c],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", "),this.uploadWaitMs=0,this.downloadWaitMs=0,a}makeTensorInfo(e,n,s){return n==="string"&&s!=null&&s.length>0&&Md(s[0])&&(s=s.map(o=>Da(o))),{dataId:this.write(s,e,n),shape:e,dtype:n}}tensorToBinding(e){if(!e)return null;const s=this.tensorMap.get(e.dataId).resource;return s instanceof GPUBuffer?{buffer:s}:s instanceof GPUTexture?s.createView():s}uploadToGPU(e){const n=this.tensorMap.get(e);if(n.resource!=null)return;const s=yE(n.dtype)*te(n.shape);let r;const o=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;if(n.values){if(r=this.bufferManager.acquireBuffer(s,o,!0),r.mapState==="unmapped"){const i=this.bufferManager.acquireBuffer(s,GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC,!0,!1),a=i.getMappedRange();n.dtype==="int32"||n.dtype==="bool"?new Int32Array(a).set(n.values):new Float32Array(a).set(n.values),i.unmap(),this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(i,0,r,0,s),this.stagingPendingDisposal.push(i)}else{const i=r.getMappedRange();n.dtype==="int32"||n.dtype==="bool"?new Int32Array(i).set(n.values):new Float32Array(i).set(n.values),r.unmap()}n.values=null}else r=this.bufferManager.acquireBuffer(s,o);n.resource=r}makeUniforms(e){let n=0,s=0;const r=[];let o=1;e.forEach(l=>{l.data.length===0&&(l.data=[1]);let u;switch(l.data.length){case 1:u=4;break;case 2:u=8;break;case 3:u=16;break;case 4:u=16;break;case 5:u=16;break;case 6:u=16;break;default:A(!1,()=>`Unsupported ${l.data.length}D shape`)}(s===5||s===6)&&(u=16),u>o&&(o=u),n=Math.ceil(n/u)*u,s=l.data.length,r.push(n),n+=l.data.length*4}),n=Math.ceil(n/o)*o;const i=new ArrayBuffer(n);e.forEach((l,u)=>{const c=r[u];l.type==="int32"?new Int32Array(i,c,l.data.length).set(l.data):l.type==="uint32"?new Uint32Array(i,c,l.data.length).set(l.data):new Float32Array(i,c,l.data.length).set(l.data)});const a=this.bufferManager.acquireBuffer(n,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);return this.queue.writeBuffer(a,0,i,0,n),this.uniformPendingDisposal.push(a),{offset:0,size:n,buffer:a}}runWebGPUProgram(e,n,s,r,o){if(o||(o=this.makeTensorInfo(e.outputShape,s)),te(o.shape)===0)return this.tensorMap.get(o.dataId).values=ps(o.dtype,0),o;this.uploadToGPU(o.dataId),e.dispatch=gxe(this.device,e);const i=n.map((l,u)=>{if(l.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");return this.uploadToGPU(l.dataId),{dtype:this.tensorMap.get(l.dataId).dtype,shape:l.shape,name:e.variableNames[u]}});e.shaderKey=oxe(e,i,o);const a=re().getBool("WEBGPU_ENGINE_COMPILE_ONLY");return e.shaderKey in this.pipelineCache||(this.pipelineCache[e.shaderKey]=nxe(this.device,e,i,o,a)),e.pipeline=this.pipelineCache[e.shaderKey],a||this.recordAndSubmit(e,o,n,r),o}recordAndSubmit(e,n,s,r){if(e.pipeline instanceof Promise)throw new Error("Please call checkCompileCompletionAsync to ensure parallel compilation is done!");let o=[],i=[];const a="int32";if(e.pixelsOpType==null){o.push({type:"float32",data:[NaN]},{type:"float32",data:[1/0]}),i=s.concat(n).map(p=>p.shape);const h="int32";i.map(p=>{o.push({type:h,data:p});const f=st(p);o.push({type:h,data:f})})}else{const h=st(n.shape);o.push({type:a,data:h})}if(e.size){const h=te(e.outputShape);o.push({type:a,data:[e.outputComponent?h/e.outputComponent:h]})}r&&(o=[...o,...r]);const l=[this.tensorToBinding(n),...s.map(h=>this.tensorToBinding(h)),this.makeUniforms(o)];s.forEach(h=>{this.commandQueueOwnedIds.add(h.dataId)}),this.commandQueueOwnedIds.add(n.dataId);const u=this.device.createBindGroup({layout:e.pipeline.getBindGroupLayout(0),entries:l.map((h,p)=>({binding:p,resource:h}))}),c=this.activeTimers!=null;this.ensureCommandEncoderReady();const d={};c&&this.supportTimestampQuery?(this.endComputePassEncoder(),this.querySet==null&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.querySetCount})),d.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1},this.computePassEncoder=this.commandEncoder.beginComputePass(d)):this.computePassEncoder||(this.computePassEncoder=this.commandEncoder.beginComputePass(d)),this.computePassEncoder.setPipeline(e.pipeline),this.computePassEncoder.setBindGroup(0,u),this.computePassEncoder.dispatchWorkgroups(e.dispatch[0],e.dispatch[1],e.dispatch[2]),this.dispatchCountInPass++,(c||re().get("WEBGPU_DEFERRED_SUBMIT_BATCH_SIZE")<=this.dispatchCountInPass||e.pixelsOpType===Dd.DRAW)&&(this.endComputePassEncoder(),c?this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime()}):this.submitQueue())}async getQueryTime(){if(!this.supportTimestampQuery)return 0;this.queryResolveBuffer==null&&(this.queryResolveBuffer=this.bufferManager.acquireBuffer(this.querySetCount*8,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.QUERY_RESOLVE)),this.commandEncoder.resolveQuerySet(this.querySet,0,this.querySetCount,this.queryResolveBuffer,0);const e=this.bufferManager.acquireBuffer(this.querySetCount*8,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,this.querySetCount*8),this.submitQueue(),await e.mapAsync(GPUMapMode.READ);const n=new BigUint64Array(e.getMappedRange()),s=Number(n[1]-n[0])/1e6;return e.unmap(),this.bufferManager.releaseBuffer(e),s}shouldExecuteOnCPU(e,n=mxe){return re().getBool("WEBGPU_CPU_FORWARD")&&e.every(s=>this.tensorMap.get(s.dataId).resource==null&&te(s.shape)<n)}numDataIds(){return this.tensorMap.numDataIds()-this.tensorDataPendingDisposal.length}dispose(){this.disposed||(this.querySet!=null&&this.querySet.destroy(),this.bufferManager.dispose(),this.textureManager.dispose(),this.disposed=!0)}}Yh.nextDataId=0;/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */iM()&&I2("webgpu",async()=>{const t={powerPreference:re().get("WEBGPU_USE_LOW_POWER_GPU")?"low-power":"high-performance"},e=await navigator.gpu.requestAdapter(t),n={},s=[];e.features.has("timestamp-query")&&s.push("timestamp-query"),e.features.has("bgra8unorm-storage")&&s.push(["bgra8unorm-storage"]),n.requiredFeatures=s;const r=e.limits;n.requiredLimits={maxComputeWorkgroupStorageSize:r.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:r.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:r.maxStorageBufferBindingSize,maxBufferSize:r.maxBufferSize,maxComputeWorkgroupSizeX:r.maxComputeWorkgroupSizeX,maxComputeInvocationsPerWorkgroup:r.maxComputeInvocationsPerWorkgroup};const o=await e.requestDevice(n),i="info"in e?e.info:"requestAdapterInfo"in e?await e.requestAdapterInfo():void 0;return new Yh(o,i)},3);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ht;(function(t){t[t.ADD=0]="ADD",t[t.ATAN2=1]="ATAN2",t[t.COMPLEX_MULTIPLY_IMAG=2]="COMPLEX_MULTIPLY_IMAG",t[t.COMPLEX_MULTIPLY_REAL=3]="COMPLEX_MULTIPLY_REAL",t[t.DIV=4]="DIV",t[t.ELU_DER=5]="ELU_DER",t[t.EQUAL=6]="EQUAL",t[t.FLOOR_DIV=7]="FLOOR_DIV",t[t.GREATER=8]="GREATER",t[t.GREATER_EQUAL=9]="GREATER_EQUAL",t[t.LESS=10]="LESS",t[t.LESS_EQUAL=11]="LESS_EQUAL",t[t.LOGICAL_AND=12]="LOGICAL_AND",t[t.LOGICAL_OR=13]="LOGICAL_OR",t[t.MAX=14]="MAX",t[t.MIN=15]="MIN",t[t.MOD=16]="MOD",t[t.MUL=17]="MUL",t[t.NOT_EQUAL=18]="NOT_EQUAL",t[t.POW=19]="POW",t[t.PRELU=20]="PRELU",t[t.SQUARED_DIFFERENCE=21]="SQUARED_DIFFERENCE",t[t.SUB=22]="SUB"})(ht||(ht={}));const yxe="let resultTemp = a + b;",xxe="let resultTemp = atan2(a, b);",wxe="let resultTemp = areal * breal - aimag * bimag;",vxe="let resultTemp = areal * bimag + aimag * breal;",bxe="let resultTemp = a / b;",Sxe="let resultTemp = select(a * (b + 1.0), a, b >= b - b);",Cxe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a == b);
`,kxe=`
  let remainder =
      select(a % b, round(a % b), (round(a) == a) & (round(b) == b));
  let quotient = (a - remainder) / b;
  let resultTemp =
      round(select(quotient, quotient - 1, sign(remainder) == -sign(b)));
`,Ixe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a > b);
`,$xe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a >= b);
`,Nxe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a < b);
`,Txe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a <= b);
`,Exe="return f32(a >= 1.0 && b >= 1.0);",Rxe=`return (vec4<f32>(a >= vec4<f32>(1.0)) *
  vec4<f32>(b >= vec4<f32>(1.0)));`,Dxe="return f32(a >= 1.0 || b >= 1.0);",Axe=`return min(vec4<f32>(a >= vec4<f32>(1.0)) +
  vec4<f32>(b >= vec4<f32>(1.0)), vec4<f32>(1.0));`,_xe="let resultTemp = max(a, b);",Fxe="let resultTemp = min(a, b);",Pxe=`
  let isNaN = b == 0.;
  var resultTemp = a % b;
  resultTemp = select((resultTemp + b) % b, resultTemp,
      (a < 0. && b < 0.) || (a >= 0. && b > 0.));
`,Oxe=`
  let isNaN = !vec4<bool>(b);
  var resultTemp = vec4<f32>(a % b);
  if (!((a[0] < 0. && b[0] < 0.) || (a[0] >= 0. && b[0] > 0.))) {
    resultTemp[0] = (resultTemp[0] + b[0]) % b[0];
  }
  if (!((a[1] < 0. && b[1] < 0.) || (a[1] >= 0. && b[1] > 0.))) {
    resultTemp[1] = (resultTemp[1] + b[1]) % b[1];
  }
  if (!((a[2] < 0. && b[2] < 0.) || (a[2] >= 0. && b[2] > 0.))) {
    resultTemp[2] = (resultTemp[2] + b[2]) % b[2];
  }
  if (!((a[3] < 0. && b[3] < 0.) || (a[3] >= 0. && b[3] > 0.))) {
    resultTemp[3] = (resultTemp[3] + b[3]) % b[3];
  }
`,Lxe="let resultTemp = a * b;",zxe=`
  var resultTemp = f32(a != b);
  let valueForNaN = 1.0;
`,Mxe=`
  var resultTemp = vec4<f32>(a != b);
  let valueForNaN = 1.0;
`,Bxe=`
  let isNaN = a < 0.0 && floor(b) < b;
  if (b == 0.0) {
    return 1.0;
  }
  var resultTemp = select(sign(a) * pow(abs(a), b), pow(abs(a), b),
      round(abs(b) % 2.0) != 1.0);
`,Vxe=`
  let isModRound1Bool = vec4<i32>(round(abs(b) % vec4<f32>(2.0))) == vec4<i32>(1);
  let isModRound1 = vec4<f32>(isModRound1Bool);
  let multiplier = sign(a) * isModRound1 + (vec4<f32>(1.0) - isModRound1);
  var resultTemp = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  let isExpZero = b == vec4<f32>(0.0);
  if (isExpZero.r) {
    resultTemp.r = 1.0;
  }
  if (isExpZero.g) {
    resultTemp.g = 1.0;
  }
  if (isExpZero.b) {
    resultTemp.b = 1.0;
  }
  if (isExpZero.a) {
    resultTemp.a = 1.0;
  }
  let isNaN = (a < vec4<f32>(0.0)) & (floor(b) < b);
`,Uxe="if (a < 0.0) { return b * a; }  return a;",Wxe=`
  let aLessThanZero = vec4<f32>(a < vec4<f32>(0.0));
  return (aLessThanZero * (b * a)) + ((vec4<f32>(1.0) - aLessThanZero) * a);
`,jxe="let resultTemp = (a - b) * (a - b);",Gxe="let resultTemp = a - b;";function hI(t,e){let n;do{switch(t){case ht.ATAN2:n=xxe;break;case ht.MAX:n=_xe;break;case ht.MIN:n=Fxe;break;case ht.MOD:n=e?Oxe:Pxe;break;case ht.NOT_EQUAL:n=e?Mxe:zxe;break;case ht.POW:n=e?Vxe:Bxe;break;default:continue}let s,r,o;return e?(s="isnanVec4",r="vec4<f32>",o="vec4<bool>"):(s="isnan",r="f32",o="bool"),`
      let aIsNaN = ${s}(a);
      let aPostLegalization = select(a, ${r}(42), aIsNaN);
      let bIsNaN = ${s}(b);
      let bPostLegalization = select(b, ${r}(42), bIsNaN);
      let isNaN = false;
      let valueForNaN = uniforms.NAN;
      {
        let a = aPostLegalization;
        let b = bPostLegalization;
        ${n}
        return select(
            resultTemp, ${r}(valueForNaN),
            ${o}(isNaN) | aIsNaN | bIsNaN);
      }
    `}while(!1);switch(t){case ht.ADD:n=yxe;break;case ht.COMPLEX_MULTIPLY_IMAG:n=vxe;break;case ht.COMPLEX_MULTIPLY_REAL:n=wxe;break;case ht.DIV:n=bxe;break;case ht.ELU_DER:n=Sxe;break;case ht.EQUAL:n=Cxe;break;case ht.FLOOR_DIV:n=kxe;break;case ht.GREATER:n=Ixe;break;case ht.GREATER_EQUAL:n=$xe;break;case ht.LESS:n=Nxe;break;case ht.LESS_EQUAL:n=Txe;break;case ht.LOGICAL_AND:return e?Rxe:Exe;case ht.LOGICAL_OR:return e?Axe:Dxe;case ht.MUL:n=Lxe;break;case ht.PRELU:return e?Wxe:Uxe;case ht.SQUARED_DIFFERENCE:n=jxe;break;case ht.SUB:n=Gxe;break}return`
    ${n}
    return resultTemp;
  `}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Te;(function(t){t[t.ABS=0]="ABS",t[t.ACOS=1]="ACOS",t[t.ACOSH=2]="ACOSH",t[t.ASIN=3]="ASIN",t[t.ASINH=4]="ASINH",t[t.ATAN=5]="ATAN",t[t.ATANH=6]="ATANH",t[t.CEIL=7]="CEIL",t[t.COS=8]="COS",t[t.COSH=9]="COSH",t[t.ELU=10]="ELU",t[t.ERF=11]="ERF",t[t.EXP=12]="EXP",t[t.EXPM1=13]="EXPM1",t[t.FLOOR=14]="FLOOR",t[t.IS_FINITE=15]="IS_FINITE",t[t.IS_INF=16]="IS_INF",t[t.IS_NAN=17]="IS_NAN",t[t.LINEAR=18]="LINEAR",t[t.LOG=19]="LOG",t[t.LOG1P=20]="LOG1P",t[t.LOGICAL_NOT=21]="LOGICAL_NOT",t[t.NEG=22]="NEG",t[t.RELU=23]="RELU",t[t.RELU6=24]="RELU6",t[t.LEAKYRELU=25]="LEAKYRELU",t[t.RECIPROCAL=26]="RECIPROCAL",t[t.ROUND=27]="ROUND",t[t.RSQRT=28]="RSQRT",t[t.SELU=29]="SELU",t[t.SIGMOID=30]="SIGMOID",t[t.SIGN=31]="SIGN",t[t.SIN=32]="SIN",t[t.SINH=33]="SINH",t[t.SOFTPLUS=34]="SOFTPLUS",t[t.SQRT=35]="SQRT",t[t.SQUARE=36]="SQUARE",t[t.STEP=37]="STEP",t[t.TAN=38]="TAN",t[t.TANH=39]="TANH",t[t.TO_INT=40]="TO_INT"})(Te||(Te={}));const Hxe="return abs(a);",Kxe=`
  if (abs(a) > 1.) {
    return uniforms.NAN;
  }
  return acos(a);
`,qxe=`
  if (a < 1.) {
    return uniforms.NAN;
  }
  return acosh(a);
`,Xxe=`
  if (abs(a) > 1.) {
    return uniforms.NAN;
  }
  return asin(a);
`,Yxe="return asinh(a);",Qxe=`
  if (isnan(a)) {
    return uniforms.NAN;
  }
  return atan(a);
`,Jxe=`
  if (abs(a) > 1.) {
    return uniforms.NAN;
  }
  if (a == 1.) {
    return uniforms.INFINITY;
  }
  if (a == -1.) {
    return -uniforms.INFINITY;
  }
  return atanh(a);
`,Zxe="return ceil(a);",e0e="return cos(a);",t0e=`
  let e2x = exp(-a);
  return (e2x + 1.0 / e2x) / 2.0;
`,n0e="return exp(a) - 1.0;",s0e="if (a >= 0.0) { return a; }  return (exp(a) - 1.0);",r0e=`
  var resFloat = exp(a) - vec4<f32>(1.0);
  if (a.r >= 0.0) {
    resFloat.r = a.r;
  }
  if (a.g >= 0.0) {
    resFloat.g = a.g;
  }
  if (a.b >= 0.0) {
    resFloat.b = a.b;
  }
  if (a.a >= 0.0) {
    resFloat.a = a.a;
  }
  return resFloat;
`,o0e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  let p = ${Hw};
  let a1 = ${Kw};
  let a2 = ${qw};
  let a3 = ${Xw};
  let a4 = ${Yw};
  let a5 = ${Qw};

  let sign = sign(a);
  let absA = abs(a);
  let t = 1.0 / (1.0 + p * absA);
  return sign * (1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * exp(-absA * absA));
`,i0e="return exp(a);",a0e="return floor(a);",l0e="return f32(!isnan(a) && !isinf(a));",u0e="return f32(isinf(a));",c0e="return f32(isnan(a));",d0e="return a;",h0e=`if (a < 0.0) { return uniforms.NAN; }
  return log(a);`,p0e=`
  if (isnan(a)) { return a; }
  return log(1.0 + a);
`,f0e="return f32(!(a >= 1.0));",m0e="return -a;",g0e="if (a < 0.0) { return uniforms.alpha * a; } return a;",y0e=`
  let aLessThanZero = vec4<f32>(a < vec4<f32>(0.0));
  return (aLessThanZero * (uniforms.alpha * a)) + ((vec4<f32>(1.0) - aLessThanZero) * a);
`,x0e="return 1.0 / a;",w0e="return select(a, 0.0, a < 0.0);",v0e="return clamp(a, 0.0, 6.0);",b0e="return clamp(a, vec4<f32>(0.0, 0.0, 0.0, 0.0), vec4<f32>(6.0, 6.0, 6.0, 6.0));",S0e=`
  return select(a, vec4<f32>(0.0), a < vec4<f32>(0.0));
`,C0e="return round(a);",k0e="return inverseSqrt(a);",I0e=`
  if (a >= 0.0) {
    return ${Zm} * a;
  } else {
    return ${Jm} * (exp(a) - 1.0);
  }
`,$0e="return 1.0 / (1.0 + exp(-1.0 * a));",N0e="return sign(a);",T0e="return sin(a);",E0e=`
  let e2x = exp(a);
  return (e2x - 1.0 / e2x) / 2.0;
`,R0e=`
  let epsilon = 1.1920928955078125e-7;
  let threshold = log(epsilon) + 2.0;

  let too_large = a > -threshold;
  let too_small = a < threshold;
  let exp_a = exp(a);

  if (too_large) {
    return a;
  } else if (too_small) {
    return exp_a;
  } else {
    return log(exp_a + 1.0);
  }
`,D0e="return sqrt(a);",A0e="return a * a;",_0e=`
  if (isnan(a)) {
    return a;
  }

  return select(uniforms.stepAlpha, 1.0, a > 0.0);
`,F0e="return tan(a);",P0e=`
  let e2x = exp(-2.0 * abs(a));
  return sign(a) * (1.0 - e2x) / (1.0 + e2x);
`,O0e="return f32(i32((a)));";function uu(t,e){switch(t){case Te.ABS:return Hxe;case Te.ACOS:return Kxe;case Te.ACOSH:return qxe;case Te.ASIN:return Xxe;case Te.ASINH:return Yxe;case Te.ATAN:return Qxe;case Te.ATANH:return Jxe;case Te.COS:return e0e;case Te.COSH:return t0e;case Te.CEIL:return Zxe;case Te.ELU:return e?r0e:s0e;case Te.ERF:return o0e;case Te.EXP:return i0e;case Te.EXPM1:return n0e;case Te.FLOOR:return a0e;case Te.IS_FINITE:return l0e;case Te.IS_INF:return u0e;case Te.IS_NAN:return c0e;case Te.LINEAR:return d0e;case Te.LOG:return h0e;case Te.LOG1P:return p0e;case Te.LOGICAL_NOT:return f0e;case Te.NEG:return m0e;case Te.LEAKYRELU:return e?y0e:g0e;case Te.RECIPROCAL:return x0e;case Te.RELU:return e?S0e:w0e;case Te.RELU6:return e?b0e:v0e;case Te.ROUND:return C0e;case Te.RSQRT:return k0e;case Te.SELU:return I0e;case Te.SIGMOID:return $0e;case Te.SIGN:return N0e;case Te.SIN:return T0e;case Te.SINH:return E0e;case Te.SOFTPLUS:return R0e;case Te.SQRT:return D0e;case Te.SQUARE:return A0e;case Te.STEP:return _0e;case Te.TAN:return F0e;case Te.TANH:return P0e;case Te.TO_INT:return O0e;default:throw new Error(`BinaryType ${t} is not implemented!`)}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ka(t,e=!1,n=!1,s=3){if(t===null)return"";let r="";if(t==="linear")r=uu(Te.LINEAR);else if(t==="relu")r=uu(Te.RELU,n);else if(t==="elu")r=uu(Te.ELU,n);else if(t==="relu6")r=uu(Te.RELU6,n);else if(t==="prelu")r=hI(ht.PRELU,n);else if(t==="sigmoid")r=uu(Te.SIGMOID,n);else if(t==="leakyrelu")r=uu(Te.LEAKYRELU,n);else throw new Error(`Activation ${t} has not been implemented for the WebGPU backend.`);const i=kt(n?4:1);let a="";return e?a=`
      fn activation(a : ${i}, coords : vec${s}<i32>) -> ${i} {
        let b = getPreluActivationWeightsByOutputCoords(coords);
        ${r}
      }`:a=`
      fn activation(a : ${i}, coords : vec${s}<i32>) -> ${i} {
        ${r}
      }`,a}function bc(t,e){return`
      ${t?"value = value + getBiasByOutputCoords(coords);":""}
      ${e?"value = activation(value, coords);":""}
      `}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lM(t,e,n=!1,s=!1,r=!1,o=1){A(t&&o===1||!t,()=>`transposeA ${t} is not compatible with component size ${o}`);const i=`
      ${t?"value = getA(batch, col, row);":"value = getA(batch, row, col);"}

    `,a=e?"value = getB(batch, col, row);":"value = getB(batch, row, col);";return`
  fn mm_readA(batch: i32, row: i32, col: i32) -> ${kt(o)} {
    var value = ${kt(o)}(0.0);
    ${n&&r?i:`
    ${t?"if(row < uniforms.dimAOuter && col < uniforms.dimInner)":"if(row < uniforms.aShape[1] && col < uniforms.aShape[2])"}
    {
      ${i}
    }
    `}
    return value;
  }

  fn mm_readB(batch: i32, row: i32, col: i32) -> ${kt(o)} {
    var value = ${kt(o)}(0.0);
    ${a}
    return value;
  }
  `}function pI(t,e,n,s,r=!1,o=!1,i=!1,a=1){return`
  ${lM(n,s,r,o,i,a)}
  fn mm_write(batch: i32, row: i32, col: i32, valueIn: ${kt(a)}) {
    ${r&&o?"":"if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)"}
    {
      var value = valueIn;
      let coords = vec3<i32>(batch, row, col);
      ${bc(t,e)}
      setOutputAtCoords(coords[0], coords[1], coords[2], value);
    }
  }
  `}const L0e=(t,e)=>t?`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          kStart + inputRow,
          globalRowStart + inputCol * ${e});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          globalRow + innerRow,
          kStart + inputCol * ${e});
        `,z0e=(t,e,n,s)=>{if(t)return`
      for (var k = 0; k < ${s}; k++) {
        let BCached0 = mm_Bsub[k][tileCol];
        let ACached0 = mm_Asub[k][localRow];
        for (var i = 0; i < ${n}; i++) {
          acc[i] = fma(BCached0, vec4<f32>(ACached0[i]), acc[i]);
        }
      }`;{let r="",o="";for(let i=0;i<e;i++)r+=`let BCached${i} = mm_Bsub[k * ${e} + ${i}][tileCol];`,o+=`acc[i] = fma(BCached${i}, vec4<f32>(ACached[${i}]), acc[i]);`;return`
      for (var k = 0; k < ${s/e}; k++) {
        ${r}
        for (var i = 0; i < ${n}; i++) {
          let ACached = mm_Asub[tileRow + i][k];
          ${o}
        }
      }`}};function S1(t,e,n=!1,s=32,r=!1,o=32,i=!1){const a=e[1]*t[1],l=e[0]*t[0],u=n?a:s,c=n?s:a,d=u/e[0],h=s/e[1],p=t[1],f=t[0];return A((n&&d===4&&t[1]===4||!n&&(d===3||d===4))&&u%e[0]===0&&s%e[1]===0&&t[0]===4,()=>`If transposeA ${n} is true, innerElementSize ${d} and workPerThread[1] ${t[1]} must be 4.
          Otherwise, innerElementSize ${d} must be 3 or 4.
      tileAWidth ${u} must be divisible by workgroupSize[0]${e[0]}. tileInner ${s} must be divisible by workgroupSize[1] ${e[1]}. colPerThread ${t[0]} must be 4.`),`
  var<workgroup> mm_Asub : array<array<vec${d}<f32>, ${u/d}>, ${c}>;
  var<workgroup> mm_Bsub : array<array<vec4<f32>, ${l/t[0]}>, ${s}>;

  ${Re()} {
    let localRow = i32(localId.y);
    let tileRow = localRow * ${p};
    let tileCol = i32(localId.x);

    let globalRow = i32(globalId.y) * ${p};
    let globalCol = i32(globalId.x) * ${f};
    let batch = ${r?"0":"i32(globalId.z)"};
    let batchA = ${r||!i?"batch":"batch % uniforms.aShape[0]"};
    let batchB = ${r||!i?"batch":"batch % uniforms.bShape[0]"};
    let globalRowStart = i32(workgroupId.y) * ${a};

    let numTiles = ${r?`${Math.ceil(o/s)}`:`(uniforms.dimInner - 1) / ${s} + 1`};
    var kStart = ${r?`i32(globalId.z) * ${o}`:"0"};

    var acc: array<vec4<f32>, ${p}>;

    // Loop over shared dimension.
    let tileRowB = localRow * ${h};
    for (var t = 0; t < numTiles; t++) {
        // Load one tile of A into local memory.
        for (var innerRow = 0; innerRow < ${p}; innerRow++) {
            let inputRow = tileRow + innerRow;
            let inputCol = tileCol;
            ${L0e(n,d)}
        }

        // Load one tile of B into local memory.
        for (var innerRow = 0; innerRow < ${h}; innerRow++) {
            let inputRow = tileRowB + innerRow;
            let inputCol = tileCol;
            mm_Bsub[inputRow][inputCol] = mm_readB(batchB, kStart + inputRow, globalCol);
        }
        kStart = kStart + ${s};
        workgroupBarrier();

        // Compute acc values for a single thread.
        ${z0e(n,d,p,s)}
        workgroupBarrier();
    }

    for (var innerRow = 0; innerRow < ${p}; innerRow++) {
        mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
    }
  }`}const xE=t=>t?`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          kStart + inputRow,
          globalRowStart + inputCol);
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          globalRowStart + inputRow,
          kStart + inputCol);
        `,M0e=t=>t?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];";function C1(t,e,n=!1,s=32,r=!1,o=32,i=!1,a=!1){const l=t[1]*e[1],u=t[0]*e[0],c=n?l:s,d=n?s:l;A(d%e[1]===0&&c%e[0]===0&&s%e[1]===0,()=>`tileAHight ${d} must be divisible by workgroupSize[1]${e[1]}, tileAWidth ${c} must be divisible by workgroupSize[0]${e[0]}, tileInner ${s} must be divisible by workgroupSize[1]${e[1]}`);const h=d/e[1],p=c/e[0],f=s/e[1],m=t[1],g=t[0],y=i?`
      let localRow = i32(localId.y);
      let localCol = i32(localId.x);
      let globalRowStart = i32(workgroupId.y) * ${l};
      let globalColStart = i32(workgroupId.x) * ${u};

      // Loop over shared dimension.
      for (var t = 0; t < numTiles; t++) {
        // Load one tile of A into local memory.
        for (var inputRow = localRow; inputRow < ${d}; inputRow = inputRow + ${e[1]}) {
          for (var inputCol = localCol; inputCol < ${c}; inputCol = inputCol + ${e[0]}) {
            ${xE(n)}
          }
        }
        // Load one tile of B into local memory.
        for (var inputRow = localRow; inputRow < ${s}; inputRow = inputRow + ${e[1]}) {
              for (var inputCol = localCol; inputCol < ${u}; inputCol = inputCol + ${e[0]}) {
            mm_Bsub[inputRow][inputCol] = mm_readB(batchB,
              kStart + inputRow,
              globalColStart + inputCol);
          }
        }
        kStart = kStart + ${s};
        workgroupBarrier();

        // Compute acc values for a single thread.
        var BCached : array<f32, ${g}>;
        for (var k = 0; k < ${s}; k++) {
          for (var inner = 0; inner < ${g}; inner++) {
            BCached[inner] = mm_Bsub[k][localCol + inner * ${e[0]}];
          }
          for (var innerRow = 0; innerRow < ${m}; innerRow++) {
            let ACached = ${n?`mm_Asub[k][localRow + innerRow * ${e[1]}];`:`mm_Asub[localRow + innerRow * ${e[1]}][k];`}
            for (var innerCol = 0; innerCol < ${g}; innerCol++) {
              acc[innerRow][innerCol] =
                  fma(ACached, BCached[innerCol], acc[innerRow][innerCol]);
            }
          }
        }
        workgroupBarrier();
      }
      for (var innerRow = 0; innerRow < ${m}; innerRow++) {
        let gRow = globalRowStart + localRow + innerRow * ${e[1]};
        for (var innerCol = 0; innerCol < ${g}; innerCol++) {
          let gCol = globalColStart + localCol + innerCol * ${e[0]};
          mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
        }
      }
      `:`
  let tileRow = i32(localId.y) * ${m};
  let tileCol = i32(localId.x) * ${g};

  let globalRow = i32(globalId.y) * ${m};
  let globalCol = i32(globalId.x) * ${g};
  let globalRowStart = i32(workgroupId.y) * ${l};

  let tileRowA = i32(localId.y) * ${h};
  let tileColA = i32(localId.x) * ${p};
  let tileRowB = i32(localId.y) * ${f};
  // Loop over shared dimension.
  for (var t = 0; t < numTiles; t++) {
    // Load one tile of A into local memory.
    for (var innerRow = 0; innerRow < ${h}; innerRow++) {
      for (var innerCol = 0; innerCol < ${p}; innerCol++) {
        let inputRow = tileRowA + innerRow;
        let inputCol = tileColA + innerCol;
        ${xE(n)}
      }
    }

    // Load one tile of B into local memory.
    for (var innerRow = 0; innerRow < ${f}; innerRow++) {
      for (var innerCol = 0; innerCol < ${g}; innerCol++) {
        let inputRow = tileRowB + innerRow;
        let inputCol = tileCol + innerCol;
        mm_Bsub[inputRow][inputCol] = mm_readB(batchB,
          kStart + inputRow,
          globalCol + innerCol);
      }
    }
    kStart = kStart + ${s};
    workgroupBarrier();

    // Compute acc values for a single thread.
    var BCached : array<f32, ${g}>;
    for (var k = 0; k < ${s}; k++) {
      for (var inner = 0; inner < ${g}; inner++) {
        BCached[inner] = mm_Bsub[k][tileCol + inner];
      }

      for (var innerRow = 0; innerRow < ${m}; innerRow++) {
        ${M0e(n)}
        for (var innerCol = 0; innerCol < ${g}; innerCol++) {
          acc[innerRow][innerCol] =
              fma(ACached, BCached[innerCol], acc[innerRow][innerCol]);
        }
      }
    }

    workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < ${m}; innerRow++) {
    for (var innerCol = 0; innerCol < ${g}; innerCol++) {
      mm_write(batch, globalRow + innerRow, globalCol + innerCol,
          acc[innerRow][innerCol]);
    }
  }
  `;return`
    var<workgroup> mm_Asub : array<array<f32, ${c}>, ${d}>;
    var<workgroup> mm_Bsub : array<array<f32, ${u}>, ${s}>;

    ${Re()} {
      let batch = ${r?"0":"i32(globalId.z)"};
      let batchA = ${r||!a?"batch":"batch % uniforms.aShape[0]"};
      let batchB = ${r||!a?"batch":"batch % uniforms.bShape[0]"};
      let numTiles = ${r?`${Math.ceil(o/s)}`:`(uniforms.dimInner - 1) / ${s} + 1`};
      var kStart = ${r?`i32(globalId.z) * ${o}`:"0"};

      var acc : array<array<f32, ${g}>, ${m}>;

      // Without this initialization strange values show up in acc.
      for (var innerRow = 0; innerRow < ${m}; innerRow++) {
        for (var innerCol = 0; innerCol < ${g}; innerCol++) {
          acc[innerRow][innerCol] = 0.0;
        }
      }
      ${y}
    }
  `}const B0e=t=>t?`
      mm_readA(batchA, colA, globalRow),
      mm_readA(batchA, colA + 1, globalRow),
      mm_readA(batchA, colA + 2, globalRow),
      mm_readA(batchA, colA + 3, globalRow)
  `:`
      mm_readA(batchA, globalRow, colA),
      mm_readA(batchA, globalRow, colA + 1),
      mm_readA(batchA, globalRow, colA + 2),
      mm_readA(batchA, globalRow, colA + 3)
  `;function V0e(t,e=!1){A(t[1]===1&&t[2]===1,()=>`A linear work group size is required. But got ${t}.`);const n=t[0]*4;return`
    var<workgroup> mm_Asub : array<vec4<f32>, ${t[0]}>;

    ${Re()} {
      let tileCol = i32(localId.x);
      let globalCol = i32(globalId.x);
      let globalRow = i32(globalId.y);

      let numTiles = (uniforms.dimInner - 1) / ${n} + 1;
      let batch = i32(globalId.z);
      let batchA = batch % uniforms.aShape[0];
      let batchB = batch % uniforms.bShape[0];
      // Without this initialization strange values show up in acc.
      var acc = 0.0;

      // Loop over shared dimension.
      for (var t = 0; t < numTiles; t++) {
        // Load one tile of A into local memory.
        let colA = t * ${n} + tileCol * 4;
        mm_Asub[tileCol] = vec4<f32>(${B0e(e)});
        workgroupBarrier();

        // Compute acc values for a single thread.
        for (var k = 0; k < ${n/4}; k++) {
          let rowB = t * ${n} + k * 4;
          let BCached = vec4<f32>(mm_readB(batchB, rowB, globalCol),
                              mm_readB(batchB, rowB + 1, globalCol),
                              mm_readB(batchB, rowB + 2, globalCol),
                              mm_readB(batchB, rowB + 3, globalCol));

          let ACached = mm_Asub[k];
          acc = acc + dot(ACached, BCached);
        }

        workgroupBarrier();
      }

      mm_write(batch, globalRow, globalCol, acc);
    }
  `}class U0e{constructor(e,n,s=!1,r=!1,o=null,i=null,a=null,l=!1){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=n,this.dispatchLayout={x:[2],y:[1],z:[0]};const u=s?e[1]:e[2];if(this.isVec4=(u%4===0&&!s||n[1]%4===0&&s)&&n[2]%4===0&&!r,this.outputComponent=this.isVec4?4:1,this.isVectorA=n[1]===1&&!s,!this.isVec4&&this.isVectorA)this.elementsPerThread=[1,1,1],this.workgroupSize=[32,1,1];else{const h=fxe(n[1],u,n[2],s);this.workgroupSize=h.workgroupSize,this.elementsPerThread=h.elementsPerThread}this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread);const c=o!=null,d=a!=null;c&&this.variableNames.push("bias"),d&&this.variableNames.push("preluActivationWeights"),this.sequentialAccessByThreads=l,this.transposeA=s,this.transposeB=r,this.addBias=c,this.activation=i,this.hasPreluActivationWeights=d,[this.fitAOuter,this.fitBOuter,this.fitInner]=this.getShapeFit(n[1],n[2],u),this.shaderKey=`matMulPacked_${this.elementsPerThread}_${s}_${r}_${this.activation}_${this.fitAOuter}_${this.fitBOuter}_${this.fitInner}_${this.isVec4}_${this.isVectorA}_${this.sequentialAccessByThreads}`}getShapeFit(e,n,s){const r=this.workgroupSize[1]*this.elementsPerThread[1],o=this.workgroupSize[0]*this.elementsPerThread[0];!this.isVec4&&this.isVectorA?this.tileInner=this.workgroupSize[0]*4:this.tileInner=o;const i=e%r===0,a=n%o===0,l=s%this.tileInner===0;return[i,a,l]}getUserCode(){return`
      ${Ka(this.activation,this.hasPreluActivationWeights,this.isVec4)}
      ${pI(this.addBias,this.activation,!1,this.transposeB,this.fitAOuter,this.fitBOuter,this.fitInner,this.isVec4?4:1)}
      ${this.isVec4?S1(this.elementsPerThread,this.workgroupSize,this.transposeA,this.tileInner,!1,null,!0):this.isVectorA?V0e(this.workgroupSize,this.transposeA):C1(this.elementsPerThread,this.workgroupSize,this.transposeA,this.tileInner,!1,null,this.sequentialAccessByThreads,!0)}
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W0e(t){return`
    var<workgroup> sumValues : array<f32, ${t}>;
    ${Re()} {
      let coords = getOutputCoords();
      let batch = coords[0];
      let batchA = batch % uniforms.aShape[0];
      let batchB = batch % uniforms.bShape[0];
      let row = coords[1];
      let col = coords[2];
      var sum = 0.0;
      let Length = uniforms.dimInner;
      for (var k = i32(localId.x); k < Length; k = k + ${t}) {
        let dataA = mm_readA(batchA, row, k);
        let dataB = mm_readB(batchB, k, col);
        sum = sum + dataA * dataB;
      }
      sumValues[localId.x] = sum;
      workgroupBarrier();

      for(var currentSize = ${t/2}u; currentSize > 1u;
          currentSize = currentSize / 2u) {
        if (localId.x < currentSize)
        {
          sumValues[localId.x] = sumValues[localId.x] + sumValues[localId.x + currentSize];
        }
        workgroupBarrier();
      }

      if (localId.x == 0u) {
        sum = sumValues[0] + sumValues[1];
        mm_write(batch, row, col, sum);
      }
    }
  `}class j0e{constructor(e,n=!1,s=!1,r=null,o=null,i=null){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[256,1,1],this.outputShape=e,this.dispatchLayout={x:[],y:[1,2],z:[0]},this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize);const a=r!=null,l=i!=null;a&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),this.transposeA=n,this.transposeB=s,this.addBias=a,this.activation=o,this.hasPreluActivationWeights=l,this.shaderKey=`matMulReduce_${this.activation}_${n}_${s}`}getUserCode(){return`
      ${Ka(this.activation,this.hasPreluActivationWeights)}
      ${pI(this.addBias,this.activation,this.transposeA,this.transposeB)}
      ${W0e(this.workgroupSize[0])}
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G0e(t){const e=t[1],n=t[0],s=e>n?e:n;return`
  var<workgroup> mm_Asub : array<array<f32, ${s}>, ${e}>;
  var<workgroup> mm_Bsub : array<array<f32, ${n}>, ${s}>;

  // If the output size is small for matrix multiplication, avoid to use vec4
  // and handle some elements per thread to optimally utilize the ALU.
  // Read data from global memory to registers firstly, then store them into
  // shared memory, so it is instruction-Level parallelism for arithmetic
  // operations and others handle IO operations between barrier api, makes ALU
  // and load/store units work simultaneously, could improves the performance.
  ${Re()} {
    let tileRow = i32(localId.y);
    let tileCol = i32(localId.x);
    let globalRow = i32(globalId.y);
    let globalCol = i32(globalId.x);
    let batch = i32(globalId.z);
    let batchA = batch % uniforms.aShape[0];
    let batchB = batch % uniforms.bShape[0];

    // uniforms.dimInner should be greater than 0.
    let numTiles = (uniforms.dimInner - 1) / ${s} + 1;
    var acc = 0.0;

    var globalColA = tileCol;
    var globalRowB = 0;
    var regA = mm_readA(batchA, globalRow, globalColA);
    var regB0 = mm_readB(batchB, globalRowB + 2 * tileRow, globalCol);
    var regB1 = mm_readB(batchB, globalRowB + 2 * tileRow + 1, globalCol);
    globalColA = globalColA + ${s};
    globalRowB = globalRowB + ${s};

    for (var t = 0; t < numTiles; t = t + 1) {
      mm_Asub[tileRow][tileCol] = regA;
      mm_Bsub[2 * tileRow][tileCol] = regB0;
      mm_Bsub[2 * tileRow + 1][tileCol] = regB1;

      workgroupBarrier();

      regA = mm_readA(batchA, globalRow, globalColA);
      regB0 = mm_readB(batchB, globalRowB + 2 * tileRow, globalCol);
      regB1 = mm_readB(batchB, globalRowB + 2 * tileRow + 1, globalCol);
      globalColA = globalColA + ${s};
      globalRowB = globalRowB + ${s};

      for (var k = 0; k < ${s}; k = k + 1) {
        acc = acc + mm_Asub[tileRow][k] * mm_Bsub[k][tileCol];
      }
      workgroupBarrier();
    }

    mm_write(batch, globalRow, globalCol, acc);
  }
  `}class H0e{constructor(e,n,s,r=!1,o=!1,i=null,a=null,l=null){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[16,8,1],this.outputShape=s,this.dispatchLayout={x:[2],y:[1],z:[0]},this.dispatch=[Math.ceil(s[2]/this.workgroupSize[0]),Math.ceil(s[1]/this.workgroupSize[1]),s[0]];const u=i!=null;u&&this.variableNames.push("bias");const c=l!=null;c&&this.variableNames.push("preluActivationWeights"),this.transposeA=r,this.transposeB=o,this.addBias=u,this.activation=a,this.hasPreluActivationWeights=c,this.shaderKey=`matMulSmallOutputSize_${this.activation}_${r}_${o}`}getUserCode(){return`
      ${Ka(this.activation,this.hasPreluActivationWeights)}
      ${pI(this.addBias,this.activation,this.transposeA,this.transposeB)}
      ${G0e(this.workgroupSize)}
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K0e{constructor(e,n,s=!1,r=!1){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[8,8,1],this.atomic=!0,this.splitedDimInner=128,A(e[0]===1,()=>"MatMulSplitKProgram only supports batch = 1."),this.outputShape=e,this.dispatchLayout={x:[2],y:[1],z:[0,3]};const o=(s&&this.outputShape[1]%4===0||!s&&n%4===0)&&this.outputShape[2]%4===0;this.elementsPerThread=[4,4,this.splitedDimInner],this.outputComponent=o?4:1,o||(this.outputShape[1]<16&&(this.elementsPerThread[1]=1),this.outputShape[2]<16&&(this.elementsPerThread[0]=1)),this.dispatch=De(this.dispatchLayout,[this.outputShape[0],this.outputShape[1],this.outputShape[2],n],this.workgroupSize,this.elementsPerThread),this.transposeA=s,this.transposeB=r,this.shaderKey=`matMulSplitK_${s}_${r}_${this.elementsPerThread}_${this.outputComponent}`}getUserCode(){const e=this.outputComponent;return`
      ${lM(!1,this.transposeB,!1,!1,!1,e)}
      fn mm_write(batch: i32, row : i32, col : i32, value : ${kt(e)}) {
        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {
          let coords = vec3<i32>(batch, row, col);
          let flatIndex = getOutputIndexFromCoords(coords);
          // The problem is that we should initialize output to zero before using.
          // Otherwise, the original value will be added to the result.
          for (var i = 0; i < ${e}; i = i + 1) {
            ${Ql("&result[flatIndex + i]",`${e>1?"value[i]":"value"}`,"float32")}
          }
        }
      }
      ${e===4?S1(this.elementsPerThread,this.workgroupSize,this.transposeA,32,!0,this.splitedDimInner):C1(this.elementsPerThread,this.workgroupSize,this.transposeA,32,!0,this.splitedDimInner)}
    `}}class q0e{constructor(e,n=null,s=null,r=null){this.uniforms="",this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.addBias=n!=null,this.hasPreluActivationWeights=r!=null,this.activation=s,this.addBias&&this.variableNames.push("bias"),this.hasPreluActivationWeights&&this.variableNames.push("preluActivationWeights"),this.shaderKey=`biasActivation_${s}`}getUserCode(){return`
    ${Ka(this.activation,this.hasPreluActivationWeights)}
    ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        var value = getXByOutputIndex(index);
        ${bc(this.addBias,this.activation)}
        setOutputAtIndex(index, value);
      }
    }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X0e{constructor(e){this.variableNames=[],this.outputShape=[],this.uniforms="value : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="fill"}getUserCode(){return`
    ${Re("index")} {
      if (index < uniforms.size) {
        setOutputAtIndex(index, uniforms.value);
      }
    }
  `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cr(t){const{backend:e,attrs:n}=t,{shape:s,value:r}=n;let{dtype:o}=n;if(o=o||oc(r),o==="string"){const i=Mn(o,te(s));return i.fill(r),e.makeTensorInfo(s,o,i)}else{const i=new X0e(s),a=[{type:"float32",data:[r]}];return e.runWebGPUProgram(i,[],o,a)}}const Y0e={kernelName:P0,backendName:"webgpu",kernelFunc:Cr};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ye(t){const{inputs:e,attrs:n}=t,{x:s}=e,{shape:r}=n,o=te(s.shape),i=u2(r,o),a=te(i);return A(o===a,()=>`The new shape (${i}) has ${a} elements and the old shape (${s.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),t.backend.incRef(s.dataId),{dataId:s.dataId,shape:i,dtype:s.dtype}}const Q0e={kernelName:Dm,backendName:"webgpu",kernelFunc:Ye};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k1({a:t,b:e,transposeA:n,transposeB:s,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:l=null}){const u=t.shape.length,c=e.shape.length,d=n?t.shape[u-2]:t.shape[u-1],h=s?e.shape[c-1]:e.shape[c-2],p=n?t.shape[u-1]:t.shape[u-2],f=s?e.shape[c-2]:e.shape[c-1],m=t.shape.slice(0,-2),g=e.shape.slice(0,-2),y=te(m),x=te(g),b=ct(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([p,f]);A(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const S=n?[y,d,p]:[y,p,d],C=s?[x,f,h]:[x,h,f],I=Ye({inputs:{x:t},backend:r,attrs:{shape:S}}),T=Ye({inputs:{x:e},backend:r,attrs:{shape:C}}),R=[I,T],_=Math.max(y,x),P=[I,T],z=[{type:"int32",data:[p]},{type:"int32",data:[f]},{type:"int32",data:[d]}];let O,V;const H=[_,p,f];let Q=re().get("WEBGPU_MATMUL_PROGRAM_TYPE");if(Q<0){const j=re().getNumber("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL"),ee=j>0?j:r.thresholdToIncreaseWorkgroups,ie=_*Math.ceil(p/32)*Math.ceil(f/32);ie<=ee||p<=8&&ie<=ee*2?_*p*f<=128?Q=Hi.MatMulReduceProgram:_===1&&h>=2e3?Q=Hi.MatMulSplitKProgram:Q=Hi.MatMulSmallOutputSizeProgram:Q=Hi.MatMulPackedProgram}switch(Q){case Hi.MatMulReduceProgram:O=new j0e(H,n,s,o,l,i);break;case Hi.MatMulSplitKProgram:{if(V=Cr({backend:r,attrs:{shape:H,value:0,dtype:t.dtype}}),O=new K0e(H,h,n,s),o||l){V=r.runWebGPUProgram(O,P,t.dtype,z,V);const ee=new q0e(V.shape,o,l,i);let ie=null;const le=[V];o&&le.push(o),i&&le.push(i),l==="leakyrelu"&&(ie=[{type:"float32",data:[a]}],ee.uniforms+=" alpha : f32,");const fe=r.runWebGPUProgram(ee,le,V.dtype,ie);R.push(V);const ge=Ye({inputs:{x:fe},backend:r,attrs:{shape:b}});R.push(fe);for(const xe of R)r.disposeData(xe.dataId);return ge}break}case Hi.MatMulSmallOutputSizeProgram:O=new H0e(S,C,H,n,s,o,l,i);break;case Hi.MatMulPackedProgram:const j=r.adapterInfo.isIntel();O=new U0e(S,H,n,s,o,l,i,j);break;default:throw new Error(`Unsupported MatMulProgramType ${Q}.`)}o&&P.push(o),i&&P.push(i),l==="leakyrelu"&&(z.push({type:"float32",data:[a]}),O.uniforms+=" alpha : f32,"),V=r.runWebGPUProgram(O,P,t.dtype,z,V);const oe=Ye({inputs:{x:V},backend:r,attrs:{shape:b}});R.push(V);for(const j of R)r.disposeData(j.dataId);return oe}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J0e(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:d}=s;return k1({a:r,b:o,transposeA:l,transposeB:u,backend:n,bias:i,preluActivationWeights:a,leakyreluAlpha:d,activation:c})}const Z0e={kernelName:pf,backendName:"webgpu",kernelFunc:J0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wE{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.workgroupSize=[128,1,1],this.size=!0,this.outputShape=ct(n,s),this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`binaryOpComplex_${e}`,this.op=e}getUserCode(){return`
      fn binaryOpComplex(
          areal : f32, aimag : f32, breal : f32, bimag : f32) -> f32 {
        ${hI(this.op,!1)}
      }

      ${Re("index")} {
        if(index < uniforms.size) {
          let areal = getARealByOutputIndex(index);
          let aimag = getAImagByOutputIndex(index);
          let breal = getBRealByOutputIndex(index);
          let bimag = getBImagByOutputIndex(index);
          setOutputAtIndex(index, binaryOpComplex(areal, aimag, breal, bimag));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zx{constructor(e,n,s){if(this.size=!0,this.variableNames=["A","B"],this.outputShape=ct(n,s),this.dispatchLayout=Ve(this.outputShape),this.op=e,this.useSharedMemoryWithA=n.length<=1&&s.length>1&&n[0]<128,this.useSharedMemoryWithB=s.length<=1&&n.length>1&&s[0]<128,this.useSharedMemoryWithA||this.useSharedMemoryWithB)this.outputComponent=1,this.variableComponents=[1,1],this.lastDimensionSize=this.useSharedMemoryWithB?s[0]:n[0],this.shaderKey=`binary_${e}_${this.lastDimensionSize}`,this.type="shared",this.workgroupSize=[256,1,1];else{const r=n.length>0&&n[n.length-1]%4===0,o=s.length>0&&s[s.length-1]%4===0;r&&o?(this.outputComponent=4,this.variableComponents=[4,4]):r&&(bN(s)||s[s.length-1]===1)||o&&(bN(n)||n[n.length-1]===1)?(this.outputComponent=4,this.variableComponents=r?[4,1]:[1,4]):(this.outputComponent=1,this.variableComponents=[1,1]),this.type="nonshared",this.shaderKey=`binary_${e}_${this.variableComponents}`,this.workgroupSize=[128,1,1]}this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.outputComponent,1,1])}getUserCode(){let e;const n=this.outputComponent===4?"vec4<f32>":"f32",s=`
    fn binaryOperation(a : ${n}, b : ${n}) -> ${n} {
      ${hI(this.op,this.outputComponent===4)}
    };
    `;if(this.type==="shared"){const r=this.lastDimensionSize>1?`coords[${this.outputShape.length-1}]`:"0",o=this.useSharedMemoryWithB?`let a = getAByOutputIndex(index);
          let b = sharedBuf[${r}];`:`let a = sharedBuf[${r}];
          let b = getBByOutputIndex(index);`;e=`
        ${s}
        var<workgroup> sharedBuf : array<f32, ${this.lastDimensionSize}>;
        ${Re("index")} {
          // Fill in the shared memory buffer.
          let localIndex = i32(localId.x);
          if(localIndex < ${this.lastDimensionSize}) {
            sharedBuf[localIndex] = f32(${this.useSharedMemoryWithB?"B":"A"}[localIndex]);
          }
          workgroupBarrier();

          if(index < uniforms.size) {
            let coords = getCoordsFromIndex(index);
            ${o}
            setOutputAtIndex(index, binaryOperation(a, b));
          }
        }
        `}else e=`
       ${s}
       ${Re("index")} {
         if (index < uniforms.size) {
           let coords = getCoordsFromIndex(index * ${this.outputComponent});
           let a = ${n}(getAByOutputCoords(coords));
           let b = ${n}(getBByOutputCoords(coords));
           setOutputAtIndex(index, binaryOperation(a, b));
         }
       }
       `;return e}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qr(t){const{inputs:e}=t,{x:n}=e;return t.backend.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}const ewe={kernelName:ah,backendName:"webgpu",kernelFunc:Qr};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sc(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,o=n.makeTensorInfo(s.shape,"complex64"),i=n.tensorMap.get(o.dataId),a=Qr({inputs:{x:s},backend:n}),l=Qr({inputs:{x:r},backend:n});return i.complexTensorInfos={real:a,imag:l},o}const twe={kernelName:b0,backendName:"webgpu",kernelFunc:Sc};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qh{constructor(e,n,s=""){this.variableNames=["A"],this.size=!0;const r=128;this.workgroupSize=[r,1,1],this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.op=n,s!==""&&(this.uniforms=s),this.shaderKey=`unary_${n}`}getUserCode(){return`
      fn unaryOperation(a : f32) -> f32 {
        ${uu(this.op,!1)}
      }
      ${Re("index")} {
        if (index < uniforms.size) {
          let a = getAByOutputIndex(index);
          setOutputAtIndex(index, unaryOperation(a));
        }
      }
      `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jt({opType:t,cpuKernelImpl:e,dtype:n}){return({inputs:s,backend:r})=>{const{x:o}=s,i=r,a=n||o.dtype;if(i.shouldExecuteOnCPU([o])&&e!=null){const u=i.tensorMap.get(o.dataId),c=e(u.values,a);return i.makeTensorInfo(o.shape,a,c)}const l=new Qh(o.shape,t);return i.runWebGPUProgram(l,[o],a)}}function Ns({opType:t,cpuKernelImpl:e,supportsComplex:n=!1,dtype:s}){return({inputs:r,backend:o})=>{const{a:i,b:a}=r,l=o;if(n&&i.dtype==="complex64"){const d=l.tensorMap.get(i.dataId),h=l.tensorMap.get(a.dataId);let p,f;if(t!==ht.MUL)[p,f]=[[d.complexTensorInfos.real,h.complexTensorInfos.real],[d.complexTensorInfos.imag,h.complexTensorInfos.imag]].map(g=>{const[y,x]=g,v={dataId:y.dataId,dtype:y.dtype,shape:i.shape},b={dataId:x.dataId,dtype:x.dtype,shape:a.shape},S=new zx(t,i.shape,a.shape);return l.runWebGPUProgram(S,[v,b],$s(y.dtype,x.dtype))});else{const g=new wE(ht.COMPLEX_MULTIPLY_REAL,i.shape,a.shape),y=new wE(ht.COMPLEX_MULTIPLY_IMAG,i.shape,a.shape),x=[{dataId:d.complexTensorInfos.real.dataId,dtype:d.complexTensorInfos.real.dtype,shape:i.shape},{dataId:d.complexTensorInfos.imag.dataId,dtype:d.complexTensorInfos.imag.dtype,shape:i.shape},{dataId:h.complexTensorInfos.real.dataId,dtype:h.complexTensorInfos.real.dtype,shape:a.shape},{dataId:h.complexTensorInfos.imag.dataId,dtype:h.complexTensorInfos.imag.dtype,shape:a.shape}];p=l.runWebGPUProgram(g,x,"float32"),f=l.runWebGPUProgram(y,x,"float32")}const m=Sc({inputs:{real:p,imag:f},backend:l});return l.disposeData(p.dataId),l.disposeData(f.dataId),m}const u=s||$s(i.dtype,a.dtype);if((i.dtype==="string"||a.dtype==="string"||l.shouldExecuteOnCPU([i,a]))&&e!=null){const d=l.tensorMap.get(i.dataId).values,h=l.tensorMap.get(a.dataId).values,p=i.dtype==="string"?Ti(d):d,f=i.dtype==="string"?Ti(h):h,[m,g]=e(i.shape,a.shape,p,f,u);return l.makeTensorInfo(g,u,m)}const c=new zx(t,i.shape,a.shape);return l.runWebGPUProgram(c,[i,a],u)}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:nwe,castImpl:swe,ceilImpl:rwe,concatImpl:owe,equalImpl:iwe,expImpl:awe,expm1Impl:lwe,floorImpl:uwe,floorDivImpl:cwe,gatherNdImpl:dwe,gatherV2Impl:hwe,greaterEqualImpl:pwe,greaterImpl:fwe,lessEqualImpl:mwe,lessImpl:gwe,logImpl:ywe,maxImpl:xwe,maximumImpl:wwe,minimumImpl:vwe,multiplyImpl:bwe,negImpl:Swe,notEqualImpl:Cwe,prodImpl:kwe,rangeImpl:Iwe,rsqrtImpl:$we,scatterImpl:Nwe,simpleAbsImpl:Twe,sliceImpl:Ewe,stridedSliceImpl:Rwe,stringNGramsImpl:Dwe,subImpl:Awe,tileImpl:_we,topKImpl:Fwe,transposeImpl:Pwe,uniqueImpl:DTe}=XL;/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Owe=jt({opType:Te.ABS,cpuKernelImpl:Twe}),Lwe={kernelName:Wf,backendName:"webgpu",kernelFunc:Owe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zwe=jt({opType:Te.ACOS}),Mwe={kernelName:Vd,backendName:"webgpu",kernelFunc:zwe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bwe=jt({opType:Te.ACOSH}),Vwe={kernelName:Ud,backendName:"webgpu",kernelFunc:Bwe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uwe=Ns({opType:ht.ADD,cpuKernelImpl:nwe,supportsComplex:!0}),Wwe={kernelName:ic,backendName:"webgpu",kernelFunc:Uwe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jwe{constructor(e){this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e[0],this.variableNames=e.map((n,s)=>`T${s}`),this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.shaderKey="addN"}getUserCode(){const e=[];this.variableNames.forEach(r=>{e.push(`let v${r} = get${r}ByOutputCoords(coords);`)});const n=this.variableNames.map(r=>`v${r}`).join(" + ");return`
      ${Re("index")} {
        for (var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let flatIndex = index * ${this.workPerThread} + i;
          if (flatIndex < uniforms.size) {
            let coords = getCoordsFromIndex(flatIndex);
            ${e.join(`
        `)}
            setOutputAtIndex(flatIndex, ${n});
          }
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gwe(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return Qr({inputs:{x:s[0]},backend:n});const r=s.map(a=>a.dtype).reduce((a,l)=>$s(a,l)),o=s.map(a=>a.shape),i=new jwe(o);return n.runWebGPUProgram(i,s,r)}const Hwe={kernelName:jf,backendName:"webgpu",kernelFunc:Gwe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kwe{constructor(e,n){this.variableNames=["A"],this.workgroupSize=[16,16,1];const s=new Array(e.length);for(let r=0;r<s.length;r++)s[r]=e[n[r]];this.outputShape=s,this.dispatchLayout={x:[0],y:[1]},this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize,[1,1,1]),this.shaderKey="transposeShared"}getUserCode(){A(this.workgroupSize[0]===this.workgroupSize[1],()=>`Must be a square tile, current tile shape is ${this.workgroupSize[0]} x ${this.workgroupSize[1]}`);const e=this.workgroupSize[0];return`
      var<workgroup> tile : array<array<f32, ${this.workgroupSize[0]+1}>, ${this.workgroupSize[0]}>;
      ${Re()} {
        var x = i32(workgroupId.x) * ${e} + i32(localId.x);
        var y = i32(workgroupId.y) * ${e} + i32(localId.y);
        let width = uniforms.outShape[0];
        let height = uniforms.outShape[1];
        if (x < width && y < height) {
          tile[localId.y][localId.x] = f32(A[y * width + x]);
        }
        workgroupBarrier();

        x = i32(workgroupId.y) * ${e} + i32(localId.x);
        y = i32(workgroupId.x) * ${e} + i32(localId.y);
        if (x < height && y < width) {
          setOutputAtIndex((y * height + x), tile[localId.x]
            [localId.y]);
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qwe{constructor(e,n){this.variableNames=["A"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0;const s=new Array(e.length);for(let r=0;r<s.length;r++)s[r]=e[n[r]];this.outputShape=s,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.newDim=n,this.shaderKey=`transpose_${n}`}getUserCode(){const e=Hn(this.outputShape.length),n=uM(this.newDim);return`
      ${Re("index")} {
        for(var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let flatIndex = index * ${this.workPerThread} + i;
          if(flatIndex < uniforms.size) {
            let coords = getCoordsFromIndex(flatIndex);
            setOutputAtIndex(flatIndex, A[getIndexFromCoords${this.outputShape.length}D(
              ${e}(${n}), uniforms.aShape)]);
          }
        }
      }
    `}}function uM(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=new Array(e);for(let s=0;s<t.length;s++)n[t[s]]=`coords.${Fa(s)}`;return n.join()}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ca(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{perm:o}=s,i=n,a=r.shape.length,l=new Array(a);for(let c=0;c<l.length;c++)l[c]=r.shape[o[c]];if(n.shouldExecuteOnCPU([r])){const d=i.tensorMap.get(r.dataId).values,h=Pwe(d,r.shape,r.dtype,o,l);return n.makeTensorInfo(l,r.dtype,h)}if(r.shape.length===2&&Ct(o,[1,0])){const c=new Kwe(r.shape,o);return i.runWebGPUProgram(c,[r],r.dtype)}const u=new qwe(r.shape,o);return i.runWebGPUProgram(u,[r],r.dtype)}const Xwe={kernelName:Eu,backendName:"webgpu",kernelFunc:ca};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ywe{constructor(e,n,s){this.variableNames=["x"],this.uniforms="reduceSize : i32,",this.size=!0,this.inputShape=[e.batchSize,e.inSize];const[r]=qn(this.inputShape,[1]);this.outputShape=r.length===0?[1]:r,e.inSize>=32768&&s>=512?this.workgroupSize=[512,1,1]:e.inSize>=4096?this.workgroupSize=[256,1,1]:this.workgroupSize=[64,1,1],this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,[1,1,1]),this.reduceType=n,this.shaderKey=`reduce_${n}`}getUserCode(){let e="",n="0.0";const s=this.workgroupSize[0];this.reduceType==="min"||this.reduceType==="max"?(e=`
         if (isnan(candidate)) {
          bestValue = uniforms.NAN;
         } else if (!isnan(bestValue) && candidate ${this.reduceType==="min"?"<":">"} bestValue)
           {  bestValue = candidate; }`,n="f32(x[offset])"):this.reduceType==="sum"||this.reduceType==="mean"?e=" bestValue = bestValue + candidate; ":this.reduceType==="prod"?(e=" bestValue = bestValue * candidate; ",n="1.0"):this.reduceType==="all"?(e=" bestValue = f32(bestValue >= 1.0 && candidate >= 1.0); ",n="1.0"):this.reduceType==="any"&&(e=" bestValue = f32(bestValue >= 1.0 || candidate >= 1.0); ",n="0.0");const r=this.reduceType==="mean"?"setOutputAtIndex(outputIndex, bestValue / f32(uniforms.reduceSize));":"setOutputAtIndex(outputIndex, bestValue);";return`
       fn DIV_CEIL(a : u32, b : u32) -> u32 {
        return ((a - 1u) / b + 1u);
       }

       ${`
         var<workgroup> xBestValues : array<f32, ${s}>;
       `}
       fn getOffset(outputIndex : i32) -> i32 {
         let outputCoords = getCoordsFromIndex(outputIndex);
         let offset = ${this.outputShape.length===1?"outputCoords":"outputCoords[0]"} * uniforms.reduceSize;
          return offset;
       }
       ${Re("index")} {
         let outputIndex = index / ${s};
         let offset = getOffset(outputIndex);
         var bestValue = ${n};
         let Length = uniforms.reduceSize;
         let WorkPerThread = DIV_CEIL(u32(Length), ${s}u);
         for (var k = i32(localId.x); k < Length && outputIndex < uniforms.size;
             k = k + ${s}) {
           let candidate = f32(x[offset + k]);
           ${e}
         }
         xBestValues[localId.x] = bestValue;
         workgroupBarrier();

         var reduceSize = min(u32(Length), ${s}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (localId.x < currentSize) {
            let candidate = xBestValues[localId.x + interval];
            ${e}
            xBestValues[localId.x] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (localId.x == 0u && outputIndex < uniforms.size) {
          ${r}
        }
       }
     `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qwe={mean:"float32",all:"bool",any:"bool"};function Cc(t,e,n,s,r){const o=t.shape.length,i=[],a=xt(e,t.shape);let l=a;const u=an(l,o);let c=t;u!=null&&(c=ca({inputs:{x:t},attrs:{perm:u},backend:r}),l=yn(l.length,o),i.push(c)),ss(s,l,o);const[d,h]=qn(c.shape,l);let p=d;n&&(p=Wn(d,a));let f;if((s==="max"||s==="prod")&&r.shouldExecuteOnCPU([c])){const m=r.tensorMap.get(c.dataId).values;switch(s){case"max":const g=xwe(m,te(h),p,t.dtype);f=r.makeTensorInfo(p,t.dtype,g);break;case"prod":const{outVals:y,outShape:x,outDtype:v}=kwe(c.shape,c.dtype,m,l);f=r.makeTensorInfo(x,v,y);break;default:throw new Error(`${s} CPU implementation is not yet supported.`)}}else{const m=te(h),y=te(c.shape)/m,x={windowSize:m,inSize:m,batchSize:y,outSize:1},v=Qwe[s]||hw(t.dtype),b=[{type:"int32",data:[m]}],S=new Ywe(x,s,r.device.limits.maxComputeWorkgroupSizeX),C=r.runWebGPUProgram(S,[c],v,b);i.push(C),f=Ye({inputs:{x:C},attrs:{shape:p},backend:r})}return i.forEach(m=>r.disposeData(m.dataId)),f}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{keepDims:o,axis:i}=s;return Cc(r,i,o,"all",n)}const Zwe={kernelName:f0,backendName:"webgpu",kernelFunc:Jwe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{keepDims:o,axis:i}=s;return Cc(r,i,o,"any",n)}const t1e={kernelName:m0,backendName:"webgpu",kernelFunc:e1e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cM{constructor(e,n,s){this.workgroupSize=[64,1,1],this.variableNames=["x"],this.uniforms="infinityValue : f32,",this.size=!0;const r=[n];this.op=s==="min"?"<":">";const[o,i]=qn(e,r);this.outputShape=o.length===0?[1]:o,this.dispatchLayout=Ve(this.outputShape),te(i)<32?(this.type="plain",this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize)):(this.type="shared",this.dispatch=De(this.dispatchLayout,this.outputShape,[1,1,1])),this.inputShape=e,this.shaderKey=`argMinMax_${this.op}_${this.type}`}getUserCode(){const e=this.workgroupSize[0],n=()=>this.inputShape.length===1?"uniforms.xShape":`uniforms.xShape.${Fa(this.inputShape.length-1)}`,s=()=>{let r="";if(this.outputShape.length===1)this.inputShape.length!==1&&(r+="outputCoords,");else for(let o=0;o<this.outputShape.length;o++)r+=`outputCoords.${Fa(o)},`;return r};return this.type==="shared"?`
      fn DIV_CEIL(a : u32, b : u32) -> u32 {
        return ((a - 1u) / b + 1u);
      }

      ${`
      var<workgroup> xBestIndices : array<i32, ${e}>;
      var<workgroup> xBestValues : array<f32, ${e}>;
    `}

      ${Re("index")} {
        let outputIndex = index / ${e};
        let reduceLength = ${n()};

        var bestIndex = i32(localId.x);
        var bestValue = uniforms.infinityValue;
        let outputCoords = getCoordsFromIndex(outputIndex);
        for (var k = i32(localId.x); k < reduceLength && outputIndex < uniforms.size;
            k = k + ${e}) {
          let candidate = getX(${s()} k);
          if (!isnan(candidate) && candidate ${this.op} bestValue) {
            bestValue = candidate;
            bestIndex = k;
          }
        }
        xBestValues[localId.x] = bestValue;
        xBestIndices[localId.x] = bestIndex;
        workgroupBarrier();

        var reduceSize = min(u32(reduceLength), ${e}u);
        for (var currentSize = reduceSize / 2u; reduceSize > 1u;
            currentSize = reduceSize / 2u) {
          let interval = DIV_CEIL(reduceSize, 2u);
          if (localId.x < currentSize) {
            let candidate = xBestValues[localId.x + interval];
            if (candidate ${this.op} bestValue) {
              bestValue = candidate;
              xBestValues[localId.x] = bestValue;
              xBestIndices[localId.x] = xBestIndices[localId.x + interval];
            }
          }
          reduceSize = interval;
          workgroupBarrier();
        }

        if (localId.x == 0u && outputIndex < uniforms.size) {
          setOutputAtIndexI32(outputIndex, xBestIndices[localId.x]);
        }
      }
    `:`
      ${Re("index")} {
        if (index < uniforms.size) {
          let outputCoords = getCoordsFromIndex(index);
          var bestIndex = 0;
          var bestValue = getX(${s()} 0);
          let reduceLength = ${n()};
          for (var i = 1; i < reduceLength; i++) {
            let candidate = getX(${s()} i);
            if (candidate ${this.op} bestValue) {
              bestValue = candidate;
              bestIndex = i;
            }
          }
          setOutputAtIndexI32(index, bestIndex);
        }
      }
      `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;let i=xt(o,r.shape);const a=an(i,r.shape.length);let l=r;const u=[];a!=null&&(l=ca({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),i=yn(i.length,l.shape.length)),ss("argMax",[i[0]],l.shape.length);const c=new cM(l.shape,i[0],"max"),d=[{type:"float32",data:[Number.NEGATIVE_INFINITY]}],h=n.runWebGPUProgram(c,[l],"int32",d);return u.forEach(p=>n.disposeData(p.dataId)),h}const s1e={kernelName:Gf,backendName:"webgpu",kernelFunc:n1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;let i=xt(o,r.shape);const a=an(i,r.shape.length);let l=r;const u=[];a!=null&&(l=ca({inputs:{x:r},backend:n,attrs:{perm:a}}),u.push(l),i=yn(i.length,l.shape.length)),ss("argMin",[i[0]],l.shape.length);const c=new cM(l.shape,i[0],"min"),d=[{type:"float32",data:[Number.POSITIVE_INFINITY]}],h=n.runWebGPUProgram(c,[l],"int32",d);return u.forEach(p=>n.disposeData(p.dataId)),h}const o1e={kernelName:Hf,backendName:"webgpu",kernelFunc:r1e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i1e=jt({opType:Te.ASIN}),a1e={kernelName:Wd,backendName:"webgpu",kernelFunc:i1e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l1e=jt({opType:Te.ASINH}),u1e={kernelName:jd,backendName:"webgpu",kernelFunc:l1e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c1e=jt({opType:Te.ATAN}),d1e={kernelName:Gd,backendName:"webgpu",kernelFunc:c1e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h1e=Ns({opType:ht.ATAN2}),p1e={kernelName:Kd,backendName:"webgpu",kernelFunc:h1e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f1e=jt({opType:Te.ATANH}),m1e={kernelName:Hd,backendName:"webgpu",kernelFunc:f1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g1e{constructor(e){this.variableNames=["x"],this.uniforms="strides : vec2<i32>,",this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="poolWithFilterSizeEqualsOne"}getUserCode(){return`
      ${Re("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let batch = coords[0];
          let d = coords[3];

          let xRCCorner = coords.yz * uniforms.strides;
          let xRCorner = xRCCorner.x;
          let xCCorner = xRCCorner.y;

          let value = getX(batch, xRCorner, xCCorner, d);
          setOutputAtIndex(index, value);
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Af{constructor(e,n,s=!1,r=!1,o=!1){if(this.variableNames=["x"],this.uniforms="strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, convDims : vec2<i32>, filterDims : vec2<i32>,",this.workgroupSize=[128,1,1],this.size=!0,n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");this.outputShape=e.outShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.poolType=n,this.computePositions=s,this.flattenPositions=r,this.includeBatchIndex=o,this.shaderKey=`pool2D_${n}_${s}_${r}_${o}`}getUserCode(){let e;this.poolType==="avg"?e="resultValue = resultValue + value; count = count + 1.0;":this.computePositions?e=`let currMaxValue = mix(value, maxValue, maxValueFound);
      if (value >= currMaxValue) {
        maxValue = value;
        maxValueFound = 1.0;
        maxPosition = ${this.flattenPositions?this.includeBatchIndex?"((batch * uniforms.xShape[1] + xR) * uniforms.xShape[2] + xC) * uniforms.xShape[3] + d":"(xR * uniforms.xShape[2] + xC) * uniforms.xShape[3] + d":"wR * uniforms.filterDims.y + wC"};
      }`:e="resultValue = max(value, resultValue);";let n="resultValue";return this.poolType==="avg"&&(n="resultValue / max(count, 1.0)"),`
      ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
          let batch = coords[0];
          let d = coords[3];
          let xRCCorner = vec2<i32>(coords.yz) * uniforms.strides - uniforms.pads;
          let xRCorner = xRCCorner.x;
          let xCCorner = xRCCorner.y;

          ${this.computePositions?`var maxValue = 0.0;
            var maxValueFound = 0.0;
            var maxPosition = 0;`:`var resultValue = ${this.poolType==="avg"?"0.0":"-1.0 / pow(10.0, -20.0)"};`}

          var count = 0.0;
          for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + uniforms.dilations.x) {
            let xR = xRCorner + wR;

            if (xR < 0 || xR >= uniforms.convDims.x) {
              continue;
            }

            for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + uniforms.dilations.y) {
              let xC = xCCorner + wC;
              if (xC < 0 || xC >= uniforms.convDims.y) {
                continue;
              }

              let value = getX(batch, xR, xC, d);
              ${e}
            }
          }

          ${this.computePositions?"setOutputAtIndexI32(index, maxPosition);":`setOutputAtIndex(index, ${n});`}
        }
      }
    `}}class fI{constructor(e,n,s=!1,r=!1,o=!1){if(this.variableNames=["x"],this.uniforms="strides : vec3<i32>, pads : vec3<i32>, convDims : vec3<i32>, filterDims : vec3<i32>,",this.workgroupSize=[128,1,1],this.size=!0,n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");this.outputShape=e.outShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.poolType=n,this.computePositions=s,this.flattenPositions=r,this.includeBatchIndex=o,this.shaderKey=`pool3D_${n}_${s}_${r}_${o}`}getUserCode(){let e;this.poolType==="avg"?e="resultValue += value; count += 1.0;":this.computePositions?e=`let currMaxValue = mix(value, maxValue, maxValueFound);
      if (value >= currMaxValue) {
        maxValue = value;
        maxValueFound = 1.0;
        maxPosition = ${this.flattenPositions?this.includeBatchIndex?"(((batch * uniforms.xShape.y + xD) * uniforms.xShape.z + xR) * uniforms.xShape.w + xC) * uniforms.xShape.u + ch":"((xD * uniforms.xShape.z + xR) * uniforms.xShape.w + xC) * uniforms.xShape.u + ch":"wD * uniforms.filterDims.y * uniforms.filterDims.y + wR * uniforms.filterDims.z + wC"};
      }`:e="resultValue = max(value, resultValue);";let n="resultValue";return this.poolType==="avg"&&(n="resultValue / max(count, 1.0)"),`
      ${Re("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let batch = coords.x;
          let ch = coords.u;

          let xCorner = vec3<i32>(coords.y, coords.z, coords.w) * uniforms.strides - uniforms.pads;
          let xDCorner = xCorner.x;
          let xRCorner = xCorner.y;
          let xCCorner = xCorner.z;

          ${this.computePositions?`var maxValue = 0.0;
            var maxValueFound = 0.0;
            var maxPosition = 0;`:`var resultValue = ${this.poolType==="avg"?"0.0":"-1.0 / pow(10.0, -20.0)"};`}

          var count = 0.0;
          for (var wD = 0; wD < uniforms.filterDims.x; wD++) {
            let xD = xDCorner + wD;
            if (xD < 0 || xD >= uniforms.convDims.x) {
              continue;
            }

            for (var wR = 0; wR < uniforms.filterDims.y; wR++) {
              let xR = xRCorner + wR;
              if (xR < 0 || xR >= uniforms.convDims.y) {
                continue;
              }

              for (var wC = 0; wC < uniforms.filterDims.z; wC++) {
                let xC = xCCorner + wC;
                if (xC < 0 || xC >= uniforms.convDims.z) {
                  continue;
                }

                let value = getX(batch, xD, xR, xC, ch);
                ${e}
              }
            }
          }

          ${this.computePositions?"setOutputAtIndexI32(index, maxPosition);":`setOutputAtIndex(index, ${n});`}
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dM(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:o,keepDims:i}=s;return Cc(r,o,i,"max",n)}const y1e={kernelName:ym,backendName:"webgpu",kernelFunc:dM};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hM(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{keepDims:o,axis:i}=s;return Cc(r,i,o,"mean",n)}const x1e={kernelName:vm,backendName:"webgpu",kernelFunc:hM};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pM(t,e,n,s){if(e.filterWidth===1&&e.filterHeight===1&&Ct(e.inShape,e.outShape))return Qr({inputs:{x:t},backend:s});if(e.filterWidth===e.inWidth&&e.filterHeight===e.inHeight&&e.batchSize===1&&e.padInfo.type==="VALID"){const i=t.shape.length,a=Ye({inputs:{x:t},backend:s,attrs:{shape:[t.shape[i-3]*t.shape[i-2],t.shape[i-1]]}});let l;n==="avg"?l=hM({inputs:{x:a},backend:s,attrs:{axis:0,keepDims:!1}}):(A(n==="max",()=>`Invalid pool type ${n}`),l=dM({inputs:{x:a},backend:s,attrs:{reductionIndices:0,keepDims:!1}}));const u=Ye({inputs:{x:l},backend:s,attrs:{shape:e.outShape}});return s.disposeData(a.dataId),s.disposeData(l.dataId),u}let r;const o=[{type:"int32",data:[e.strideHeight,e.strideWidth]}];return e.filterHeight===1&&e.filterWidth===1?r=new g1e(e):(n==="avg"?r=new Af(e,"avg"):(A(n==="max",()=>`Invalid pool type ${n}`),r=new Af(e,"max")),o.push({type:"int32",data:[e.padInfo.top,e.padInfo.left]},{type:"int32",data:[e.dilationHeight,e.dilationWidth]},{type:"int32",data:[e.inHeight,e.inWidth]},{type:"int32",data:[e.effectiveFilterHeight,e.effectiveFilterWidth]})),s.runWebGPUProgram(r,[t],t.dtype,o)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,c=qs(r.shape,o,i,1,a,l);return pM(r,c,"avg",n)}const v1e={kernelName:Kf,backendName:"webgpu",kernelFunc:w1e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dataFormat:l,dimRoundingMode:u}=s,c=[1,1,1],d=xo(r.shape,o,i,c,a,u,l),h=new fI(d,"avg"),p=[{type:"int32",data:[d.strideDepth,d.strideHeight,d.strideWidth]},{type:"int32",data:[d.padInfo.front,d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.inDepth,d.inHeight,d.inWidth]},{type:"int32",data:[d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth]}];return n.runWebGPUProgram(h,[r],r.dtype,p)}const S1e={kernelName:qf,backendName:"webgpu",kernelFunc:b1e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C1e{constructor(e){this.variableNames=["dy"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, filterDims : vec2<i32>,
       outHeight : i32, outWidth : i32, avgMultiplier : f32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="avgPool2DBackprop"}getUserCode(){return`
      ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d = coords[3];

        let dyRCCorner = vec2<i32>(coords.yz) - uniforms.pads;
        let dyRCorner = dyRCCorner.x;
        let dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var wR = 0; wR < uniforms.filterDims[0]; wR = wR + uniforms.dilations[0]) {
          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);

          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
            continue;
          }
          let idyR = i32(dyR);

          for (var wC = 0; wC < uniforms.filterDims[1]; wC = wC + uniforms.dilations[1]) {
            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);

            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
              continue;
            }
            let idyC = i32(dyC);

            let dyValue = getDy(batch, idyR, idyC, d);

            dotProd = dotProd + dyValue * uniforms.avgMultiplier;
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}}class k1e{constructor(e){this.variableNames=["dy"],this.uniforms=`strides : vec3<i32>, pads : vec3<i32>, filterDims : vec3<i32>,
       outDepth : i32, outHeight : i32, outWidth : i32, avgMultiplier : f32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="avgPool3DBackprop"}getUserCode(){return`
      ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords.x;
        let ch = coords.u;

        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;
        let dyDCorner = dyCorner.x;
        let dyRCorner = dyCorner.y;
        let dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var wD = 0; wD < uniforms.filterDims[0]; wD++) {
          let dyD = f32(dyDCorner + wD) / f32(uniforms.strides[0]);

          if (dyD < 0.0 || dyD >= f32(uniforms.outDepth) || fract(dyD) > 0.0) {
            continue;
          }
          let idyD = i32(dyD);

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);

            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
              continue;
            }
            let idyR = i32(dyR);

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);

              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
                continue;
              }
              let idyC = i32(dyC);

              let dyValue = getDy(batch, idyD, idyR, idyC, ch);
              dotProd += dyValue * uniforms.avgMultiplier;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I1e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=s,d=xo(i.shape,a,l,1,u,c),h=new k1e(d),p=1/(d.filterDepth*d.filterHeight*d.filterWidth),f=[{type:"int32",data:[d.strideDepth,d.strideHeight,d.strideWidth]},{type:"int32",data:[d.effectiveFilterDepth-1-d.padInfo.front,d.effectiveFilterHeight-1-d.padInfo.top,d.effectiveFilterWidth-1-d.padInfo.left]},{type:"int32",data:[d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth]},{type:"int32",data:[d.outDepth]},{type:"int32",data:[d.outHeight]},{type:"int32",data:[d.outWidth]},{type:"float32",data:[p]}];return n.runWebGPUProgram(h,[r],i.dtype,f)}const $1e={kernelName:y0,backendName:"webgpu",kernelFunc:I1e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N1e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o;aM([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,c=qs(i.shape,a,l,1,u),d=new C1e(c),h=1/(c.filterHeight*c.filterWidth),p=[{type:"int32",data:[c.strideHeight,c.strideWidth]},{type:"int32",data:[c.effectiveFilterHeight-1-c.padInfo.top,c.effectiveFilterWidth-1-c.padInfo.left]},{type:"int32",data:[c.dilationHeight,c.dilationWidth]},{type:"int32",data:[c.effectiveFilterHeight,c.effectiveFilterWidth]},{type:"int32",data:[c.outHeight]},{type:"int32",data:[c.outWidth]},{type:"float32",data:[h]}];return n.runWebGPUProgram(d,[r],i.dtype,p)}const T1e={kernelName:g0,backendName:"webgpu",kernelFunc:N1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E1e(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;return k1({a:r,b:o,transposeA:i,transposeB:a,backend:n})}const R1e={kernelName:Xf,backendName:"webgpu",kernelFunc:E1e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D1e{constructor(e,n){this.variableNames=["source"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n,this.rank=n.length,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.start=e,this.uniforms=`start : ${Hn(e.length)}, `,this.shaderKey="slice"}getUserCode(){const e=Hn(this.rank),n=A1e(this.rank);let s;return this.start.length===1?s=this.outputShape.map((o,i)=>"sourceLoc = uniforms.start + coords;"):s=this.outputShape.map((o,i)=>`sourceLoc.${US[i]} = uniforms.start.${Fa(i)} + coords.${US[i]};`),`
      ${Re("index")} {
        if (index < uniforms.size) {
          var sourceLoc : ${e};
          let coords = getCoordsFromIndex(index);
          ${s.join(`
`)}
          setOutputAtIndex(index, getSource(${n}));
        }
      }
    `}}const US=["x","y","z","w","u","v"];function A1e(t){if(t===1)return"sourceLoc";if(t<=6)return US.slice(0,t).map(e=>`sourceLoc.${e}`).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jh(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,size:i}=s,[a,l]=Qm(r,o,i);if(zw(r,a,l),n.shouldExecuteOnCPU([r])||r.dtype==="string"){const d=n.tensorMap.get(r.dataId),h=Ewe(d.values,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,h)}if(te(l)===0)return n.makeTensorInfo(l,r.dtype,[]);const u=new D1e(a,l),c=[{type:"int32",data:a}];return n.runWebGPUProgram(u,[r],r.dtype,c)}const _1e={kernelName:Om,backendName:"webgpu",kernelFunc:Jh};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F1e=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,crops:i}=s;A(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGPU backend not implemented yet");const a=o.reduce((x,v)=>x*v),l=hc(r.shape,o,a),u=pc(l.length,o.length),c=fc(r.shape,o,a),d=jw(i,o.length),h=Gw(c,i,o.length),p=[],f=Ye({inputs:{x:r},backend:n,attrs:{shape:l}}),m=ca({inputs:{x:f},backend:n,attrs:{perm:u}}),g=Ye({inputs:{x:m},backend:n,attrs:{shape:c}}),y=Jh({inputs:{x:g},backend:n,attrs:{begin:d,size:h}});return p.push(f),p.push(m),p.push(g),p.forEach(x=>n.disposeData(x.dataId)),y},P1e={kernelName:Yf,backendName:"webgpu",kernelFunc:F1e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O1e=`
  fn bincount_write(index: i32, value: f32) {
    ${Ql("&result[index]","value","float32")}
  }
`,L1e=`
  fn bincount_write(index: i32, value: f32) {
    atomicStore(&result[index], bitcast<i32>(value));
  }
`;class fM{constructor(e,n,s=!1){this.outputShape=[],this.variableNames=["x"],this.uniforms="binCountSize : i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.hasWeights=!0,this.binaryOutput=!1,this.outputShape=e,this.rank=e.length,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.binaryOutput=s,s&&(this.atomic=!1),this.hasWeights=n,this.hasWeights&&this.variableNames.push("w"),this.shaderKey=`bincount_${this.hasWeights}_${this.binaryOutput}_${this.rank}`}getUserCode(){return`
    ${this.binaryOutput?L1e:O1e}
  ${Re("index")} {
    ${this.rank===1?`if (index < uniforms.xShape) {
      let indexVal = i32(getX(index));
      if (indexVal < uniforms.binCountSize) {
        let value = ${this.binaryOutput?1:this.hasWeights?"getW(index)":"1."};
        bincount_write(indexVal, value);
      }
    }`:`let coord = getCoordsFromIndex(index);
    if (coordsInBounds2D(coord, uniforms.xShape)) {
      let indexVal = i32(getX(coord[0], coord[1]));
      if (indexVal < uniforms.binCountSize) {
        let value = ${this.binaryOutput?1:this.hasWeights?"getW(coord[0], coord[1])":"1."};
        bincount_write(coord.x * uniforms.binCountSize + indexVal, value);
      }
    }`}
  }
  `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i}=s,a=te(r.shape),u=te(o.shape)>0,c=[i],d=o.dtype,h=Cr({backend:n,attrs:{shape:c,value:0,dtype:d}}),p=new fM([a],u),f=[{type:"int32",data:[i]}],m=u?[r,o]:[r];return n.runWebGPUProgram(p,m,d,f,h)}const M1e={kernelName:x0,backendName:"webgpu",kernelFunc:z1e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B1e{constructor(e){this.outputShape=[],this.variableNames=["s0","s1"],this.uniforms="s0Size : i32, s1Size : i32, ",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e],this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="broadcastArgs"}getUserCode(){return`
  ${Re("index")} {
    if (index < uniforms.size) {
      var s0 = 1.0;
      var s1 = 1.0;
      let indexS0 = index - uniforms.size + uniforms.s0Size;
      let indexS1 = index - uniforms.size + uniforms.s1Size;
      if (indexS0 >= 0) {
        s0 = getS0(indexS0);
      }
      if (indexS1 >= 0) {
        s1 = getS1(indexS1);
      }

      if (s0 == 1.0) {
        setOutputAtIndex(index, s1);
      } else if (s1 == 1.0) {
        setOutputAtIndex(index, s0);
      } else if (s0 != s1) {
        setOutputAtIndex(index, uniforms.NAN);
      } else {
        setOutputAtIndex(index, s0);
      }
    }
  }
  `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V1e(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e;if(n.shouldExecuteOnCPU([s,r])){const c=n.tensorMap.get(s.dataId),d=n.tensorMap.get(r.dataId),h=c.values,p=d.values,f=ct(Array.from(h),Array.from(p));return n.makeTensorInfo([f.length],"int32",Int32Array.from(f))}const o=te(s.shape),i=te(r.shape),a=Math.max(o,i),l=new B1e(a),u=[{type:"int32",data:[o]},{type:"int32",data:[i]}];return n.runWebGPUProgram(l,[s,r],"int32",u)}const U1e={kernelName:v0,backendName:"webgpu",kernelFunc:V1e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mM=Ns({opType:ht.NOT_EQUAL,dtype:"bool",cpuKernelImpl:Cwe}),W1e={kernelName:km,backendName:"webgpu",kernelFunc:mM};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fg(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.tensorMap.get(s.dataId);return Qr({inputs:{x:r.complexTensorInfos.real},backend:n})}const j1e={kernelName:X0,backendName:"webgpu",kernelFunc:fg};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G1e(t,e){const n=new Qh(t.shape,Te.TO_INT),s=e.runWebGPUProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WS(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return Qr({inputs:{x:r},backend:n});const i=Gn(r.shape),a=WS({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),l=Sc({inputs:{real:a,imag:i},backend:n});return i.dispose(),n.disposeData(a.dataId),l}if(r.dtype==="complex64"){const i=fg({inputs:{input:r},backend:n}),a=WS({inputs:{x:i},backend:n,attrs:{dtype:o}});return n.disposeData(i.dataId),a}if(!c2(r.dtype,o)){const i=Qr({inputs:{x:r},backend:n});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(n.shouldExecuteOnCPU([r])){const i=n.tensorMap.get(r.dataId).values,[a,l,u]=swe(i,r.shape,r.dtype,o);return n.makeTensorInfo(a,l,u)}if(o==="int32")return G1e(r,n);if(o==="bool"){const i=n.makeTensorInfo([],"bool",ps("bool",1)),l=mM({inputs:{a:r,b:i},backend:n});return n.disposeData(i.dataId),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const H1e={kernelName:qd,backendName:"webgpu",kernelFunc:WS};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K1e=jt({opType:Te.CEIL,cpuKernelImpl:rwe}),q1e={kernelName:Xd,backendName:"webgpu",kernelFunc:K1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X1e{constructor(e){this.variableNames=["A"],this.uniforms="minVal : f32, maxVal : f32,",this.workPerThread=4,this.workgroupSize=[64,1,1],this.outputComponent=4,this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.shaderKey="clipVec4"}getUserCode(){return`
      ${Re("index")} {
        if(index < uniforms.size) {
          let value = getAByOutputIndex(index);
          var clampedValue = clamp(
              value, vec4<f32>(uniforms.minVal), vec4<f32>(uniforms.maxVal));
          clampedValue = select(clampedValue, value, isnanVec4(value));
          setOutputAtIndex(index, clampedValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y1e{constructor(e){this.variableNames=["A"],this.uniforms="minVal : f32, maxVal : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="clip"}getUserCode(){return`
      ${Re("index")} {
        if(index < uniforms.size) {
          let value = getAByOutputIndex(index);
          if (isnan(value)) {
            setOutputAtIndex(index, value);
            return;
          }
          setOutputAtIndex(index, clamp(value, uniforms.minVal, uniforms.maxVal));
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{clipValueMin:o,clipValueMax:i}=s;let a;const l=[{type:"float32",data:[o]},{type:"float32",data:[i]}];return te(r.shape)%4===0?a=new X1e(r.shape):a=new Y1e(r.shape),n.runWebGPUProgram(a,[r],r.dtype,l)}const J1e={kernelName:Yd,backendName:"webgpu",kernelFunc:Q1e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z1e{constructor(e){this.outputShape=[],this.variableNames=["real","imag"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="complexAbs"}getUserCode(){return`
    ${Re("index")} {
      if (index < uniforms.size) {
        let re = abs(getRealByOutputIndex(index));
        let im = abs(getImagByOutputIndex(index));
        let mx = max(re, im);

        // The length function in wgsl may be not underflow-safe on some GPUs.
        // So the safe solution is to ensure underflow-safety in all cases.
        setOutputAtIndex(index, select(mx * length(vec2<f32>(1, min(re, im)/mx)), 0.0, mx == 0.0));
      }
    }
  `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vE(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function eve(t){const{inputs:e,backend:n}=t,{x:s}=e,r=n.tensorMap.get(s.dataId),o=new Z1e(s.shape),i=[vE(s,r.complexTensorInfos.real),vE(s,r.complexTensorInfos.imag)];return n.runWebGPUProgram(o,i,i[0].dtype)}const tve={kernelName:Qf,backendName:"webgpu",kernelFunc:eve};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nve{constructor(e){this.uniforms="",this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=Sr(e,1),this.variableNames=e.map((n,s)=>`T${s}`),this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.offsetLength=e.length-1;for(let n=0;n<this.offsetLength;n++)this.uniforms+=`offset${n} : i32,`;this.shaderKey="concat"}getUserCode(){const e=[];if(this.offsetLength>0){e.push("if (yC < uniforms.offset0){ setOutputAtCoords(coords.x, coords.y, getT0(yR, yC)); }");for(let o=1;o<this.offsetLength;o++)e.push(`else if (yC < uniforms.offset${[o]}){ setOutputAtCoords(coords.x, coords.y, getT${o}(yR, yC - uniforms.offset${o-1})); }`);const s=this.offsetLength,r=this.offsetLength-1;e.push(`else { setOutputAtCoords(coords.x, coords.y, getT${s}(yR, yC - uniforms.offset${r})); }`)}else e.push("setOutputAtCoords(coords.x, coords.y, getT0(yR, yC));");return`
      ${Re("index")} {
        for(var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let flatIndex = index * ${this.workPerThread} + i;
          if(flatIndex < uniforms.size) {
            let coords = getCoordsFromIndex(flatIndex);
            let yR = coords.x;
            let yC = coords.y;

            ${e.join(`
        `)}
          }
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I1(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.tensorMap.get(s.dataId);return Qr({inputs:{x:r.complexTensorInfos.imag},backend:n})}const sve={kernelName:M0,backendName:"webgpu",kernelFunc:I1};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fp(t,e,n){const s=t[0].dtype;if(s==="complex64"){const f=t.map(v=>fg({inputs:{input:v},backend:n})),m=t.map(v=>I1({inputs:{input:v},backend:n})),g=Fp(f,e,n),y=Fp(m,e,n),x=Sc({inputs:{real:g,imag:y},backend:n});return f.forEach(v=>n.disposeData(v.dataId)),m.forEach(v=>n.disposeData(v.dataId)),n.disposeData(g.dataId),n.disposeData(y.dataId),x}let r=n.shouldExecuteOnCPU(t);if(s==="string"&&(r=!0),r){const f=t.map(S=>{const I=[-1,te(S.shape.slice(e))];return Ye({inputs:{x:S},backend:n,attrs:{shape:I}})}),m=f.map(S=>({vals:n.readSync(S.dataId),shape:S.shape})),g=Sr(f.map(S=>S.shape),1),y=f[0].shape[0]===1,x=owe(m,g,s,y),v=Sr(t.map(S=>S.shape),e),b=n.makeTensorInfo(v,s,x);return f.forEach(S=>n.disposeData(S.dataId)),b}const o=n.device.limits.maxStorageBuffersPerShaderStage-1;if(t.length>o){const f=[];for(let g=0;g<t.length;g+=o){const y=t.slice(g,g+o);f.push(Fp(y,e,n))}const m=Fp(f,e,n);for(const g of f)n.disposeData(g.dataId);return m}const{tensors2D:i,outShape:a}=rve(t,e,n),l=i.map(f=>f.shape),u=new nve(l),c=[],d=new Array(l.length-1);if(d.length>0){d[0]=l[0][1],c.push({type:"int32",data:[d[0]]});for(let f=1;f<d.length;f++)d[f]=d[f-1]+l[f][1],c.push({type:"int32",data:[d[f]]})}const h=n.runWebGPUProgram(u,i,i[0].dtype,c);i.forEach(f=>n.disposeData(f.dataId));const p=Ye({inputs:{x:h},backend:n,attrs:{shape:a}});return n.disposeData(h.dataId),p}function rve(t,e,n){const s=Sr(t.map(o=>o.shape),e);return{tensors2D:t.map(o=>Ye({inputs:{x:o},backend:n,attrs:{shape:[te(o.shape.slice(0,e)),te(o.shape.slice(e))]}})),outShape:s}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gM(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,o=xt(r,e[0].shape)[0],i=e.map(u=>u.shape);Vw(i,o);const a=Sr(e.map(u=>u.shape),o);if(te(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>te(u.shape)>0);return l.length===1?Qr({inputs:{x:l[0]},backend:n}):Fp(l,o,n)}const ove={kernelName:Jf,backendName:"webgpu",kernelFunc:gM};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ive(t,e,n,s,r=!1,o=null,i=!1,a=4,l=4,u=4){const c=R=>{switch(R){case 1:return"resData = f32(x[xIndex]);";case 3:return"resData = vec3<f32>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);";case 4:return"resData = vec4<f32>(x[xIndex / 4]);";default:throw new Error(`innerElementSize ${R} is not supported.`)}},d=R=>{switch(R){case 1:return"return f32(W[row * uniforms.wShape[3] + col]);";case 4:return"return vec4<f32>(W[(row * uniforms.wShape[3] + col) / 4]);";default:throw new Error(`innerElementSize ${R} is not supported.`)}},h=t?`
      let coord = vec4<i32>(batch, xRow, xCol, xCh);
      `:`
      let coord = vec4<i32>(batch, xCh, xRow, xCol);
      `,p=t?`
      let coords = vec4<i32>(
        batch,
        row / outWidth,
        row % outWidth,
        col);
      `:`
      let coords = vec4<i32>(
        batch,
        row,
        col / outWidth,
        col % outWidth);
      `,f=t?"uniforms.xShape[1]":"uniforms.xShape[2]",m=t?"uniforms.xShape[2]":"uniforms.xShape[3]",g=t?"row":"col",y=t?"col":"row",x=`
      let inChannels = uniforms.wShape[2];
      let outWidth = ${t?"uniforms.outShape[2]":"uniforms.outShape[3]"};
      let outRow = ${g} / outWidth;
      let outCol = ${g} % outWidth;

      let WRow = ${y} / (uniforms.filterDims[1] * inChannels);
      let WCol = ${y} / inChannels % uniforms.filterDims[1];
      let xRow = outRow * uniforms.strides[0] + uniforms.dilations[0] * WRow - uniforms.pads[0];
      let xCol = outCol * uniforms.strides[1] + uniforms.dilations[1] * WCol - uniforms.pads[1];
      let xCh = ${y} % inChannels;
      var resData = ${kt(a)}(0.0);
      // The bounds checking is always needed since we use it to pad zero for
      // the 'same' padding type.
      if (xRow >= 0 && xRow < ${f} && xCol >= 0 && xCol < ${m}) {
        ${h}
        let xIndex = getIndexFromCoords4D(coord, uniforms.xShape);
        ${c(a)}
      }
      return resData;`,v=t?e&&s?`
      ${x}`:`
      if (row < uniforms.dimAOuter && col < uniforms.dimInner) {
        ${x}
      }
      return ${kt(a)}(0.0);`:s&&n?`
      ${x}`:`
      if (row < uniforms.dimInner && col < uniforms.dimBOuter) {
        ${x}
      }
      return ${kt(a)}(0.0);`,b=`${d(l)}`,S=kt(u),C=kt(t?a:l),I=kt(t?l:a);return`
      ${Ka(o,i,u===4,4)}
      fn mm_readA(batch: i32, row : i32, col : i32) -> ${C} {
        ${t?v:b}
      }

      fn mm_readB(batch: i32, row : i32, col : i32) -> ${I} {
        ${t?b:v}
      }

      fn mm_write(batch: i32, row : i32, col : i32, valueIn : ${S}) {
        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)
        {
        var value = valueIn;
        let outWidth = ${t?"uniforms.outShape[2]":"uniforms.outShape[3]"};
        ${p}
        ${bc(r,o)}
        setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
        }
      }`}class ave{constructor(e,n,s,r,o=!1,i=null,a=!1,l=!1){this.variableNames=["x","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, dilations : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=e.outShape,this.isChannelsLast=e.dataFormat==="channelsLast",this.isVec4=((e.inChannels%4===0||e.inChannels%3===0)&&this.isChannelsLast||e.outWidth%4===0&&!this.isChannelsLast)&&e.outChannels%4===0,this.dispatchLayout=this.isChannelsLast?{x:[3],y:[1,2],z:[0]}:{x:[2,3],y:[1],z:[0]},this.workgroupSize=rM(this.dispatchLayout,this.outputShape,this.isVec4),this.elementsPerThread=oM(this.dispatchLayout,this.outputShape,this.isVec4),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread),this.isVec4?(this.outputComponent=4,this.isChannelsLast&&e.inChannels%4!==0?(this.innerElementSize=3,this.variableComponents=[1,4]):(this.innerElementSize=4,this.variableComponents=[4,4]),o&&(this.variableNames.push("bias"),this.variableComponents.push(4)),a&&(this.variableNames.push("preluActivationWeights"),this.variableComponents.push(4))):(this.innerElementSize=this.elementsPerThread[0],o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights")),this.sequentialAccessByThreads=l,this.addBias=o,this.activation=i,this.hasPreluActivationWeights=a,this.tileAOuter=this.workgroupSize[1]*this.elementsPerThread[1],this.tileBOuter=this.workgroupSize[0]*this.elementsPerThread[0],this.tileInner=Math.max(this.workgroupSize[0]*this.innerElementSize,this.workgroupSize[1]),this.fitAOuter=n%this.tileAOuter===0,this.fitBOuter=s%this.tileBOuter===0,this.fitInner=r%this.tileInner===0,this.shaderKey=`conv2DMM_${this.elementsPerThread}_${this.activation}}_${this.fitAOuter}_${this.fitBOuter}_${this.fitInner}_${this.isVec4}_${this.innerElementSize}_${this.isChannelsLast}_${this.sequentialAccessByThreads}`}getUserCode(){const e=this.isVec4?S1(this.elementsPerThread,this.workgroupSize,!this.isChannelsLast,this.tileInner):C1(this.elementsPerThread,this.workgroupSize,!this.isChannelsLast,this.tileInner,!1,null,this.sequentialAccessByThreads),n=this.isVec4?[this.innerElementSize,4,4]:[1,1,1];return`
    ${ive(this.isChannelsLast,this.fitAOuter,this.fitBOuter,this.fitInner,this.addBias,this.activation,this.hasPreluActivationWeights,n[0],n[1],n[2])}
    ${e}
  `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lve{constructor(e,n=!1,s=null,r=!1){this.variableNames=["x","W"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>,",this.workgroupSize=[4,4,8],this.outputShape=e.outShape,this.isChannelsLast=e.dataFormat==="channelsLast",this.dispatchLayout=this.isChannelsLast?{x:[2],y:[1],z:[0,3]}:{x:[3],y:[2],z:[0,1]},this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.addBias=n,this.activation=s,this.hasPreluActivationWeights=r,n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.shaderKey=`conv2dnaive_${this.activation}_${this.isChannelsLast}`}getUserCode(){return`
       ${Ka(this.activation,this.hasPreluActivationWeights,!1,4)}
       fn readInp(batch : i32, row : i32, col : i32, chan : i32) -> f32{
         let coords = vec4<i32>(batch, row, col, chan);
         if (coordsInBounds4D(coords, uniforms.xShape)) {
           return  getX(batch, row, col, chan);
         } else {
          return 0.0;
         }
       }
       fn readFilt(row : i32, col : i32, xChannel : i32, outChannel : i32) -> f32{
         let coords = vec4<i32>(row, col, xChannel, outChannel);
         if(coordsInBounds4D(coords, uniforms.wShape)) {
           return getW(row, col, xChannel, outChannel);
          } else {
            return 0.0;
          }
       }
       fn writeResult(batch : i32, row : i32, col : i32, chan : i32, valueIn : f32) {
         let coords = ${this.isChannelsLast?"vec4<i32>(batch, row, col, chan);":"vec4<i32>(batch, chan, row, col);"}
         if (coordsInBounds4D(coords, uniforms.outShape)) {
           var value = valueIn;
           ${bc(this.addBias,this.activation)}
           setOutputAtCoords(coords.x, coords.y, coords.z, coords.w, value);
         }
       }
       ${Re("index")} {
         let coords = getOutputCoords();
         let batch = coords[0];
         let outChannel = ${this.isChannelsLast?"coords[3];":"coords[1];"}
         let outRow = ${this.isChannelsLast?"coords[1];":"coords[2];"}
         let outCol = ${this.isChannelsLast?"coords[2];":"coords[3];"}
         var acc : f32 = 0.0;
         for (var row = 0; row < uniforms.filterDims[0]; row = row + 1) {
           for (var col = 0; col < uniforms.filterDims[1]; col = col + 1) {
             let xRow = outRow * uniforms.strides[0] + uniforms.dilations[0] * row - uniforms.pads[0];
             let xCol = outCol * uniforms.strides[1] + uniforms.dilations[1] * col - uniforms.pads[1];
             for (var xChannel = 0; xChannel < ${this.isChannelsLast?"uniforms.xShape[3];":"uniforms.xShape[1];"} xChannel = xChannel + 1) {
               ${this.isChannelsLast?"let v = readInp(batch, xRow, xCol, xChannel);":"let v = readInp(batch, xChannel, xRow, xCol);"}
               let f = readFilt(row, col, xChannel, outChannel);
               acc = acc + v * f;
             }
           }
         }
         writeResult(batch, outRow, outCol, outChannel, acc);
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uve{constructor(e,n){this.variableNames=["x"],this.uniforms=`pads : vec2<i32>, strides : vec2<i32>, dilations : vec2<i32>, outWidth : i32, itemsPerBlockRow : i32,
       inChannels : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=n,this.shaderKey=`im2col_${this.isChannelsLast}`}getUserCode(){const e=this.isChannelsLast?1:2,n=this.isChannelsLast?2:3,s=this.isChannelsLast?"coords[1]":"coords[2]",r=this.isChannelsLast?"coords[2]":"coords[1]",o=this.isChannelsLast?"getX(batch, xRow, xCol, ch)":"getX(batch, ch, xRow, xCol)";return`
    ${Re("index")} {
      let coords = getCoordsFromIndex(index);
      if(index < uniforms.size) {
        let batch = coords[0];
        let row = ${s};
        let col = ${r};
        let offsetY = (row / uniforms.outWidth) * uniforms.strides[0] - uniforms.pads[0];
        let xRow = offsetY + uniforms.dilations[0] * (col / uniforms.itemsPerBlockRow);
        var value = 0.0;
        if(xRow < uniforms.xShape[${e}] && xRow >= 0) {
          let offsetX = (row % uniforms.outWidth) * uniforms.strides[1] -
              uniforms.pads[1];
          let xCol = offsetX + uniforms.dilations[1] * ((col %
              uniforms.itemsPerBlockRow) / uniforms.inChannels);
          let ch = col % uniforms.inChannels;
          if(xCol < uniforms.xShape[${n}] && xCol >= 0) {
            value = ${o};
          }
        }
        setOutputAtIndex(index, value);
      }
    }
   `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mx(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function cve({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const l=n.dataFormat==="channelsLast",u=!l,c=!1,d=l&&n.filterHeight===n.inHeight&&n.filterWidth===n.inWidth&&n.padInfo.type==="VALID",h=[];let p,f;if(d){const y=n.inHeight*n.inWidth*n.inChannels;p=Ye({inputs:{x:t},backend:s,attrs:{shape:[1,n.batchSize,y]}}),f=Ye({inputs:{x:e},backend:s,attrs:{shape:[1,y,n.outChannels]}})}else p=Ye({inputs:{x:t},backend:s,attrs:{shape:l?[n.batchSize,n.inHeight*n.inWidth,n.inChannels]:[n.batchSize,n.inChannels,n.inHeight*n.inWidth]}}),f=Ye({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});if(h.push(p),h.push(f),o!=null){const y=Mx(o.shape,l);y!=null&&(o=Ye({inputs:{x:o},backend:s,attrs:{shape:y}}),h.push(o))}if(r!=null){const y=Mx(r.shape,l);y!=null&&(r=Ye({inputs:{x:r},backend:s,attrs:{shape:y}}),h.push(r))}const m=k1({a:l?p:f,b:l?f:p,transposeA:u,transposeB:c,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),g=Ye({inputs:{x:m},backend:s,attrs:{shape:n.outShape}});h.push(m);for(const y of h)s.disposeData(y.dataId);return g}function dve({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:c,strideWidth:d,strideHeight:h,padInfo:p,outWidth:f,outHeight:m,dilationWidth:g,dilationHeight:y,dataFormat:x}=n,v=x==="channelsLast",b=l*u*c,S=m*f,C=v?[n.batchSize,S,b]:[n.batchSize,b,S],I=new uve(C,v),T=[{type:"int32",data:[p.top,p.left]},{type:"int32",data:[h,d]},{type:"int32",data:[y,g]},{type:"int32",data:[f]},{type:"int32",data:[c*l]},{type:"int32",data:[c]}],R=s.runWebGPUProgram(I,[t],t.dtype,T),_=[];_.push(R);const P=Ye({inputs:{x:e},backend:s,attrs:{shape:[1,b,-1]}});if(_.push(P),o!=null){const Q=Mx(o.shape,v);Q!=null&&(o=Ye({inputs:{x:o},backend:s,attrs:{shape:Q}}),_.push(o))}if(r!=null){const Q=Mx(r.shape,v);Q!=null&&(r=Ye({inputs:{x:r},backend:s,attrs:{shape:Q}}),_.push(r))}const V=k1({a:v?R:P,b:v?P:R,transposeA:!v,transposeB:!1,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),H=Ye({inputs:{x:V},backend:s,attrs:{shape:n.outShape}});_.push(V);for(const Q of _)s.disposeData(Q.dataId);return H}function yM({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const l=r!=null,u=o!=null,c=n.dataFormat==="channelsLast",d=c&&n.filterHeight===n.inHeight&&n.filterWidth===n.inWidth&&n.padInfo.type==="VALID",h=re().getBool("WEBGPU_USE_NAIVE_CONV2D_DEBUG");if(!h&&(d||n.filterHeight===1&&n.filterWidth===1&&n.dilationHeight===1&&n.dilationWidth===1&&n.strideHeight===1&&n.strideWidth===1&&(n.padInfo.type==="SAME"||n.padInfo.type==="VALID")))return cve({x:t,filter:e,convInfo:n,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i});const p=re().getNumber("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL"),f=p>-1?p:s.thresholdToIncreaseWorkgroups,m=n.batchSize*Math.ceil(n.outHeight*n.outWidth/32)*Math.ceil(n.outChannels/32);if(re().getBool("WEBGPU_CONV_SEPARATE_IM2COL_SHADER")||m<=f)return dve({x:t,filter:e,convInfo:n,backend:s,bias:r,preluActivationWeights:o,leakyreluAlpha:i,activation:a});let g;const y=[n.padInfo.top,n.padInfo.left],x=[{type:"int32",data:[n.filterHeight,n.filterWidth]},{type:"int32",data:[...y]},{type:"int32",data:[n.strideHeight,n.strideWidth]},{type:"int32",data:[n.dilationHeight,n.dilationWidth]}];if(h)g=new lve(n,l,a,u);else{const C=c?n.outHeight*n.outWidth:n.outChannels,I=c?n.outChannels:n.outHeight*n.outWidth,T=n.filterHeight*n.filterWidth*n.inChannels;x.push({type:"int32",data:[C]},{type:"int32",data:[I]},{type:"int32",data:[T]});const R=s.adapterInfo.isIntel();g=new ave(n,C,I,T,l,a,u,R)}const v=[],b=[t,e];l&&(!c&&r.shape.length===1&&(r=Ye({inputs:{x:r},backend:s,attrs:{shape:[r.shape[0],1,1]}}),v.push(r)),b.push(r)),u&&(!c&&o.shape.length===1&&(o=Ye({inputs:{x:o},backend:s,attrs:{shape:[o.shape[0],1,1]}}),v.push(o)),b.push(o)),a==="leakyrelu"&&(x.push({type:"float32",data:[i]}),g.uniforms+=" alpha : f32,");const S=s.runWebGPUProgram(g,b,t.dtype,x);for(const C of v)s.disposeData(C.dataId);return S}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hve(t){const{inputs:e,attrs:n,backend:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=n,d=Zr(l),h=gn(r.shape,o.shape,i,u,a,c,!1,d);return yM({x:r,filter:o,convInfo:h,backend:s})}const pve={kernelName:Zf,backendName:"webgpu",kernelFunc:hve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fve{constructor(e){this.variableNames=["dy","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, outBackprop : vec4<i32>,",this.workgroupSize=[64,1,1],this.size=!1,this.isVec4=!1,this.workPerThread=1,this.outputShape=e.inShape,this.isChannelsLast=e.dataFormat==="channelsLast",this.isVec4=this.isChannelsLast&&e.outChannels%4===0&&e.inChannels%4===0,this.isVec4?(this.workPerThread=2,this.outputComponent=4,this.workgroupSize=[4,4,4],this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize,[4,this.workPerThread,1])):(this.size=!0,this.workPerThread=1,this.workgroupSize=[64,1,1],this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize)),this.shaderKey=`conv2DDerInput_${this.isChannelsLast}_${this.isVec4}_${this.workPerThread}`}getUserCode(){const e=this.isChannelsLast?1:2,n=this.isChannelsLast?2:3,s=this.isChannelsLast?3:1,r=`
    ${Re()} {
      let batch = i32(globalId.z) / uniforms.outShape[1];
      let r = i32(globalId.z) % uniforms.outShape[1];
      let c = i32(globalId.y) * ${this.workPerThread};
      let d1 = i32(globalId.x) * 4;

      let dyCorner = vec2<i32>(r, c) - uniforms.pads;

      // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
      // ? = to be determined. : = across all values in that axis.
      var dotProd: array<vec4<f32>, ${this.workPerThread}>;
      for (var i = 0; i < ${this.workPerThread}; i++) {
        dotProd[i] = vec4<f32>(0.0);
      }
      for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + 1) {
        let dyR = f32(dyCorner.x + wR) / f32(uniforms.strides.x);
        let wRPerm = uniforms.filterDims.x - 1 - wR;
        if (dyR < 0.0 || dyR >= f32(uniforms.outBackprop[1]) ||
            fract(dyR) > 0.0) {
          continue;
        }
        let idyR = i32(dyR);

        for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + 1) {
          let dyC = f32(dyCorner.y + wC) / f32(uniforms.strides.y);
          let dyC2 = f32(dyCorner.y + 1 + wC) / f32(uniforms.strides.y);
          let wCPerm = uniforms.filterDims.y - 1 - wC;
          var bDyCVal = true;
          var bDyCVal2 = true;
          if (dyC < 0.0 || dyC >= f32(uniforms.outBackprop[2]) ||
              fract(dyC) > 0.0) {
            bDyCVal = false;
          }
          if (dyC2 < 0.0 || dyC2 >= f32(uniforms.outBackprop[2]) ||
              fract(dyC2) > 0.0) {
            bDyCVal2 = false;
          }

          let idyC = i32(dyC);
          let idyC2 = i32(dyC2);
          if (bDyCVal && bDyCVal2) {
            let d2Length = uniforms.outBackprop[3];
            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {
              let wValue0 = getW(wRPerm, wCPerm, d1, d2);
              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);
              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);
              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);
              var xValue =  getDy(batch, idyR, idyC, d2);
              let tmpval = vec4<f32>(dot(xValue, wValue0),
                                     dot(xValue, wValue1),
                                     dot(xValue, wValue2),
                                     dot(xValue, wValue3));
              dotProd[0] = dotProd[0] + tmpval;
              xValue = getDy(batch, idyR, idyC2, d2);
              dotProd[1] = dotProd[1] + vec4<f32>(dot(xValue, wValue0),
                                                  dot(xValue, wValue1),
                                                  dot(xValue, wValue2),
                                                  dot(xValue, wValue3));
            }
          } else if (bDyCVal) {
            let d2Length = uniforms.outBackprop[3];
            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {
              let wValue0 = getW(wRPerm, wCPerm, d1, d2);
              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);
              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);
              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);
              var xValue =  getDy(batch, idyR, idyC, d2);
              let tmpval = vec4<f32>(dot(xValue, wValue0),
                                     dot(xValue, wValue1),
                                     dot(xValue, wValue2),
                                     dot(xValue, wValue3));
              dotProd[0] = dotProd[0] + tmpval;
            }
          } else if (bDyCVal2) {
            let d2Length = uniforms.outBackprop[3];
            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {
              let wValue0 = getW(wRPerm, wCPerm, d1, d2);
              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);
              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);
              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);
              var xValue =  getDy(batch, idyR, idyC2, d2);
              let tmpval = vec4<f32>(dot(xValue, wValue0),
                                     dot(xValue, wValue1),
                                     dot(xValue, wValue2),
                                     dot(xValue, wValue3));
              dotProd[1] = dotProd[1] + tmpval;
            }
          }
        }
      }

      for (var i = 0; i < ${this.workPerThread}; i = i + 1) {
        let coords = vec4<i32>(batch, r, c + i, d1);
        if (coordsInBounds4D(coords, uniforms.outShape)) {
          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], dotProd[i]);
        }
      }
    }
    `;return this.isVec4?`
    ${r}
    `:`
    ${Re("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d1 = coords[${s}];

        let dyCorner = vec2<i32>(coords[${e}], coords[${n}]) - uniforms.pads;
        let dyRCorner = dyCorner.x;
        let dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + 1) {
          let dyR = (f32(dyRCorner) + f32(wR)) / f32(uniforms.strides.x);
          let wRPerm = uniforms.filterDims.x - 1 - wR;
          if (dyR < 0.0 || dyR >= f32(uniforms.outBackprop[1]) || fract(dyR) > 0.0 ||
              wRPerm < 0) {
            continue;
          }
          let idyR = i32(dyR);

          for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + 1) {
            let dyC = (f32(dyCCorner) + f32(wC)) / f32(uniforms.strides.y);
            let wCPerm = uniforms.filterDims.y - 1 - wC;
            if (dyC < 0.0 || dyC >= f32(uniforms.outBackprop[2]) ||
                fract(dyC) > 0.0 || wCPerm < 0) {
              continue;
            }
            let idyC = i32(dyC);

            for (var d2 = 0; d2 < uniforms.outBackprop[3]; d2 = d2 + 1) {
              let xValue = ${this.isChannelsLast?"getDy(batch, idyR, idyC, d2)":"getDy(batch, d2, idyR, idyC)"};
              let wValue = getW(wRPerm, wCPerm, d1, d2);
              dotProd = dotProd + xValue * wValue;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}}class mve{constructor(e){this.variableNames=["x","dy"],this.uniforms="pads : vec2<i32>, strides : vec2<i32>, batchSize : i32, outHeight : i32, outWidth : i32, inHeight : i32, inWidth : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.filterShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=e.dataFormat==="channelsLast",this.shaderKey=`conv2DDerFilter_${this.isChannelsLast}`}getUserCode(){return`
    ${Re("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let wR = coords[0];
        let wC = coords[1];
        let d1 = coords[2];
        let d2 = coords[3];

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var b = 0; b < uniforms.batchSize; b = b + 1) {
          for (var yR = 0; yR < uniforms.outHeight; yR = yR + 1) {
            let xR = wR + yR * uniforms.strides[0] - uniforms.pads[0];
            if (xR < 0 || xR >= uniforms.inHeight) {
              continue;
            }

            for (var yC = 0; yC < uniforms.outWidth; yC = yC + 1) {
              let xC = wC + yC * uniforms.strides[1] - uniforms.pads[1];

              if (xC < 0 || xC >= uniforms.inWidth) {
                continue;
              }

              if (${this.isChannelsLast}) {
                let dyValue = getDy(b, yR, yC, d2);
                let xValue = getX(b, xR, xC, d1);
                dotProd = dotProd + xValue * dyValue;
              } else {
                let dyValue = getDy(b, d2, yR, yC);
                let xValue = getX(b, d1, xR, xC);
                dotProd = dotProd + xValue * dyValue;
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}}class gve{constructor(e){this.variableNames=["x","dy"],this.uniforms=`pads : vec3<i32>, strides : vec3<i32>, batchSize : i32, outDepth : i32,
       outHeight : i32, outWidth : i32, inDepth : i32, inHeight : i32, inWidth : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.filterShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3DDerFilter"}getUserCode(){return`
    ${Re("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let wF = coords.x;
        let wR = coords.y;
        let wC = coords.z;
        let d1 = coords.w;
        let d2 = coords.u;

        var dotProd = 0.0;
        for (var b = 0; b < uniforms.batchSize; b++) {
          for (var yF = 0; yF < uniforms.outDepth; yF++) {
            let xF = wF + yF * uniforms.strides[0] - uniforms.pads[0];
            if (xF < 0 || xF >= uniforms.inDepth) {
              continue;
            }

            for (var yR = 0; yR < uniforms.outHeight; yR++) {
              let xR = wR + yR * uniforms.strides[1] - uniforms.pads[1];
              if (xR < 0 || xR >= uniforms.inHeight) {
                continue;
              }

              for (var yC = 0; yC < uniforms.outWidth; yC++) {
                let xC = wC + yC * uniforms.strides[2] - uniforms.pads[2];
                if (xC < 0 || xC >= uniforms.inWidth) {
                  continue;
                }

                let dyValue = getDy(b, yF, yR, yC, d2);
                let xValue = getX(b, xF, xR, xC, d1);
                dotProd += xValue * dyValue;
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}}class yve{constructor(e){this.variableNames=["dy","W"],this.uniforms=`filterDims : vec3<i32>, pads : vec3<i32>, strides : vec3<i32>,
      outDepth : i32, outHeight : i32, outWidth : i32, outChannels : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3DDerInput"}getUserCode(){return`
    ${Re("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords.x;
        let d1 = coords.u;

        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;
        let dyFCorner = dyCorner.x;
        let dyRCorner = dyCorner.y;
        let dyCCorner = dyCorner.z;

        var dotProd = 0.0;
        for (var wF = 0; wF < uniforms.filterDims[0]; wF++) {
          let dyF = f32(dyFCorner + wF) / f32(uniforms.strides[0]);
          if (dyF < 0.0 || dyF >= f32(uniforms.outDepth) || fract(dyF) > 0.0) {
            continue;
          }
          let idyF = i32(dyF);

          let wFPerm = uniforms.filterDims[0] - 1 - wF;

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);

            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
              continue;
            }
            let idyR = i32(dyR);

            let wRPerm = uniforms.filterDims[1] - 1 - wR;

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);

              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
                continue;
              }
              let idyC = i32(dyC);

              let wCPerm = uniforms.filterDims[2] - 1 - wC;

              for (var d2 = 0; d2 < uniforms.outChannels; d2++) {
                let xValue = getDy(batch, idyF, idyR, idyC, d2);
                let wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=s,d=Zr(l),h=gn(r.shape,c,i,1,a,u,!1,d),p=new mve(h),f=[{type:"int32",data:[h.padInfo.top,h.padInfo.left]},{type:"int32",data:[h.strideHeight,h.strideWidth]},{type:"int32",data:[h.batchSize]},{type:"int32",data:[h.outHeight]},{type:"int32",data:[h.outWidth]},{type:"int32",data:[h.inHeight]},{type:"int32",data:[h.inWidth]}];return n.runWebGPUProgram(p,[r,o],r.dtype,f)}const wve={kernelName:S0,backendName:"webgpu",kernelFunc:xve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vve(t=4){const e=o=>{switch(o){case 1:return"return W[getIndexFromCoords4D(coord, uniforms.wShape)];";case 4:return`
            let coord1 = vec4<i32>(coordX, coordY, col + 1, rowInner);
            let coord2 = vec4<i32>(coordX, coordY, col + 2, rowInner);
            let coord3 = vec4<i32>(coordX, coordY, col + 3, rowInner);
            let v0 = W[getIndexFromCoords4D(coord, uniforms.wShape)];
            let v1 = W[getIndexFromCoords4D(coord1, uniforms.wShape)];
            let v2 = W[getIndexFromCoords4D(coord2, uniforms.wShape)];
            let v3 = W[getIndexFromCoords4D(coord3, uniforms.wShape)];
            return vec4<f32>(v0, v1, v2, v3);
            `;default:throw new Error(`innerElementSize ${o} is not supported.`)}},s=`if (row < uniforms.dimAOuter && col < uniforms.dimInner) {
        ${`
      let outRow = row / uniforms.outShape[2];
      let outCol = row % uniforms.outShape[2];

      let WRow = col / (uniforms.filterDims[1] * uniforms.outBackprop[3]);
      let WCol = col / uniforms.outBackprop[3] % uniforms.filterDims[1];
      let xR = f32(outRow - uniforms.pads[0] + WRow) / f32(uniforms.strides[0]);
      let xC = f32(outCol - uniforms.pads[1] + WCol) / f32(uniforms.strides[1]);
      if (xR < 0.0 || xR >= f32(uniforms.outBackprop[1]) || fract(xR) > 0.0) {
        return ${kt(t)}(0.0);
      }
      if (xC < 0.0 || xC >= f32(uniforms.outBackprop[2]) || fract(xC) > 0.0) {
        return ${kt(t)}(0.0);
      }
      let coord = vec4<i32>(
          batch,
          i32(xR),
          i32(xC),
          col % uniforms.outBackprop[3]);
      return x[getIndexFromCoords4D(coord, uniforms.xShape)/${t}];`}
      }
      return ${kt(t)}(0.0);`;return`
  fn mm_readA(batch: i32, row : i32, col : i32) -> ${kt(t)} {
    ${s}
  }

  fn mm_readB(batch: i32, row : i32, col : i32) -> ${kt(t)} {
    let coordX = uniforms.filterDims.x - 1 -
        row / (uniforms.filterDims[1] * uniforms.outBackprop[3]);
    let coordY = uniforms.filterDims.y - 1 -
        (row / uniforms.outBackprop[3]) % uniforms.filterDims[1];
    if (row < uniforms.dimInner && col < uniforms.dimBOuter &&
        coordX >= 0 && coordY >= 0) {
      let rowInner = row % uniforms.outBackprop[3];
      let coord = vec4<i32>(coordX, coordY, col, rowInner);
      ${e(t)}
    }
    return ${kt(t)}(0.0);
  }

  fn mm_write(batch: i32, row : i32, col : i32, valueInput : ${kt(t)}) {
    if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {
      var value = valueInput;
      let outCoord = vec4<i32>(
          batch,
          row / uniforms.outShape[2],
          row % uniforms.outShape[2],
          col);
      result[getIndexFromCoords4D(outCoord, uniforms.outShape)/${t}] = value;
    }
  }`}class bve{constructor(e){this.variableNames=["x","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, outBackprop : vec4<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=e.inShape,A(e.dataFormat==="channelsLast",()=>"TODO: NCHW is unimplemented"),this.isVec4=e.inChannels%4===0&&e.outChannels%4===0,this.dispatchLayout={x:[3],y:[1,2],z:[0]},this.workgroupSize=rM(this.dispatchLayout,this.outputShape,this.isVec4),this.elementsPerThread=oM(this.dispatchLayout,this.outputShape,this.isVec4),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread),this.isVec4&&(this.outputComponent=4,this.variableComponents=[4,1]),this.shaderKey=`conv2DDerInputMM_${this.isVec4}_${this.elementsPerThread}`}getUserCode(){const e=this.isVec4?S1(this.elementsPerThread,this.workgroupSize):C1(this.elementsPerThread,this.workgroupSize);return`
    ${vve(this.isVec4?4:1)}
    ${e}
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sve(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=s,d=Zr(u),h=gn(i,o.shape,a,1,l,c,!1,d),p=[{type:"int32",data:[h.filterHeight,h.filterWidth]},{type:"int32",data:[h.filterHeight-1-h.padInfo.top,h.filterWidth-1-h.padInfo.left]},{type:"int32",data:[h.strideHeight,h.strideWidth]},{type:"int32",data:[h.batchSize,h.outHeight,h.outWidth,h.outChannels]}];let f;if(re().getBool("WEBGPU_USE_NAIVE_CONV2D_TRANSPOSE")||h.dataFormat!=="channelsLast")f=new fve(h);else{f=new bve(h);const m=h.inHeight*h.inWidth,g=h.inChannels,y=h.filterHeight*h.filterWidth*h.outChannels;p.push({type:"uint32",data:[m]},{type:"uint32",data:[g]},{type:"uint32",data:[y]})}return n.runWebGPUProgram(f,[r,o],"float32",p)}const Cve={kernelName:em,backendName:"webgpu",kernelFunc:Sve};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kve{constructor(e){this.variableNames=["x","W"],this.uniforms="filterDims: vec3<i32>, pads: vec3<i32>, strides: vec3<i32>, dilations: vec3<i32>,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3dnaive"}getUserCode(){return`
    ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let batch = coords.x;
        let d2 = coords.u;

        let xFRCCorner = vec3<i32>(coords.y, coords.z, coords.w) * uniforms.strides - uniforms.pads;
        let xFCorner = xFRCCorner.x;
        let xRCorner = xFRCCorner.y;
        let xCCorner = xFRCCorner.z;

        let inputDepthNearestVec4 = (uniforms.xShape.u / 4) * 4;
        let inputDepthVec4Remainder = uniforms.xShape.u % 4;

        var dotProd = 0.0;
        for (var wF = 0; wF < uniforms.filterDims[0]; wF++) {
          let xF = xFCorner + wF * uniforms.dilations[0];
          if (xF < 0 || xF >= uniforms.xShape.y) {
            continue;
          }

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let xR = xRCorner + wR * uniforms.dilations[1];
            if (xR < 0 || xR >= uniforms.xShape.z) {
              continue;
            }

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let xC = xCCorner + wC * uniforms.dilations[2];
              if (xC < 0 || xC >= uniforms.xShape.w) {
                continue;
              }

              for (var d1 = 0; d1 < inputDepthNearestVec4; d1 += 4) {
                let xValues = vec4<f32>(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                let wValues = vec4<f32>(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (inputDepthVec4Remainder == 1) {
                dotProd += getX(batch, xF, xR, xC, inputDepthNearestVec4) *
                  getW(wF, wR, wC, inputDepthNearestVec4, d2);
              } else if (inputDepthVec4Remainder == 2) {
                let xValues = vec2<f32>(
                  getX(batch, xF, xR, xC, inputDepthNearestVec4),
                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1)
                );
                let wValues = vec2<f32>(
                  getW(wF, wR, wC, inputDepthNearestVec4, d2),
                  getW(wF, wR, wC, inputDepthNearestVec4 + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (inputDepthVec4Remainder == 3) {
                let xValues = vec3<f32>(
                  getX(batch, xF, xR, xC, inputDepthNearestVec4),
                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2)
                );
                let wValues = vec3<f32>(
                  getW(wF, wR, wC, inputDepthNearestVec4, d2),
                  getW(wF, wR, wC, inputDepthNearestVec4 + 1, d2),
                  getW(wF, wR, wC, inputDepthNearestVec4 + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }`}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ive(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s,u=Oi(r.shape,o.shape,i,l,a),c=[u.padInfo.front,u.padInfo.top,u.padInfo.left],d=[{type:"int32",data:[u.filterDepth,u.filterHeight,u.filterWidth]},{type:"int32",data:[...c]},{type:"int32",data:[u.strideDepth,u.strideHeight,u.strideWidth]},{type:"int32",data:[u.dilationDepth,u.dilationHeight,u.dilationWidth]}],h=new kve(u),p=$s(r.dtype,o.dtype);return n.runWebGPUProgram(h,[r,o],p,d)}const $ve={kernelName:tm,backendName:"webgpu",kernelFunc:Ive};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:l}=s,u=Oi(r.shape,l,i,1,a),c=new gve(u),d=[{type:"int32",data:[u.padInfo.front,u.padInfo.top,u.padInfo.left]},{type:"int32",data:[u.strideDepth,u.strideHeight,u.strideWidth]},{type:"int32",data:[u.batchSize]},{type:"int32",data:[u.outDepth]},{type:"int32",data:[u.outHeight]},{type:"int32",data:[u.outWidth]},{type:"int32",data:[u.inDepth]},{type:"int32",data:[u.inHeight]},{type:"int32",data:[u.inWidth]}];return n.runWebGPUProgram(c,[r,o],o.dtype,d)}const Tve={kernelName:C0,backendName:"webgpu",kernelFunc:Nve};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eve(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{strides:i,pad:a,inputShape:l}=s,u=Oi(l,o.shape,i,1,a),c=new yve(u),d=[{type:"int32",data:[u.filterDepth,u.filterHeight,u.filterWidth]},{type:"int32",data:[u.filterDepth-1-u.padInfo.front,u.filterHeight-1-u.padInfo.top,u.filterWidth-1-u.padInfo.left]},{type:"int32",data:[u.strideDepth,u.strideHeight,u.strideWidth]},{type:"int32",data:[u.outDepth]},{type:"int32",data:[u.outHeight]},{type:"int32",data:[u.outWidth]},{type:"int32",data:[u.outChannels]}];return n.runWebGPUProgram(c,[r,o],r.dtype,d)}const Rve={kernelName:k0,backendName:"webgpu",kernelFunc:Eve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dve=jt({opType:Te.COS}),Ave={kernelName:Qd,backendName:"webgpu",kernelFunc:Dve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ve=jt({opType:Te.COSH}),Fve={kernelName:Jd,backendName:"webgpu",kernelFunc:_ve};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pve{constructor(e,n,s,r){this.variableNames=["Image","Boxes","BoxInd"],this.uniforms="extrapolationValue : f32,",this.workgroupSize=[64,1,1],this.size=!0;const[o]=n;this.outputShape=[o,s[0],s[1],e],this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.methodId=r==="bilinear"?1:0,this.cropHeightBiggerThan1=this.outputShape[1]>1,this.cropWidthBiggerThan1=this.outputShape[2]>1,this.shaderKey=`cropAndResize_${this.methodId}_${this.cropHeightBiggerThan1}_${this.cropWidthBiggerThan1}`}getUserCode(){const[e,n]=["f32(uniforms.imageShape[1] - 1)","f32(uniforms.imageShape[2] - 1)"],[s,r,o]=this.cropHeightBiggerThan1?[`(${e} / f32(uniforms.outShape[1] - 1))`,"(y2-y1) * height_ratio",`y1*${e} + f32(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${e}`],[i,a,l]=this.cropWidthBiggerThan1?[`(${n} / f32(uniforms.outShape[2] - 1))`,"(x2-x1) * width_ratio",`x1*${n} + f32(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${n}`];return`
    ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let height_ratio = f32(${s});
        let width_ratio = f32(${i});
        let b = coords[0];
        let y = coords[1];
        let x = coords[2];
        let d = coords[3];
        // get box vals
        let y1 = getBoxes(b, 0);
        let x1 = getBoxes(b, 1);
        let y2 = getBoxes(b, 2);
        let x2 = getBoxes(b, 3);
        // get image in batch index
        let bInd = i32(round(getBoxInd(b)));
        if(bInd < 0 || bInd >= uniforms.outShape[0]) {
          return;
        }
        let height_scale = ${r};
        let width_scale = ${a};
        let in_y = ${o};
        if( in_y < 0.0 || in_y > ${e} ) {
          setOutputAtIndex(index, uniforms.extrapolationValue);
          return;
        }
        let in_x = ${l};
        if( in_x < 0.0 || in_x > ${n} ) {
          setOutputAtIndex(index, uniforms.extrapolationValue);
          return;
        }
        let sourceFracIndexCR = vec2<f32>(in_x,in_y);
        if(${this.methodId} == 1) {
          // Compute the four integer indices.
          let sourceFloorCR = vec2<i32>(sourceFracIndexCR);
          let sourceCeilCR = vec2<i32>(ceil(sourceFracIndexCR));
          let topLeft = getImage(bInd, sourceFloorCR.y, sourceFloorCR.x, d);
          let bottomLeft = getImage(bInd, sourceCeilCR.y, sourceFloorCR.x, d);
          let topRight = getImage(bInd, sourceFloorCR.y, sourceCeilCR.x, d);
          let bottomRight = getImage(bInd, sourceCeilCR.y, sourceCeilCR.x, d);
          let fracCR = sourceFracIndexCR - vec2<f32>(sourceFloorCR);
          let top = topLeft + (topRight - topLeft) * fracCR.x;
          let bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          let newValue = top + (bottom - top) * fracCR.y;
          setOutputAtIndex(index, newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          let sourceNearestCR = vec2<i32>(floor(
            sourceFracIndexCR + vec2<f32>(0.5,0.5)));
          let newValue = getImage(
            bInd, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutputAtIndex(index, newValue);
        }
      }
    }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ove=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=s,c=new Pve(r.shape[3],o.shape,a,l),d=[{type:"float32",data:[u]}];return n.runWebGPUProgram(c,[r,o,i],"float32",d)},Lve={kernelName:$0,backendName:"webgpu",kernelFunc:Ove};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var _f;(function(t){t.Prod="*",t.Sum="+"})(_f||(_f={}));class bE{constructor(e,n,s,r){this.variableNames=["x"],this.uniforms="index : f32,",this.size=!0,this.workgroupSize=[128,1,1],this.outputShape=n,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.exclusive=s,this.reverse=r,this.op=e,this.shaderKey=`cum_${this.op}_${this.exclusive}_${this.reverse}`}getUserCode(){const e=this.outputShape.length,n=this.op===_f.Prod?"1.0":"0.0",s=this.exclusive?n:`getX(${SE(e,"coords",this.op)})`,r=this.outputShape[this.outputShape.length-1];let o="",i="";return this.exclusive?(o=this.reverse?`end != ${r-1}`:"end != 0",i=this.reverse?"end + 1":"end - 1"):(o=this.reverse?`end + pow2 < ${r}`:"end >= pow2",i=this.reverse?"end + pow2":"end - pow2"),`
      ${Re("index")} {
       if (index < uniforms.size) {
         var coords = getCoordsFromIndex(index);

         let end = ${CE(e,"coords",this.op)};
         var val = ${s};
         let pow2 = i32(pow(2.0, uniforms.index));
         if (${o}) {
           let idx = ${i};
           ${CE(e,"coords",this.op)} = idx;
           val ${this.op}= getX(${SE(e,"coords",this.op)});
         }
         setOutputAtIndex(index, val);
       }
      }
    `}}function SE(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function CE(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xM(t,e,n,s,r,o){const i=e.shape.length,a=an([s],i);let l=e;a!=null&&(l=ca({inputs:{x:e},backend:n,attrs:{perm:a}}));const u=yn(1,i)[0];if(u!==i-1)throw new Error(`WebGPU cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const c=l.shape[u];let d=Qr({inputs:{x:l},backend:n});for(let h=0;h<=Math.ceil(Math.log2(c))-1;h++){const p=new bE(t,l.shape,!1,o),f=d,m=[{type:"float32",data:[h]}];d=n.runWebGPUProgram(p,[d],d.dtype,m),n.disposeData(f.dataId)}if(r){const h=new bE(t,l.shape,r,o),p=d,f=[{type:"float32",data:[0]}];d=n.runWebGPUProgram(h,[d],d.dtype,f),n.disposeData(p.dataId)}if(a!=null){const h=ha(a),p=ca({inputs:{x:d},backend:n,attrs:{perm:h}});return n.disposeData(d.dataId),n.disposeData(l.dataId),p}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return xM(_f.Prod,r,n,o,i,a)}const Mve={kernelName:I0,backendName:"webgpu",kernelFunc:zve};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return xM(_f.Sum,r,n,o,i,a)}const Vve={kernelName:nm,backendName:"webgpu",kernelFunc:Bve};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s,l=r.shape.length===1,c=te(o.shape)>0,d=o.dtype,h=l?[r.shape[0]]:[r.shape[0],r.shape[1]],p=l?[i]:[r.shape[0],i],f=Cr({backend:n,attrs:{shape:p,value:0,dtype:d}}),m=new fM(h,c,a),g=[{type:"int32",data:[i]}],y=c?[r,o]:[r];return n.runWebGPUProgram(m,y,d,g,f)}const Wve={kernelName:N0,backendName:"webgpu",kernelFunc:Uve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jve{constructor(e,n){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.uniforms="blockSize : i32,",this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`depthToSpace_${n}`,this.dataFormat=n}getUserCode(){return`
      ${Re("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let b = coords[0];
          let h = ${this.getHeightCoordString()};
          let w = ${this.getWidthCoordString()};
          let d = ${this.getDepthCoordString()};

          let in_h = h / uniforms.blockSize;
          let offset_h = h % uniforms.blockSize;
          let in_w = w / uniforms.blockSize;
          let offset_w = w % uniforms.blockSize;
          let offset_d = (offset_h * uniforms.blockSize + offset_w) *
            ${this.getOutputDepthSize()};
          let in_d = d + offset_d;

          let rlt = ${this.getInputSamplingString()};
          setOutputAtIndex(index, rlt);
        }
      }`}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?"uniforms.outShape[3]":"uniforms.outShape[1]"}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:o,dataFormat:i}=s,a=r.shape[0],l=i==="NHWC"?r.shape[1]:r.shape[2],u=i==="NHWC"?r.shape[2]:r.shape[3],c=i==="NHWC"?r.shape[3]:r.shape[1],d=l*o,h=u*o,p=c/(o*o),f=i==="NHWC"?[a,d,h,p]:[a,p,d,h],m=[{type:"int32",data:[o]}],g=new jve(f,i);return n.runWebGPUProgram(g,[r],r.dtype,m)}const Hve={kernelName:T0,backendName:"webgpu",kernelFunc:Gve};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kve{constructor(e,n,s,r=!1,o=null,i=!1){this.variableNames=["x","W"],this.uniforms="pads : vec2<i32>, inDims : vec2<i32>,",this.workgroupSize=[16,16,1],this.outputShape=e,this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),r&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.addBias=r,this.activation=o,this.hasPreluActivation=i,this.filterHeight=n,this.filterWidth=s,this.shaderKey=`depthwiseNCHW_${this.activation}_${this.filterHeight}_${this.filterWidth}`}getUserCode(){const e=this.filterWidth*this.filterHeight,n=this.workgroupSize[0]*this.workgroupSize[1]*this.workgroupSize[2],s=this.workgroupSize[1]+this.filterHeight-1,r=this.workgroupSize[0]+this.filterWidth-1;return`
      ${Ka(this.activation,this.hasPreluActivation,!1,4)}

      var<workgroup> mm_Asub : array<array<f32, ${r}>, ${s}>;
      var<workgroup> mm_Bsub : array<array<f32, ${this.filterWidth}>, ${this.filterHeight}>;
      fn readX(batch : i32, channel : i32, row : i32, col : i32) -> f32 {
        var value = 0.0;
        if (row >=0 && row < uniforms.inDims[0] && col >=0 && col < uniforms.inDims[1])
        {
          value = getX(batch, channel, row, col);
        }
        return value;
      }

      ${Re()} {
        let coords = getOutputCoords();
        let batch = coords[0];
        let xRCCorner = vec2<i32>(coords.zw) - uniforms.pads;
        let channelMul = uniforms.wShape[3];
        let d1 = coords[1] / channelMul;
        let q = coords[1] % channelMul;

        let inputRowStart = xRCCorner.x;
        let inputColStart = xRCCorner.y;

        let localRow = i32(localId.y);
        let localCol = i32(localId.x);

        // Load one tile of X into local memory.
        for (var inputRow = localRow; inputRow < ${s}; inputRow = inputRow + ${this.workgroupSize[1]}) {
          for (var inputCol = localCol; inputCol < ${r}; inputCol = inputCol + ${this.workgroupSize[0]}) {
            let rowOffset = inputRow - localRow;
            let colOffset = inputCol - localCol;
            mm_Asub[inputRow][inputCol] = readX(batch, d1, inputRowStart + rowOffset, inputColStart + colOffset);
          }
        }

        // Load one tile of W into local memory.
        var wIndex = i32(localIndex);
        ${e<n?`if (wIndex < ${e})`:`for(; wIndex < ${e}; wIndex = wIndex + ${n})`}

        {
          let wRow = wIndex / ${this.filterWidth};
          let wCol = wIndex % ${this.filterWidth};
          mm_Bsub[wRow][wCol] = getW(wRow, wCol, d1, q);
        }

        workgroupBarrier();

        var value = 0.0;
        for (var wR = 0; wR < ${this.filterHeight}; wR = wR + 1) {
          for (var wC = 0; wC < ${this.filterWidth}; wC = wC + 1) {
            let xVal = mm_Asub[localRow + wR][localCol + wC];
            let wVal = mm_Bsub[wR][wC];
            value = fma(xVal, wVal, value);
          }
        }
        ${bc(this.addBias,this.activation)}
        if (coordsInBounds4D(coords, uniforms.outShape)) {
          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wM{constructor(e,n=!1,s=null,r=!1){this.variableNames=["x","W"],this.uniforms="pads : vec2<i32>, inDims : vec2<i32>, virtualWidth : i32,",this.workgroupSize=[64,1,1],this.workPerThread=4,this.outputComponent=4,this.outputShape=e.outShape,this.virtualWidth=Math.ceil(this.outputShape[2]/this.workPerThread)*this.workPerThread;const o=[this.outputShape[0],this.outputShape[1],this.virtualWidth,this.outputShape[3]];this.dispatchLayout=Ve(o),this.dispatch=De(this.dispatchLayout,o,this.workgroupSize,[this.outputComponent*this.workPerThread,1,1]),A(e.dataFormat==="channelsLast",()=>"TODO: NCHW is unimplemented"),n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.convInfo=e,this.addBias=n,this.activation=s,this.hasPreluActivation=r,this.shaderKey=`depthwiseVec4_${s}_${this.convInfo.filterHeight}_${this.convInfo.filterWidth}_${this.convInfo.strideHeight}_${this.convInfo.strideWidth}_${this.workPerThread}`}getUserCode(){const e=(this.workPerThread-1)*this.convInfo.strideWidth+this.convInfo.filterWidth,n=this.convInfo.strideHeight,s=this.convInfo.strideWidth;return`
      ${Ka(this.activation,this.hasPreluActivation,!0,4)}
      fn readX(batch : i32, row : i32, col : i32, channel : i32) -> vec4<f32> {
        var value = vec4<f32>(0.0);
        if (col >=0 && col < uniforms.inDims[1]) {
          value = getX(batch, row, col, channel);
        }
        return value;
      }

      ${Re("index")} {
        let width0 = uniforms.outShape[3] / ${this.outputComponent};
        let d1 = (index % width0) * ${this.outputComponent};
        var index1 = index / width0;
        let width1 = uniforms.virtualWidth / ${this.workPerThread};
        let c = (index1 % width1) * ${this.workPerThread};
        index1 = index1 / width1;
        let r = index1 % uniforms.outShape[1];
        let batch = index1 / uniforms.outShape[1];

        let xRCCorner = vec2<i32>(r, c) * vec2<i32>(${n}, ${s}) - uniforms.pads;

        let xRCorner = xRCCorner.x;
        let xCCorner = xRCCorner.y;
        var xVals : array<vec4<f32>, ${e}>;
        var dotProd : array<vec4<f32>, ${this.workPerThread}>;
        for (var i = 0; i < ${this.workPerThread}; i++) {
          dotProd[i] = vec4<f32>(0.0);
        }

        // Use constant instead of uniform can give better performance.
        for (var wR = 0; wR < ${this.convInfo.filterHeight}; wR = wR + 1) {
          let xR = xRCorner + wR;
          if (xR >=0 && xR < uniforms.inDims[0]) {
            for (var i = 0; i < ${e}; i++) {
              xVals[i] = readX(batch, xR, xCCorner + i, d1);
            }
            for (var wC = 0; wC < ${this.convInfo.filterWidth}; wC = wC + 1) {
              let wValue = getW(wR, wC, d1, 0);
              for (var i = 0; i < ${this.workPerThread}; i++) {
                dotProd[i] = fma(xVals[i * ${s} + wC], wValue, dotProd[i]);
              }
            }
          }
        }

        for (var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let coords = vec4<i32>(batch, r, c + i, d1);
          if (coordsInBounds4D(coords, uniforms.outShape)) {
            var value = dotProd[i];
            ${bc(this.addBias,this.activation)}
            setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
          }
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vM{constructor(e,n=!1,s=null,r=!1){this.variableNames=["x","W"],this.uniforms=`pads : vec2<i32>, inDims : vec2<i32>, filterHeight : i32,
      filterWidth : i32, strides : vec2<i32>, dilations : vec2<i32>,`,this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=e.dataFormat==="channelsLast",n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.convInfo=e,this.addBias=n,this.activation=s,this.hasPreluActivation=r,this.shaderKey=`depthwise_${this.activation}_${this.isChannelsLast}`}getUserCode(){const e=this.isChannelsLast?"getX(batch, xR, xC, d1);":"getX(batch, d1, xR, xC);";return`
      ${Ka(this.activation,this.hasPreluActivation,!1,4)}

      ${Re("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let batch = coords[0];
          let xRCCorner = vec2<i32>(coords.${this.isChannelsLast?"yz":"zw"}) * uniforms.strides - uniforms.pads;
          let d2 = coords[${this.isChannelsLast?3:1}];
          let channelMul = uniforms.wShape[3];
          let d1 = d2 / channelMul;
          let q = d2 % channelMul;

          let inputRowStart = xRCCorner.x;
          let inputColStart = xRCCorner.y;
          let inputRowEnd = inputRowStart + uniforms.filterHeight *
              uniforms.dilations[0];
          let inputColEnd = inputColStart + uniforms.filterWidth *
              uniforms.dilations[1];

          // Convolve x(?, ?, d1)|x(d1, ?, ?) with w(:, :, d1, q) to get
          // y(yR, yC, d2)|y(d2, yR, yC). ? = to be determined. : = across all
          // values in that axis. x(?, ?, d1) and y(yR, yC, d2) is for NHWC.
          // x(d1, ?, ?) and y(d2, yR, yC) is for NCHW.
          var value = 0.0;

          // Extract if checking out of for loop for performance.
          if (inputRowStart >= 0 && inputColStart >= 0 &&
            inputRowEnd < uniforms.inDims[0] &&
                inputColEnd < uniforms.inDims[1]) {
              for (var wR = 0; wR < uniforms.filterHeight; wR = wR + 1) {
                let xR = inputRowStart + wR * uniforms.dilations[0];

                for (var wC = 0; wC < uniforms.filterWidth; wC = wC + 1) {
                  let xC = inputColStart + wC * uniforms.dilations[1];

                  let xVal = ${e};
                  let wVal = getW(wR, wC, d1, q);
                  value = value + xVal * wVal;
                }
              }
            } else {
              for (var wR = 0; wR < uniforms.filterHeight; wR = wR + 1) {
                let xR = inputRowStart + wR * uniforms.dilations[0];

                if (xR < 0 || xR >= uniforms.inDims[0]) {
                  continue;
                }

                for (var wC = 0; wC < uniforms.filterWidth; wC = wC + 1) {
                  let xC = inputColStart + wC * uniforms.dilations[1];

                  if (xC < 0 || xC >= uniforms.inDims[1]) {
                    continue;
                  }

                  let xVal = ${e};
                  let wVal = getW(wR, wC, d1, q);
                  value = value + xVal * wVal;
                }
              }
            }
            ${bc(this.addBias,this.activation)}
          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=s,d=Zr(l);let h=u;h==null&&(h=[1,1]);const p=gn(r.shape,o.shape,i,h,a,c,!0,d),f=[{type:"int32",data:[p.padInfo.top,p.padInfo.left]},{type:"int32",data:[p.inHeight,p.inWidth]}],m=p.dataFormat==="channelsLast";let g;return!m&&p.inHeight>16&&p.inWidth>16&&p.strideHeight===1&&p.strideWidth===1&&p.dilationWidth===1&&p.dilationHeight===1&&p.inChannels===p.outChannels?g=new Kve(p.outShape,p.filterHeight,p.filterWidth):m&&p.outHeight>4&&p.outWidth>4&&p.strideWidth<=2&&p.inChannels===p.outChannels&&p.dilationHeight===1&&p.dilationWidth===1&&p.inChannels%4===0?(g=new wM(p),f.push({type:"int32",data:[g.virtualWidth]})):(g=new vM(p),f.push({type:"int32",data:[p.filterHeight]},{type:"int32",data:[p.filterWidth]},{type:"int32",data:[p.strideHeight,p.strideWidth]},{type:"int32",data:[p.dilationHeight,p.dilationWidth]})),n.runWebGPUProgram(g,[r,o],r.dtype,f)}const Xve={kernelName:sm,backendName:"webgpu",kernelFunc:qve};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yve{constructor(e){this.variableNames=["x","dy"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, filterDims : vec2<i32>, outHeight : i32,
      outWidth : i32, inHeight : i32, inWidth : i32, batchSize : i32, channelMul : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.filterShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="depthwise_conv2d_backprop_filter"}getUserCode(){return`
      ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let wR = coords[0];
        let wC = coords[1];
        let d1 = coords[2];
        let dm = coords[3];
        let d2 = d1 * uniforms.channelMul + dm;

        var dotProd = 0.0;
        for (var b = 0; b < uniforms.batchSize; b++) {
          for (var yR = 0; yR < uniforms.outHeight; yR++) {
            let xR = wR + yR * uniforms.strides[0] - uniforms.pads[0];

            if (xR < 0 || xR >= uniforms.inHeight) {
              continue;
            }

            for (var yC = 0; yC < uniforms.outWidth; yC++) {
              let xC = wC + yC * uniforms.strides[1] - uniforms.pads[1];

              if (xC < 0 || xC >= uniforms.inWidth) {
                continue;
              }

              let dyValue = getDy(b, yR, yC, d2);
              let xValue = getX(b, xR, xC, d1);
              dotProd += xValue * dyValue;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}}class Qve{constructor(e){this.variableNames=["dy","W"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, filterDims : vec2<i32>,
       outHeight : i32, outWidth : i32, channelMul : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="depthwise_conv2d_backprop_input"}getUserCode(){return`
      ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d1 = coords[3];
        let dyCorner = coords.yz - uniforms.pads;
        let dyRCorner = dyCorner.x;
        let dyCCorner = dyCorner.y;

        var dotProd = 0.0;
        for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {
          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);

          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
            continue;
          }

          let idyR = i32(dyR);
          let wRPerm = uniforms.filterDims[0] - 1 - wR;

          for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {
            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);

            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
              continue;
            }

            let idyC = i32(dyC);
            let wCPerm = uniforms.filterDims[1] - 1 - wC;

            for (var dm = 0; dm < uniforms.channelMul; dm++) {
              let d2 = d1 * uniforms.channelMul + dm;
              let xValue = getDy(batch, idyR, idyC, d2);
              let wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jve(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=s,d=gn(r.shape,c,i,a,l,u,!0),h=new Yve(d),p=[{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.filterHeight,d.filterWidth]},{type:"int32",data:[d.outHeight]},{type:"int32",data:[d.outWidth]},{type:"int32",data:[d.inHeight]},{type:"int32",data:[d.inWidth]},{type:"int32",data:[d.batchSize]},{type:"int32",data:[d.outChannels/d.inChannels]}];return n.runWebGPUProgram(h,[r,o],"float32",p)}const Zve={kernelName:E0,backendName:"webgpu",kernelFunc:Jve};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ebe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=s,d=gn(c,o.shape,i,a,l,u,!0),h=new Qve(d),p=[{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.filterHeight-1-d.padInfo.top,d.filterWidth-1-d.padInfo.left]},{type:"int32",data:[d.filterHeight,d.filterWidth]},{type:"int32",data:[d.outHeight]},{type:"int32",data:[d.outWidth]},{type:"int32",data:[d.outChannels/d.inChannels]}];return n.runWebGPUProgram(h,[r,o],r.dtype,p)}const tbe={kernelName:R0,backendName:"webgpu",kernelFunc:ebe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nbe{constructor(e){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e,e],this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="diag"}getUserCode(){return`
      ${Re("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let value = select(0.0, getX(coords[0]), coords[0] == coords[1]);
          setOutputAtIndex(index, value);
        }
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sbe(t){const{inputs:e,backend:n}=t,{x:s}=e,r=[...s.shape,...s.shape],o=te(s.shape),i=Ye({inputs:{x:s},backend:n,attrs:{shape:[o]}}),a=new nbe(o),l=n.runWebGPUProgram(a,[i],i.dtype),u=Ye({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeData(i.dataId),n.disposeData(l.dataId),u}const rbe={kernelName:D0,backendName:"webgpu",kernelFunc:sbe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class obe{constructor(e){this.variableNames=["x","w"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="dilation2d"}getUserCode(){return`
       ${Re("index")} {
         if (index < uniforms.size) {
           let neg_infinity = -3.4e38;
           let coords = getOutputCoords();
           let batch = coords.x;
           let d1 = coords.w;
           let outTopLeftCorner = coords.yz * uniforms.strides - uniforms.pads;
           let hBeg = outTopLeftCorner.x;
           let wBeg = outTopLeftCorner.y;

           var curVal = neg_infinity;
           for (var h = 0; h < uniforms.filterDims[0]; h = h + 1) {
             let hIn = hBeg + h * uniforms.dilations[0];

             if (hIn >= 0 && hIn < uniforms.xShape[1]) {
               for (var w = 0; w < uniforms.filterDims[1]; w = w + 1) {
                 let wIn = wBeg + w * uniforms.dilations[1];

                 if (wIn >= 0 && wIn < uniforms.xShape[2]) {
                   let val = getX(batch, hIn, wIn, d1) + getW(h, w, d1);
                   if (val > curVal) {
                     curVal = val;
                   }
                 }
               }
             }
           }

           setOutputAtIndex(index, curVal);
         }
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ibe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s,u=Gl(r.shape,o.shape,i,a,"NHWC",l),c=[u.padInfo.top,u.padInfo.left],d=[{type:"int32",data:[u.filterHeight,u.filterWidth]},{type:"int32",data:[...c]},{type:"int32",data:[u.strideHeight,u.strideWidth]},{type:"int32",data:[u.dilationHeight,u.dilationWidth]}],h=new obe(u);return n.runWebGPUProgram(h,[r,o],r.dtype,d)}const abe={kernelName:rm,backendName:"webgpu",kernelFunc:ibe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lbe{constructor(e,n){if(this.variableNames=["x","w","dy"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>, dySize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=e.inShape,this.dispatchLayout=Ve(e.outShape),this.dispatch=De(this.dispatchLayout,e.outShape,this.workgroupSize),n!=="float32"&&n!=="int32")throw new Error(`Dilation2DBackpropInput only supports float32 and int32
          types, does not support ${n} type.`);this.type=n,this.shaderKey="dilation2DBackpropInput"}getUserCode(){return`
       ${Re("index")} {
         if (index < uniforms.dySize) {
           let coords = getDyCoordsFromIndex(index);
           let b = coords[0];
           let r = coords[1];
           let c = coords[2];
           let d = coords[3];

           let dyCorner = vec2<i32>(r, c) * uniforms.strides - uniforms.pads;
           var curVal = -3.4e38;  // neg_infinity
           var xRMax = 0;
           var xCMax = 0;

           // In the case of multiple argmax branches, we only back-propagate
           // along the last branch, i.e., the one with largest value of
           // 'wR * uniforms.filterDims[1] + wC', similarly to the max-pooling
           // backward routines.
           for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {
             let xR = dyCorner.x + wR * uniforms.dilations[0];

             if (xR >= 0 && xR < uniforms.xShape[1]) {
               for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {
                 let xC = dyCorner.y + wC * uniforms.dilations[1];

                 if (xC >= 0 && xC < uniforms.xShape[2]) {
                   let val = getX(b, xR, xC, d) + getW(wR, wC, d);
                   if (val > curVal) {
                     curVal = val;
                     xRMax = xR;
                     xCMax = xC;
                   }
                 }
               }
             }
           }

           let flatIndexIn = d + uniforms.xShape[3] *
               (xCMax + uniforms.xShape[2] * (xRMax + uniforms.xShape[1] * b));
           let value = getDy(b, r, c, d);
           ${Ql("&result[flatIndexIn]","value",this.type)}
         }
       }
     `}}class ube{constructor(e,n,s){if(this.variableNames=["x","w","dy"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>, dySize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=e.filterShape,this.dispatchLayout=Ve(e.outShape),this.dispatch=De(this.dispatchLayout,e.outShape,this.workgroupSize),s!=="float32"&&s!=="int32")throw new Error(`Dilation2DBackpropFilter only supports float32 and int32
          types, does not support ${s} type.`);this.type=s,this.shaderKey="dilation2DBackpropFilter"}getUserCode(){return`
       ${Re("index")} {
         if (index < uniforms.dySize) {
           let coords = getDyCoordsFromIndex(index);
           let b = coords[0];
           let r = coords[1];
           let c = coords[2];
           let d = coords[3];

           let dyCorner = vec2<i32>(r, c) * uniforms.strides - uniforms.pads;
           var curVal = -3.4e38;  // neg_infinity
           var wRMax = 0;
           var wCMax = 0;

           // In the case of multiple argmax branches, we only back-propagate
           // along the last branch, i.e., the one with largest value of
           // 'wR * uniforms.filterDims[1] + wC', similarly to the max-pooling
           // backward routines.
           for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {
             let xR = dyCorner.x + wR * uniforms.dilations[0];

             if (xR >= 0 && xR < uniforms.xShape[1]) {
               for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {
                 let xC = dyCorner.y + wC * uniforms.dilations[1];

                 if (xC >= 0 && xC < uniforms.xShape[2]) {
                   let val = getX(b, xR, xC, d) + getW(wR, wC, d);
                   if (val > curVal) {
                     curVal = val;
                     wRMax = wR;
                     wCMax = wC;
                   }
                 }
               }
             }
           }

           let flatIndexIn = d + uniforms.wShape[2] * (wCMax + wRMax * uniforms.wShape[1]);
           let value = getDy(b, r, c, d);
           ${Ql("&result[flatIndexIn]","value",this.type)}
         }
       }
     `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cbe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,dy:i}=e,{strides:a,pad:l,dilations:u}=s,c=Gl(r.shape,o.shape,a,l,"NHWC",u),d=o.dtype,h=new ube(c,o.shape,d),p=[{type:"int32",data:[c.filterHeight,c.filterWidth]},{type:"int32",data:[c.padInfo.top,c.padInfo.left]},{type:"int32",data:[c.strideHeight,c.strideWidth]},{type:"int32",data:[c.dilationHeight,c.dilationWidth]},{type:"int32",data:[te(c.outShape)]}],f=Cr({backend:n,attrs:{shape:o.shape,value:0,dtype:d}});return n.runWebGPUProgram(h,[r,o,i],d,p,f)}const dbe={kernelName:ux,backendName:"webgpu",kernelFunc:cbe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hbe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,dy:i}=e,{strides:a,pad:l,dilations:u}=s,c=Gl(r.shape,o.shape,a,l,"NHWC",u),d=r.dtype,h=new lbe(c,d),p=[{type:"int32",data:[c.filterHeight,c.filterWidth]},{type:"int32",data:[c.padInfo.top,c.padInfo.left]},{type:"int32",data:[c.strideHeight,c.strideWidth]},{type:"int32",data:[c.dilationHeight,c.dilationWidth]},{type:"int32",data:[te(c.outShape)]}],f=Cr({backend:n,attrs:{shape:c.inShape,value:0,dtype:d}});return n.runWebGPUProgram(h,[r,o,i],d,p,f)}const pbe={kernelName:lx,backendName:"webgpu",kernelFunc:hbe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fbe{constructor(e,n,s){this.variableNames=["Image"],this.uniforms="alpha: f32,",this.workgroupSize=[64,1,1],this.pixelsOpType=Dd.DRAW,this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.type=n,this.textureFormat=s,this.shaderKey=`draw_${n}_${s}`}getUserCode(){let e;const n=this.type==="float32"?"value":"value / 255.0";return e=`
      if (uniforms.numChannels == 1) {
        rgba[0] = ${n};
        rgba[1] = ${n};
        rgba[2] = ${n};
      } else {
        rgba[d] = ${n};
      }`,`
       @group(0) @binding(0) var outImage : texture_storage_2d<${this.textureFormat}, write>;
       ${Re("index")} {
         if (index < uniforms.size) {
           var rgba = vec4<f32>(0.0, 0.0, 0.0, uniforms.alpha);
           for (var d = 0; d < uniforms.numChannels; d = d + 1) {
             let value = f32(inBuf[index * uniforms.numChannels + d]);
             ${e}
           }
           rgba.x = rgba.x * rgba.w;
           rgba.y = rgba.y * rgba.w;
           rgba.z = rgba.z * rgba.w;
           let coords = getCoordsFromIndex(index);
           textureStore(outImage, vec2<i32>(coords.yx), rgba);
         }
       }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use backend file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mbe(t){const{inputs:e,backend:n,attrs:s}=t,{image:r}=e,{canvas:o,options:i}=s,[a,l]=r.shape.slice(0,2),{imageOptions:u}=i||{},c=(u==null?void 0:u.alpha)||1,d=n.device.features.has("bgra8unorm-storage")?"bgra8unorm":"rgba8unorm",h=[a,l],p=new fbe(h,r.dtype,d);o.width=l,o.height=a;const f="webgpu";let m=o.getContext(f),g;m||(g=new OffscreenCanvas(l,a),m=g.getContext(f));const y=r.shape.length===3?r.shape[2]:1;m.configure({device:n.device,format:d,usage:GPUTextureUsage.STORAGE_BINDING,alphaMode:"premultiplied"});const x="int32",v=n.makeTensorInfo(h,x),b=n.tensorMap.get(v.dataId);b.resource=m.getCurrentTexture(),b.external=!0;const S=[{type:"uint32",data:[y]},{type:"float32",data:[c]}];if(n.runWebGPUProgram(p,[r],x,S,v),g){const C=o.getContext("2d");if(!C)throw new Error("Please make sure this canvas has only been used for 2d or webgpu context!");C.drawImage(g,0,0)}return n.disposeData(v.dataId),r}const gbe={kernelName:p2,backendName:"webgpu",kernelFunc:mbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bM=Ns({opType:ht.MUL,cpuKernelImpl:bwe,supportsComplex:!0}),ybe={kernelName:gh,backendName:"webgpu",kernelFunc:bM};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SM(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;return Cc(r,o,i,"sum",n)}const xbe={kernelName:Lm,backendName:"webgpu",kernelFunc:SM};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wbe(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:l}=Jw(r,o.length);e1(i.length,l,o);const{path:u,steps:c}=t1(a,l),d=c.length;let h=null,p=i.length;const f=[];for(let m=0;m<d;++m){for(const g of c[m]){const{permutationIndices:y,expandDims:x}=Zw(p,l[g]);let v;n1(y)?v=o[g]:(v=ca({inputs:{x:o[g]},backend:n,attrs:{perm:y}}),f.push(v));const b=v.shape.slice();for(let S=0;S<x.length;++S)b.splice(x[S],0,1);Ct(v.shape,b)||(v=Ye({inputs:{x:v},backend:n,attrs:{shape:b}}),f.push(v)),h===null?h=v:(h=bM({inputs:{a:v,b:h},backend:n}),f.push(h))}m<d-1&&(u[m]>=0&&(h=SM({inputs:{x:h},backend:n,attrs:{axis:u[m]-(i.length-p),keepDims:!1}}),f.push(h)),p--)}for(const m of f)m!==h&&n.disposeData(m.dataId);return h}const vbe={kernelName:A0,backendName:"webgpu",kernelFunc:wbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bbe=jt({opType:Te.ELU}),Sbe={kernelName:eh,backendName:"webgpu",kernelFunc:bbe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cbe=t=>{const{inputs:e,backend:n}=t,{dy:s,y:r}=e,o=new zx(ht.ELU_DER,s.shape,r.shape);return n.runWebGPUProgram(o,[s,r],s.dtype)},kbe={kernelName:_0,backendName:"webgpu",kernelFunc:Cbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ibe=Ns({opType:ht.EQUAL,dtype:"bool",cpuKernelImpl:iwe}),$be={kernelName:om,backendName:"webgpu",kernelFunc:Ibe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nbe=jt({opType:Te.ERF}),Tbe={kernelName:th,backendName:"webgpu",kernelFunc:Nbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ebe=jt({opType:Te.EXP,cpuKernelImpl:awe,dtype:"float32"}),Rbe={kernelName:nh,backendName:"webgpu",kernelFunc:Ebe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jS(t){const{inputs:e,attrs:n,backend:s}=t,{dim:r}=n,{input:o}=e,i=o.shape.length,a=o.shape.slice();let l=r;return r<0&&(A(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+r+1),a.splice(l,0,1),Ye({inputs:{x:o},backend:s,attrs:{shape:a}})}const Dbe={kernelName:im,backendName:"webgpu",kernelFunc:jS};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Abe=jt({opType:Te.EXPM1,cpuKernelImpl:lwe}),_be={kernelName:sh,backendName:"webgpu",kernelFunc:Abe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kE{constructor(e,n){this.variableNames=["real","imag"],this.outputShape=[],this.uniforms="exponentMultiplier : f32, denominator: f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.component=e,this.shaderKey=`fft_${e}`}getUserCode(){return`
    fn unaryOpComplex(real: f32, expR: f32, imag: f32, expI: f32) -> f32 {
      ${this.component==="real"?"return real * expR - imag * expI;":"return real * expI + imag * expR;"}
    }

    fn mulMatDFT(batch: i32, index: i32) -> f32 {
      let indexRatio = f32(index) / f32(uniforms.realShape[1]);
      let exponentMultiplierTimesIndexRatio =
          uniforms.exponentMultiplier * indexRatio;

      var result = 0.0;

      for (var i = 0; i < uniforms.realShape[1]; i = i + 1) {
        // x = (-2|2 * PI / N) * index * i;
        let x = exponentMultiplierTimesIndexRatio * f32(i);
        let expR = cos(x);
        let expI = sin(x);
        let real = getReal(batch, i);
        let imag = getImag(batch, i);

        result = result +
            unaryOpComplex(real, expR, imag, expI) / uniforms.denominator;
      }

      return result;
    }

    ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        setOutputAtIndex(index, mulMatDFT(coords[0], coords[1]));
      }
    }
  `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CM(t,e,n){const s=n.tensorMap.get(t.dataId),r=te(t.shape),o=t.shape[t.shape.length-1],i=r/o,a=[],l=Ye({inputs:{x:t},backend:n,attrs:{shape:[i,o]}});a.push(l);const u=l.shape,c=new kE("real",u),d=new kE("imag",u),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:u},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:u}],p=e?2*Math.PI:-2*Math.PI,f=e?u[1]:1,m=[{type:"float32",data:[p]},{type:"float32",data:[f]}],g=n.runWebGPUProgram(c,h,"float32",m);a.push(g);const y=n.runWebGPUProgram(d,h,"float32",m);a.push(y);const x=Sc({inputs:{real:g,imag:y},backend:n});a.push(x);const v=Ye({inputs:{x},backend:n,attrs:{shape:t.shape}});return a.forEach(b=>n.disposeData(b.dataId)),v}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fbe(t){const{inputs:e,backend:n}=t,{input:s}=e;return CM(s,!1,n)}const Pbe={kernelName:F0,backendName:"webgpu",kernelFunc:Fbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Obe{constructor(e){this.outputShape=[],this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="flipLeftRight"}getUserCode(){return`
      ${Re("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let coordX = uniforms.xShape[2] - coords[2] - 1;
          let outputValue = getX(coords[0], coords[1], coordX, coords[3]);
          setOutputAtIndex(index, outputValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lbe={kernelName:O0,backendName:"webgpu",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,r=new Obe(n.shape);return s.runWebGPUProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zbe=jt({opType:Te.FLOOR,cpuKernelImpl:uwe}),Mbe={kernelName:rh,backendName:"webgpu",kernelFunc:zbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bbe=Ns({opType:ht.FLOOR_DIV,cpuKernelImpl:cwe,dtype:"int32"}),Vbe={kernelName:oh,backendName:"webgpu",kernelFunc:Bbe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ube{constructor(e,n,s=!1){this.pixelsOpType=Dd.FROM_PIXELS,this.outputShape=[0],this.variableNames=[],this.workgroupSize=[256,1,1],this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize,[n,1,1]),this.importVideo=s,this.shaderKey=`fromPixels_${this.importVideo}`}getUserCode(){const e=this.importVideo?"textureLoad(src, vec2<i32>(coords.yx));":"textureLoad(src, vec2<i32>(coords.yx), 0)";return`
      @binding(1) @group(0) var src: ${this.importVideo?"texture_external":"texture_2d<f32>"};
      ${Re("index")} {
        let flatIndex = index * uniforms.numChannels;
        if (flatIndex < uniforms.size) {
          let coords = getCoordsFromIndex(flatIndex);
          let values = ${e};
          for (var i = 0; i < uniforms.numChannels; i = i + 1) {
            result[flatIndex + i] = i32(floor(255.0 * values[i]));
          }
        }
      }
  `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use backend file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wbe={kernelName:cx,backendName:"webgpu",kernelFunc:jbe};let _c,Lv=re().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function jbe(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:r}=e;const{numChannels:o}=s;if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");const i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,l=typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas,u=typeof ImageBitmap<"u"&&r instanceof ImageBitmap,[c,d]=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],h=[d,c,o],p=re().getBool("WEBGPU_IMPORT_EXTERNAL_TEXTURE")&&i,f=i||a;if(u||l||f){let x;if(p)x=n.device.importExternalTexture({source:r});else{if(f){const O=re().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(_c==null||O!==Lv)&&(Lv=O,_c=document.createElement("canvas").getContext("2d",{willReadFrequently:Lv})),_c.canvas.width=c,_c.canvas.height=d,_c.drawImage(r,0,0,c,d),r=_c.canvas}const _=GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,z=n.textureManager.acquireTexture(h[1],h[0],"rgba8unorm",_);n.queue.copyExternalImageToTexture({source:r},{texture:z},[h[1],h[0]]),x=z}const v=te(h),b=st(h),S=new Ube(h,o,p),C=[{type:"uint32",data:[v]},{type:"uint32",data:[o]},{type:"uint32",data:[...b]}],I=n.makeTensorInfo([d,c],"int32"),T=n.tensorMap.get(I.dataId);T.resource=x;const R=n.runWebGPUProgram(S,[I],"int32",C);return n.disposeData(I.dataId),R}const m=r.data;let g=m;if(o!=null&&o!==4){g=new Uint8Array(r.width*r.height*o);const x=m.length;let v=0;for(let b=0;b<x;b++)b%4<o&&(g[v++]=m[b])}const y=n.makeTensorInfo(h,"int32",new Int32Array(g));return n.uploadToGPU(y.dataId),y}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gbe{constructor(e,n,s,r,o){this.uniforms="varianceEpsilon : f32,",this.workgroupSize=[128,1,1],this.size=!0,this.variableNames=["x","mean","variance"],ct(e,n),ct(e,s),this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),r!=null&&(ct(e,r),this.variableNames.push("offset")),o!=null&&(ct(e,o),this.variableNames.push("scale")),this.offsetShape=r,this.scaleShape=o,this.shaderKey="batchNorm"}getUserCode(){let e="0.0";this.offsetShape!=null&&(e="getOffsetByOutputIndex(index)");let n="1.0";return this.scaleShape!=null&&(n="getScaleByOutputIndex(index)"),`
      ${Re("index")} {
        if (index < uniforms.size)
        {
          let xValue = getXByOutputIndex(index);
          let meanValue = getMeanByOutputIndex(index);
          let varianValue = getVarianceByOutputIndex(index);
          let offsetValue = ${e};
          let scaleValue = ${n};
          let inv = scaleValue * inverseSqrt(varianValue + f32(uniforms.varianceEpsilon));
          setOutputAtIndex(index,dot(vec3<f32>(xValue, -meanValue, offsetValue), vec3<f32>(inv, inv, 1.0)));
        }
      }
  `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hbe={kernelName:am,backendName:"webgpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s,scale:r,offset:o,mean:i,variance:a}=t,{varianceEpsilon:l}=e,u=n,c=[s,i,a];let d=null;o!=null&&(d=o.shape,c.push(o));let h=null;r!=null&&(h=r.shape,c.push(r));const p=new Gbe(s.shape,i.shape,a.shape,d,h),f=[{type:"float32",data:[l]}];return u.runWebGPUProgram(p,c,s.dtype,f)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kbe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:d,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=s,m=Zr(c),g=gn(r.shape,o.shape,l,d,u,h,!1,m);return yM({x:r,filter:o,convInfo:g,backend:n,bias:i,preluActivationWeights:a,leakyreluAlpha:f,activation:p})}const qbe={kernelName:ff,backendName:"webgpu",kernelFunc:Kbe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xbe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:c,dimRoundingMode:d,activation:h,leakyreluAlpha:p}=s;let f=c;f==null&&(f=[1,1]),A(ms(l,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${f}'`);const m=gn(r.shape,o.shape,l,f,u,d,!0),g=[r,o],y=i!=null,x=a!=null;y&&g.push(i),x&&g.push(a);const v=[{type:"int32",data:[m.padInfo.top,m.padInfo.left]},{type:"int32",data:[m.inHeight,m.inWidth]}];let b;return m.outHeight>4&&m.outWidth>4&&m.strideWidth<=2&&m.inChannels===m.outChannels&&m.dilationHeight===1&&m.dilationWidth===1&&m.inChannels%4===0?(b=new wM(m,y,h,x),v.push({type:"int32",data:[b.virtualWidth]})):(b=new vM(m,y,h,x),v.push({type:"int32",data:[m.filterHeight]},{type:"int32",data:[m.filterWidth]},{type:"int32",data:[m.strideHeight,m.strideWidth]},{type:"int32",data:[m.dilationHeight,m.dilationWidth]})),h==="leakyrelu"&&(v.push({type:"float32",data:[p]}),b.uniforms+=" alpha : f32,"),n.runWebGPUProgram(b,g,"float32",v)}const Ybe={kernelName:mf,backendName:"webgpu",kernelFunc:Xbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qbe{constructor(e,n){this.variableNames=["A","indices"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`gathernd_${e}`,this.sliceDim=e,this.uniforms=`sliceDim : i32, strides : ${Hn(e)},`}getUserCode(){let e;return this.sliceDim>1?e="uniforms.strides[j]":e="uniforms.strides",`
      ${Re("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          var flattenIndex = 0;
          for (var j = 0; j < uniforms.sliceDim; j = j + 1) {
            let indexTemp = i32(round(getIndices(coords[0], j)));
            let strideNum = ${e};
            flattenIndex = flattenIndex + indexTemp * strideNum;
          }

          setOutputAtIndex(index, getA(flattenIndex, coords[1]));
        }
      }
      `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jbe(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,o=r.shape,i=o[o.length-1],a=te(s.shape),[l,u,c,d]=Lw(s,r),h=Ye({inputs:{x:r},backend:n,attrs:{shape:[u,i]}}),p=Ye({inputs:{x:s},backend:n,attrs:{shape:[te(s.shape)/c,c]}});if(n.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const x=n.readSync(r.dataId),v=n.bufferSync(s),b=dwe(x,v,s.dtype,u,i,c,d,s.shape,a);return n.makeTensorInfo(l,s.dtype,b.values)}const f=new Qbe(i,[u,c]),m=[{type:"int32",data:[i]},{type:"int32",data:d}],g=n.runWebGPUProgram(f,[p,h],p.dtype,m),y=Ye({inputs:{x:g},backend:n,attrs:{shape:l}});return n.disposeData(h.dataId),n.disposeData(p.dataId),n.disposeData(g.dataId),y}const Zbe={kernelName:L0,backendName:"webgpu",kernelFunc:Jbe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eSe{constructor(e,n){this.variableNames=["A","indices"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.slice(),this.aShape=e,this.outputShape=n,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="gather"}getUserCode(){const e=tSe(this.aShape);return`
      ${Re("index")} {
        if (index < uniforms.size) {
          let resRC = getCoordsFromIndex(index);
          let indexZ = i32(getIndices(resRC.x, resRC.z));
          let inBounds = select(0.0, 1.0, indexZ >= 0 && indexZ < uniforms.aShape[2]);
          setOutputAtIndex(index, inBounds * getA(${e}));
        }
      }
    `}}function tSe(t){const e=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let s=0;s<t.length;s++)s===2?n.push("indexZ"):n.push(`${e[s]}`);return n.join()}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kM(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:o}=e,{axis:i,batchDims:a}=s,l=xt(i,r.shape)[0],u=r1(r,o,l,a),c=te(o.shape),d=[],h=Ye({inputs:{x:r},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),p=Ye({inputs:{x:o},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});d.push(h),d.push(p);const f=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([r,o])){const v=n.tensorMap.get(p.dataId).values,b=yt(p.shape,p.dtype,v),C=n.tensorMap.get(h.dataId).values,I=yt(h.shape,h.dtype,C),T=hwe(I,b,f);return d.forEach(R=>n.disposeData(R.dataId)),n.makeTensorInfo(u.outputShape,T.dtype,T.values)}const m=new eSe(h.shape,f),g=n.runWebGPUProgram(m,[h,p],h.dtype);d.push(g);const y=Ye({inputs:{x:g},backend:n,attrs:{shape:u.outputShape}});return d.forEach(x=>n.disposeData(x.dataId)),y}const nSe={kernelName:lm,backendName:"webgpu",kernelFunc:kM};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sSe=Ns({opType:ht.GREATER,cpuKernelImpl:fwe,dtype:"bool"}),rSe={kernelName:um,backendName:"webgpu",kernelFunc:sSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oSe=Ns({opType:ht.GREATER_EQUAL,dtype:"bool",cpuKernelImpl:pwe}),iSe={kernelName:ih,backendName:"webgpu",kernelFunc:oSe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aSe(t){const{inputs:e,backend:n}=t,{input:s}=e;return CM(s,!0,n)}const lSe={kernelName:z0,backendName:"webgpu",kernelFunc:aSe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uSe=jt({opType:Te.IS_FINITE,dtype:"bool"}),cSe={kernelName:lh,backendName:"webgpu",kernelFunc:uSe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dSe=jt({opType:Te.IS_INF,dtype:"bool"}),hSe={kernelName:uh,backendName:"webgpu",kernelFunc:dSe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pSe=jt({opType:Te.IS_NAN,dtype:"bool"}),fSe={kernelName:ch,backendName:"webgpu",kernelFunc:pSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:o}=s,i=[{type:"float32",data:[o]}],a=new Qh(r.shape,Te.LEAKYRELU,"alpha : f32,");return n.runWebGPUProgram(a,[r],"float32",i)}const gSe={kernelName:cm,backendName:"webgpu",kernelFunc:mSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ySe=Ns({opType:ht.LESS,dtype:"bool",cpuKernelImpl:gwe}),xSe={kernelName:dm,backendName:"webgpu",kernelFunc:ySe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wSe=Ns({opType:ht.LESS_EQUAL,dtype:"bool",cpuKernelImpl:mwe}),vSe={kernelName:hm,backendName:"webgpu",kernelFunc:wSe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bSe{constructor(e){this.variableNames=[],this.outputShape=[],this.uniforms="start : f32, step : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e],this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="linSpace"}getUserCode(){return`
      ${Re("index")} {
        if (index < uniforms.size) {
          setOutputAtIndex(index, uniforms.start + f32(index) * uniforms.step);
        }
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SSe(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:o}=n,i=(r-s)/(o-1),a=new bSe(o),l=[{type:"float32",data:[s]},{type:"float32",data:[i]}];return e.runWebGPUProgram(a,[],"float32",l)}const CSe={kernelName:B0,backendName:"webgpu",kernelFunc:SSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kSe=jt({opType:Te.LOG,cpuKernelImpl:ywe}),ISe={kernelName:dh,backendName:"webgpu",kernelFunc:kSe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Se=jt({opType:Te.LOG1P}),NSe={kernelName:hh,backendName:"webgpu",kernelFunc:$Se};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TSe=Ns({opType:ht.LOGICAL_AND,dtype:"bool"}),ESe={kernelName:pm,backendName:"webgpu",kernelFunc:TSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RSe=jt({opType:Te.LOGICAL_NOT}),DSe={kernelName:fm,backendName:"webgpu",kernelFunc:RSe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ASe=Ns({opType:ht.LOGICAL_OR}),_Se={kernelName:mm,backendName:"webgpu",kernelFunc:ASe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IM=`
  var powValue = 0.0;
  let basis = uniforms.bias + uniforms.alpha * sum;
  if (uniforms.beta == 0.5) {
    powValue = inverseSqrt(basis);
  } else if (uniforms.beta == 1.0) {
    powValue = 1.0 / basis;
  } else {
    powValue = exp(log(basis) * (-uniforms.beta));
  }
`;class FSe{constructor(e){this.outputShape=[],this.variableNames=["x"],this.uniforms="radius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="lrn"}getUserCode(){return`
    ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let b = coords[0];
        let r = coords[1];
        let c = coords[2];
        let d = coords[3];

        let x = getX(b, r, c, d);
        var sum = 0.0;
        for (var i = -uniforms.radius; i <= uniforms.radius; i = i + 1) {
          let idx = d + i;
          if (idx >= 0 && idx < uniforms.xShape[3]) {
            let z = getX(b, r, c, idx);
            sum = sum + z * z;
          }
        }
        ${IM}

        setOutputAtIndex(index, x * powValue);
      }
    }
  `}}class PSe{constructor(e,n){this.outputShape=[],this.variableNames=["x"],this.uniforms="radius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[256,1,1],this.maxAllowRadius=16,A(n<=this.maxAllowRadius,()=>`Radius must be less than or equal to ${this.maxAllowRadius}, current radius is ${n}`),this.outputShape=e,this.elementsPerWorkgroup=this.workgroupSize[0]-2*this.maxAllowRadius,this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=De(this.dispatchLayout,this.outputShape,[this.elementsPerWorkgroup,this.workgroupSize[1],this.workgroupSize[2]]),this.shaderKey="lrn_shared"}getUserCode(){return`
    var <workgroup>lrnSub: array<f32, ${this.workgroupSize[0]}>;
    const elementsPerWorkgroup = ${this.elementsPerWorkgroup};
    const maxAllowRadius = ${this.maxAllowRadius};

    ${Re()} {
      let localDepth = i32(localId.x);
      let workgroupDepth = i32(workgroupId.x) * elementsPerWorkgroup;
      let xDepth = workgroupDepth + localDepth - maxAllowRadius;
      let b = i32(globalId.z) / uniforms.xShape[1];
      let r = i32(globalId.z) - b * uniforms.xShape[1];
      let c = i32(globalId.y);
      let d = workgroupDepth + localDepth;

      var x = 0.0;
      if (xDepth >= 0 && xDepth < uniforms.xShape[3]) {
        x = getX(b, r, c, xDepth);
      }
      lrnSub[localDepth] = x;
      workgroupBarrier();

      if (localDepth < elementsPerWorkgroup && d < uniforms.outShape[3]) {
        var sum = 0.0;
        let index = localDepth + maxAllowRadius;
        for (var i = -uniforms.radius; i <= uniforms.radius; i = i + 1) {
          let z = lrnSub[index + i];
          sum = sum + z * z;
        }
        ${IM}

        setOutputAtCoords(b, r, c, d, lrnSub[index] * powValue);
      }
    } `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:l}=s;let u;o>16?u=new FSe(r.shape):u=new PSe(r.shape,o);const c=[{type:"int32",data:[o]},{type:"float32",data:[i]},{type:"float32",data:[a]},{type:"float32",data:[l]}];return n.runWebGPUProgram(u,[r],r.dtype,c)}const LSe={kernelName:gm,backendName:"webgpu",kernelFunc:OSe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zSe{constructor(e){this.outputShape=[],this.variableNames=["inputImage","outputImage","dy"],this.uniforms="depthRadius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="lrn_grad"}getUserCode(){return`
    ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let b = coords[0];
        let r = coords[1];
        let c = coords[2];

        let MIN_DEPTH_BEGIN = 0;
        let MAX_DEPTH_END = uniforms.outShape[3];
        var result = 0.0;
        for (var d = MIN_DEPTH_BEGIN; d < MAX_DEPTH_END; d++) {
          let depthBegin = max(MIN_DEPTH_BEGIN, d - uniforms.depthRadius);
          let depthEnd = min(MAX_DEPTH_END, d + uniforms.depthRadius + 1);

          var norm = 0.0;
          for (var k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; k++) {
            if (k < depthBegin) {
              continue;
            } else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            } else {
              break;
            }
          }

          norm = uniforms.alpha * norm + uniforms.bias;

          for (var k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; k++) {
            if (k < depthBegin) {
              continue;
            } else if (k >= depthBegin && k < depthEnd) {
              var dyi = -2.0 * uniforms.alpha * uniforms.beta
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d) / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * uniforms.beta);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            } else {
              break;
            }
          }
        }

        setOutputAtIndex(index, result);
      }
    }
  `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=s,d=new zSe(r.shape),h=[{type:"int32",data:[a]},{type:"float32",data:[l]},{type:"float32",data:[u]},{type:"float32",data:[c]}];return n.runWebGPUProgram(d,[r,o,i],r.dtype,h)}const BSe={kernelName:V0,backendName:"webgpu",kernelFunc:MSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VSe=Ns({opType:ht.MAX,cpuKernelImpl:wwe}),USe={kernelName:ph,backendName:"webgpu",kernelFunc:VSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,c=qs(r.shape,o,i,1,a,l);return pM(r,c,"max",n)}const jSe={kernelName:xm,backendName:"webgpu",kernelFunc:WSe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dataFormat:l,dimRoundingMode:u}=s,c=[1,1,1],d=xo(r.shape,o,i,c,a,u,l),h=new fI(d,"max"),p=[{type:"int32",data:[d.strideDepth,d.strideHeight,d.strideWidth]},{type:"int32",data:[d.padInfo.front,d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.inDepth,d.inHeight,d.inWidth]},{type:"int32",data:[d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth]}];return n.runWebGPUProgram(h,[r],r.dtype,p)}const HSe={kernelName:wm,backendName:"webgpu",kernelFunc:GSe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KSe{constructor(e){this.variableNames=["dy","maxPos"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, filterDims : vec2<i32>,
       outHeight : i32, outWidth : i32`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="maxPool2DBackprop"}getUserCode(){return`
      ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d = coords[3];

        let dyRCCorner = vec2<i32>(coords.yz) - uniforms.pads;
        let dyRCorner = dyRCCorner.x;
        let dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        let lastIndex = uniforms.filterDims[0] * uniforms.filterDims[1] - 1;
        for (var wR = 0; wR < uniforms.filterDims[0]; wR += uniforms.dilations[0]) {
          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);

          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
            continue;
          }
          let idyR = i32(dyR);

          for (var wC = 0; wC < uniforms.filterDims[1]; wC += uniforms.dilations[1]) {
            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);

            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
              continue;
            }
            let idyC = i32(dyC);

            let dyValue = getDy(batch, idyR, idyC, d);
            let maxPosValue = lastIndex - i32(getMaxPos(batch, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            let curPosValue = wR * uniforms.filterDims[1] + wC;
            let mask = select(0.0, 1.0, maxPosValue == curPosValue);
            dotProd += dyValue * mask;
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}}class qSe{constructor(e){this.variableNames=["dy","maxPos"],this.uniforms=`strides : vec3<i32>, pads : vec3<i32>, filterDims : vec3<i32>,
      outDepth : i32, outHeight : i32, outWidth : i32`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="maxPool3DBackprop"}getUserCode(){return`
      ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords.x;
        let ch = coords.u;

        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;
        let dyDCorner = dyCorner.x;
        let dyRCorner = dyCorner.y;
        let dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        let lastIndex = uniforms.filterDims[0] * uniforms.filterDims[1] * uniforms.filterDims[2] - 1;

        for (var wD = 0; wD < uniforms.filterDims[0]; wD++) {
          let dyD = f32(dyDCorner + wD) / f32(uniforms.strides[0]);

          if (dyD < 0.0 || dyD >= f32(uniforms.outDepth) || fract(dyD) > 0.0) {
            continue;
          }
          let idyD = i32(dyD);

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);

            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
              continue;
            }
            let idyR = i32(dyR);

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);

              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
                continue;
              }
              let idyC = i32(dyC);

              let dyValue = getDy(batch, idyD, idyR, idyC, ch);
              let maxPosValue = lastIndex - i32(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              let curPosValue = wD * uniforms.filterDims[1] * uniforms.filterDims[2] + wR * uniforms.filterDims[2] + wC;
              let mask = select(0.0, 1.0, maxPosValue == curPosValue);
              dotProd += dyValue * mask;
            }
          }
        }

        setOutputAtIndex(index, dotProd);
      }
    }
    `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XSe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=s,d=[1,1,1],h=xo(i.shape,a,l,d,u,c),p=new fI(h,"max",!0);let f=[{type:"int32",data:[h.strideDepth,h.strideHeight,h.strideWidth]},{type:"int32",data:[h.padInfo.front,h.padInfo.top,h.padInfo.left]},{type:"int32",data:[h.inDepth,h.inHeight,h.inWidth]},{type:"int32",data:[h.effectiveFilterDepth,h.effectiveFilterHeight,h.effectiveFilterWidth]}];const m=n.runWebGPUProgram(p,[i],"int32",f),g=new qSe(h);f=[{type:"int32",data:[h.strideDepth,h.strideHeight,h.strideWidth]},{type:"int32",data:[h.effectiveFilterDepth-1-h.padInfo.front,h.effectiveFilterHeight-1-h.padInfo.top,h.effectiveFilterWidth-1-h.padInfo.left]},{type:"int32",data:[h.effectiveFilterDepth,h.effectiveFilterHeight,h.effectiveFilterWidth]},{type:"int32",data:[h.outDepth]},{type:"int32",data:[h.outHeight]},{type:"int32",data:[h.outWidth]}];const y=n.runWebGPUProgram(g,[r,m],i.dtype,f);return n.disposeData(m.dataId),y}const YSe={kernelName:W0,backendName:"webgpu",kernelFunc:XSe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QSe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o,output:i}=e,a=o;aM([o,i],"maxPoolGrad");const{filterSize:l,strides:u,pad:c,dimRoundingMode:d}=s,h=qs(a.shape,l,u,1,c,d),p=new Af(h,"max",!0);let f=[{type:"int32",data:[h.strideHeight,h.strideWidth]},{type:"int32",data:[h.padInfo.top,h.padInfo.left]},{type:"int32",data:[h.dilationHeight,h.dilationWidth]},{type:"int32",data:[h.inHeight,h.inWidth]},{type:"int32",data:[h.effectiveFilterHeight,h.effectiveFilterWidth]}];const m=n.runWebGPUProgram(p,[a],"int32",f),g=new KSe(h);f=[{type:"int32",data:[h.strideHeight,h.strideWidth]},{type:"int32",data:[h.effectiveFilterHeight-1-h.padInfo.top,h.effectiveFilterWidth-1-h.padInfo.left]},{type:"int32",data:[h.dilationHeight,h.dilationWidth]},{type:"int32",data:[h.effectiveFilterHeight,h.effectiveFilterWidth]},{type:"int32",data:[h.outHeight]},{type:"int32",data:[h.outWidth]}];const y=n.runWebGPUProgram(g,[r,m],a.dtype,f);return n.disposeData(m.dataId),y}const JSe={kernelName:U0,backendName:"webgpu",kernelFunc:QSe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZSe(t){const{inputs:e,backend:n,attrs:s}=t,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=s,{x:l}=e;A(l.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${l.shape.length}.`);const u=[1,1];A(ms(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const c=qs(l.shape,r,o,u,i),d=[{type:"int32",data:[c.strideHeight,c.strideWidth]},{type:"int32",data:[c.padInfo.top,c.padInfo.left]},{type:"int32",data:[c.dilationHeight,c.dilationWidth]},{type:"int32",data:[c.inHeight,c.inWidth]},{type:"int32",data:[c.effectiveFilterHeight,c.effectiveFilterWidth]}];let h=new Af(c,"max",!1);const p=n.runWebGPUProgram(h,[l],l.dtype,d);h=new Af(c,"max",!0,!0,a);const f=n.runWebGPUProgram(h,[l],"int32",d);return[p,f]}const eCe={kernelName:j0,backendName:"webgpu",kernelFunc:ZSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;return Cc(r,o,i,"min",n)}const nCe={kernelName:bm,backendName:"webgpu",kernelFunc:tCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sCe=Ns({opType:ht.MIN,cpuKernelImpl:vwe}),rCe={kernelName:fh,backendName:"webgpu",kernelFunc:sCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oCe{constructor(e,n,s){this.uniforms="",this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n.map((r,o)=>r[0]+e[o]+r[1]),this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.xShape=e,n.map((r,o)=>{this.uniforms+=` pad${o} : vec2<i32>,`}),this.offset=s==="reflect"?0:1,this.shaderKey=`mirrorPad_${s}`}getUserCode(){const e=this.xShape.length,n=this.xShape.map((u,c)=>`uniforms.pad${c}[0]`).join(","),s=this.xShape.map((u,c)=>`uniforms.pad${c}[0] + uniforms.xShape${e>1?`[${c}]`:""}`).join(","),r=e===1?"start":"start[i]",o=e===1?"end":"end[i]",i=e===1?"outC":"outC[i]",a=Hn(e),l=e>1?["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,e):"coords";return`
      ${Re("index")} {
        if (index < uniforms.size) {
          let start = ${a}(${n});
          let end = ${a}(${s});
          var outC = getCoordsFromIndex(index);
          for (var i = 0; i < ${e}; i = i + 1) {
            if (${i} < ${r}) {
              ${i} = ${r} * 2 - ${i} - ${this.offset};
            } else if(${i} >= ${o}) {
              ${i} = (${o} - 1) * 2 - ${i} + ${this.offset};
            }
          }
          let coords = outC - start;
          setOutputAtIndex(index, getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iCe={kernelName:Sm,backendName:"webgpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{paddings:r,mode:o}=e,i=n,a=r.map(c=>({type:"int32",data:[c[0],c[1]]})),l=new oCe(s.shape,r,o);return i.runWebGPUProgram(l,[s],s.dtype,a)}};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aCe=Ns({opType:ht.MOD}),lCe={kernelName:mh,backendName:"webgpu",kernelFunc:aCe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uCe{constructor(e,n){this.variableNames=["probs"],this.outputShape=[],this.uniforms="seed : f32, numOutcomes: i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e,n],this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="multinomial"}getUserCode(){return`
    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    fn random (seed : f32, resultUV : vec2<f32>) -> f32 {
      let HASHSCALE1 = 443.8975;
      let p = resultUV * seed;
      var p3  = fract(vec3<f32>(p.xyx) * HASHSCALE1);
      p3 = p3 + dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Re("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let batch = coords[0];

        let resUV = vec2<f32>(f32(coords[1]) / f32(uniforms.outShape[1]),
            f32(coords[0]) / f32(uniforms.outShape[0]));
        let r = random(uniforms.seed, resUV);
        var cdf = 0.0;
        for (var i = 0; i < uniforms.numOutcomes - 1; i = i + 1) {
          cdf = cdf + getProbs(batch, i);

          if (r < cdf) {
            setOutputAtIndexI32(index, i);
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutputAtIndexI32(index, uniforms.numOutcomes - 1);
      }
    }
  `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cCe{constructor(e){this.variableNames=["logits"],this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=[this.outputShape[0],1,1],this.outputShape[1]>=4096?this.workgroupSize=[256,1,1]:this.workgroupSize=[64,1,1],this.shaderKey="softmax"}getUserCode(){return`
    var<workgroup> buf : array<f32, ${this.workgroupSize[0]}>;
    var<workgroup> rowMaxShared : f32;
    var<workgroup> rowSumShared : f32;
    const blockSize = ${this.workgroupSize[0]};
    ${Re("index")} {
      let row = index / blockSize;
      let tid = i32(localId.x);
      let cols = uniforms.outShape[1];

      var threadMax = -3.402823e+38f;
      for (var col = tid; col < cols; col += blockSize) {
        let value = getLogits(row, col);
        threadMax = max(threadMax, value);
      }
      if (tid < cols) {
        buf[tid] = threadMax;
      }
      workgroupBarrier();

      var reduceSize = min(cols, blockSize);
      for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
        reduceSize = currSize + (reduceSize & 1);
        if (tid < currSize) {
          buf[tid] = max(buf[tid], buf[tid + reduceSize]);
        }
        workgroupBarrier();
      }

      if (tid == 0) {
        rowMaxShared = buf[0];
      }
      workgroupBarrier();

      var threadSum = 0.0;
      for (var col = tid; col < cols; col += blockSize) {
        let subExp = exp(getLogits(row, col) - rowMaxShared);
        threadSum += subExp;
      }
      buf[tid] = threadSum;
      workgroupBarrier();

      for (var currSize = blockSize >> 1;  currSize > 0; currSize = currSize >> 1) {
        if (tid < currSize) {
          buf[tid] = buf[tid] + buf[tid + currSize];
        }
        workgroupBarrier();
      }

      if (tid == 0) {
        rowSumShared = buf[0];
      }
      workgroupBarrier();

      for (var col = tid; col < cols; col += blockSize) {
        let value = exp(getLogits(row, col) - rowMaxShared) / rowSumShared;
        setOutputAtCoords(row, col, value);
      }
  }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $M(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:o}=s,i=Ye({inputs:{x:r},backend:n,attrs:{shape:[te(r.shape)/r.shape[o],r.shape[o]]}}),a=new cCe(i.shape),l=n.runWebGPUProgram(a,[i],r.dtype),u=Ye({inputs:{x:l},backend:n,attrs:{shape:r.shape}});return n.disposeData(i.dataId),n.disposeData(l.dataId),u}const dCe={kernelName:Bm,backendName:"webgpu",kernelFunc:$M};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hCe(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s,l=a?r:$M({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),u=l.shape[0],c=l.shape[1],d=new uCe(u,o),h=[{type:"float32",data:[i]},{type:"int32",data:[c]}],p=n.runWebGPUProgram(d,[l],"int32",h);return a||n.disposeData(l.dataId),p}const pCe={kernelName:G0,backendName:"webgpu",kernelFunc:hCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fCe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const o=n.tensorMap.get(s.dataId),[i,a]=Swe(o.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,i)}const r=new Qh(s.shape,Te.NEG);return n.runWebGPUProgram(r,[s],s.dtype)}const mCe={kernelName:Cm,backendName:"webgpu",kernelFunc:fCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gCe(t){console.warn("tf.nonMaxSuppression() in webgpu locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s,u=n.readSync(r.dataId),c=n.readSync(o.dataId),{selectedIndices:d}=Pw(u,c,i,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const yCe={kernelName:H0,backendName:"webgpu",kernelFunc:gCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xCe(t){console.warn("tf.nonMaxSuppression() in webgpu locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,c=n.readSync(r.dataId),d=n.readSync(o.dataId),h=i,p=a,f=l,m=u,{selectedIndices:g,selectedScores:y}=Ow(c,d,h,p,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const wCe={kernelName:K0,backendName:"webgpu",kernelFunc:xCe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vCe{constructor(e,n){this.variableNames=["x"],this.uniforms="onValue : f32, offValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e,n],this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="onehot"}getUserCode(){return`
      ${Re("index")} {
        if(index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          setOutputAtIndex(index, mix(uniforms.offValue, uniforms.onValue,
                                      f32(i32(round(getX(coords.x))) == coords.y)));
        }
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bCe(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:l}=s,u=te(r.shape),c=new vCe(u,i),d=Ye({inputs:{x:r},backend:n,attrs:{shape:[u]}}),h=[{type:"float32",data:[a]},{type:"float32",data:[l]}],p=n.runWebGPUProgram(c,[d],o,h);n.disposeData(d.dataId);const f=[...r.shape,i],m=Ye({inputs:{x:p},backend:n,attrs:{shape:f}});return n.disposeData(p.dataId),m}const SCe={kernelName:$m,backendName:"webgpu",kernelFunc:bCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bx(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const r=fg({inputs:{input:s},backend:n}),o=Bx({inputs:{x:r},backend:n}),i=I1({inputs:{input:s},backend:n}),a=Bx({inputs:{x:i},backend:n}),l=Sc({inputs:{real:o,imag:a},backend:n});return n.disposeData(r.dataId),n.disposeData(o.dataId),n.disposeData(i.dataId),n.disposeData(a.dataId),l}else return Cr({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const CCe={kernelName:Wm,backendName:"webgpu",kernelFunc:Bx};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NM(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=fg({inputs:{input:s},backend:n}),o=NM({inputs:{x:r},backend:n}),i=I1({inputs:{input:s},backend:n}),a=Bx({inputs:{x:i},backend:n}),l=Sc({inputs:{real:o,imag:a},backend:n});return n.disposeData(r.dataId),n.disposeData(o.dataId),n.disposeData(i.dataId),n.disposeData(a.dataId),l}else return Cr({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const kCe={kernelName:Im,backendName:"webgpu",kernelFunc:NM};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ICe(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return jS({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(c=>{Er(o,c.shape,"All tensors passed to stack must have matching shapes"),A(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(c=>{const d=jS({inputs:{input:c},backend:n,attrs:{dim:r}});return a.push(d),d}),u=gM({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(c=>n.disposeData(c.dataId)),u}const $Ce={kernelName:Nm,backendName:"webgpu",kernelFunc:ICe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TM(t,e=!1){const n=t.length,s=Hn(n),r=t.map((d,h)=>`uniforms.pad${h}[0]`).join(","),o=t.map((d,h)=>`uniforms.pad${h}[0] + uniforms.xShape${n>1?`[${h}]`:""}`).join(","),i=n>1?`${s}(${r})`:`${r}`,a=n>1?`${s}(${o})`:`${o}`,l=n>1?"any(paddedCoords < start)":"paddedCoords < start",u=n>1?"any(paddedCoords >= end)":"paddedCoords >= end",c=n>1?["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n):"coords";return`
        let start = ${i};
        let end = ${a};
        if (${l} || ${u}) {
          setOutputAtIndex(index, ${e?0:"uniforms.constantValue"});
        } else {
          let coords = paddedCoords - start;
          setOutputAtIndex(index, getX(${c}));
        }
  `}class NCe{constructor(e,n){this.variableNames=["x"],this.uniforms="constantValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n.map((s,r)=>s[0]+e[r]+s[1]),this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),n.map((s,r)=>{this.uniforms+=` pad${r} : vec2<i32>,`}),this.xShape=e,this.shaderKey="pad"}getUserCode(){return`
      ${Re("index")} {
        if (index < uniforms.size) {
          let paddedCoords = getCoordsFromIndex(index);
          ${TM(this.xShape)}
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TCe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:o,constantValue:i}=s;if(o.every(u=>Ct(u,[0,0])))return Qr({inputs:{x:r},backend:n});if(te(r.shape)===0){const u=o.map((c,d)=>c[0]+r.shape[d]+c[1]);return Cr({backend:n,attrs:{shape:u,value:i,dtype:r.dtype}})}const a=[{type:"float32",data:[i]}];o.map(u=>a.push({type:"int32",data:[u[0],u[1]]}));const l=new NCe(r.shape,o);return n.runWebGPUProgram(l,[r],r.dtype,a)},ECe={kernelName:Tm,backendName:"webgpu",kernelFunc:TCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RCe=Ns({opType:ht.POW}),DCe={kernelName:yh,backendName:"webgpu",kernelFunc:RCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ACe(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e,o=new zx(ht.PRELU,s.shape,r.shape);return n.runWebGPUProgram(o,[s,r],"float32")}const _Ce={kernelName:Em,backendName:"webgpu",kernelFunc:ACe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;return Cc(r,o,i,"prod",n)}const PCe={kernelName:Rm,backendName:"webgpu",kernelFunc:FCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OCe=t=>{const{backend:e,attrs:n}=t,{start:s,stop:r,step:o,dtype:i}=n,a=Iwe(s,r,o,i);return e.makeTensorInfo([a.length],i,a)},LCe={kernelName:q0,backendName:"webgpu",kernelFunc:OCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zCe=Ns({opType:ht.DIV}),MCe={kernelName:Zd,backendName:"webgpu",kernelFunc:zCe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BCe=jt({opType:Te.RECIPROCAL}),VCe={kernelName:xh,backendName:"webgpu",kernelFunc:BCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UCe=jt({opType:Te.RELU}),WCe={kernelName:wh,backendName:"webgpu",kernelFunc:UCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jCe=jt({opType:Te.RELU6}),GCe={kernelName:vh,backendName:"webgpu",kernelFunc:jCe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HCe{constructor(e,n,s){this.variableNames=["x"],this.uniforms="adjustHeightWidth : vec2<f32>, halfPixelCenters : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e[0],n,s,e[3]],this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="resizeBilinear"}getUserCode(){return`
      ${Re("index")} {
        if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
          let b = coords[0];
          let d = coords[3];
          let rc = coords.yz;

          let effectiveInSize = vec2<f32>(
            f32(uniforms.xShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.xShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveOutSize = vec2<f32>(
            f32(uniforms.outShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.outShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveInputOverOutputRatioRC =
              effectiveInSize / effectiveOutSize;

          // Fractional source index
          let sourceFracIndexRC =
            (vec2<f32>(rc) + vec2<f32>(uniforms.halfPixelCenters)) *
            effectiveInputOverOutputRatioRC - vec2<f32>(uniforms.halfPixelCenters);

          // Compute the four integer indices.
          let sourceFloorRC = vec2<i32>(sourceFracIndexRC);
          let sourceCeilRC = vec2<i32>(
            min(vec2<f32>(uniforms.xShape.yz) - vec2<f32>(1.0), ceil(sourceFracIndexRC)));

          let topLeft = getX(b, sourceFloorRC.x, sourceFloorRC.y, d);
          let bottomLeft = getX(b, sourceCeilRC.x, sourceFloorRC.y, d);
          let topRight = getX(b, sourceFloorRC.x, sourceCeilRC.y, d);
          let bottomRight = getX(b, sourceCeilRC.x, sourceCeilRC.y, d);

          let fracRC = sourceFracIndexRC - vec2<f32>(sourceFloorRC);

          let top = topLeft + (topRight - topLeft) * fracRC.y;
          let bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
          let newValue = top + (bottom - top) * fracRC.x;

          setOutputAtIndex(index, newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KCe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,size:i,halfPixelCenters:a}=s,[l,u]=i,c=o&&l>1?1:0,d=o&&u>1?1:0,p=[{type:"float32",data:[c,d]},{type:"float32",data:[a?.5:0]}],f=new HCe(r.shape,l,u);return n.runWebGPUProgram(f,[r],"float32",p)}const qCe={kernelName:_m,backendName:"webgpu",kernelFunc:KCe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XCe{constructor(e,n){this.variableNames=["dy"],this.uniforms=`effectiveXSize : vec2<i32>, effectiveYSize : vec2<i32>, heightScale : f32, widthScale : f32,
       invHeightScale : f32, invWidthScale : f32, winHeight : i32, winWidth : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.alignCorners=n,this.shaderKey=`resizeBilinearBackprop_${n}`}getUserCode(){return`
      ${Re("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let b = coords[0];
          let d = coords[3];
          let r = coords[1];
          let c = coords[2];

          var accumulator = 0.0;

          // Compute bounds for where in dy we will look
          let startRLerp = floor(f32(r) * uniforms.invHeightScale);
          let startDyR = i32(startRLerp - f32(uniforms.winHeight / 2));

          let startCLerp = floor(f32(c) * uniforms.invWidthScale);
          let startDyC = i32(startCLerp - f32(uniforms.winWidth / 2));

          // Loop over dy
          for (var dyROffset = 0; dyROffset < uniforms.winHeight; dyROffset++) {
            let dyR = startDyR + dyROffset;

            // Guard against the window exceeding the bounds of dy
            if (dyR < 0 || dyR >= uniforms.dyShape[1]) {
              continue;
            }

            for (var dyCOffset = 0; dyCOffset < uniforms.winWidth; dyCOffset++) {
              let dyC = startDyC + dyCOffset;

              // Guard against the window exceeding the bounds of dy
              if (dyC < 0 || dyC >= uniforms.dyShape[2]) {
                continue;
              }

              let dxR = f32(dyR) * uniforms.heightScale;
              let topDxRIndex = i32(floor(dxR));
              let bottomDxRIndex = i32(min(ceil(dxR), f32(uniforms.outShape[1] - 1)));
              let dxRLerp = dxR - f32(topDxRIndex);
              let inverseDxRLerp = 1.0 - dxRLerp;

              let dxC = f32(dyC) * uniforms.widthScale;
              let leftDxCIndex = i32(floor(dxC));
              let rightDxCIndex = i32(min(ceil(dxC), f32(uniforms.outShape[2] - 1)));
              let dxCLerp = dxC - f32(leftDxCIndex);
              let inverseDxCLerp = 1.0 - dxCLerp;

              if (r == topDxRIndex && c == leftDxCIndex) {
                // topLeft
                accumulator +=
                  getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
              }

              if (r == topDxRIndex && c == rightDxCIndex) {
                // topRight
                accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
              }

              if (r == bottomDxRIndex && c == leftDxCIndex) {
                // bottomLeft
                accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
              }

              if (r == bottomDxRIndex && c == rightDxCIndex) {
                // bottomRight
                accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
              }
            }
          }
          // End loop over dy

          setOutputAtIndex(index, accumulator);
        }
      }
    `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YCe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s,[,a,l]=r.shape,[,u,c]=o.shape,d=[i&&u>1?a-1:a,i&&c>1?l-1:l],h=[i&&u>1?u-1:u,i&&c>1?c-1:c],p=d[0]/h[0],f=d[1]/h[1],m=1/p,g=1/f,y=Math.ceil(m)*2+2,x=Math.ceil(g)*2+2,v=new XCe(r.shape,i),b=[{type:"int32",data:d},{type:"int32",data:h},{type:"float32",data:[p]},{type:"float32",data:[f]},{type:"float32",data:[m]},{type:"float32",data:[g]},{type:"int32",data:[y]},{type:"int32",data:[x]}];return n.runWebGPUProgram(v,[o],o.dtype,b)}const QCe={kernelName:Q0,backendName:"webgpu",kernelFunc:YCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JCe{constructor(e,n,s,r){this.variableNames=["x"],this.uniforms="adjustHeightWidth : vec2<f32>, roundBase : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e[0],n,s,e[3]],this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.halfPixelCenters=r,this.shaderKey=`resizeNearest_${r}`}getUserCode(){let e;return this.halfPixelCenters?e="max((vec2<f32>(rc) + vec2<f32>(0.5)) * effectiveInputOverOutputRatioRC, vec2<f32>(0.0))":e="vec2<f32>(rc) * effectiveInputOverOutputRatioRC",`
      ${Re("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let b = coords[0];
          let d = coords[3];
          let rc = coords.yz;

          let effectiveInSize = vec2<f32>(
            f32(uniforms.xShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.xShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveOutSize = vec2<f32>(
            f32(uniforms.outShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.outShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveInputOverOutputRatioRC =
              effectiveInSize / effectiveOutSize;

          // Fractional source index
          let sourceFracIndexRC = ${e};

          // Compute the coordinators of nearest neighbor point.
          let inputShapeRC = vec2<f32>(f32(uniforms.xShape.y), f32(uniforms.xShape.z));
          let sourceNearestRC = vec2<i32>(
            min(inputShapeRC - 1.0, floor(sourceFracIndexRC + uniforms.roundBase)));
          let newValue = getX(b, sourceNearestRC.x, sourceNearestRC.y, d);

          setOutputAtIndex(index, newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZCe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[l,u]=a,c=o&&l>1?1:0,d=o&&u>1?1:0,p=[{type:"float32",data:[c,d]},{type:"float32",data:[o?.5:0]}],f=new JCe(r.shape,l,u,i);return n.runWebGPUProgram(f,[r],r.dtype,p)}const e2e={kernelName:Am,backendName:"webgpu",kernelFunc:ZCe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t2e{constructor(e,n){this.variableNames=["dy"],this.uniforms=`effectiveXSize : vec2<i32>, effectiveYSize : vec2<i32>, invHeightScale : f32, invWidthScale : f32,
       winHeight : i32, winWidth : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.alignCorners=n,this.shaderKey=`resizeNearestNeigborBackprop_${n}`}getUserCode(){return`
      ${Re("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let b = coords[0];
          let d = coords[3];
          let r = coords[1];
          let c = coords[2];

          var accumulator = 0.0;

          // Compute bounds for where in dy we will look
          let startRLerp = floor(f32(r) * uniforms.invHeightScale);
          let startDyR = i32(floor(startRLerp - f32(uniforms.winHeight / 2)));

          let startCLerp = floor(f32(c) * uniforms.invWidthScale);
          let startDyC = i32(floor(startCLerp - f32(uniforms.winWidth / 2)));

          // Loop over dy
          for (var dyROffset = 0; dyROffset < uniforms.winHeight; dyROffset++) {
            let dyR = startDyR + dyROffset;

            // Guard against the window exceeding the bounds of dy
            if (dyR < 0 || dyR >= uniforms.dyShape[1]) {
              continue;
            }

            for (var dyCOffset = 0; dyCOffset < uniforms.winWidth; dyCOffset++) {
              let dyC = startDyC + dyCOffset;

              // Guard against the window exceeding the bounds of dy
              if (dyC < 0 || dyC >= uniforms.dyShape[2]) {
                continue;
              }

              let sourceFracRow = f32(uniforms.effectiveXSize[0]) *
                  (f32(dyR) / f32(uniforms.effectiveYSize[0]));

              let sourceFracCol = f32(uniforms.effectiveXSize[1]) *
                  (f32(dyC) / f32(uniforms.effectiveYSize[1]));

              let sourceNearestRow =
                  i32(min(f32(uniforms.outShape[1] - 1),
                  ${this.alignCorners?"floor(sourceFracRow + 0.5)":"floor(sourceFracRow)"}));

              let sourceNearestCol =
                  i32(min(f32(uniforms.outShape[2] - 1),
                  ${this.alignCorners?"floor(sourceFracCol + 0.5)":"floor(sourceFracCol)"}));

              if (r == sourceNearestRow && c == sourceNearestCol) {
                accumulator += getDy(b, dyR, dyC, d);
              }
            }
          }
          // End loop over dy

          setOutputAtIndex(index, accumulator);
        }
      }
    `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n2e(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s,[,a,l]=r.shape,[,u,c]=o.shape,d=[i&&u>1?a-1:a,i&&c>1?l-1:l],h=[i&&u>1?u-1:u,i&&c>1?c-1:c],p=d[0]/h[0],f=d[1]/h[1],m=1/p,g=1/f,y=Math.ceil(m)*2+2,x=Math.ceil(g)*2+2,v=new t2e(r.shape,i),b=[{type:"int32",data:d},{type:"int32",data:h},{type:"float32",data:[m]},{type:"float32",data:[g]},{type:"int32",data:[y]},{type:"int32",data:[x]}];return n.runWebGPUProgram(v,[o],o.dtype,b)}const s2e={kernelName:Y0,backendName:"webgpu",kernelFunc:n2e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r2e{constructor(e){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=" axis : vec4<i32>,",this.shaderKey="reverse"}getUserCode(){return`
      
      // Using uniform variables as judging conditions, so the function has
      // coherent execution within all threads.
      fn getReverseCoords(coords : vec4<i32>) -> vec4<i32> {
        var reverseCoords = coords;
        if (uniforms.axis[0] == 1) {
          reverseCoords[0] = uniforms.xShape[0] - coords[0] - 1;
        }
        if (uniforms.axis[1] == 1) {
          reverseCoords[1] = uniforms.xShape[1] - coords[1] - 1;
        }
        if (uniforms.axis[2] == 1) {
          reverseCoords[2] = uniforms.xShape[2] - coords[2] - 1;
        }
        if (uniforms.axis[3] == 1) {
          reverseCoords[3] = uniforms.xShape[3] - coords[3] - 1;
        }

        return reverseCoords;
      }
    
      ${Re("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let reverseCoords = getReverseCoords(coords);
          setOutputAtIndex(index, getX(reverseCoords[0],
              reverseCoords[1], reverseCoords[2], reverseCoords[3]));
        }
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:o}=s,i=r.shape.length;if(i===0)return Qr({inputs:{x:r},backend:n});const a=r.shape,l=[1,1,1,1];a.forEach((g,y)=>{const x=y+4-i;l[x]=g});const u=xt(o,r.shape),c=[0,0,0,0];u.forEach(g=>{const y=g+4-i;c[y]=1});const d=[{type:"int32",data:c}],h=Ye({inputs:{x:r},backend:n,attrs:{shape:l}}),p=new r2e(l),f=n.runWebGPUProgram(p,[h],h.dtype,d);n.disposeData(h.dataId);const m=Ye({inputs:{x:f},backend:n,attrs:{shape:a}});return n.disposeData(f.dataId),m}const i2e={kernelName:Fm,backendName:"webgpu",kernelFunc:o2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a2e{constructor(e,n){this.outputShape=[],this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=`centerX : f32, centerY : f32, sinRadians : f32,
          cosRadians : f32,`,this.shaderKey="rotate",this.outputShape=e,typeof n=="number"?(this.uniforms+=" fillValue : f32,",this.fillSnippet="var outputValue = uniforms.fillValue;",this.shaderKey+="_float"):(this.uniforms+=" fillValue : vec3<f32>,",this.fillSnippet="var outputValue = uniforms.fillValue[coords[3]];",this.shaderKey+="_vec3")}getUserCode(){return`
        ${Re("index")} {
          if (index < uniforms.size) {
            let coords = getCoordsFromIndex(index);
            let coordXFloat = (f32(coords[2]) - uniforms.centerX) *
                uniforms.cosRadians - (f32(coords[1]) - uniforms.centerY) *
                uniforms.sinRadians;
            let coordYFloat = (f32(coords[2]) - uniforms.centerX) *
                uniforms.sinRadians + (f32(coords[1]) - uniforms.centerY) *
                uniforms.cosRadians;
            let coordX = i32(round(coordXFloat + uniforms.centerX));
            let coordY = i32(round(coordYFloat + uniforms.centerY));
            ${this.fillSnippet}
            if(coordX >= 0 && coordX < uniforms.xShape[2] && coordY >= 0 &&
                coordY < uniforms.xShape[1]) {
              outputValue = getX(coords[0], coordY, coordX, coords[3]);
            }
            setOutputAtIndex(index, outputValue);
          }
        }
      `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l2e={kernelName:cw,backendName:"webgpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:o,center:i}=e,a=n,l=new a2e(s.shape,o),[u,c]=Ww(i,s.shape[1],s.shape[2]),d=[{type:"float32",data:[u]},{type:"float32",data:[c]},{type:"float32",data:[Math.sin(r)]},{type:"float32",data:[Math.cos(r)]}];return typeof o=="number"?d.push({type:"float32",data:[Number.parseFloat(o.toFixed(2))]}):d.push({type:"float32",data:o}),a.runWebGPUProgram(l,[s],s.dtype,d)}};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u2e=jt({opType:Te.ROUND}),c2e={kernelName:bh,backendName:"webgpu",kernelFunc:u2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d2e=jt({opType:Te.RSQRT,cpuKernelImpl:$we}),h2e={kernelName:Sh,backendName:"webgpu",kernelFunc:d2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hp{constructor(e,n,s,r,o,i,a,l=!0){this.variableNames=["updates","indices"],this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=i,this.type=a,this.sumDupeIndices=l,this.dispatchLayout=Ve(e),this.dispatch=De(this.dispatchLayout,e,this.workgroupSize),this.sliceDimGreaterThanOne=n>1,this.shaderKey=`scatter_${s}_${r}_${this.sliceDimGreaterThanOne}_${a}_${l}_${o.length}`;const u=Hn(o.length);this.uniforms=`sliceDim : i32, strides: ${u}, updatesSize: i32,`,this.updatesRank=r,this.indicesRank=s}getUserCode(){let e="";this.indicesRank===1?e="coords[0]":this.indicesRank===2&&(e="coords[0], j");const n=`getIndices(${e})`,s=this.sliceDimGreaterThanOne?"uniforms.strides[j]":"uniforms.strides";let r="",o="";this.dispatchLayout.x.length===1?(r="flattenedIndex",o=`
      fn getUpdatesCoordsFromFlatIndex(index : i32) -> i32 {
        return index;
      }
      `):this.dispatchLayout.x.length===2&&(r="vec2<i32>(flattenedIndex, coords[1])",o=`
      fn getUpdatesCoordsFromFlatIndex(index : i32) -> vec2<i32> {
        // N.B. |updates| could be a scalar tensor, conceptually representing a
        // 2D tensor with all values equal to that. By design, its size must be
        // the same as |outShape[1]| in one dimension, and |indicesShape[0]|
        // gives the other.
        let sliceSize = uniforms.outShape[1];
        let d0 = index / sliceSize;
        let d1 = index - d0 * sliceSize;
        return vec2<i32>(d0, d1);
      }
      `);const a=`getUpdates(${Array.from({length:this.updatesRank},(u,c)=>`coords[${c}]`).join(", ")})`;return`
    ${o}
      ${Re("index")} {
        if (index < uniforms.updatesSize) {
          let coords = getUpdatesCoordsFromFlatIndex(index);
          var flattenedIndex = 0;
          for (var j = 0; j < uniforms.sliceDim; j = j + 1) {
            let indexInside = i32(round(${n}));
            flattenedIndex = flattenedIndex + indexInside * ${s};
          }
          let updateValue =
              ${gu(this.type)}(${a});
          let flatIndex = getOutputIndexFromCoords(${r});

          ${this.sumDupeIndices?Ql("&result[flatIndex]","updateValue",this.type):"atomicStore(&result[flatIndex], bitcast<i32>(updateValue));"}
        }
      }`}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p2e(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:d}=fa(o,r,i),h=[d/u,u];if(d===0)return n.makeTensorInfo(i,r.dtype);const p=Ye({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),f=Ye({inputs:{x:o},backend:n,attrs:{shape:[l,u]}}),m=f.dtype,g=Cr({backend:n,attrs:{shape:h,value:0,dtype:m}}),y=te(f.shape),x=[{type:"int32",data:[a]},{type:"int32",data:c},{type:"int32",data:[y]}],v=new Hp(f.shape,a,p.shape.length,f.shape.length,c,h,m),b=n.runWebGPUProgram(v,[f,p],m,x,g),S=Ye({inputs:{x:b},backend:n,attrs:{shape:i}});return n.disposeData(p.dataId),n.disposeData(f.dataId),n.disposeData(b.dataId),S}const f2e={kernelName:J0,backendName:"webgpu",kernelFunc:p2e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m2e{constructor(e,n){this.outputShape=[],this.variableNames=["sortedSequence","values"],this.uniforms="numInputs : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.side=n,this.shaderKey=`search_sorted_${n}`}getUserCode(){return`
      fn findBound(batch: i32, value: f32) -> i32 {
        var left = i32(0);
        var right = uniforms.numInputs;
        while (left < right) {
          var mid = (left + right) / 2;
          if (getSortedSequence(batch, mid) ${this.side==="left"?"<":"<="} value) {
            left = mid + 1;
          } else {
            right = mid;
          }
        }
        return right;
      }

      ${Re("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let value = getValuesByOutputIndex(index);
          setOutputAtIndexI32(index, findBound(coords[0], value));
        }
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g2e(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:o}=e,{side:i}=s,a=new m2e([o.shape[0],o.shape[1]],i),l=[{type:"int32",data:[r.shape[1]]}];return n.runWebGPUProgram(a,[r,o],"int32",l)}const y2e={kernelName:ew,backendName:"webgpu",kernelFunc:g2e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x2e{constructor(e,n,s){this.variableNames=["c","a","b"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=n,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.cRank=e,this.rank=s,this.shaderKey="select"}getUserCode(){let e,n;if(this.rank>4)throw Error(`Where for rank ${this.rank} is not yet supported`);if(this.rank===1)n="resRC",e="resRC";else{const r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=[];for(let a=0;a<this.outputShape.length;a++)i.push(`${r[a]}`),a<this.cRank&&o.push(`${r[a]}`);e=o.join(),n=i.join()}return`
      ${Re("index")} {
        if (index < uniforms.size) {
          let resRC = getCoordsFromIndex(index);
          let cVal = getC(${e});
          if (cVal >= 1.0) {
            setOutputAtIndex(index, getA(${n}));
          } else {
            setOutputAtIndex(index, getB(${n}));
          }
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w2e(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:o}=e,i=new x2e(s.shape.length,r.shape,r.shape.length);return n.runWebGPUProgram(i,[s,r,o],$s(r.dtype,o.dtype))}const v2e={kernelName:Pm,backendName:"webgpu",kernelFunc:w2e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b2e=jt({opType:Te.SELU}),S2e={kernelName:Ch,backendName:"webgpu",kernelFunc:b2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C2e=jt({opType:Te.SIGMOID}),k2e={kernelName:Nh,backendName:"webgpu",kernelFunc:C2e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I2e=jt({opType:Te.SIGN}),$2e={kernelName:$h,backendName:"webgpu",kernelFunc:I2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N2e=jt({opType:Te.SIN}),T2e={kernelName:kh,backendName:"webgpu",kernelFunc:N2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E2e=jt({opType:Te.SINH}),R2e={kernelName:Ih,backendName:"webgpu",kernelFunc:E2e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D2e=jt({opType:Te.SOFTPLUS}),A2e={kernelName:Th,backendName:"webgpu",kernelFunc:D2e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _2e{constructor(e,n,s,r,o,i){this.variableNames=["x"],this.outputShape=[],this.uniforms="",this.workgroupSize=[64,1,1],this.size=!0;const a=new Array(r.length);for(let l=0;l<a.length;l++)a[l]=r[o[l]];this.outputShape=a,this.newDim=o,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.xShape=e,this.paddedXShape=n,this.uniforms+=`reshapedPaddedXShape : ${Hn(r.length)}, paddedXShapeStrides : ${Hn(i)}, `,s.map((l,u)=>{this.uniforms+=` pad${u} : vec2<i32>,`}),this.shaderKey=`spaceToBatchND_${o}`}getUserCode(){const e=Hn(this.outputShape.length),n=uM(this.newDim);return`
      ${$y(this.paddedXShape,"PaddedX")}
      ${Re("index")} {
        if(index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let switchedIndex = getIndexFromCoords${this.outputShape.length}D(${e}(${n}), uniforms.reshapedPaddedXShape);
          let paddedCoords = getPaddedXCoordsFromIndex(switchedIndex);
          ${TM(this.xShape,!0)}
        }
      }
    `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F2e=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,paddings:i}=s;A(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGPU backend not implemented yet");const a=o.reduce((x,v)=>x*v),l=[[0,0]];l.push(...i);for(let x=1+o.length;x<r.shape.length;++x)l.push([0,0]);const u=l.map((x,v)=>x[0]+r.shape[v]+x[1]),c=hc(u,o,a,!1),d=pc(c.length,o.length,!1),h=fc(u,o,a,!1),p=st(u),f=new _2e(r.shape,u,l,c,d,p.length),m=[{type:"int32",data:c},{type:"int32",data:p}];l.map(x=>m.push({type:"int32",data:[x[0],x[1]]}));const g=n.runWebGPUProgram(f,[r],r.dtype,m),y=Ye({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeData(g.dataId),y},P2e={kernelName:zm,backendName:"webgpu",kernelFunc:F2e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O2e{constructor(e,n,s){this.variableNames=["input","indices","segmentIds"],this.outputShape=[],this.uniforms="segmentSize : i32, sparseSize : i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=e,this.type=s,this.dispatchLayout=Ve([n]),this.dispatch=De(this.dispatchLayout,[n],this.workgroupSize),this.shaderKey="sparseSegmentSum"}getUserCode(){return`
    ${Re("index")} {
      if (index < uniforms.sparseSize) {
        let indexInSegmentIds = index / uniforms.segmentSize;
        let indexInSegment = index % uniforms.segmentSize;
        let indexInInput = indices[indexInSegmentIds];
        let segmentId = segmentIds[indexInSegmentIds];

        let value = input[indexInInput * uniforms.segmentSize + indexInSegment];
        let outIndex = segmentId * uniforms.segmentSize + indexInSegment;
        ${Ql("&result[outIndex]","value",this.type)}
      }
    }
  `}}class L2e{constructor(e,n){this.variableNames=["segmentIds"],this.outputShape=[],this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=[e],this.dispatchLayout=Ve(n),this.dispatch=De(this.dispatchLayout,n,this.workgroupSize),this.shaderKey="sparseSegmentIdCountProgram"}getUserCode(){return`
    ${Re("index")} {
      if (index < uniforms.segmentIdsShape) {
        let segmentId = segmentIds[index];
        ${Ql("&result[segmentId]","1","int32")}
      }
    }
  `}}class z2e{constructor(e,n){this.variableNames=["segmentSum","sameSegmentIdCount"],this.outputShape=[],this.uniforms="segmentSize : i32",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.type=n,this.dispatchLayout=Ve(e),this.dispatch=De(this.dispatchLayout,e,this.workgroupSize),this.shaderKey="sparseSegmentMean"}getUserCode(){return`
    ${Re("index")} {
      if (index < uniforms.size) {
        let segmentId = index / uniforms.segmentSize;
        let count = sameSegmentIdCount[segmentId];
        if (count != 0) {
          ${this.type==="float32"?"setOutputAtIndex(index, segmentSum[index] / f32(count));":"setOutputAtIndexI32(index, segmentSum[index] / count);"}
        }
      }
    }
  `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EM(t,e,n,s=!1,r){const i=te(t.shape)/t.shape[0],a=t.dtype,l=te(e.shape),u=r.readSync(n.dataId),d=l>0?u[l-1]+1:0;let h;const p=t.shape.slice();p[0]=d;const f=l*i,m=Cr({backend:r,attrs:{shape:p,value:0,dtype:a}});h=new O2e(p,f,a);let g=[{type:"int32",data:[i]},{type:"int32",data:[f]}];const y=r.runWebGPUProgram(h,[t,e,n],a,g,m);if(s)return y;const x=Cr({backend:r,attrs:{shape:[d],value:0,dtype:"int32"}});h=new L2e(d,n.shape);const v=r.runWebGPUProgram(h,[n],"int32",null,x),b=Cr({backend:r,attrs:{shape:p,value:0,dtype:a}});h=new z2e(p,a),g=[{type:"int32",data:[i]}];const S=r.runWebGPUProgram(h,[y,v],a,g,b);return r.disposeData(y.dataId),r.disposeData(v.dataId),S}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M2e(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;return EM(s,r,o,!1,n)}const B2e={kernelName:tw,backendName:"webgpu",kernelFunc:M2e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V2e(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;return EM(s,r,o,!0,n)}const U2e={kernelName:nw,backendName:"webgpu",kernelFunc:V2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W2e{constructor(e,n){this.variableNames=["A"],this.workgroupSize=[64,1,1],this.size=!0;const s=new Array(e.length);for(let r=0;r<s.length;r++)s[r]=e[r]*n[r];this.outputShape=s,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.rank=this.outputShape.length,this.shaderKey="tile"}getUserCode(){const e=j2e(this.rank,"uniforms.");return`
      ${Re("index")} {
        if (index < uniforms.size) {
          let resRC = getCoordsFromIndex(index);
          setOutputAtIndex(index, getA(${e}));
        }
      }
    `}}function j2e(t,e=""){if(t>=5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`(resRC % ${e}aShape)`;const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<t;r++)s.push(`(${n[r]} % ${e}aShape[${r}])`);return s.join()}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mI(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:o}=s;if(n.shouldExecuteOnCPU([r])||r.dtype==="string"||r.shape.length>=5){const l=n.readSync(r.dataId),u=r.dtype==="string"?l.map(h=>ki(h)):l,c=yt(r.shape,r.dtype,u),d=_we(c,o);return n.makeTensorInfo(d.shape,d.dtype,d.values)}const i=new W2e(r.shape,o);return n.runWebGPUProgram(i,[r],r.dtype)}const G2e={kernelName:Fh,backendName:"webgpu",kernelFunc:mI};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H2e(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:c,strides:d,outputSize:h}=fa(o,r,a),p=!1;if(o.dtype==="string"){const T=n.bufferSync(r),R=n.bufferSync(o),_=ki(n.readSync(i.dataId)[0]),P=Nwe(T,R,a,h,c,u,l,d,_,p);return n.makeTensorInfo(a,P.dtype,P.values)}const f=[h/c,c],m=Ye({inputs:{x:r},backend:n,attrs:{shape:[u,l]}}),g=o.shape.length?Ye({inputs:{x:o},backend:n,attrs:{shape:[u,c]}}):Qr({inputs:{x:o},backend:n}),y=g.dtype,x=n.makeTensorInfo([],y,Ls(1,y)),v=Ye({inputs:{x:i},backend:n,attrs:{shape:Array(f.length).fill(1)}}),b=mI({inputs:{x:v},backend:n,attrs:{reps:f}}),S=te([u,c]),C=[{type:"int32",data:[l]},{type:"int32",data:d},{type:"int32",data:[S]}];switch(u){case 0:break;case 1:{const T=new Hp([u,c],l,m.shape.length,g.shape.length,d,f,y,p);n.runWebGPUProgram(T,[g,m],y,C,b)}break;default:{const T=new Hp([u,c],l,m.shape.length,x.shape.length,d,f,y,p);n.runWebGPUProgram(T,[x,m],y,C,b)}{const T=new Hp([u,c],l,m.shape.length,g.shape.length,d,f,y);n.runWebGPUProgram(T,[g,m],y,C,b)}}const I=Ye({inputs:{x:b},backend:n,attrs:{shape:a}});return n.disposeData(m.dataId),n.disposeData(g.dataId),n.disposeData(v.dataId),n.disposeData(x.dataId),n.disposeData(b.dataId),I}const K2e={kernelName:sw,backendName:"webgpu",kernelFunc:H2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=xt(i,r.shape)[0],l=s1(r,o,a),u=r.shape.length,c=new Array(u).fill(0),d=r.shape.slice();return l.map(h=>{const p=[...d];p[a]=h;const f=Jh({inputs:{x:r},backend:n,attrs:{begin:c,size:p}});return c[a]+=h,f})}const X2e={kernelName:Mm,backendName:"webgpu",kernelFunc:q2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y2e=jt({opType:Te.SQRT}),Q2e={kernelName:Eh,backendName:"webgpu",kernelFunc:Y2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J2e={kernelName:rw,backendName:"webgpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e,r=new Qh(n.shape,Te.SQUARE);return s.runWebGPUProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z2e=Ns({opType:ht.SQUARED_DIFFERENCE}),eke={kernelName:Rh,backendName:"webgpu",kernelFunc:Z2e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tke({inputs:t,attrs:e,backend:n}){const{x:s}=t,r=new Qh(s.shape,Te.STEP,"stepAlpha : f32,"),o=[{type:"float32",data:[e.alpha]}];return n.runWebGPUProgram(r,[s],s.dtype,o)}const nke={kernelName:Ph,backendName:"webgpu",kernelFunc:tke};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ske{constructor(e){this.variableNames=["x"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]);const n=Hn(this.outputShape.length);this.uniforms=`begin : ${n},  strides : ${n}, `,this.shaderKey="stridedSlice"}getUserCode(){const e=this.outputShape.length;let n="";if(e===1)n="coords * uniforms.strides + uniforms.begin";else{let r=0;n=this.outputShape.map((o,i)=>(r++,this.outputShape.length===1?`coords * uniforms.strides[${i}] + uniforms.begin[${i}]`:`coords[${r-1}] * uniforms.strides[${i}] + uniforms.begin[${i}]`)).join(",")}return`
       ${Re("index")} {
         if (index < uniforms.size) {
           let coords = getCoordsFromIndex(index);
           setOutputAtIndex(index, getX(${n}));
         }
       }
     `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:d,shrinkAxisMask:h}=s,{finalShapeSparse:p,finalShape:f,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:x,end:v,strides:b}=Bw(r.shape,o,i,a,l,u,c,d,h);let S;if(m)S=Ye({inputs:{x:r},backend:n,attrs:{shape:f}});else if(g||y){A(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const C=Mw(x,v,b),I=Jh({inputs:{x:r},backend:n,attrs:{begin:x,size:C}});S=Ye({inputs:{x:I},backend:n,attrs:{shape:f}}),n.disposeData(I.dataId)}else if(n.shouldExecuteOnCPU([r])){const I=n.readSync(r.dataId),T=yt(r.shape,r.dtype,I),R=Rwe(p,T,b,x);S=n.makeTensorInfo(f,r.dtype,R.values)}else{const I=new ske(p),T=[{type:"int32",data:x},{type:"int32",data:b}],R=n.runWebGPUProgram(I,[r],r.dtype,T);S=Ye({inputs:{x:R},backend:n,attrs:{shape:f}}),n.disposeData(R.dataId)}return S}const oke={kernelName:iw,backendName:"webgpu",kernelFunc:rke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ike(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:c,dataSplits:d}=e,h=n.readSync(c.dataId),p=n.readSync(d.dataId),[f,m]=Dwe(h,p,r,o,i,a,l,u);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(d.shape,"int32",m)]}const ake={kernelName:aw,backendName:"webgpu",kernelFunc:ike};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lke=Ns({opType:ht.SUB,cpuKernelImpl:Awe,supportsComplex:!0}),uke={kernelName:Dh,backendName:"webgpu",kernelFunc:lke};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cke=jt({opType:Te.TAN}),dke={kernelName:Ah,backendName:"webgpu",kernelFunc:cke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hke=jt({opType:Te.TANH}),pke={kernelName:_h,backendName:"webgpu",kernelFunc:hke};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fke(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:r,indices:o,updates:i}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:d}=fa(i,o,r.shape),h=[d/u,u];if(d===0)return n.makeTensorInfo(r.shape,o.dtype);const p=[],f=Ye({inputs:{x:o},backend:n,attrs:{shape:[l,a]}});p.push(f);const m=Ye({inputs:{x:i},backend:n,attrs:{shape:[l,u]}});p.push(m);const g=Ye({inputs:{x:r},backend:n,attrs:{shape:h}});p.push(g);const y=mI({inputs:{x:g},backend:n,attrs:{reps:Array(h.length).fill(1)}}),x=new Hp([l,u],a,f.shape.length,m.shape.length,c,h,r.dtype,!1),v=te([l,u]),b=[{type:"int32",data:[a]},{type:"int32",data:c},{type:"int32",data:[v]}],S=n.runWebGPUProgram(x,[m,f],g.dtype,b,y);p.push(S);const C=Ye({inputs:{x:S},backend:n,attrs:{shape:r.shape}});return p.forEach(I=>n.disposeData(I.dataId)),C}const mke={kernelName:Z0,backendName:"webgpu",kernelFunc:fke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gke{constructor(e){this.variableNames=["x","indices"],this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=`inputSize : i32, firstPass : i32, negativeInf : f32,
        dir : i32, inc : i32,`,this.shaderKey="swap"}getUserCode(){return`
        ${Re("index")} {
          if (index < uniforms.size) {
            let outC = getCoordsFromIndex(index);
            let batch = outC[0];
            let elemIdx = outC[1];
            // We compare elements pair-wise within a group of size 2 * inc.
            // The comparing rule for each group alternates between ascending
            // and descending. Within each group, we compare each pair at
            // positions i and i+inc. To decide whether an element at position i
            // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
            // inc, it is in the first half of the group, we denote it as x0,
            // otherwise we denote it as x1.
            // For example, as shown in the Bitonic top K paper referenced
            // above, Figure5(a) shows that element[1] is in the second half of
            // the group when group size is 2, but it is in the first half of
            // the group when group size is 4.
            let isFirstInPair = elemIdx % (2 * uniforms.inc) < uniforms.inc;
            var i = 0;
            if (isFirstInPair) {
              i = elemIdx;
            } else {
              i = elemIdx - uniforms.inc;
            }

            var i0 = 0;
            if (uniforms.firstPass == 1) {
              i0 = i;
            } else {
              i0 = i32(getIndices(batch, i));
            }

            var i1 = 0;
            if (uniforms.firstPass == 1) {
              i1 = i + uniforms.inc;
            } else {
              i1 = i32(getIndices(batch, i + uniforms.inc));
            }

            var x0 = f32(0.0);
            var x1 = f32(0.0);
            if (i0 < uniforms.inputSize) {
              x0 = getX(batch, i0);
            } else {
              x0 = uniforms.negativeInf;
            }
            if (i1 < uniforms.inputSize) {
              x1 = getX(batch, i1);
            } else {
              x1 = uniforms.negativeInf;
            }

            let reverse = elemIdx % (2 * uniforms.dir) >= uniforms.dir;
            let isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
            if (reverse == isGreater) {
              // Elements in opposite order of direction
              let iTemp = i0;
              i0 = i1;
              i1 = iTemp;
            }
            if (isFirstInPair) {
              setOutputAtIndex(index, f32(i0));
            } else {
              setOutputAtIndex(index, f32(i1));
            }
          }
        }
      `}}class yke{constructor(e){this.variableNames=["x","indices"],this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms="inputSize : i32, firstPass : i32, k : i32,",this.shaderKey="merge"}getUserCode(){return`
        ${Re("index")} {
          if (index < uniforms.size) {
            let outC = getCoordsFromIndex(index);
            let batch = outC[0];
            let elemIdx = outC[1];
            // The output size is half of the previous size.
            // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _
            // (k=4), we only need to output the indices at positions |, the
            // indices at positions _ can be thrown away, see Figure5(b) After
            // Phase 2 (Merge phase) in the Bitonic Top K paper referenced
            // above.
            // For example, the paper shows we only need to output the orange
            // bars. The output sequence should look like this | | | | | | | |.
            // Because the sequence is halved, to map the output index back to
            // the previous sequence to find the corresponding value, we need
            // to double the index. When we double the index, we basically
            // interpolate a position, so 2i looks like
            // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k
            // position of each 2k positions by - elemIdx % k. E.g. for output
            // at index 4,5,6,7, we want to get the corresponding element at
            // original index 8,9,10,11, for output at index 8,9,10,11,
            // we want to get the corresponding element at original index
            // 16,17,18,19, so on and so forth.

            var i = 0;
            if (elemIdx < uniforms.k) {
              i = elemIdx;
            } else {
              i = elemIdx * 2 - elemIdx % uniforms.k;
            }
            var i0 = 0;
            if (uniforms.firstPass == 1) {
              i0 = i;
            } else {
              i0 = i32(getIndices(batch, i));
            }
            var i1 = 0;
            if (uniforms.firstPass == 1) {
              i1 = i + uniforms.k;
            } else {
              i1 = i32(getIndices(batch, i + uniforms.k));
            }

            let x0 = getX(batch, i0);
            var x1 = f32(0.0);
            if (i1 < uniforms.inputSize) {
              x1 = getX(batch, i1);
            } else {
              x1 = x0;
            }

            if (x0 >= x1) {
              setOutputAtIndex(index, f32(i0));
            } else {
              setOutputAtIndex(index, f32(i1));
            }
          }
        }
      `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fc(t,e){e!==null&&t.disposeData(e.dataId)}function IE(t){let e=1;for(;e<t;)e*=2;return e}function xke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:o,sorted:i}=s,a=r.shape,l=a[a.length-1];if(n.shouldExecuteOnCPU([r])){const S=n.readSync(r.dataId),[C,I]=Fwe(S,a,r.dtype,o,i);return[n.makeTensorInfo(C.shape,C.dtype,C.values),n.makeTensorInfo(I.shape,I.dtype,I.values)]}if(o===0)return a[a.length-1]=0,[n.makeTensorInfo(a,r.dtype,[]),n.makeTensorInfo(a,"int32",[])];if(l===1)return[r,Cr({attrs:{shape:a,dtype:"int32",value:0},backend:n})];const c=te(a)/l,d=Ye({inputs:{x:r},attrs:{shape:[c,l]},backend:n}),h=IE(o),p=IE(l);let f=null;const m=()=>f===null?[d,d]:[d,f],g=(S,C,I)=>{const T=m(),R=new gke(I),P=[{type:"int32",data:[l]},{type:"int32",data:[f===null?1:0]},{type:"float32",data:[Number.NEGATIVE_INFINITY]},{type:"int32",data:[S]},{type:"int32",data:[C]}],z=f;f=n.runWebGPUProgram(R,T,"int32",P),Fc(n,z)};for(let S=1;S<h;S*=2){const C=S*2;for(let I=S;I>=1;I/=2)g(C,I,[c,p])}for(let S=p;S>h;S/=2){const C=m(),I=new yke([c,S/2]),R=[{type:"int32",data:[l]},{type:"int32",data:[f===null?1:0]},{type:"int32",data:[h]}],_=f;f=n.runWebGPUProgram(I,C,"int32",R),Fc(n,_);const P=h/2,z=P*2;for(let O=P;O>=1;O/=2)g(z,O,f.shape)}let y=f;f=Jh({inputs:{x:f},backend:n,attrs:{begin:0,size:[c,o]}}),Fc(n,y);let x=kM({inputs:{x:d,indices:f},backend:n,attrs:{axis:1,batchDims:1}});Fc(n,d);const v=a.slice(0,-1);v.push(o),y=f,f=Ye({inputs:{x:f},attrs:{shape:v},backend:n}),Fc(n,y);const b=x;return x=Ye({inputs:{x},attrs:{shape:v},backend:n}),Fc(n,b),[x,f]}const wke={kernelName:lw,backendName:"webgpu",kernelFunc:xke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vke{constructor(e){this.variableNames=["Image","Transforms"],this.uniforms="interpolationModeId : i32, fillModeId : i32, fillValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="transform"}getUserCode(){return`
          fn mapCoord(outCoord : f32, len : f32) -> f32{
            var inCoord = outCoord;
            if(uniforms.fillModeId == 2) {
              if (inCoord < 0.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz2 = 2.0 * len;
                  if (inCoord < sz2) {
                    inCoord = sz2 * f32(i32(f32(-inCoord / sz2))) +
                    inCoord;
                  }
                  if (inCoord < -len) {
                    inCoord = inCoord + sz2;
                  } else {
                    inCoord = -inCoord - 1.0;
                  }
                }
              } else if (inCoord > len - 1.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz2 = 2.0 * len;
                  inCoord = inCoord - sz2 * f32(i32(f32(inCoord / sz2)));
                  if (inCoord >= len) {
                    inCoord = sz2 - inCoord - 1.0;
                  }
                }
              }
              return clamp(inCoord, 0.0, len - 1.0);
            } else if (uniforms.fillModeId == 3) {
              if (inCoord < 0.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz = len - 1.0;
                  inCoord = inCoord + len * (f32(i32(f32(-inCoord / sz))) + 1.0);
                }
              } else if (inCoord > len - 1.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz = len - 1.0;
                  inCoord = inCoord - len * f32(i32(f32(inCoord / sz)));
                }
              }
              return clamp(inCoord, 0.0, len - 1.0);
            } else if (uniforms.fillModeId == 4) {
              return clamp(outCoord, 0.0, len - 1.0);
            }
            return outCoord;
          }
          fn readWithFillValue(batch : i32, coordY : i32, coordX : i32,
            channel : i32) -> f32 {
            var outputValue : f32;
            if (0 <= coordY && coordY < uniforms.imageShape[1] && 0 <= coordX && coordX < uniforms.imageShape[2]) {
                outputValue = getImage(batch, coordY, coordX, channel);
            } else {
              outputValue = uniforms.fillValue;
            }
            return outputValue;
          }

          ${Re("index")} {
            if (index < uniforms.size) {
              let coords = getCoordsFromIndex(index);
              var outputValue : f32;
              let batch = coords[0];
              let x = coords[2];
              let y = coords[1];
              let channel = coords[3];
              let xf = f32(x);
              let yf = f32(y);
              let a1 = getTransforms(batch, 0);
              let a2 = getTransforms(batch, 1);
              let a3 = getTransforms(batch, 2);
              let b1 = getTransforms(batch, 3);
              let b2 = getTransforms(batch, 4);
              let b3 = getTransforms(batch, 5);
              let c1 = getTransforms(batch, 6);
              let c2 = getTransforms(batch, 7);
              let projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = uniforms.fillValue;
              } else {
                let inX = (a1 * xf + a2 * yf + a3) / projection;
                let inY = (b1 * xf + b2 * yf + b3) / projection;
                let mapX = mapCoord(inX, f32(uniforms.imageShape[2]));
                let mapY = mapCoord(inY, f32(uniforms.imageShape[1]));

                if (uniforms.interpolationModeId == 1) {
                  let coordY = i32(round(mapY));
                  let coordX = i32(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  let yFloor = floor(mapY);
                  let xFloor = floor(mapX);
                  let yCeil = yFloor + 1.0;
                  let xCeil = xFloor + 1.0;
                  let valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, i32(yFloor), i32(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, i32(yFloor), i32(xCeil), channel);
                  let valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, i32(yCeil), i32(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, i32(yCeil), i32(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutputAtIndex(index, outputValue);
            }
          }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bke(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=s,[c,d,h,p]=r.shape,[f,m]=u??[d,h],g=[c,f,m,p],y=new vke(g),x=i==="nearest"?1:2;let v;switch(a){case"constant":v=1;break;case"reflect":v=2;break;case"wrap":v=3;break;case"nearest":v=4;break;default:v=1;break}const b=[{type:"int32",data:[x]},{type:"int32",data:[v]},{type:"float32",data:[l]}];return n.runWebGPUProgram(y,[r,o],"float32",b)}const Ske={kernelName:uw,backendName:"webgpu",kernelFunc:bke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cke(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r,a=i.shape.length,l=r.shape[o],u=new Array(a-1);let c=0;for(let m=0;m<a;m++)m!==o&&(u[c++]=i.shape[m]);const d=[],h=new Array(a).fill(0),p=i.shape.slice();p[o]=1;const f=new Array(l);for(let m=0;m<f.length;m++){h[o]=m;const g=Jh({inputs:{x:i},backend:n,attrs:{begin:h,size:p}}),y=Ye({inputs:{x:g},backend:n,attrs:{shape:u}});f[m]=y,d.push(g)}return d.forEach(m=>n.disposeData(m.dataId)),f}const kke={kernelName:Vm,backendName:"webgpu",kernelFunc:Cke};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ike{constructor(e,n,s){if(this.outputShape=[],this.variableNames=["x","segmentIds"],this.uniforms="numSegments : i32, xSize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=n,this.dispatchLayout=Ve(e),this.dispatch=De(this.dispatchLayout,e,this.workgroupSize),s!=="float32"&&s!=="int32")throw new Error(`UnsortedSegmentSum only supports float32 and int32
              types, does not support ${s} type.`);this.type=s,this.shaderKey="unsortedSegmentSum"}getUserCode(){return`
    ${Re("index")} {
      if (index < uniforms.xSize) {
        let coords = getXCoordsFromIndex(index);
        let b = coords[0];
        let inCol = coords[1];

        let segmentId = i32(getSegmentIds(inCol));
        if (segmentId >= 0) {
          let flatIndex = b * uniforms.numSegments + segmentId % uniforms.numSegments;
          let value = getX(b, inCol);

          ${Ql("&result[flatIndex]","value",this.type)}
        }
      }
    }
  `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:o}=e,{numSegments:i}=s,a=r.shape.length,l=[];let u=0;const c=an([u],a);let d=r;c!=null&&(d=ca({inputs:{x:r},backend:n,attrs:{perm:c}}),l.push(d),u=yn(1,a)[0]);const h=kk(d.shape,u,i),p=te([d.shape[u]]),f=Ye({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}});l.push(f);const m=r.dtype,g=[f.shape[0],i],y=Cr({backend:n,attrs:{shape:g,value:0,dtype:m}}),x=new Ike(f.shape,g,m),v=[{type:"int32",data:[i]},{type:"int32",data:[te(f.shape)]}],b=n.runWebGPUProgram(x,[f,o],m,v,y),S=Ye({inputs:{x:b},backend:n,attrs:{shape:h}});l.push(b);let C=S;if(c!=null){l.push(S);const I=ha(c);C=ca({inputs:{x:C},backend:n,attrs:{perm:I}})}return l.forEach(I=>n.disposeData(I.dataId)),C}const Nke={kernelName:Um,backendName:"webgpu",kernelFunc:$ke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tke=[Z0e,Lwe,Mwe,Vwe,Wwe,Hwe,Zwe,t1e,s1e,o1e,a1e,u1e,d1e,p1e,m1e,v1e,S1e,$1e,T1e,R1e,P1e,M1e,U1e,H1e,q1e,J1e,twe,tve,ove,pve,wve,Cve,$ve,Tve,Rve,Ave,Fve,Lve,Mve,Vve,Wve,Hve,Zve,tbe,Xve,rbe,abe,dbe,pbe,gbe,vbe,Sbe,kbe,$be,Tbe,Rbe,Dbe,_be,Pbe,Y0e,Lbe,Wbe,Mbe,Vbe,Hbe,qbe,Ybe,Zbe,nSe,rSe,iSe,ewe,lSe,sve,cSe,hSe,fSe,gSe,xSe,vSe,CSe,NSe,ISe,ESe,DSe,_Se,LSe,BSe,y1e,USe,jSe,JSe,HSe,YSe,eCe,x1e,nCe,rCe,iCe,lCe,pCe,ybe,mCe,yCe,wCe,W1e,SCe,kCe,$Ce,ECe,DCe,_Ce,PCe,LCe,j1e,MCe,VCe,WCe,GCe,Q0e,qCe,QCe,e2e,s2e,i2e,l2e,c2e,h2e,f2e,y2e,v2e,S2e,k2e,$2e,T2e,R2e,_1e,nke,oke,ake,dCe,A2e,P2e,B2e,U2e,K2e,X2e,Q2e,J2e,eke,uke,xbe,dke,pke,mke,G2e,wke,Ske,Xwe,kke,Nke,CCe];for(const t of Tke)C2(t);/**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */var RM=function(t,e){return(RM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(n[r]=s[r])})(t,e)};function DM(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}RM(t,e),t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var dn=function(){return(dn=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function Mt(t,e,n,s){return new(n||(n=Promise))(function(r,o){function i(u){try{l(s.next(u))}catch(c){o(c)}}function a(u){try{l(s.throw(u))}catch(c){o(c)}}function l(u){var c;u.done?r(u.value):(c=u.value,c instanceof n?c:new n(function(d){d(c)})).then(i,a)}l((s=s.apply(t,[])).next())})}function Bt(t,e){var n,s,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,s&&(r=2&c[0]?s.return:c[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,c[1])).done)return r;switch(s=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,s=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(r=i.trys,!((r=r.length>0&&r[r.length-1])||c[0]!==6&&c[0]!==2)){i=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){i.label=c[1];break}if(c[0]===6&&i.label<r[1]){i.label=r[1],r=c;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(c);break}r[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(t,i)}catch(d){c=[6,d],s=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([l,u])}}}function Iu(t,e,n){if(n||arguments.length===2)for(var s,r=0,o=e.length;r<o;r++)!s&&r in e||(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}var da=["nose","left_eye","right_eye","left_ear","right_ear","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],Ff=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"];function Vx(t){return t instanceof SVGAnimatedLength?t.baseVal.value:t}function AM(t){return Mt(this,void 0,void 0,function(){var e,n;return Bt(this,function(s){switch(s.label){case 0:return e=document.createElement("canvas"),t instanceof Qt?[4,wk(t,e)]:[3,2];case 1:return s.sent(),[3,3];case 2:e.width=Vx(t.width),e.height=Vx(t.height),n=e.getContext("2d"),t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0),s.label=3;case 3:return[2,e]}})})}function _M(t){return Mt(this,void 0,void 0,function(){var e,n,s,r,o,i;return Bt(this,function(a){switch(a.label){case 0:return t instanceof Qt?(e=t.shape.slice(0,2),n=e[0],s=e[1],r=ImageData.bind,[4,wk(t)]):[3,2];case 1:return[2,new(r.apply(ImageData,[void 0,a.sent(),s,n]))];case 2:return o=document.createElement("canvas"),i=o.getContext("2d"),o.width=Vx(t.width),o.height=Vx(t.height),i.drawImage(t,0,0),[2,i.getImageData(0,0,o.width,o.height)]}})})}function Eke(t){return Mt(this,void 0,void 0,function(){var e,n;return Bt(this,function(s){switch(s.label){case 0:return t instanceof SVGImageElement||t instanceof OffscreenCanvas?[4,AM(t)]:[3,2];case 1:return n=s.sent(),[3,3];case 2:n=t,s.label=3;case 3:return e=n,[2,nF(e,4)]}})})}function FM(t){if(t<0||t>=256)throw new Error("Mask value must be in range [0, 255] but got ".concat(t));if(!Number.isInteger(t))throw new Error("Mask value must be an integer but got ".concat(t))}var bp={runtime:"mediapipe",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,modelType:"full"},Rke=function(){function t(e){this.mask=e}return t.prototype.toCanvasImageSource=function(){return Mt(this,void 0,void 0,function(){return Bt(this,function(e){return[2,this.mask]})})},t.prototype.toImageData=function(){return Mt(this,void 0,void 0,function(){return Bt(this,function(e){return[2,_M(this.mask)]})})},t.prototype.toTensor=function(){return Mt(this,void 0,void 0,function(){return Bt(this,function(e){return[2,Eke(this.mask)]})})},t.prototype.getUnderlyingType=function(){return"canvasimagesource"},t}();function Dke(t){return FM(t),"person"}var Ake=function(){function t(e){var n,s=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new Qye.Pose({locateFile:function(r,o){if(e.solutionPath){var i=e.solutionPath.replace(/\/+$/,"");return"".concat(i,"/").concat(r)}return"".concat(o,"/").concat(r)}}),e.modelType){case"lite":n=0;break;case"heavy":n=2;break;case"full":default:n=1}this.poseSolution.setOptions({modelComplexity:n,smoothLandmarks:e.enableSmoothing,enableSegmentation:e.enableSegmentation,smoothSegmentation:e.smoothSegmentation,selfieMode:this.selfieMode}),this.poseSolution.onResults(function(r){if(s.height=r.image.height,s.width=r.image.width,r.poseLandmarks==null)s.poses=[];else{var o=s.translateOutput(r.poseLandmarks,r.poseWorldLandmarks);r.segmentationMask&&(o.segmentation={maskValueToLabel:Dke,mask:new Rke(r.segmentationMask)}),s.poses=[o]}})}return t.prototype.translateOutput=function(e,n){var s=this,r={keypoints:e.map(function(o,i){return{x:o.x*s.width,y:o.y*s.height,z:o.z,score:o.visibility,name:Ff[i]}})};return n!=null&&(r.keypoints3D=n.map(function(o,i){return{x:o.x,y:o.y,z:o.z,score:o.visibility,name:Ff[i]}})),r},t.prototype.estimatePoses=function(e,n,s){return Mt(this,void 0,void 0,function(){var r,o;return Bt(this,function(i){switch(i.label){case 0:return n&&n.flipHorizontal&&n.flipHorizontal!==this.selfieMode&&(this.selfieMode=n.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),e instanceof Qt?(o=ImageData.bind,[4,wk(e)]):[3,2];case 1:return r=new(o.apply(ImageData,[void 0,i.sent(),e.shape[1],e.shape[0]])),[3,3];case 2:r=e,i.label=3;case 3:return e=r,[4,this.poseSolution.send({image:e},s)];case 4:return i.sent(),[2,this.poses]}})})},t.prototype.dispose=function(){this.poseSolution.close()},t.prototype.reset=function(){this.poseSolution.reset()},t.prototype.initialize=function(){return this.poseSolution.initialize()},t}();function _ke(t){return Mt(this,void 0,void 0,function(){var e,n;return Bt(this,function(s){switch(s.label){case 0:return e=function(r){if(r==null)return dn({},bp);var o=dn({},r);return o.runtime="mediapipe",o.enableSegmentation==null&&(o.enableSegmentation=bp.enableSegmentation),o.enableSmoothing==null&&(o.enableSmoothing=bp.enableSmoothing),o.smoothSegmentation==null&&(o.smoothSegmentation=bp.smoothSegmentation),o.modelType==null&&(o.modelType=bp.modelType),o}(t),[4,(n=new Ake(e)).initialize()];case 1:return s.sent(),[2,n]}})})}function Ad(t){return t instanceof Qt?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}}function PM(t){return t-2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))}function gI(t){return t instanceof Qt?t:nF(t)}function OM(t,e,n){return GS(n,"inputResolution"),[1/n.width*t[0][0]*e.width,1/n.height*t[0][1]*e.width,t[0][3]*e.width,1/n.width*t[1][0]*e.height,1/n.height*t[1][1]*e.height,t[1][3]*e.height,0,0]}function GS(t,e){A(t.width!==0,function(){return"".concat(e," width cannot be 0.")}),A(t.height!==0,function(){return"".concat(e," height cannot be 0.")})}function zv(t,e,n){var s=n.rotationVectorStartKeypointIndex,r=n.rotationVectorEndKeypointIndex,o=t.locationData,i=o.relativeKeypoints[s].x*e.width,a=o.relativeKeypoints[s].y*e.height,l=o.relativeKeypoints[r].x*e.width,u=o.relativeKeypoints[r].y*e.height,c=2*Math.sqrt((l-i)*(l-i)+(u-a)*(u-a)),d=function(h,p,f){var m,g=h.locationData,y=f.rotationVectorStartKeypointIndex,x=f.rotationVectorEndKeypointIndex;m=f.rotationVectorTargetAngle?f.rotationVectorTargetAngle:Math.PI*f.rotationVectorTargetAngleDegree/180;var v=g.relativeKeypoints[y].x*p.width,b=g.relativeKeypoints[y].y*p.height,S=g.relativeKeypoints[x].x*p.width,C=g.relativeKeypoints[x].y*p.height;return PM(m-Math.atan2(-(C-b),S-v))}(t,e,n);return{xCenter:i/e.width,yCenter:a/e.height,width:c/e.width,height:c/e.height,rotation:d}}function LM(t){if(t.length!==16)throw new Error("Array length must be 16 but got ".concat(t.length));return[[t[0],t[1],t[2],t[3]],[t[4],t[5],t[6],t[7]],[t[8],t[9],t[10],t[11]],[t[12],t[13],t[14],t[15]]]}function Mv(t,e,n,s,r,o,i){return t[e][r]*(t[n][o]*t[s][i]-t[n][i]*t[s][o])}function sr(t,e,n){var s=(e+1)%4,r=(e+2)%4,o=(e+3)%4,i=(n+1)%4,a=(n+2)%4,l=(n+3)%4;return Mv(t,s,r,o,i,a,l)+Mv(t,r,o,s,i,a,l)+Mv(t,o,s,r,i,a,l)}function $E(t,e,n){n===void 0&&(n={ignoreRotation:!1});for(var s=[],r=0,o=t;r<o.length;r++){var i=o[r],a=i.x-.5,l=i.y-.5,u=n.ignoreRotation?0:e.rotation,c=Math.cos(u)*a-Math.sin(u)*l,d=Math.sin(u)*a+Math.cos(u)*l;c=c*e.width+e.xCenter,d=d*e.height+e.yCenter;var h=i.z*e.width,p=dn({},i);p.x=c,p.y=d,p.z=h,s.push(p)}return s}function zM(t,e){var n=function(s,r,o,i){var a=r-s,l=i-o,u=l/a;return{scale:u,offset:o-s*u}}(0,255,e[0],e[1]);return ne(function(){return me(U(t,n.scale),n.offset)})}function HS(t,e,n){var s,r,o,i,a,l,u,c,d,h,p,f,m,g,y=e.outputTensorSize,x=e.keepAspectRatio,v=e.borderMode,b=e.outputTensorFloatRange,S=Ad(t),C=function(R,_){return _?{xCenter:_.xCenter*R.width,yCenter:_.yCenter*R.height,width:_.width*R.width,height:_.height*R.height,rotation:_.rotation}:{xCenter:.5*R.width,yCenter:.5*R.height,width:R.width,height:R.height,rotation:0}}(S,n),I=function(R,_,P){if(P===void 0&&(P=!1),!P)return{top:0,left:0,right:0,bottom:0};var z=_.height,O=_.width;GS(_,"targetSize"),GS(R,"roi");var V,H,Q=z/O,oe=R.height/R.width,j=0,ee=0;return Q>oe?(V=R.width,H=R.width*Q,ee=(1-oe/Q)/2):(V=R.height/Q,H=R.height,j=(1-Q/oe)/2),R.width=V,R.height=H,{top:ee,left:j,right:j,bottom:ee}}(C,y,x),T=(s=C,r=S.width,o=S.height,i=!1,a=s.width,l=s.height,u=i?-1:1,c=Math.cos(s.rotation),d=Math.sin(s.rotation),h=s.xCenter,p=s.yCenter,f=1/r,m=1/o,(g=new Array(16))[0]=a*c*u*f,g[1]=-l*d*f,g[2]=0,g[3]=(-.5*a*c*u+.5*l*d+h)*f,g[4]=a*d*u*m,g[5]=l*c*m,g[6]=0,g[7]=(-.5*l*c-.5*a*d*u+p)*m,g[8]=0,g[9]=0,g[10]=a*f,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,LM(g));return{imageTensor:ne(function(){var R=gI(t),_=Ho(OM(T,S,y),[1,8]),P=v==="zero"?"constant":"nearest",z=cr.transform(Zn(Ee(R,"float32")),_,"bilinear",P,0,[y.height,y.width]);return b!=null?zM(z,b):z}),padding:I,transformationMatrix:T}}function NE(t,e,n,s){return s===1?.5*(t+e):t+(e-t)*n/(s-1)}function Fke(t){return ne(function(){var e=function(r){return ne(function(){return[pt(r,[0,0,0],[1,-1,1]),pt(r,[0,0,1],[1,-1,-1])]})}(t),n=e[0],s=e[1];return{boxes:Ht(s),logits:Ht(n)}})}function MM(t){return t!=null&&t.currentTime!=null}function TE(t){for(var e={locationData:{relativeKeypoints:[]}},n=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,i=0;i<t.length;++i){var a=t[i];n=Math.min(n,a.x),s=Math.max(s,a.x),r=Math.min(r,a.y),o=Math.max(o,a.y),e.locationData.relativeKeypoints.push({x:a.x,y:a.y})}return e.locationData.relativeBoundingBox={xMin:n,yMin:r,xMax:s,yMax:o,width:s-n,height:o-r},e}function Pke(t,e,n,s){return Mt(this,void 0,void 0,function(){var r,o,i,a,l;return Bt(this,function(u){switch(u.label){case 0:return t.sort(function(c,d){return Math.max.apply(Math,d.score)-Math.max.apply(Math,c.score)}),r=Ho(t.map(function(c){return[c.locationData.relativeBoundingBox.yMin,c.locationData.relativeBoundingBox.xMin,c.locationData.relativeBoundingBox.yMax,c.locationData.relativeBoundingBox.xMax]})),o=es(t.map(function(c){return c.score[0]})),[4,cr.nonMaxSuppressionAsync(r,o,e,n)];case 1:return[4,(i=u.sent()).array()];case 2:return a=u.sent(),l=t.filter(function(c,d){return a.indexOf(d)>-1}),lt([r,o,i]),[2,l]}})})}function BM(t,e){return t.map(function(n){var s=dn(dn({},n),{x:n.x*e.width,y:n.y*e.height});return n.z!=null&&(s.z=n.z*e.width),s})}function Oke(t,e,n){return Mt(this,void 0,void 0,function(){var s,r,o,i,a,l,u,c,d,h,p,f,m,g,y,x,v,b,S,C,I,T,R,_;return Bt(this,function(P){switch(P.label){case 0:if(s=Ht(e,[0]),r=s.shape,o=r[0],i=r[1],a=r[2],t.length!==a)throw new Error("Expected heatmap to have same number of channels as the number of landmarks. But got landmarks length: "+"".concat(t.length,", heatmap length: ").concat(a));return l=[],[4,s.buffer()];case 1:for(u=P.sent(),c=0;c<t.length;c++)if(d=t[c],h=dn({},d),l.push(h),p=Math.trunc(h.x*i),f=Math.trunc(h.y*o),!(p<0||p>=i||f<0||p>=o)){for(m=Math.trunc((n.kernelSize-1)/2),g=Math.max(0,p-m),y=Math.min(i,p+m+1),x=Math.max(0,f-m),v=Math.min(o,f+m+1),b=0,S=0,C=0,I=0,T=x;T<v;++T)for(R=g;R<y;++R)_=u.get(T,R,c),b+=_,I=Math.max(I,_),S+=R*_,C+=T*_;I>=n.minConfidenceToRefine&&b>0&&(h.x=S/i/b,h.y=C/o/b)}return s.dispose(),[2,l]}})})}function EE(t,e){var n=e.left,s=e.top,r=e.left+e.right,o=e.top+e.bottom;return t.map(function(i){return dn(dn({},i),{x:(i.x-n)/(1-r),y:(i.y-s)/(1-o),z:i.z/(1-r)})})}function Lke(t,e,n){return gf()==="webgl"?function(s,r,o){var i=o.combineWithPreviousRatio.toFixed(2),a={variableNames:["prevMask","newMask"],outputShape:s.shape,userCode:`
  void main() {
      ivec2 coords = getOutputCoords();
      int height = coords[0];
      int width = coords[1];

      float prevMaskValue = getPrevMask(height, width);
      float newMaskValue = getNewMask(height, width);

      /*
      * Assume p := newMaskValue
      * H(p) := 1 + (p * log(p) + (1-p) * log(1-p)) / log(2)
      * uncertainty alpha(p) =
      *   Clamp(1 - (1 - H(p)) * (1 - H(p)), 0, 1) [squaring the
      * uncertainty]
      *
      * The following polynomial approximates uncertainty alpha as a
      * function of (p + 0.5):
      */
      const float c1 = 5.68842;
      const float c2 = -0.748699;
      const float c3 = -57.8051;
      const float c4 = 291.309;
      const float c5 = -624.717;
      float t = newMaskValue - 0.5;
      float x = t * t;

      float uncertainty =
        1.0 - min(1.0, x * (c1 + x * (c2 + x * (c3 + x * (c4 + x * c5)))));

      float outputValue = newMaskValue + (prevMaskValue - newMaskValue) *
                             (uncertainty * `.concat(i,`);

      setOutput(outputValue);
    }
`)},l=ju();return ne(function(){var u=l.compileAndRun(a,[s,r]);return rr().makeTensorFromDataId(u.dataId,u.shape,u.dtype)})}(t,e,n):ne(function(){var s=Be(e,.5),r=sn(s),o=Be(1,Rl(1,U(r,me(5.68842,U(r,me(-.748699,U(r,me(-57.8051,U(r,me(291.309,U(r,-624.717)))))))))));return me(e,U(Be(t,e),U(o,n.combineWithPreviousRatio)))})}function zke(t,e,n){return Mt(this,void 0,void 0,function(){var s,r,o,i,a;return Bt(this,function(l){switch(l.label){case 0:return s=t[0],r=t[1],o=function(u,c,d){return ne(function(){var h,p,f,m;d.reverseOutputOrder?(p=Ht(pt(u,[0,d.boxCoordOffset+0],[-1,1])),h=Ht(pt(u,[0,d.boxCoordOffset+1],[-1,1])),m=Ht(pt(u,[0,d.boxCoordOffset+2],[-1,1])),f=Ht(pt(u,[0,d.boxCoordOffset+3],[-1,1]))):(h=Ht(pt(u,[0,d.boxCoordOffset+0],[-1,1])),p=Ht(pt(u,[0,d.boxCoordOffset+1],[-1,1])),f=Ht(pt(u,[0,d.boxCoordOffset+2],[-1,1])),m=Ht(pt(u,[0,d.boxCoordOffset+3],[-1,1]))),p=me(U(Me(p,d.xScale),c.w),c.x),h=me(U(Me(h,d.yScale),c.h),c.y),d.applyExponentialOnBoxSize?(f=U(hr(Me(f,d.hScale)),c.h),m=U(hr(Me(m,d.wScale)),c.w)):(f=U(Me(f,d.hScale),c.h),m=U(Me(m,d.wScale),c.h));var g=Be(h,Me(f,2)),y=Be(p,Me(m,2)),x=me(h,Me(f,2)),v=me(p,Me(m,2)),b=Pn([q(g,[d.numBoxes,1]),q(y,[d.numBoxes,1]),q(x,[d.numBoxes,1]),q(v,[d.numBoxes,1])],1);if(d.numKeypoints)for(var S=0;S<d.numKeypoints;++S){var C=d.keypointCoordOffset+S*d.numValuesPerKeypoint,I=void 0,T=void 0;d.reverseOutputOrder?(I=Ht(pt(u,[0,C],[-1,1])),T=Ht(pt(u,[0,C+1],[-1,1]))):(T=Ht(pt(u,[0,C],[-1,1])),I=Ht(pt(u,[0,C+1],[-1,1])));var R=me(U(Me(I,d.xScale),c.w),c.x),_=me(U(Me(T,d.yScale),c.h),c.y);b=Pn([b,q(R,[d.numBoxes,1]),q(_,[d.numBoxes,1])],1)}return b})}(r,e,n),i=ne(function(){var u=s;return n.sigmoidScore?(n.scoreClippingThresh!=null&&(u=Ir(s,-n.scoreClippingThresh,n.scoreClippingThresh)),u=uo(u)):u}),[4,Mke(o,i,n)];case 1:return a=l.sent(),lt([o,i]),[2,a]}})})}function Mke(t,e,n){return Mt(this,void 0,void 0,function(){var s,r,o,i,a,l,u,c,d,h,p,f;return Bt(this,function(m){switch(m.label){case 0:return s=[],[4,t.data()];case 1:return r=m.sent(),[4,e.data()];case 2:for(o=m.sent(),i=0;i<n.numBoxes;++i)if(!(n.minScoreThresh!=null&&o[i]<n.minScoreThresh||(a=i*n.numCoords,l=Bke(r[a+0],r[a+1],r[a+2],r[a+3],o[i],n.flipVertically,i),(u=l.locationData.relativeBoundingBox).width<0||u.height<0))){if(n.numKeypoints>0)for((c=l.locationData).relativeKeypoints=[],d=n.numKeypoints*n.numValuesPerKeypoint,h=0;h<d;h+=n.numValuesPerKeypoint)p=a+n.keypointCoordOffset+h,f={x:r[p+0],y:n.flipVertically?1-r[p+1]:r[p+1]},c.relativeKeypoints.push(f);s.push(l)}return[2,s]}})})}function Bke(t,e,n,s,r,o,i){return{score:[r],ind:i,locationData:{relativeBoundingBox:{xMin:e,yMin:o?1-n:t,xMax:s,yMax:o?1-t:n,width:s-e,height:n-t}}}}function Vke(t,e){return t==="none"?e:function(n){return 1/(1+Math.exp(-n))}(e)}function RE(t,e,n,s){return Mt(this,void 0,void 0,function(){var r,o,i,a,l,u,c,d;return Bt(this,function(h){switch(h.label){case 0:return n=n||e.flipHorizontally||!1,s=s||e.flipVertically||!1,r=t.size,o=r/e.numLandmarks,[4,t.data()];case 1:for(i=h.sent(),a=[],l=0;l<e.numLandmarks;++l)u=l*o,(d={x:0,y:0}).x=n?e.inputImageWidth-i[u]:i[u],o>1&&(d.y=s?e.inputImageHeight-i[u+1]:i[u+1]),o>2&&(d.z=i[u+2]),o>3&&(d.score=Vke(e.visibilityActivation,i[u+3])),a.push(d);for(c=0;c<a.length;++c)(d=a[c]).x=d.x/e.inputImageWidth,d.y=d.y/e.inputImageHeight,d.z=d.z/e.inputImageWidth/(e.normalizeZ||1);return[2,a]}})})}function DE(t,e,n){var s=t.width,r=t.height,o=t.rotation;if(n.rotation==null&&n.rotationDegree==null||(o=function(u,c){return c.rotation!=null?u+=c.rotation:c.rotationDegree!=null&&(u+=Math.PI*c.rotationDegree/180),PM(u)}(o,n)),o===0)t.xCenter=t.xCenter+s*n.shiftX,t.yCenter=t.yCenter+r*n.shiftY;else{var i=(e.width*s*n.shiftX*Math.cos(o)-e.height*r*n.shiftY*Math.sin(o))/e.width,a=(e.width*s*n.shiftX*Math.sin(o)+e.height*r*n.shiftY*Math.cos(o))/e.height;t.xCenter=t.xCenter+i,t.yCenter=t.yCenter+a}{var l=Math.max(s*e.width,r*e.height);s=l/e.width,r=l/e.height}return t.width=s*n.scaleX,t.height=r*n.scaleY,t}function Uke(t,e){return t.map(function(n){var s=dn(dn({},n),{x:n.x/e.width,y:n.y/e.height});return n.z!=null&&(n.z=n.z/e.width),s})}var dl=function(){function t(e){this.alpha=e,this.initialized=!1}return t.prototype.apply=function(e,n){var s;return this.initialized?s=n==null?this.storedValue+this.alpha*(e-this.storedValue):this.storedValue+this.alpha*n*Math.asinh((e-this.storedValue)/n):(s=e,this.initialized=!0),this.rawValue=e,this.storedValue=s,s},t.prototype.applyWithAlpha=function(e,n,s){return this.alpha=n,this.apply(e,s)},t.prototype.hasLastRawValue=function(){return this.initialized},t.prototype.lastRawValue=function(){return this.rawValue},t.prototype.reset=function(){this.initialized=!1},t}(),Bv=function(){function t(e){this.frequency=e.frequency,this.minCutOff=e.minCutOff,this.beta=e.beta,this.thresholdCutOff=e.thresholdCutOff,this.thresholdBeta=e.thresholdBeta,this.derivateCutOff=e.derivateCutOff,this.x=new dl(this.getAlpha(this.minCutOff)),this.dx=new dl(this.getAlpha(this.derivateCutOff)),this.lastTimestamp=0}return t.prototype.apply=function(e,n,s){if(e==null)return e;var r=Math.trunc(n);if(this.lastTimestamp>=r)return e;this.lastTimestamp!==0&&r!==0&&(this.frequency=1/(1e-6*(r-this.lastTimestamp))),this.lastTimestamp=r;var o=this.x.hasLastRawValue()?(e-this.x.lastRawValue())*s*this.frequency:0,i=this.dx.applyWithAlpha(o,this.getAlpha(this.derivateCutOff)),a=this.minCutOff+this.beta*Math.abs(i),l=this.thresholdCutOff!=null?this.thresholdCutOff+this.thresholdBeta*Math.abs(i):null;return this.x.applyWithAlpha(e,this.getAlpha(a),l)},t.prototype.getAlpha=function(e){return 1/(1+this.frequency/(2*Math.PI*e))},t}(),KS=function(){function t(e){this.config=e}return t.prototype.apply=function(e,n,s){var r=this;if(e==null)return this.reset(),null;this.initializeFiltersIfEmpty(e);var o=1;if(!this.config.disableValueScaling){if(s<this.config.minAllowedObjectScale)return Iu([],e,!0);o=1/s}return e.map(function(i,a){var l=dn(dn({},i),{x:r.xFilters[a].apply(i.x,n,o),y:r.yFilters[a].apply(i.y,n,o)});return i.z!=null&&(l.z=r.zFilters[a].apply(i.z,n,o)),l})},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(e){var n=this;this.xFilters!=null&&this.xFilters.length===e.length||(this.xFilters=e.map(function(s){return new Bv(n.config)}),this.yFilters=e.map(function(s){return new Bv(n.config)}),this.zFilters=e.map(function(s){return new Bv(n.config)}))},t}(),Vv=function(){function t(e){this.config=e,this.window=[],this.lowPassFilter=new dl(1),this.lastValue=0,this.lastValueScale=1,this.lastTimestamp=-1}return t.prototype.apply=function(e,n,s){if(e==null)return e;var r,o=Math.trunc(n);if(this.lastTimestamp>=o)return e;if(this.lastTimestamp===-1)r=1;else{for(var i=e*s-this.lastValue*this.lastValueScale,a=o-this.lastTimestamp,l=i,u=a,c=(1+this.window.length)*(1e6/30),d=0,h=this.window;d<h.length;d++){var p=h[d];if(u+p.duration>c)break;l+=p.distance,u+=p.duration}var f=l/(1e-6*u);r=1-1/(1+this.config.velocityScale*Math.abs(f)),this.window.unshift({distance:i,duration:a}),this.window.length>this.config.windowSize&&this.window.pop()}return this.lastValue=e,this.lastValueScale=s,this.lastTimestamp=o,this.lowPassFilter.applyWithAlpha(e,r)},t}(),Wke=function(){function t(e){this.config=e}return t.prototype.apply=function(e,n,s){var r=this;if(e==null)return this.reset(),null;var o=1;if(!this.config.disableValueScaling){if(s<this.config.minAllowedObjectScale)return Iu([],e,!0);o=1/s}return this.initializeFiltersIfEmpty(e),e.map(function(i,a){var l=dn(dn({},i),{x:r.xFilters[a].apply(i.x,n,o),y:r.yFilters[a].apply(i.y,n,o)});return i.z!=null&&(l.z=r.zFilters[a].apply(i.z,n,o)),l})},t.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},t.prototype.initializeFiltersIfEmpty=function(e){var n=this;this.xFilters!=null&&this.xFilters.length===e.length||(this.xFilters=e.map(function(s){return new Vv(n.config)}),this.yFilters=e.map(function(s){return new Vv(n.config)}),this.zFilters=e.map(function(s){return new Vv(n.config)}))},t}(),Uv=function(){function t(e){if(e.velocityFilter!=null)this.keypointsFilter=new Wke(e.velocityFilter);else{if(e.oneEuroFilter==null)throw new Error("Either configure velocityFilter or oneEuroFilter, but got "+"".concat(e,"."));this.keypointsFilter=new KS(e.oneEuroFilter)}}return t.prototype.apply=function(e,n,s,r,o){if(r===void 0&&(r=!1),e==null)return this.keypointsFilter.reset(),null;var i=o!=null?function(u,c){return(u.width*c.width+u.height*c.height)/2}(o,s):1,a=r?BM(e,s):e,l=this.keypointsFilter.apply(a,n,i);return r?Uke(l,s):l},t}(),AE=function(){function t(e){this.alpha=e.alpha}return t.prototype.apply=function(e){var n=this;if(e==null)return this.visibilityFilters=null,null;this.visibilityFilters!=null&&this.visibilityFilters.length===e.length||(this.visibilityFilters=e.map(function(a){return new dl(n.alpha)}));for(var s=[],r=0;r<e.length;++r){var o=e[r],i=dn({},o);i.score=this.visibilityFilters[r].apply(o.score),s.push(i)}return s},t}(),jke={reduceBoxesInLowestlayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:5,minScale:.1484375,maxScale:.75,inputSizeHeight:224,inputSizeWidth:224,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,32,32,32],aspectRatios:[1],fixedAnchorSize:!0},Pc={runtime:"tfjs",modelType:"full",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/detector/1",landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"},Gke={maxPoses:1,flipHorizontal:!1},Hke={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2254,numCoords:12,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:4,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:224,yScale:224,hScale:224,wScale:224,minScoreThresh:.5},Kke=.3,_E={shiftX:0,shiftY:0,scaleX:1.25,scaleY:1.25,squareLong:!0},qke={outputTensorSize:{width:224,height:224},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},Xke={outputTensorSize:{width:256,height:256},keepAspectRatio:!0,outputTensorFloatRange:[0,1],borderMode:"zero"},Yke={numLandmarks:39,inputImageWidth:256,inputImageHeight:256,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},Qke={numLandmarks:39,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},Jke={kernelSize:7,minConfidenceToRefine:.5},FE={alpha:.1},Zke={oneEuroFilter:{frequency:30,minCutOff:.05,beta:80,derivateCutOff:1,minAllowedObjectScale:1e-6}},eIe={oneEuroFilter:{frequency:30,minCutOff:.01,beta:10,derivateCutOff:1,minAllowedObjectScale:1e-6}},tIe={oneEuroFilter:{frequency:30,minCutOff:.1,beta:40,derivateCutOff:1,minAllowedObjectScale:1e-6,disableValueScaling:!0}},nIe={activation:"none"},sIe={combineWithPreviousRatio:.7},rIe=function(){function t(e){this.mask=e}return t.prototype.toCanvasImageSource=function(){return Mt(this,void 0,void 0,function(){return Bt(this,function(e){return[2,AM(this.mask)]})})},t.prototype.toImageData=function(){return Mt(this,void 0,void 0,function(){return Bt(this,function(e){return[2,_M(this.mask)]})})},t.prototype.toTensor=function(){return Mt(this,void 0,void 0,function(){return Bt(this,function(e){return[2,this.mask]})})},t.prototype.getUnderlyingType=function(){return"tensor"},t}();function oIe(t){return FM(t),"person"}var iIe=function(){function t(e,n,s,r,o,i){this.detectorModel=e,this.landmarkModel=n,this.enableSmoothing=s,this.enableSegmentation=r,this.smoothSegmentation=o,this.modelType=i,this.regionOfInterest=null,this.prevFilteredSegmentationMask=null,this.anchors=function(d){d.reduceBoxesInLowestLayer==null&&(d.reduceBoxesInLowestLayer=!1),d.interpolatedScaleAspectRatio==null&&(d.interpolatedScaleAspectRatio=1),d.fixedAnchorSize==null&&(d.fixedAnchorSize=!1);for(var h=[],p=0;p<d.numLayers;){for(var f=[],m=[],g=[],y=[],x=p;x<d.strides.length&&d.strides[x]===d.strides[p];){var v=NE(d.minScale,d.maxScale,x,d.strides.length);if(x===0&&d.reduceBoxesInLowestLayer)g.push(1),g.push(2),g.push(.5),y.push(.1),y.push(v),y.push(v);else{for(var b=0;b<d.aspectRatios.length;++b)g.push(d.aspectRatios[b]),y.push(v);if(d.interpolatedScaleAspectRatio>0){var S=x===d.strides.length-1?1:NE(d.minScale,d.maxScale,x+1,d.strides.length);y.push(Math.sqrt(v*S)),g.push(d.interpolatedScaleAspectRatio)}}x++}for(var C=0;C<g.length;++C){var I=Math.sqrt(g[C]);f.push(y[C]/I),m.push(y[C]*I)}var T=0,R=0;if(d.featureMapHeight.length>0)T=d.featureMapHeight[p],R=d.featureMapWidth[p];else{var _=d.strides[p];T=Math.ceil(d.inputSizeHeight/_),R=Math.ceil(d.inputSizeWidth/_)}for(var P=0;P<T;++P)for(var z=0;z<R;++z)for(var O=0;O<f.length;++O){var V={xCenter:(z+d.anchorOffsetX)/R,yCenter:(P+d.anchorOffsetY)/T,width:0,height:0};d.fixedAnchorSize?(V.width=1,V.height=1):(V.width=m[O],V.height=f[O]),h.push(V)}p=x}return h}(jke);var a=es(this.anchors.map(function(d){return d.width})),l=es(this.anchors.map(function(d){return d.height})),u=es(this.anchors.map(function(d){return d.xCenter})),c=es(this.anchors.map(function(d){return d.yCenter}));this.anchorTensor={x:u,y:c,w:a,h:l},this.prevFilteredSegmentationMask=this.enableSegmentation?Ho([],[0,0]):null}return t.prototype.estimatePoses=function(e,n,s){return Mt(this,void 0,void 0,function(){var r,o,i,a,l,u,c,d,h,p,f,m,g,y,x,v,b,S,C,I,T,R,_;return Bt(this,function(P){switch(P.label){case 0:return r=function(z){var O;if((O=z==null?Gke:dn({},z)).maxPoses==null&&(O.maxPoses=1),O.maxPoses<=0)throw new Error("Invalid maxPoses ".concat(O.maxPoses,". Should be > 0."));if(O.maxPoses>1)throw new Error("Multi-pose detection is not implemented yet. Please set maxPoses to 1.");return O}(n),e==null?(this.reset(),[2,[]]):(this.maxPoses=r.maxPoses,this.timestamp=s!=null?1e3*s:MM(e)?1e6*e.currentTime:null,o=Ad(e),i=ne(function(){return Ee(gI(e),"float32")}),(a=this.regionOfInterest)!=null?[3,2]:[4,this.detectPose(i)]);case 1:if((l=P.sent()).length===0)return this.reset(),i.dispose(),[2,[]];u=l[0],a=this.poseDetectionToRoi(u,o),P.label=2;case 2:return[4,this.poseLandmarksByRoi(a,i)];case 3:return c=P.sent(),i.dispose(),c==null?(this.reset(),[2,[]]):(d=c.landmarks,h=c.auxiliaryLandmarks,p=c.poseScore,f=c.worldLandmarks,m=c.segmentationMask,g=this.poseLandmarkFiltering(d,h,f,o),y=g.actualLandmarksFiltered,x=g.auxiliaryLandmarksFiltered,v=g.actualWorldLandmarksFiltered,b=this.poseLandmarksToRoi(x,o),this.regionOfInterest=b,S=this.smoothSegmentation&&m!=null?this.poseSegmentationFiltering(m):m,(C=y!=null?BM(y,o):null)!=null&&C.forEach(function(z,O){z.name=Ff[O]}),(I=v)!=null&&I.forEach(function(z,O){z.name=Ff[O]}),T={score:p,keypoints:C,keypoints3D:I},S!==null&&(R=ne(function(){var z=Zn(S,2),O=$i(z,[[0,0],[0,0],[0,1]]);return U2(O,[[0,0],[0,0],[0,2]],"symmetric")}),this.smoothSegmentation||lt(S),_={maskValueToLabel:oIe,mask:new rIe(R)},T.segmentation=_),[2,[T]])}})})},t.prototype.poseSegmentationFiltering=function(e){var n=this.prevFilteredSegmentationMask;return n.size===0?this.prevFilteredSegmentationMask=e:(this.prevFilteredSegmentationMask=Lke(n,e,sIe),lt(e)),lt(n),this.prevFilteredSegmentationMask},t.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),lt([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h,this.prevFilteredSegmentationMask])},t.prototype.reset=function(){this.regionOfInterest=null,this.enableSegmentation&&(lt(this.prevFilteredSegmentationMask),this.prevFilteredSegmentationMask=Ho([],[0,0])),this.visibilitySmoothingFilterActual=null,this.visibilitySmoothingFilterAuxiliary=null,this.landmarksSmoothingFilterActual=null,this.landmarksSmoothingFilterAuxiliary=null},t.prototype.detectPose=function(e){return Mt(this,void 0,void 0,function(){var n,s,r,o,i,a,l,u,c,d;return Bt(this,function(h){switch(h.label){case 0:return n=HS(e,qke),s=n.imageTensor,r=n.padding,o=this.detectorModel.predict(s),i=Fke(o),a=i.boxes,[4,zke([l=i.logits,a],this.anchorTensor,Hke)];case 1:return(u=h.sent()).length===0?(lt([s,o,l,a]),[2,u]):[4,Pke(u,this.maxPoses,Kke)];case 2:return c=h.sent(),d=function(p,f){p===void 0&&(p=[]);for(var m=f.left,g=f.top,y=f.left+f.right,x=f.top+f.bottom,v=0;v<p.length;v++){var b=p[v],S=b.locationData.relativeBoundingBox,C=(S.xMin-m)/(1-y),I=(S.yMin-g)/(1-x),T=S.width/(1-y),R=S.height/(1-x);S.xMin=C,S.yMin=I,S.width=T,S.height=R,S.xMax=C+T,S.yMax=I+R;var _=b.locationData.relativeKeypoints;_&&_.forEach(function(P){var z=(P.x-m)/(1-y),O=(P.y-g)/(1-x);P.x=z,P.y=O})}return p}(c,r),lt([s,o,l,a]),[2,d]}})})},t.prototype.poseDetectionToRoi=function(e,n){return DE(zv(e,n,{rotationVectorEndKeypointIndex:1,rotationVectorStartKeypointIndex:0,rotationVectorTargetAngleDegree:90}),n,_E)},t.prototype.poseLandmarksByRoi=function(e,n){return Mt(this,void 0,void 0,function(){var s,r,o,i,a,l,u,c,d,h,p,f,m,g;return Bt(this,function(y){switch(y.label){case 0:if(s=Ad(n),r=HS(n,Xke,e),o=r.imageTensor,i=r.padding,a=r.transformationMatrix,this.modelType!=="lite"&&this.modelType!=="full"&&this.modelType!=="heavy")throw new Error("Model type must be one of lite, full or heavy,"+"but got ".concat(this.modelType));return l=["ld_3d","output_poseflag","activation_heatmap","world_3d"],this.enableSegmentation&&l.push("activation_segmentation"),u=this.landmarkModel.execute(o,l),[4,this.tensorsToPoseLandmarksAndSegmentation(u)];case 1:return(c=y.sent())==null?(lt(u),lt(o),[2,null]):(d=c.landmarks,h=c.auxiliaryLandmarks,p=c.poseScore,f=c.worldLandmarks,m=c.segmentationMask,[4,this.poseLandmarksAndSegmentationInverseProjection(s,e,i,a,d,h,f,m)]);case 2:return g=y.sent(),lt(u),lt(o),[2,dn({poseScore:p},g)]}})})},t.prototype.poseLandmarksAndSegmentationInverseProjection=function(e,n,s,r,o,i,a,l){return Mt(this,void 0,void 0,function(){var u,c,d,h,p,f;return Bt(this,function(m){return u=EE(o,s),c=EE(i,s),d=$E(u,n),h=$E(c,n),p=function(g,y){for(var x=[],v=0,b=g;v<b.length;v++){var S=b[v],C=S.x,I=S.y,T=y.rotation,R=Math.cos(T)*C-Math.sin(T)*I,_=Math.sin(T)*C+Math.cos(T)*I,P=dn({},S);P.x=R,P.y=_,x.push(P)}return x}(a,n),f=null,this.enableSegmentation&&(f=ne(function(){var g=l.shape,y=g[0],x=g[1],v=function(C){var I=LM(new Array(16).fill(0));I[0][0]=sr(C,0,0),I[1][0]=-sr(C,0,1),I[2][0]=sr(C,0,2),I[3][0]=-sr(C,0,3),I[0][2]=sr(C,2,0),I[1][2]=-sr(C,2,1),I[2][2]=sr(C,2,2),I[3][2]=-sr(C,2,3),I[0][1]=-sr(C,1,0),I[1][1]=sr(C,1,1),I[2][1]=-sr(C,1,2),I[3][1]=sr(C,1,3),I[0][3]=-sr(C,3,0),I[1][3]=sr(C,3,1),I[2][3]=-sr(C,3,2),I[3][3]=sr(C,3,3);for(var T=C[0][0]*I[0][0]+C[1][0]*I[0][1]+C[2][0]*I[0][2]+C[3][0]*I[0][3],R=0;R<I.length;R++)for(var _=0;_<I.length;_++)I[R][_]/=T;return I}(r),b=Ho(OM(v,{width:x,height:y},e),[1,8]),S=[1,y,x,1];return Ht(cr.transform(q(l,S),b,"bilinear","constant",0,[e.height,e.width]),[0,3])}),lt(l)),[2,{landmarks:d,auxiliaryLandmarks:h,worldLandmarks:p,segmentationMask:f}]})})},t.prototype.tensorsToPoseLandmarksAndSegmentation=function(e){return Mt(this,void 0,void 0,function(){var n,s,r,o,i,a,l,u,c,d,h,p,f;return Bt(this,function(m){switch(m.label){case 0:return n=e[0],s=e[1],r=e[2],o=e[3],i=this.enableSegmentation?e[4]:null,[4,s.data()];case 1:return(a=m.sent()[0])<.5?[2,null]:[4,RE(n,Yke)];case 2:return[4,Oke(m.sent(),r,Jke)];case 3:return l=m.sent(),u=l.slice(0,33),c=l.slice(33,35),[4,RE(o,Qke)];case 4:return d=m.sent(),h=d.slice(0,33),p=function(g,y,x){for(var v=[],b=0;b<g.length;b++){var S=dn({},y[b]);S.score=g[b].score,v.push(S)}return v}(u,h),f=this.enableSegmentation?function(g,y,x){return ne(function(){var v=Ht(g,[0]),b=v.shape[2];if(b===1){var S=v;switch(y.activation){case"none":break;case"sigmoid":S=uo(S);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported (".concat(y.activation,")"))}var C=S;return Ht(C,[2])}throw new Error("Unsupported number of tensor channels ".concat(b))})}(i,nIe):null,[2,{landmarks:u,auxiliaryLandmarks:c,poseScore:a,worldLandmarks:p,segmentationMask:f}]}})})},t.prototype.poseLandmarksToRoi=function(e,n){return DE(zv(TE(e),n,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:90}),n,_E)},t.prototype.poseLandmarkFiltering=function(e,n,s,r){var o,i,a;if(this.timestamp!=null&&this.enableSmoothing){var l=zv(TE(n),r,{rotationVectorEndKeypointIndex:0,rotationVectorStartKeypointIndex:1,rotationVectorTargetAngleDegree:90});this.visibilitySmoothingFilterActual==null&&(this.visibilitySmoothingFilterActual=new AE(FE)),o=this.visibilitySmoothingFilterActual.apply(e),this.visibilitySmoothingFilterAuxiliary==null&&(this.visibilitySmoothingFilterAuxiliary=new AE(FE)),i=this.visibilitySmoothingFilterAuxiliary.apply(n),a=this.visibilitySmoothingFilterActual.apply(s),this.landmarksSmoothingFilterActual==null&&(this.landmarksSmoothingFilterActual=new Uv(Zke)),o=this.landmarksSmoothingFilterActual.apply(o,this.timestamp,r,!0,l),this.landmarksSmoothingFilterAuxiliary==null&&(this.landmarksSmoothingFilterAuxiliary=new Uv(eIe)),i=this.landmarksSmoothingFilterAuxiliary.apply(i,this.timestamp,r,!0,l),this.worldLandmarksSmoothingFilterActual==null&&(this.worldLandmarksSmoothingFilterActual=new Uv(tIe)),a=this.worldLandmarksSmoothingFilterActual.apply(s,this.timestamp)}else o=e,i=n,a=s;return{actualLandmarksFiltered:o,auxiliaryLandmarksFiltered:i,actualWorldLandmarksFiltered:a}},t}();function aIe(t){return Mt(this,void 0,void 0,function(){var e,n,s,r,o,i;return Bt(this,function(a){switch(a.label){case 0:return e=function(l){var u=dn({},l??Pc);if(u.enableSmoothing==null&&(u.enableSmoothing=Pc.enableSmoothing),u.enableSegmentation==null&&(u.enableSegmentation=Pc.enableSegmentation),u.smoothSegmentation==null&&(u.smoothSegmentation=Pc.smoothSegmentation),u.modelType==null&&(u.modelType=Pc.modelType),u.detectorModelUrl==null&&(u.detectorModelUrl=Pc.detectorModelUrl),u.landmarkModelUrl==null)switch(u.modelType){case"lite":u.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/lite/2";break;case"heavy":u.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/heavy/2";break;case"full":default:u.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"}return u}(t),n=typeof e.detectorModelUrl=="string"&&e.detectorModelUrl.indexOf("https://tfhub.dev")>-1,s=typeof e.landmarkModelUrl=="string"&&e.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([Id(e.detectorModelUrl,{fromTFHub:n}),Id(e.landmarkModelUrl,{fromTFHub:s})])];case 1:return r=a.sent(),o=r[0],i=r[1],[2,new iIe(o,i,e.enableSmoothing,e.enableSegmentation,e.smoothSegmentation,e.modelType)]}})})}var _u,ia,VM=function(){function t(e){(function(n){if(n.maxTracks<1)throw new Error("Must specify 'maxTracks' to be at least 1, but "+"encountered ".concat(n.maxTracks));if(n.maxAge<=0)throw new Error("Must specify 'maxAge' to be positive, but "+"encountered ".concat(n.maxAge));if(n.keypointTrackerParams!==void 0){if(n.keypointTrackerParams.keypointConfidenceThreshold<0||n.keypointTrackerParams.keypointConfidenceThreshold>1)throw new Error("Must specify 'keypointConfidenceThreshold' to be in the range [0, 1], but encountered "+"".concat(n.keypointTrackerParams.keypointConfidenceThreshold));if(n.keypointTrackerParams.minNumberOfKeypoints<1)throw new Error("Must specify 'minNumberOfKeypoints' to be at least 1, but "+"encountered ".concat(n.keypointTrackerParams.minNumberOfKeypoints));for(var s=0,r=n.keypointTrackerParams.keypointFalloff;s<r.length;s++){var o=r[s];if(o<=0)throw new Error("Must specify each keypoint falloff parameterto be positive "+"but encountered ".concat(o))}}})(e),this.tracks=[],this.maxTracks=e.maxTracks,this.maxAge=1e3*e.maxAge,this.minSimilarity=e.minSimilarity,this.nextID=1}return t.prototype.apply=function(e,n){this.filterOldTracks(n);var s=this.computeSimilarity(e);return this.assignTracks(e,s,n),this.updateTracks(n),e},t.prototype.getTracks=function(){return this.tracks.slice()},t.prototype.getTrackIDs=function(){return new Set(this.tracks.map(function(e){return e.id}))},t.prototype.filterOldTracks=function(e){var n=this;this.tracks=this.tracks.filter(function(s){return e-s.lastTimestamp<=n.maxAge})},t.prototype.assignTracks=function(e,n,s){for(var r=Array.from(Array(n[0].length).keys()),o=[],i=0,a=Array.from(Array(e.length).keys());i<a.length;i++){var l=a[i];if(r.length!==0){for(var u=-1,c=-1,d=0,h=r;d<h.length;d++){var p=h[d],f=n[l][p];f>=this.minSimilarity&&f>c&&(u=p,c=f)}if(u>=0){var m=this.tracks[u];m=Object.assign(m,this.createTrack(e[l],s,m.id)),e[l].id=m.id;var g=r.indexOf(u);r.splice(g,1)}else o.push(l)}else o.push(l)}for(var y=0,x=o;y<x.length;y++){l=x[y];var v=this.createTrack(e[l],s);this.tracks.push(v),e[l].id=v.id}},t.prototype.updateTracks=function(e){this.tracks.sort(function(n,s){return s.lastTimestamp-n.lastTimestamp}),this.tracks=this.tracks.slice(0,this.maxTracks)},t.prototype.createTrack=function(e,n,s){var r={id:s||this.nextTrackID(),lastTimestamp:n,keypoints:Iu([],e.keypoints,!0).map(function(o){return dn({},o)})};return e.box!==void 0&&(r.box=dn({},e.box)),r},t.prototype.nextTrackID=function(){var e=this.nextID;return this.nextID+=1,e},t.prototype.remove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.tracks=this.tracks.filter(function(s){return!e.includes(s.id)})},t.prototype.reset=function(){this.tracks=[]},t}(),lIe=function(t){function e(n){return t.call(this,n)||this}return DM(e,t),e.prototype.computeSimilarity=function(n){var s=this;return n.length===0||this.tracks.length===0?[[]]:n.map(function(r){return s.tracks.map(function(o){return s.iou(r,o)})})},e.prototype.iou=function(n,s){var r=Math.max(n.box.xMin,s.box.xMin),o=Math.max(n.box.yMin,s.box.yMin),i=Math.min(n.box.xMax,s.box.xMax),a=Math.min(n.box.yMax,s.box.yMax);if(r>=i||o>=a)return 0;var l=(i-r)*(a-o);return l/(n.box.width*n.box.height+s.box.width*s.box.height-l)},e}(VM),uIe=function(t){function e(n){var s=t.call(this,n)||this;return s.keypointThreshold=n.keypointTrackerParams.keypointConfidenceThreshold,s.keypointFalloff=n.keypointTrackerParams.keypointFalloff,s.minNumKeyoints=n.keypointTrackerParams.minNumberOfKeypoints,s}return DM(e,t),e.prototype.computeSimilarity=function(n){if(n.length===0||this.tracks.length===0)return[[]];for(var s=[],r=0,o=n;r<o.length;r++){for(var i=o[r],a=[],l=0,u=this.tracks;l<u.length;l++){var c=u[l];a.push(this.oks(i,c))}s.push(a)}return s},e.prototype.oks=function(n,s){for(var r=this.area(s.keypoints)+1e-6,o=0,i=0,a=0;a<n.keypoints.length;++a){var l=n.keypoints[a],u=s.keypoints[a];if(!(l.score<this.keypointThreshold||u.score<this.keypointThreshold)){i+=1;var c=Math.pow(l.x-u.x,2)+Math.pow(l.y-u.y,2),d=2*this.keypointFalloff[a];o+=Math.exp(-1*c/(2*r*Math.pow(d,2)))}}return i<this.minNumKeyoints?0:o/i},e.prototype.area=function(n){var s=this,r=n.filter(function(l){return l.score>s.keypointThreshold}),o=Math.min.apply(Math,Iu([1],r.map(function(l){return l.x}),!1)),i=Math.max.apply(Math,Iu([0],r.map(function(l){return l.x}),!1)),a=Math.min.apply(Math,Iu([1],r.map(function(l){return l.y}),!1));return(i-o)*(Math.max.apply(Math,Iu([0],r.map(function(l){return l.y}),!1))-a)},e}(VM);function cIe(t){switch(t){case ia.BlazePose:return Ff.reduce(function(e,n,s){return e[n]=s,e},{});case ia.PoseNet:case ia.MoveNet:return da.reduce(function(e,n,s){return e[n]=s,e},{});default:throw new Error("Model ".concat(t," is not supported."))}}(function(t){t.Keypoint="keypoint",t.BoundingBox="boundingBox"})(_u||(_u={})),function(t){t.MoveNet="MoveNet",t.BlazePose="BlazePose",t.PoseNet="PoseNet"}(ia||(ia={}));var PE=["SinglePose.Lightning","SinglePose.Thunder","MultiPose.Lightning"],UM={modelType:"SinglePose.Lightning",enableSmoothing:!0},OE={},LE={frequency:30,minCutOff:2.5,beta:300,derivateCutOff:2.5,thresholdCutOff:.5,thresholdBeta:5,disableValueScaling:!0},Wv={maxTracks:18,maxAge:1e3,minSimilarity:.2,keypointTrackerParams:{keypointConfidenceThreshold:.3,keypointFalloff:[.026,.025,.025,.035,.035,.079,.079,.072,.072,.062,.062,.107,.107,.087,.087,.089,.089],minNumberOfKeypoints:4}},zE={maxTracks:18,maxAge:1e3,minSimilarity:.15,trackerParams:{}};function dIe(t,e,n,s){for(var r={},o=0,i=da;o<i.length;o++){var a=i[o];r[a]=[e[n[a]].y*s.height,e[n[a]].x*s.width]}if(function(x,v){return(x[v.left_hip].score>.2||x[v.right_hip].score>.2)&&(x[v.left_shoulder].score>.2||x[v.right_shoulder].score>.2)}(e,n)){var l=(r.left_hip[0]+r.right_hip[0])/2,u=(r.left_hip[1]+r.right_hip[1])/2,c=function(x,v,b,S,C){for(var I=["left_shoulder","right_shoulder","left_hip","right_hip"],T=0,R=0,_=0;_<I.length;_++)(H=Math.abs(S-b[I[_]][0]))>T&&(T=H),(Q=Math.abs(C-b[I[_]][1]))>R&&(R=Q);for(var P=0,z=0,O=0,V=Object.keys(b);O<V.length;O++){var H,Q,oe=V[O];x[v[oe]].score<.2||((H=Math.abs(S-b[oe][0]))>P&&(P=H),(Q=Math.abs(C-b[oe][1]))>z&&(z=Q))}return[T,R,P,z]}(e,n,r,l,u),d=c[0],h=c[1],p=c[2],f=c[3],m=Math.max(1.9*h,1.9*d,1.2*p,1.2*f),g=[l-(m=Math.min(m,Math.max(u,s.width-u,l,s.height-l))),u-m];if(m>Math.max(s.width,s.height)/2)return qS(t==null,s);var y=2*m;return{yMin:g[0]/s.height,xMin:g[1]/s.width,yMax:(g[0]+y)/s.height,xMax:(g[1]+y)/s.width,height:(g[0]+y)/s.height-g[0]/s.height,width:(g[1]+y)/s.width-g[1]/s.width}}return qS(t==null,s)}function qS(t,e){var n,s,r,o;return t?e.width>e.height?(n=1,s=e.height/e.width,r=0,o=(e.width/2-e.height/2)/e.width):(n=e.width/e.height,s=1,r=(e.height/2-e.width/2)/e.height,o=0):e.width>e.height?(n=e.width/e.height,s=1,r=(e.height/2-e.width/2)/e.height,o=0):(n=1,s=e.height/e.width,r=0,o=(e.width/2-e.height/2)/e.width),{yMin:r,xMin:o,yMax:r+n,xMax:o+s,height:n,width:s}}function hIe(t){var e,n=t==null?UM:dn({},t);if(n.modelType==null)n.modelType="SinglePose.Lightning";else if(PE.indexOf(n.modelType)<0)throw new Error("Invalid architecture ".concat(n.modelType,". ")+"Should be one of ".concat(PE));if(n.enableSmoothing==null&&(n.enableSmoothing=!0),n.minPoseScore!=null&&(n.minPoseScore<0||n.minPoseScore>1))throw new Error("minPoseScore should be between 0.0 and 1.0");if(n.multiPoseMaxDimension!=null&&(n.multiPoseMaxDimension%32!=0||n.multiPoseMaxDimension<32))throw new Error("multiPoseMaxDimension must be a multiple of 32 and higher than 0");if(n.modelType==="MultiPose.Lightning"&&n.enableTracking==null&&(n.enableTracking=!0),n.modelType==="MultiPose.Lightning"&&n.enableTracking===!0)if(n.trackerType==null&&(n.trackerType=_u.BoundingBox),n.trackerType===_u.Keypoint)n.trackerConfig!=null?n.trackerConfig=function(s){var r=ME(Wv,s);return r.keypointTrackerParams=dn({},Wv.keypointTrackerParams),s.keypointTrackerParams!=null&&(s.keypointTrackerParams.keypointConfidenceThreshold!=null&&(r.keypointTrackerParams.keypointConfidenceThreshold=s.keypointTrackerParams.keypointConfidenceThreshold),s.keypointTrackerParams.keypointFalloff!=null&&(r.keypointTrackerParams.keypointFalloff=s.keypointTrackerParams.keypointFalloff),s.keypointTrackerParams.minNumberOfKeypoints!=null&&(r.keypointTrackerParams.minNumberOfKeypoints=s.keypointTrackerParams.minNumberOfKeypoints)),r}(n.trackerConfig):n.trackerConfig=Wv;else{if(n.trackerType!==_u.BoundingBox)throw new Error("Tracker type not supported by MoveNet");n.trackerConfig!=null?n.trackerConfig=(e=n.trackerConfig,ME(zE,e)):n.trackerConfig=zE}return n}function ME(t,e){var n={maxTracks:t.maxTracks,maxAge:t.maxAge,minSimilarity:t.minSimilarity};return e.maxTracks!=null&&(n.maxTracks=e.maxTracks),e.maxAge!=null&&(n.maxAge=e.maxAge),e.minSimilarity!=null&&(n.minSimilarity=e.minSimilarity),n}var pIe=function(){function t(e,n){this.moveNetModel=e,this.modelInputResolution={height:0,width:0},this.keypointIndexByName=cIe(ia.MoveNet),n.modelType==="SinglePose.Lightning"?(this.modelInputResolution.width=192,this.modelInputResolution.height=192):n.modelType==="SinglePose.Thunder"&&(this.modelInputResolution.width=256,this.modelInputResolution.height=256),this.multiPoseModel=n.modelType==="MultiPose.Lightning",this.multiPoseModel||(this.keypointFilter=new KS(LE),this.cropRegionFilterYMin=new dl(.9),this.cropRegionFilterXMin=new dl(.9),this.cropRegionFilterYMax=new dl(.9),this.cropRegionFilterXMax=new dl(.9)),this.enableSmoothing=n.enableSmoothing,n.minPoseScore?this.minPoseScore=n.minPoseScore:this.minPoseScore=.25,n.multiPoseMaxDimension?this.multiPoseMaxDimension=n.multiPoseMaxDimension:this.multiPoseMaxDimension=256,this.enableTracking=n.enableTracking,this.multiPoseModel&&this.enableTracking&&(n.trackerType===_u.Keypoint?this.tracker=new uIe(n.trackerConfig):n.trackerType===_u.BoundingBox&&(this.tracker=new lIe(n.trackerConfig)),this.enableSmoothing&&(this.keypointFilterMap=new Map))}return t.prototype.runSinglePersonPoseModel=function(e){return Mt(this,void 0,void 0,function(){var n,s,r,o,i;return Bt(this,function(a){switch(a.label){case 0:if((n=this.moveNetModel.execute(e)).shape.length!==4||n.shape[0]!==1||n.shape[1]!==1||n.shape[2]!==17||n.shape[3]!==3)throw n.dispose(),new Error("Unexpected output shape from model: [".concat(n.shape,"]"));return gf()==="webgpu"?[3,1]:(s=n.dataSync(),[3,3]);case 1:return[4,n.data()];case 2:s=a.sent(),a.label=3;case 3:for(n.dispose(),r={keypoints:[],score:0},o=0,i=0;i<17;++i)r.keypoints[i]={y:s[3*i],x:s[3*i+1],score:s[3*i+2]},r.keypoints[i].score>.2&&(++o,r.score+=r.keypoints[i].score);return o>0&&(r.score/=o),[2,r]}})})},t.prototype.runMultiPersonPoseModel=function(e){return Mt(this,void 0,void 0,function(){var n,s,r,o,i,a,l,u;return Bt(this,function(c){switch(c.label){case 0:if((n=this.moveNetModel.execute(e)).shape.length!==3||n.shape[0]!==1||n.shape[2]!==56)throw n.dispose(),new Error("Unexpected output shape from model: [".concat(n.shape,"]"));return gf()==="webgpu"?[3,1]:(s=n.dataSync(),[3,3]);case 1:return[4,n.data()];case 2:s=c.sent(),c.label=3;case 3:for(n.dispose(),r=[],o=s.length/56,i=0;i<o;++i)for(r[i]={keypoints:[]},a=56*i+51,r[i].box={yMin:s[a],xMin:s[a+1],yMax:s[a+2],xMax:s[a+3],width:s[a+3]-s[a+1],height:s[a+2]-s[a]},l=56*i+55,r[i].score=s[l],r[i].keypoints=[],u=0;u<17;++u)r[i].keypoints[u]={y:s[56*i+3*u],x:s[56*i+3*u+1],score:s[56*i+3*u+2]};return[2,r]}})})},t.prototype.estimatePoses=function(e,n,s){return n===void 0&&(n=OE),Mt(this,void 0,void 0,function(){var r,o,i,a,l,u;return Bt(this,function(c){switch(c.label){case 0:return n=function(d){return d==null?OE:dn({},d)}(n),e==null?(this.reset(),[2,[]]):(s==null?MM(e)&&(s=1e6*e.currentTime):s*=1e3,r=gI(e),o=Ad(r),i=Zn(r,0),e instanceof Qt||r.dispose(),a=[],this.multiPoseModel?[3,2]:[4,this.estimateSinglePose(i,o,s)]);case 1:return a=c.sent(),[3,4];case 2:return[4,this.estimateMultiplePoses(i,o,s)];case 3:a=c.sent(),c.label=4;case 4:for(l=0;l<a.length;++l)for(u=0;u<a[l].keypoints.length;++u)a[l].keypoints[u].name=da[u],a[l].keypoints[u].y*=o.height,a[l].keypoints[u].x*=o.width;return[2,a]}})})},t.prototype.estimateSinglePose=function(e,n,s){return Mt(this,void 0,void 0,function(){var r,o,i,a,l=this;return Bt(this,function(u){switch(u.label){case 0:return this.cropRegion||(this.cropRegion=qS(this.cropRegion==null,n)),r=ne(function(){var c=Ho([[l.cropRegion.yMin,l.cropRegion.xMin,l.cropRegion.yMax,l.cropRegion.xMax]]),d=Gn([1],"int32"),h=[l.modelInputResolution.height,l.modelInputResolution.width];return Ee(cr.cropAndResize(e,c,d,h,"bilinear",0),"int32")}),e.dispose(),[4,this.runSinglePersonPoseModel(r)];case 1:if(o=u.sent(),r.dispose(),o.score<this.minPoseScore)return this.reset(),[2,[]];for(i=0;i<o.keypoints.length;++i)o.keypoints[i].y=this.cropRegion.yMin+o.keypoints[i].y*this.cropRegion.height,o.keypoints[i].x=this.cropRegion.xMin+o.keypoints[i].x*this.cropRegion.width;return s!=null&&this.enableSmoothing&&(o.keypoints=this.keypointFilter.apply(o.keypoints,s,1)),a=dIe(this.cropRegion,o.keypoints,this.keypointIndexByName,n),this.cropRegion=this.filterCropRegion(a),[2,[o]]}})})},t.prototype.estimateMultiplePoses=function(e,n,s){return Mt(this,void 0,void 0,function(){var r,o,i,a,l,u,c,d,h,p,f,m=this;return Bt(this,function(g){switch(g.label){case 0:return n.width>n.height?(o=this.multiPoseMaxDimension,i=Math.round(this.multiPoseMaxDimension*n.height/n.width),r=cr.resizeBilinear(e,[i,o]),l=o,u=32*Math.ceil(i/32),a=$i(r,[[0,0],[0,u-i],[0,0],[0,0]])):(o=Math.round(this.multiPoseMaxDimension*n.width/n.height),i=this.multiPoseMaxDimension,r=cr.resizeBilinear(e,[i,o]),l=32*Math.ceil(o/32),u=i,a=$i(r,[[0,0],[0,0],[0,l-o],[0,0]])),r.dispose(),e.dispose(),c=Ee(a,"int32"),a.dispose(),[4,this.runMultiPersonPoseModel(c)];case 1:for(d=g.sent(),c.dispose(),d=d.filter(function(y){return y.score>=m.minPoseScore}),p=0;p<d.length;++p)for(h=0;h<d[p].keypoints.length;++h)d[p].keypoints[h].y*=u/i,d[p].keypoints[h].x*=l/o;if(this.enableTracking&&(this.tracker.apply(d,s),this.enableSmoothing)){for(p=0;p<d.length;++p)this.keypointFilterMap.has(d[p].id)||this.keypointFilterMap.set(d[p].id,new KS(LE)),d[p].keypoints=this.keypointFilterMap.get(d[p].id).apply(d[p].keypoints,s,1);f=this.tracker.getTrackIDs(),this.keypointFilterMap.forEach(function(y,x){f.has(x)||m.keypointFilterMap.delete(x)})}return[2,d]}})})},t.prototype.filterCropRegion=function(e){if(e){var n=this.cropRegionFilterYMin.apply(e.yMin),s=this.cropRegionFilterXMin.apply(e.xMin),r=this.cropRegionFilterYMax.apply(e.yMax),o=this.cropRegionFilterXMax.apply(e.xMax);return{yMin:n,xMin:s,yMax:r,xMax:o,height:r-n,width:o-s}}return this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset(),null},t.prototype.dispose=function(){this.moveNetModel.dispose()},t.prototype.reset=function(){this.cropRegion=null,this.resetFilters()},t.prototype.resetFilters=function(){this.keypointFilter.reset(),this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset()},t}();function fIe(t){return t===void 0&&(t=UM),Mt(this,void 0,void 0,function(){var e,n,s,r;return Bt(this,function(o){switch(o.label){case 0:return e=hIe(t),s=!0,e.modelUrl?(s=typeof e.modelUrl=="string"&&e.modelUrl.indexOf("https://tfhub.dev")>-1,[4,Id(e.modelUrl,{fromTFHub:s})]):[3,2];case 1:return n=o.sent(),[3,4];case 2:return r=void 0,e.modelType==="SinglePose.Lightning"?r="https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4":e.modelType==="SinglePose.Thunder"?r="https://tfhub.dev/google/tfjs-model/movenet/singlepose/thunder/4":e.modelType==="MultiPose.Lightning"&&(r="https://tfhub.dev/google/tfjs-model/movenet/multipose/lightning/1"),[4,Id(r,{fromTFHub:s})];case 3:n=o.sent(),o.label=4;case 4:return gf()==="webgl"&&re().set("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",0),[2,new pIe(n,e)]}})})}var BE={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:{height:257,width:257}},VE=["MobileNetV1","ResNet50"],UE={MobileNetV1:[8,16],ResNet50:[16]},mIe=[8,16,32],WE={MobileNetV1:[.5,.75,1],ResNet50:[1]},jE=[1,2,4],GE={maxPoses:1,flipHorizontal:!1},gIe={maxPoses:5,flipHorizontal:!1,scoreThreshold:.5,nmsRadius:20},yIe=[-123.15,-115.9,-103.06];function jv(t){return Math.floor(t/2)}var xIe=function(){function t(e,n){this.priorityQueue=new Array(e),this.numberOfElements=-1,this.getElementValue=n}return t.prototype.enqueue=function(e){this.priorityQueue[++this.numberOfElements]=e,this.swim(this.numberOfElements)},t.prototype.dequeue=function(){var e=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,e},t.prototype.empty=function(){return this.numberOfElements===-1},t.prototype.size=function(){return this.numberOfElements+1},t.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},t.prototype.max=function(){return this.priorityQueue[0]},t.prototype.swim=function(e){for(;e>0&&this.less(jv(e),e);)this.exchange(e,jv(e)),e=jv(e)},t.prototype.sink=function(e){for(;2*e<=this.numberOfElements;){var n=2*e;if(n<this.numberOfElements&&this.less(n,n+1)&&n++,!this.less(e,n))break;this.exchange(e,n),e=n}},t.prototype.getValueAt=function(e){return this.getElementValue(this.priorityQueue[e])},t.prototype.less=function(e,n){return this.getValueAt(e)<this.getValueAt(n)},t.prototype.exchange=function(e,n){var s=this.priorityQueue[e];this.priorityQueue[e]=this.priorityQueue[n],this.priorityQueue[n]=s},t}();function wIe(t,e,n,s,r,o){for(var i=o.shape,a=i[0],l=i[1],u=!0,c=Math.max(n-r,0),d=Math.min(n+r+1,a),h=c;h<d;++h){for(var p=Math.max(s-r,0),f=Math.min(s+r+1,l),m=p;m<f;++m)if(o.get(h,m,t)>e){u=!1;break}if(!u)break}return u}function vIe(t){return Mt(this,void 0,void 0,function(){return Bt(this,function(e){return[2,Promise.all(t.map(function(n){return n.buffer()}))]})})}function WM(t,e,n,s){return{y:s.get(t,e,n),x:s.get(t,e,n+17)}}function jM(t,e,n){var s=WM(t.heatmapY,t.heatmapX,t.id,n),r=s.y,o=s.x;return{x:t.heatmapX*e+o,y:t.heatmapY*e+r}}function GM(t,e,n,s){var r=n.x,o=n.y;return t.some(function(i){var a,l,u,c,d,h,p=i.keypoints;return a=o,l=r,u=p[s].y,c=p[s].x,(d=u-a)*d+(h=c-l)*h<=e})}var HE=da.reduce(function(t,e,n){return t[e]=n,t},{}),HM=[["nose","left_eye"],["left_eye","left_ear"],["nose","right_eye"],["right_eye","right_ear"],["nose","left_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["nose","right_shoulder"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"]].map(function(t){var e=t[0],n=t[1];return[HE[e],HE[n]]}),Gv=HM.map(function(t){return t[1]}),KE=HM.map(function(t){return t[0]});function qE(t,e,n){return t<e?e:t>n?n:t}function Hv(t,e,n,s){return{y:qE(Math.round(t.y/e),0,n-1),x:qE(Math.round(t.x/e),0,s-1)}}function XE(t,e){return{x:t.x+e.x,y:t.y+e.y}}function YE(t,e,n,s,r,o,i,a){a===void 0&&(a=2);for(var l=s.shape,u=l[0],c=l[1],d={y:e.y,x:e.x},h=XE(d,function(x,v,b){var S=b.shape[2]/2;return{y:b.get(v.y,v.x,x),x:b.get(v.y,v.x,S+x)}}(t,Hv(d,o,u,c),i)),p=0;p<a;p++){var f=Hv(h,o,u,c),m=WM(f.y,f.x,n,r);h=XE({x:f.x*o,y:f.y*o},{x:m.x,y:m.y})}var g=Hv(h,o,u,c),y=s.get(g.y,g.x,n);return{y:h.y,x:h.x,name:da[n],score:y}}function bIe(t,e,n,s,r,o){var i=e.shape[2],a=Gv.length,l=new Array(i),u=t.part,c=t.score,d=jM(u,s,n);l[u.id]={score:c,name:da[u.id],y:d.y,x:d.x};for(var h=a-1;h>=0;--h){var p=Gv[h],f=KE[h];l[p]&&!l[f]&&(l[f]=YE(h,l[p],f,e,n,s,o))}for(h=0;h<a;++h)p=KE[h],f=Gv[h],l[p]&&!l[f]&&(l[f]=YE(h,l[p],f,e,n,s,r));return l}function SIe(t,e,n){return n.reduce(function(s,r,o){var i=r.y,a=r.x,l=r.score;return GM(t,e,{y:i,x:a},o)||(s+=l),s},0)/n.length}function CIe(t,e,n,s,r,o,i,a){return i===void 0&&(i=.5),a===void 0&&(a=20),Mt(this,void 0,void 0,function(){var l,u,c,d,h,p,f,m,g,y,x,v;return Bt(this,function(b){switch(b.label){case 0:return[4,vIe([t,e,n,s])];case 1:for(l=b.sent(),u=l[0],c=l[1],d=l[2],h=l[3],p=[],f=function(S,C,I){for(var T=I.shape,R=T[0],_=T[1],P=T[2],z=new xIe(R*_*P,function(oe){return oe.score}),O=0;O<R;++O)for(var V=0;V<_;++V)for(var H=0;H<P;++H){var Q=I.get(O,V,H);Q<S||wIe(H,Q,O,V,C,I)&&z.enqueue({score:Q,part:{heatmapY:O,heatmapX:V,id:H}})}return z}(i,1,u),m=a*a;p.length<o&&!f.empty();)g=f.dequeue(),y=jM(g.part,r,c),GM(p,m,y,g.part.id)||(x=bIe(g,u,c,r,d,h),v=SIe(p,m,x),p.push({keypoints:x,score:v}));return[2,p]}})})}function KM(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];switch(e.length){case 0:t="fn main() ";break;case 1:t="fn main(".concat(e[0]," : i32)");break;default:throw Error("Unreachable")}return t}var kIe=function(){function t(e){this.variableNames=["A","B"],this.size=!0,this.workgroupSize=[32,1,1],this.outputShape=[e[0],1],this.dispatchLayout=Ve(this.outputShape),this.dispatch=De(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="getpointsConfidenceOp"}return t.prototype.getUserCode=function(){return`
        `.concat(KM("index"),` {
          if (index < uniforms.size) {
            let y = B[index * 2];
            let x = B[index * 2 + 1];
            let outIndex = y * uniforms.aShape.x * uniforms.aShape.z + x * uniforms.aShape.z + index;
            result[index] = A[outIndex];
          }
        }
        `)},t}();function IIe(t,e){if(ju()instanceof Yh)return function(n,s){var r=ju(),o=new kIe(s.shape),i=r.runWebGPUProgram(o,[n,s],"float32");return rr().makeTensorFromTensorInfo(i)}(t,e);throw new Error("getPointsConfidenceWebGPU is not supported in this backend!")}var $Ie=function(){function t(e){if(this.variableNames=["A","B"],this.size=!0,this.supportedLastDimension=2,e.length!==2||e[1]!==this.supportedLastDimension)throw new Error("GetOffsetVectorsProgram only supports shape of [x, ".concat(this.supportedLastDimension,"], but current shape is ").concat(e));this.workgroupSize=[32,1,1],this.outputShape=e;var n=[e[0],1];this.dispatchLayout=Ve(n),this.dispatch=De(this.dispatchLayout,n,this.workgroupSize),this.shaderKey="GetOffsetVectors"}return t.prototype.getUserCode=function(){return`
    fn getOffsetPoint(y: i32, x: i32, index: i32) -> vec2<i32> {
      let outIndexY = y * uniforms.bShape.x * uniforms.bShape.y + x * uniforms.bShape.y + index;
      let outIndexX = outIndexY + uniforms.bShape.z;
      let outY = i32(B[outIndexY]);
      let outX = i32(B[outIndexX]);
      return vec2<i32>(outY, outX);
    }

    `.concat(KM("index"),` {
      if (index < uniforms.size) {
        let indexY = index * `).concat(this.supportedLastDimension,`;
        let indexX = indexY + 1;
        let heatmapY = A[indexY];
        let heatmapX = A[indexX];
        let out = getOffsetPoint(i32(heatmapY), i32(heatmapX), index);
        result[indexY] = f32(out[0]);
        result[indexX] = f32(out[1]);
      }
    }
    `)},t}();function NIe(t,e){if(ju()instanceof Yh)return function(n,s){var r=ju(),o=new $Ie(n.shape),i=r.runWebGPUProgram(o,[n,s],"float32");return rr().makeTensorFromTensorInfo(i)}(t,e);throw new Error("getOffsetVectorsGPU is not supported in this backend!")}function qM(t){var e=t.shape,n=e[0],s=e[1],r=e[2];return ne(function(){var o,i,a=q(t,[n*s,r]),l=Ku(a,0),u=Zn(Me(l,ot(s,"int32")),1),c=Zn((o=l,i=s,ne(function(){var d=Me(o,ot(i,"int32"));return Be(o,U(d,ot(i,"int32")))})),1);return Pn([u,c],1)})}function TIe(t,e,n){return ne(function(){var s=function(r,o){for(var i=[],a=0;a<da.length;a++){var l=r.get(a,0).valueOf(),u=r.get(a,1).valueOf(),c=EIe(l,u,a,o),d=c.x,h=c.y;i.push(h),i.push(d)}return Ho(i,[da.length,2])}(t,n);return me(Ee(U(t.toTensor(),ot(e,"int32")),"float32"),s)})}function EIe(t,e,n,s){return{y:s.get(t,e,n),x:s.get(t,e,n+da.length)}}function RIe(t,e,n){return Mt(this,void 0,void 0,function(){var s,r,o,i,a,l,u,c,d,h;return Bt(this,function(p){switch(p.label){case 0:return s=0,r=qM(t),[4,Promise.all([t.buffer(),e.buffer(),r.buffer()])];case 1:return o=p.sent(),i=o[0],a=o[1],l=o[2],[4,(u=TIe(l,n,a)).buffer()];case 2:return c=p.sent(),d=Array.from(function(f,m){for(var g=m.shape[0],y=new Float32Array(g),x=0;x<g;x++){var v=m.get(x,0),b=m.get(x,1);y[x]=f.get(v,b,x)}return y}(i,l)),h=d.map(function(f,m){return s+=f,{y:c.get(m,0),x:c.get(m,1),score:f,name:da[m]}}),r.dispose(),u.dispose(),[2,{keypoints:h,score:s/h.length}]}})})}function DIe(t,e,n){return Mt(this,void 0,void 0,function(){var s,r,o;return Bt(this,function(i){return s=qM(t),r=function(a,l,u){return ne(function(){var c=NIe(a,u);return me(Ee(U(a,ot(l,"int32")),"float32"),c)})}(s,n,e),o=IIe(t,s),[2,[r,o]]})})}function QE(t,e){return(t-1)%e==0}var JE="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",ZE="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";function eR(t,e){return function(n,s){return(n-1)%s==0}(t,e)?t:Math.floor(t/e)*e+1}var tR=function(){function t(e,n){this.posenetModel=e;var s=this.posenetModel.inputs[0].shape;A(s[1]===-1&&s[2]===-1,function(){return"Input shape [".concat(s[1],", ").concat(s[2],"] ")+"must both be equal to or -1"});var r,o,i=(r=n.inputResolution,o=n.outputStride,{height:eR(r.height,o),width:eR(r.width,o)});(function(a){A(mIe.indexOf(a)>=0,function(){return"outputStride of ".concat(a," is invalid. ")+"It must be either 8 or 16."})})(n.outputStride),function(a,l){A(QE(a.height,l),function(){return"height of ".concat(a.height," is invalid for output stride ")+"".concat(l,".")}),A(QE(a.width,l),function(){return"width of ".concat(a.width," is invalid for output stride ")+"".concat(l,".")})}(i,n.outputStride),this.inputResolution=i,this.outputStride=n.outputStride,this.architecture=n.architecture}return t.prototype.estimatePoses=function(e,n){return n===void 0&&(n=GE),Mt(this,void 0,void 0,function(){return Bt(this,function(s){return[2,this.estimatePosesGPU(e,n,!1)]})})},t.prototype.estimatePosesGPU=function(e,n,s){return n===void 0&&(n=GE),s===void 0&&(s=!1),Mt(this,void 0,void 0,function(){var r,o,i,a,l,u,c,d,h,p,f,m,g,y,x,v,b,S;return Bt(this,function(C){switch(C.label){case 0:return r=function(I){var T=I;if(T.maxPoses==null&&(T.maxPoses=1),T.maxPoses<=0)throw new Error("Invalid maxPoses ".concat(T.maxPoses,". Should be > 0."));if(T.maxPoses>1){if((T=dn(dn({},gIe),T)).scoreThreshold<0||T.scoreThreshold>1)throw new Error("Invalid scoreThreshold ".concat(T.scoreThreshold,". ")+"Should be in range [0.0, 1.0]");if(T.nmsRadius<=0)throw new Error("Invalid nmsRadius ".concat(T.nmsRadius,"."))}return T}(n),e==null?[2,s?[[],[]]:[]]:(this.maxPoses=r.maxPoses,o=HS(e,{outputTensorSize:this.inputResolution,keepAspectRatio:!0,borderMode:"replicate"}),i=o.imageTensor,a=o.padding,l=this.architecture==="ResNet50"?me(i,yIe):zM(i,[-1,1]),u=this.posenetModel.predict(l),this.architecture==="ResNet50"?(c=Ht(u[2],[0]),d=Ht(u[3],[0]),h=Ht(u[0],[0]),p=Ht(u[1],[0])):(c=Ht(u[0],[0]),d=Ht(u[1],[0]),h=Ht(u[2],[0]),p=Ht(u[3],[0])),f=uo(d),this.maxPoses!==1?[3,5]:s?[4,DIe(f,c,this.outputStride)]:[3,2]);case 1:return g=C.sent(),x=g[0],y=g[1],m=[x,y],[3,4];case 2:return[4,RIe(f,c,this.outputStride)];case 3:x=C.sent(),m=[x],C.label=4;case 4:return[3,7];case 5:if(s)throw new Error("GPU renderer only supports single pose!");return[4,CIe(f,c,h,p,this.outputStride,this.maxPoses,r.scoreThreshold,r.nmsRadius)];case 6:m=C.sent(),C.label=7;case 7:if(s){if(r.flipHorizontal===!0)throw new Error("flipHorizontal is not supported!");v=this.getCanvasInfo(Ad(e),this.inputResolution,a)}else S=Ad(e),b=function(I,T,R,_){var P=T.height,z=T.width,O=P/(R.height*(1-_.top-_.bottom)),V=z/(R.width*(1-_.left-_.right)),H=-_.top*R.height,Q=-_.left*R.width;if(V===1&&O===1&&H===0&&Q===0)return I;for(var oe=0,j=I;oe<j.length;oe++)for(var ee=0,ie=j[oe].keypoints;ee<ie.length;ee++){var le=ie[ee];le.x=(le.x+Q)*V,le.y=(le.y+H)*O}return I}(m,S,this.inputResolution,a),r.flipHorizontal&&(b=function(I,T){for(var R=0,_=I;R<_.length;R++)for(var P=0,z=_[R].keypoints;P<z.length;P++){var O=z[P];O.x=T.width-1-O.x}return I}(b,S));return i.dispose(),l.dispose(),lt(u),c.dispose(),d.dispose(),h.dispose(),p.dispose(),f.dispose(),[2,s?[m,v]:b]}})})},t.prototype.getCanvasInfo=function(e,n,s){var r=e.height,o=e.width,i=r/(n.height*(1-s.top-s.bottom)),a=o/(n.width*(1-s.left-s.right)),l=-s.top*n.height;return[-s.left*n.width,l,a,i,e.width,e.height]},t.prototype.dispose=function(){this.posenetModel.dispose()},t.prototype.reset=function(){},t}();function AIe(t){return t===void 0&&(t=BE),Mt(this,void 0,void 0,function(){var e,n,s,r,o;return Bt(this,function(i){switch(i.label){case 0:return(e=function(c){var d=c||BE;if(d.architecture==null&&(d.architecture="MobileNetV1"),VE.indexOf(d.architecture)<0)throw new Error("Invalid architecture ".concat(d.architecture,". ")+"Should be one of ".concat(VE));if(d.inputResolution==null&&(d.inputResolution={height:257,width:257}),d.outputStride==null&&(d.outputStride=16),UE[d.architecture].indexOf(d.outputStride)<0)throw new Error("Invalid outputStride ".concat(d.outputStride,". ")+"Should be one of ".concat(UE[d.architecture]," ")+"for architecture ".concat(d.architecture,"."));if(d.multiplier==null&&(d.multiplier=1),WE[d.architecture].indexOf(d.multiplier)<0)throw new Error("Invalid multiplier ".concat(d.multiplier,". ")+"Should be one of ".concat(WE[d.architecture]," ")+"for architecture ".concat(d.architecture,"."));if(d.quantBytes==null&&(d.quantBytes=4),jE.indexOf(d.quantBytes)<0)throw new Error("Invalid quantBytes ".concat(d.quantBytes,". ")+"Should be one of ".concat(jE," ")+"for architecture ".concat(d.architecture,"."));if(d.architecture==="MobileNetV1"&&d.outputStride===32&&d.multiplier!==1)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return d}(t)).architecture!=="ResNet50"?[3,2]:(a=e.outputStride,l=e.quantBytes,u="model-stride".concat(a,".json"),n=l===4?ZE+"float/"+u:ZE+"quant".concat(l,"/")+u,[4,Id(e.modelUrl||n)]);case 1:return s=i.sent(),[2,new tR(s,e)];case 2:return r=function(c,d,h){var p={1:"100",.75:"075",.5:"050"},f="model-stride".concat(c,".json");return h===4?JE+"float/".concat(p[d],"/")+f:JE+"quant".concat(h,"/").concat(p[d],"/")+f}(e.outputStride,e.multiplier,e.quantBytes),[4,Id(e.modelUrl||r)];case 3:return o=i.sent(),[2,new tR(o,e)]}var a,l,u})})}function _Ie(t,e){return Mt(this,void 0,void 0,function(){var n,s;return Bt(this,function(r){switch(t){case ia.PoseNet:return[2,AIe(e)];case ia.BlazePose:if(s=void 0,(n=e)!=null){if(n.runtime==="tfjs")return[2,aIe(e)];if(n.runtime==="mediapipe")return[2,_ke(e)];s=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' "+"or 'mediapipe', but got ".concat(s));case ia.MoveNet:return[2,fIe(e)];default:throw new Error("".concat(t," is not a supported model name."))}})})}var FIe={modelType:{SINGLEPOSE_LIGHTNING:"SinglePose.Lightning",SINGLEPOSE_THUNDER:"SinglePose.Thunder",MULTIPOSE_LIGHTNING:"MultiPose.Lightning"}},XM={exports:{}};(function(t,e){(function(s,r){t.exports=r(X)})(xi,function(n){return function(s){var r={};function o(i){if(r[i])return r[i].exports;var a=r[i]={i,l:!1,exports:{}};return s[i].call(a.exports,a,a.exports,o),a.l=!0,a.exports}return o.m=s,o.c=r,o.d=function(i,a,l){o.o(i,a)||Object.defineProperty(i,a,{enumerable:!0,get:l})},o.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},o.t=function(i,a){if(a&1&&(i=o(i)),a&8||a&4&&typeof i=="object"&&i&&i.__esModule)return i;var l=Object.create(null);if(o.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:i}),a&2&&typeof i!="string")for(var u in i)o.d(l,u,(function(c){return i[c]}).bind(null,u));return l},o.n=function(i){var a=i&&i.__esModule?function(){return i.default}:function(){return i};return o.d(a,"a",a),a},o.o=function(i,a){return Object.prototype.hasOwnProperty.call(i,a)},o.p="",o(o.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(s,r,o){o.r(r);var i=o("react"),a=function(){var h=function(p,f){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,g){m.__proto__=g}||function(m,g){for(var y in g)g.hasOwnProperty(y)&&(m[y]=g[y])},h(p,f)};return function(p,f){h(p,f);function m(){this.constructor=p}p.prototype=f===null?Object.create(f):(m.prototype=f.prototype,new m)}}(),l=function(){return l=Object.assign||function(h){for(var p,f=1,m=arguments.length;f<m;f++){p=arguments[f];for(var g in p)Object.prototype.hasOwnProperty.call(p,g)&&(h[g]=p[g])}return h},l.apply(this,arguments)},u=function(h,p){var f={};for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&p.indexOf(m)<0&&(f[m]=h[m]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function")for(var g=0,m=Object.getOwnPropertySymbols(h);g<m.length;g++)p.indexOf(m[g])<0&&Object.prototype.propertyIsEnumerable.call(h,m[g])&&(f[m[g]]=h[m[g]]);return f};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(p){var f=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return f?new Promise(function(m,g){f.call(navigator,p,m,g)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function c(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var d=function(h){a(p,h);function p(f){var m=h.call(this,f)||this;return m.canvas=null,m.ctx=null,m.requestUserMediaId=0,m.unmounted=!1,m.state={hasUserMedia:!1},m}return p.prototype.componentDidMount=function(){var f=this,m=f.state,g=f.props;if(this.unmounted=!1,!c()){g.onUserMediaError("getUserMedia not supported");return}m.hasUserMedia||this.requestUserMedia(),g.children&&typeof g.children!="function"&&console.warn("children must be a function")},p.prototype.componentDidUpdate=function(f){var m=this.props;if(!c()){m.onUserMediaError("getUserMedia not supported");return}var g=JSON.stringify(f.audioConstraints)!==JSON.stringify(m.audioConstraints),y=JSON.stringify(f.videoConstraints)!==JSON.stringify(m.videoConstraints),x=f.minScreenshotWidth!==m.minScreenshotWidth,v=f.minScreenshotHeight!==m.minScreenshotHeight;(y||x||v)&&(this.canvas=null,this.ctx=null),(g||y)&&(this.stopAndCleanup(),this.requestUserMedia())},p.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},p.stopMediaStream=function(f){f&&(f.getVideoTracks&&f.getAudioTracks?(f.getVideoTracks().map(function(m){f.removeTrack(m),m.stop()}),f.getAudioTracks().map(function(m){f.removeTrack(m),m.stop()})):f.stop())},p.prototype.stopAndCleanup=function(){var f=this.state;f.hasUserMedia&&(p.stopMediaStream(this.stream),f.src&&window.URL.revokeObjectURL(f.src))},p.prototype.getScreenshot=function(f){var m=this,g=m.state,y=m.props;if(!g.hasUserMedia)return null;var x=this.getCanvas(f);return x&&x.toDataURL(y.screenshotFormat,y.screenshotQuality)},p.prototype.getCanvas=function(f){var m=this,g=m.state,y=m.props;if(!this.video||!g.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var x=this.video.videoWidth,v=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var b=x/v;x=y.minScreenshotWidth||this.video.clientWidth,v=x/b,y.minScreenshotHeight&&v<y.minScreenshotHeight&&(v=y.minScreenshotHeight,x=v*b)}this.canvas=document.createElement("canvas"),this.canvas.width=(f==null?void 0:f.width)||x,this.canvas.height=(f==null?void 0:f.height)||v,this.ctx=this.canvas.getContext("2d")}var S=this,C=S.ctx,I=S.canvas;return C&&I&&(I.width=(f==null?void 0:f.width)||I.width,I.height=(f==null?void 0:f.height)||I.height,y.mirrored&&(C.translate(I.width,0),C.scale(-1,1)),C.imageSmoothingEnabled=y.imageSmoothing,C.drawImage(this.video,0,0,(f==null?void 0:f.width)||I.width,(f==null?void 0:f.height)||I.height),y.mirrored&&(C.scale(-1,1),C.translate(-I.width,0))),I},p.prototype.requestUserMedia=function(){var f=this,m=this.props,g=function(v,b){var S={video:typeof b<"u"?b:!0};m.audio&&(S.audio=typeof v<"u"?v:!0),f.requestUserMediaId++;var C=f.requestUserMediaId;navigator.mediaDevices.getUserMedia(S).then(function(I){f.unmounted||C!==f.requestUserMediaId?p.stopMediaStream(I):f.handleUserMedia(null,I)}).catch(function(I){f.handleUserMedia(I)})};if("mediaDevices"in navigator)g(m.audioConstraints,m.videoConstraints);else{var y=function(v){return{optional:[{sourceId:v}]}},x=function(v){var b=v.deviceId;return typeof b=="string"?b:Array.isArray(b)&&b.length>0?b[0]:typeof b=="object"&&b.ideal?b.ideal:null};MediaStreamTrack.getSources(function(v){var b=null,S=null;v.forEach(function(T){T.kind==="audio"?b=T.id:T.kind==="video"&&(S=T.id)});var C=x(m.audioConstraints);C&&(b=C);var I=x(m.videoConstraints);I&&(S=I),g(y(b),y(S))})}},p.prototype.handleUserMedia=function(f,m){var g=this.props;if(f||!m){this.setState({hasUserMedia:!1}),g.onUserMediaError(f);return}this.stream=m;try{this.video&&(this.video.srcObject=m),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(m)})}g.onUserMedia(m)},p.prototype.render=function(){var f=this,m=this,g=m.state,y=m.props,x=y.audio;y.forceScreenshotSourceSize;var v=y.disablePictureInPicture;y.onUserMedia,y.onUserMediaError,y.screenshotFormat,y.screenshotQuality,y.minScreenshotWidth,y.minScreenshotHeight,y.audioConstraints,y.videoConstraints,y.imageSmoothing;var b=y.mirrored,S=y.style,C=S===void 0?{}:S,I=y.children,T=u(y,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),R=b?l(l({},C),{transform:(C.transform||"")+" scaleX(-1)"}):C,_={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",l({autoPlay:!0,disablePictureInPicture:v,src:g.src,muted:!x,playsInline:!0,ref:function(P){f.video=P},style:R},T)),I&&I(_))},p.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},p}(i.Component);r.default=d},react:function(s,r){s.exports=n}}).default})})(XM);var PIe=XM.exports;const OIe=jx(PIe);function YM(t,e){return function(){return t.apply(e,arguments)}}const{toString:LIe}=Object.prototype,{getPrototypeOf:yI}=Object,$1=(t=>e=>{const n=LIe.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),zi=t=>(t=t.toLowerCase(),e=>$1(e)===t),N1=t=>e=>typeof e===t,{isArray:Zh}=Array,Pf=N1("undefined");function zIe(t){return t!==null&&!Pf(t)&&t.constructor!==null&&!Pf(t.constructor)&&co(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const QM=zi("ArrayBuffer");function MIe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&QM(t.buffer),e}const BIe=N1("string"),co=N1("function"),JM=N1("number"),T1=t=>t!==null&&typeof t=="object",VIe=t=>t===!0||t===!1,Ny=t=>{if($1(t)!=="object")return!1;const e=yI(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},UIe=zi("Date"),WIe=zi("File"),jIe=zi("Blob"),GIe=zi("FileList"),HIe=t=>T1(t)&&co(t.pipe),KIe=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||co(t.append)&&((e=$1(t))==="formdata"||e==="object"&&co(t.toString)&&t.toString()==="[object FormData]"))},qIe=zi("URLSearchParams"),[XIe,YIe,QIe,JIe]=["ReadableStream","Request","Response","Headers"].map(zi),ZIe=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function mg(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let s,r;if(typeof t!="object"&&(t=[t]),Zh(t))for(s=0,r=t.length;s<r;s++)e.call(null,t[s],s,t);else{const o=n?Object.getOwnPropertyNames(t):Object.keys(t),i=o.length;let a;for(s=0;s<i;s++)a=o[s],e.call(null,t[a],a,t)}}function ZM(t,e){e=e.toLowerCase();const n=Object.keys(t);let s=n.length,r;for(;s-- >0;)if(r=n[s],e===r.toLowerCase())return r;return null}const $u=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,eB=t=>!Pf(t)&&t!==$u;function XS(){const{caseless:t}=eB(this)&&this||{},e={},n=(s,r)=>{const o=t&&ZM(e,r)||r;Ny(e[o])&&Ny(s)?e[o]=XS(e[o],s):Ny(s)?e[o]=XS({},s):Zh(s)?e[o]=s.slice():e[o]=s};for(let s=0,r=arguments.length;s<r;s++)arguments[s]&&mg(arguments[s],n);return e}const e$e=(t,e,n,{allOwnKeys:s}={})=>(mg(e,(r,o)=>{n&&co(r)?t[o]=YM(r,n):t[o]=r},{allOwnKeys:s}),t),t$e=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),n$e=(t,e,n,s)=>{t.prototype=Object.create(e.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},s$e=(t,e,n,s)=>{let r,o,i;const a={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),o=r.length;o-- >0;)i=r[o],(!s||s(i,t,e))&&!a[i]&&(e[i]=t[i],a[i]=!0);t=n!==!1&&yI(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},r$e=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const s=t.indexOf(e,n);return s!==-1&&s===n},o$e=t=>{if(!t)return null;if(Zh(t))return t;let e=t.length;if(!JM(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},i$e=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&yI(Uint8Array)),a$e=(t,e)=>{const s=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=s.next())&&!r.done;){const o=r.value;e.call(t,o[0],o[1])}},l$e=(t,e)=>{let n;const s=[];for(;(n=t.exec(e))!==null;)s.push(n);return s},u$e=zi("HTMLFormElement"),c$e=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,s,r){return s.toUpperCase()+r}),nR=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),d$e=zi("RegExp"),tB=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),s={};mg(n,(r,o)=>{let i;(i=e(r,o,t))!==!1&&(s[o]=i||r)}),Object.defineProperties(t,s)},h$e=t=>{tB(t,(e,n)=>{if(co(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=t[n];if(co(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},p$e=(t,e)=>{const n={},s=r=>{r.forEach(o=>{n[o]=!0})};return Zh(t)?s(t):s(String(t).split(e)),n},f$e=()=>{},m$e=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,Kv="abcdefghijklmnopqrstuvwxyz",sR="0123456789",nB={DIGIT:sR,ALPHA:Kv,ALPHA_DIGIT:Kv+Kv.toUpperCase()+sR},g$e=(t=16,e=nB.ALPHA_DIGIT)=>{let n="";const{length:s}=e;for(;t--;)n+=e[Math.random()*s|0];return n};function y$e(t){return!!(t&&co(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const x$e=t=>{const e=new Array(10),n=(s,r)=>{if(T1(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[r]=s;const o=Zh(s)?[]:{};return mg(s,(i,a)=>{const l=n(i,r+1);!Pf(l)&&(o[a]=l)}),e[r]=void 0,o}}return s};return n(t,0)},w$e=zi("AsyncFunction"),v$e=t=>t&&(T1(t)||co(t))&&co(t.then)&&co(t.catch),sB=((t,e)=>t?setImmediate:e?((n,s)=>($u.addEventListener("message",({source:r,data:o})=>{r===$u&&o===n&&s.length&&s.shift()()},!1),r=>{s.push(r),$u.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",co($u.postMessage)),b$e=typeof queueMicrotask<"u"?queueMicrotask.bind($u):typeof process<"u"&&process.nextTick||sB,pe={isArray:Zh,isArrayBuffer:QM,isBuffer:zIe,isFormData:KIe,isArrayBufferView:MIe,isString:BIe,isNumber:JM,isBoolean:VIe,isObject:T1,isPlainObject:Ny,isReadableStream:XIe,isRequest:YIe,isResponse:QIe,isHeaders:JIe,isUndefined:Pf,isDate:UIe,isFile:WIe,isBlob:jIe,isRegExp:d$e,isFunction:co,isStream:HIe,isURLSearchParams:qIe,isTypedArray:i$e,isFileList:GIe,forEach:mg,merge:XS,extend:e$e,trim:ZIe,stripBOM:t$e,inherits:n$e,toFlatObject:s$e,kindOf:$1,kindOfTest:zi,endsWith:r$e,toArray:o$e,forEachEntry:a$e,matchAll:l$e,isHTMLForm:u$e,hasOwnProperty:nR,hasOwnProp:nR,reduceDescriptors:tB,freezeMethods:h$e,toObjectSet:p$e,toCamelCase:c$e,noop:f$e,toFiniteNumber:m$e,findKey:ZM,global:$u,isContextDefined:eB,ALPHABET:nB,generateString:g$e,isSpecCompliantForm:y$e,toJSONObject:x$e,isAsyncFn:w$e,isThenable:v$e,setImmediate:sB,asap:b$e};function It(t,e,n,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),s&&(this.request=s),r&&(this.response=r,this.status=r.status?r.status:null)}pe.inherits(It,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:pe.toJSONObject(this.config),code:this.code,status:this.status}}});const rB=It.prototype,oB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{oB[t]={value:t}});Object.defineProperties(It,oB);Object.defineProperty(rB,"isAxiosError",{value:!0});It.from=(t,e,n,s,r,o)=>{const i=Object.create(rB);return pe.toFlatObject(t,i,function(l){return l!==Error.prototype},a=>a!=="isAxiosError"),It.call(i,t.message,e,n,s,r),i.cause=t,i.name=t.name,o&&Object.assign(i,o),i};const S$e=null;function YS(t){return pe.isPlainObject(t)||pe.isArray(t)}function iB(t){return pe.endsWith(t,"[]")?t.slice(0,-2):t}function rR(t,e,n){return t?t.concat(e).map(function(r,o){return r=iB(r),!n&&o?"["+r+"]":r}).join(n?".":""):e}function C$e(t){return pe.isArray(t)&&!t.some(YS)}const k$e=pe.toFlatObject(pe,{},null,function(e){return/^is[A-Z]/.test(e)});function E1(t,e,n){if(!pe.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=pe.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!pe.isUndefined(g[m])});const s=n.metaTokens,r=n.visitor||c,o=n.dots,i=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&pe.isSpecCompliantForm(e);if(!pe.isFunction(r))throw new TypeError("visitor must be a function");function u(f){if(f===null)return"";if(pe.isDate(f))return f.toISOString();if(!l&&pe.isBlob(f))throw new It("Blob is not supported. Use a Buffer instead.");return pe.isArrayBuffer(f)||pe.isTypedArray(f)?l&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function c(f,m,g){let y=f;if(f&&!g&&typeof f=="object"){if(pe.endsWith(m,"{}"))m=s?m:m.slice(0,-2),f=JSON.stringify(f);else if(pe.isArray(f)&&C$e(f)||(pe.isFileList(f)||pe.endsWith(m,"[]"))&&(y=pe.toArray(f)))return m=iB(m),y.forEach(function(v,b){!(pe.isUndefined(v)||v===null)&&e.append(i===!0?rR([m],b,o):i===null?m:m+"[]",u(v))}),!1}return YS(f)?!0:(e.append(rR(g,m,o),u(f)),!1)}const d=[],h=Object.assign(k$e,{defaultVisitor:c,convertValue:u,isVisitable:YS});function p(f,m){if(!pe.isUndefined(f)){if(d.indexOf(f)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(f),pe.forEach(f,function(y,x){(!(pe.isUndefined(y)||y===null)&&r.call(e,y,pe.isString(x)?x.trim():x,m,h))===!0&&p(y,m?m.concat(x):[x])}),d.pop()}}if(!pe.isObject(t))throw new TypeError("data must be an object");return p(t),e}function oR(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function xI(t,e){this._pairs=[],t&&E1(t,this,e)}const aB=xI.prototype;aB.append=function(e,n){this._pairs.push([e,n])};aB.toString=function(e){const n=e?function(s){return e.call(this,s,oR)}:oR;return this._pairs.map(function(r){return n(r[0])+"="+n(r[1])},"").join("&")};function I$e(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function lB(t,e,n){if(!e)return t;const s=n&&n.encode||I$e;pe.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let o;if(r?o=r(e,n):o=pe.isURLSearchParams(e)?e.toString():new xI(e,n).toString(s),o){const i=t.indexOf("#");i!==-1&&(t=t.slice(0,i)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}class iR{constructor(){this.handlers=[]}use(e,n,s){return this.handlers.push({fulfilled:e,rejected:n,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){pe.forEach(this.handlers,function(s){s!==null&&e(s)})}}const uB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$$e=typeof URLSearchParams<"u"?URLSearchParams:xI,N$e=typeof FormData<"u"?FormData:null,T$e=typeof Blob<"u"?Blob:null,E$e={isBrowser:!0,classes:{URLSearchParams:$$e,FormData:N$e,Blob:T$e},protocols:["http","https","file","blob","url","data"]},wI=typeof window<"u"&&typeof document<"u",QS=typeof navigator=="object"&&navigator||void 0,R$e=wI&&(!QS||["ReactNative","NativeScript","NS"].indexOf(QS.product)<0),D$e=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",A$e=wI&&window.location.href||"http://localhost",_$e=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:wI,hasStandardBrowserEnv:R$e,hasStandardBrowserWebWorkerEnv:D$e,navigator:QS,origin:A$e},Symbol.toStringTag,{value:"Module"})),ur={..._$e,...E$e};function F$e(t,e){return E1(t,new ur.classes.URLSearchParams,Object.assign({visitor:function(n,s,r,o){return ur.isNode&&pe.isBuffer(n)?(this.append(s,n.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function P$e(t){return pe.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function O$e(t){const e={},n=Object.keys(t);let s;const r=n.length;let o;for(s=0;s<r;s++)o=n[s],e[o]=t[o];return e}function cB(t){function e(n,s,r,o){let i=n[o++];if(i==="__proto__")return!0;const a=Number.isFinite(+i),l=o>=n.length;return i=!i&&pe.isArray(r)?r.length:i,l?(pe.hasOwnProp(r,i)?r[i]=[r[i],s]:r[i]=s,!a):((!r[i]||!pe.isObject(r[i]))&&(r[i]=[]),e(n,s,r[i],o)&&pe.isArray(r[i])&&(r[i]=O$e(r[i])),!a)}if(pe.isFormData(t)&&pe.isFunction(t.entries)){const n={};return pe.forEachEntry(t,(s,r)=>{e(P$e(s),r,n,0)}),n}return null}function L$e(t,e,n){if(pe.isString(t))try{return(e||JSON.parse)(t),pe.trim(t)}catch(s){if(s.name!=="SyntaxError")throw s}return(0,JSON.stringify)(t)}const gg={transitional:uB,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const s=n.getContentType()||"",r=s.indexOf("application/json")>-1,o=pe.isObject(e);if(o&&pe.isHTMLForm(e)&&(e=new FormData(e)),pe.isFormData(e))return r?JSON.stringify(cB(e)):e;if(pe.isArrayBuffer(e)||pe.isBuffer(e)||pe.isStream(e)||pe.isFile(e)||pe.isBlob(e)||pe.isReadableStream(e))return e;if(pe.isArrayBufferView(e))return e.buffer;if(pe.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(s.indexOf("application/x-www-form-urlencoded")>-1)return F$e(e,this.formSerializer).toString();if((a=pe.isFileList(e))||s.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return E1(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return o||r?(n.setContentType("application/json",!1),L$e(e)):e}],transformResponse:[function(e){const n=this.transitional||gg.transitional,s=n&&n.forcedJSONParsing,r=this.responseType==="json";if(pe.isResponse(e)||pe.isReadableStream(e))return e;if(e&&pe.isString(e)&&(s&&!this.responseType||r)){const i=!(n&&n.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(a){if(i)throw a.name==="SyntaxError"?It.from(a,It.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ur.classes.FormData,Blob:ur.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};pe.forEach(["delete","get","head","post","put","patch"],t=>{gg.headers[t]={}});const z$e=pe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),M$e=t=>{const e={};let n,s,r;return t&&t.split(`
`).forEach(function(i){r=i.indexOf(":"),n=i.substring(0,r).trim().toLowerCase(),s=i.substring(r+1).trim(),!(!n||e[n]&&z$e[n])&&(n==="set-cookie"?e[n]?e[n].push(s):e[n]=[s]:e[n]=e[n]?e[n]+", "+s:s)}),e},aR=Symbol("internals");function Sp(t){return t&&String(t).trim().toLowerCase()}function Ty(t){return t===!1||t==null?t:pe.isArray(t)?t.map(Ty):String(t)}function B$e(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(t);)e[s[1]]=s[2];return e}const V$e=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function qv(t,e,n,s,r){if(pe.isFunction(s))return s.call(this,e,n);if(r&&(e=n),!!pe.isString(e)){if(pe.isString(s))return e.indexOf(s)!==-1;if(pe.isRegExp(s))return s.test(e)}}function U$e(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,s)=>n.toUpperCase()+s)}function W$e(t,e){const n=pe.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(t,s+n,{value:function(r,o,i){return this[s].call(this,e,r,o,i)},configurable:!0})})}class Kr{constructor(e){e&&this.set(e)}set(e,n,s){const r=this;function o(a,l,u){const c=Sp(l);if(!c)throw new Error("header name must be a non-empty string");const d=pe.findKey(r,c);(!d||r[d]===void 0||u===!0||u===void 0&&r[d]!==!1)&&(r[d||l]=Ty(a))}const i=(a,l)=>pe.forEach(a,(u,c)=>o(u,c,l));if(pe.isPlainObject(e)||e instanceof this.constructor)i(e,n);else if(pe.isString(e)&&(e=e.trim())&&!V$e(e))i(M$e(e),n);else if(pe.isHeaders(e))for(const[a,l]of e.entries())o(l,a,s);else e!=null&&o(n,e,s);return this}get(e,n){if(e=Sp(e),e){const s=pe.findKey(this,e);if(s){const r=this[s];if(!n)return r;if(n===!0)return B$e(r);if(pe.isFunction(n))return n.call(this,r,s);if(pe.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Sp(e),e){const s=pe.findKey(this,e);return!!(s&&this[s]!==void 0&&(!n||qv(this,this[s],s,n)))}return!1}delete(e,n){const s=this;let r=!1;function o(i){if(i=Sp(i),i){const a=pe.findKey(s,i);a&&(!n||qv(s,s[a],a,n))&&(delete s[a],r=!0)}}return pe.isArray(e)?e.forEach(o):o(e),r}clear(e){const n=Object.keys(this);let s=n.length,r=!1;for(;s--;){const o=n[s];(!e||qv(this,this[o],o,e,!0))&&(delete this[o],r=!0)}return r}normalize(e){const n=this,s={};return pe.forEach(this,(r,o)=>{const i=pe.findKey(s,o);if(i){n[i]=Ty(r),delete n[o];return}const a=e?U$e(o):String(o).trim();a!==o&&delete n[o],n[a]=Ty(r),s[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return pe.forEach(this,(s,r)=>{s!=null&&s!==!1&&(n[r]=e&&pe.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const s=new this(e);return n.forEach(r=>s.set(r)),s}static accessor(e){const s=(this[aR]=this[aR]={accessors:{}}).accessors,r=this.prototype;function o(i){const a=Sp(i);s[a]||(W$e(r,i),s[a]=!0)}return pe.isArray(e)?e.forEach(o):o(e),this}}Kr.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);pe.reduceDescriptors(Kr.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(s){this[n]=s}}});pe.freezeMethods(Kr);function Xv(t,e){const n=this||gg,s=e||n,r=Kr.from(s.headers);let o=s.data;return pe.forEach(t,function(a){o=a.call(n,o,r.normalize(),e?e.status:void 0)}),r.normalize(),o}function dB(t){return!!(t&&t.__CANCEL__)}function ep(t,e,n){It.call(this,t??"canceled",It.ERR_CANCELED,e,n),this.name="CanceledError"}pe.inherits(ep,It,{__CANCEL__:!0});function hB(t,e,n){const s=n.config.validateStatus;!n.status||!s||s(n.status)?t(n):e(new It("Request failed with status code "+n.status,[It.ERR_BAD_REQUEST,It.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function j$e(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function G$e(t,e){t=t||10;const n=new Array(t),s=new Array(t);let r=0,o=0,i;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=s[o];i||(i=u),n[r]=l,s[r]=u;let d=o,h=0;for(;d!==r;)h+=n[d++],d=d%t;if(r=(r+1)%t,r===o&&(o=(o+1)%t),u-i<e)return;const p=c&&u-c;return p?Math.round(h*1e3/p):void 0}}function H$e(t,e){let n=0,s=1e3/e,r,o;const i=(u,c=Date.now())=>{n=c,r=null,o&&(clearTimeout(o),o=null),t.apply(null,u)};return[(...u)=>{const c=Date.now(),d=c-n;d>=s?i(u,c):(r=u,o||(o=setTimeout(()=>{o=null,i(r)},s-d)))},()=>r&&i(r)]}const Ux=(t,e,n=3)=>{let s=0;const r=G$e(50,250);return H$e(o=>{const i=o.loaded,a=o.lengthComputable?o.total:void 0,l=i-s,u=r(l),c=i<=a;s=i;const d={loaded:i,total:a,progress:a?i/a:void 0,bytes:l,rate:u||void 0,estimated:u&&a&&c?(a-i)/u:void 0,event:o,lengthComputable:a!=null,[e?"download":"upload"]:!0};t(d)},n)},lR=(t,e)=>{const n=t!=null;return[s=>e[0]({lengthComputable:n,total:t,loaded:s}),e[1]]},uR=t=>(...e)=>pe.asap(()=>t(...e)),K$e=ur.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,ur.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(ur.origin),ur.navigator&&/(msie|trident)/i.test(ur.navigator.userAgent)):()=>!0,q$e=ur.hasStandardBrowserEnv?{write(t,e,n,s,r,o){const i=[t+"="+encodeURIComponent(e)];pe.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),pe.isString(s)&&i.push("path="+s),pe.isString(r)&&i.push("domain="+r),o===!0&&i.push("secure"),document.cookie=i.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function X$e(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Y$e(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function pB(t,e){return t&&!X$e(e)?Y$e(t,e):e}const cR=t=>t instanceof Kr?{...t}:t;function nc(t,e){e=e||{};const n={};function s(u,c,d,h){return pe.isPlainObject(u)&&pe.isPlainObject(c)?pe.merge.call({caseless:h},u,c):pe.isPlainObject(c)?pe.merge({},c):pe.isArray(c)?c.slice():c}function r(u,c,d,h){if(pe.isUndefined(c)){if(!pe.isUndefined(u))return s(void 0,u,d,h)}else return s(u,c,d,h)}function o(u,c){if(!pe.isUndefined(c))return s(void 0,c)}function i(u,c){if(pe.isUndefined(c)){if(!pe.isUndefined(u))return s(void 0,u)}else return s(void 0,c)}function a(u,c,d){if(d in e)return s(u,c);if(d in t)return s(void 0,u)}const l={url:o,method:o,data:o,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:a,headers:(u,c,d)=>r(cR(u),cR(c),d,!0)};return pe.forEach(Object.keys(Object.assign({},t,e)),function(c){const d=l[c]||r,h=d(t[c],e[c],c);pe.isUndefined(h)&&d!==a||(n[c]=h)}),n}const fB=t=>{const e=nc({},t);let{data:n,withXSRFToken:s,xsrfHeaderName:r,xsrfCookieName:o,headers:i,auth:a}=e;e.headers=i=Kr.from(i),e.url=lB(pB(e.baseURL,e.url),t.params,t.paramsSerializer),a&&i.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let l;if(pe.isFormData(n)){if(ur.hasStandardBrowserEnv||ur.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((l=i.getContentType())!==!1){const[u,...c]=l?l.split(";").map(d=>d.trim()).filter(Boolean):[];i.setContentType([u||"multipart/form-data",...c].join("; "))}}if(ur.hasStandardBrowserEnv&&(s&&pe.isFunction(s)&&(s=s(e)),s||s!==!1&&K$e(e.url))){const u=r&&o&&q$e.read(o);u&&i.set(r,u)}return e},Q$e=typeof XMLHttpRequest<"u",J$e=Q$e&&function(t){return new Promise(function(n,s){const r=fB(t);let o=r.data;const i=Kr.from(r.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:u}=r,c,d,h,p,f;function m(){p&&p(),f&&f(),r.cancelToken&&r.cancelToken.unsubscribe(c),r.signal&&r.signal.removeEventListener("abort",c)}let g=new XMLHttpRequest;g.open(r.method.toUpperCase(),r.url,!0),g.timeout=r.timeout;function y(){if(!g)return;const v=Kr.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),S={data:!a||a==="text"||a==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:v,config:t,request:g};hB(function(I){n(I),m()},function(I){s(I),m()},S),g=null}"onloadend"in g?g.onloadend=y:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(y)},g.onabort=function(){g&&(s(new It("Request aborted",It.ECONNABORTED,t,g)),g=null)},g.onerror=function(){s(new It("Network Error",It.ERR_NETWORK,t,g)),g=null},g.ontimeout=function(){let b=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const S=r.transitional||uB;r.timeoutErrorMessage&&(b=r.timeoutErrorMessage),s(new It(b,S.clarifyTimeoutError?It.ETIMEDOUT:It.ECONNABORTED,t,g)),g=null},o===void 0&&i.setContentType(null),"setRequestHeader"in g&&pe.forEach(i.toJSON(),function(b,S){g.setRequestHeader(S,b)}),pe.isUndefined(r.withCredentials)||(g.withCredentials=!!r.withCredentials),a&&a!=="json"&&(g.responseType=r.responseType),u&&([h,f]=Ux(u,!0),g.addEventListener("progress",h)),l&&g.upload&&([d,p]=Ux(l),g.upload.addEventListener("progress",d),g.upload.addEventListener("loadend",p)),(r.cancelToken||r.signal)&&(c=v=>{g&&(s(!v||v.type?new ep(null,t,g):v),g.abort(),g=null)},r.cancelToken&&r.cancelToken.subscribe(c),r.signal&&(r.signal.aborted?c():r.signal.addEventListener("abort",c)));const x=j$e(r.url);if(x&&ur.protocols.indexOf(x)===-1){s(new It("Unsupported protocol "+x+":",It.ERR_BAD_REQUEST,t));return}g.send(o||null)})},Z$e=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let s=new AbortController,r;const o=function(u){if(!r){r=!0,a();const c=u instanceof Error?u:this.reason;s.abort(c instanceof It?c:new ep(c instanceof Error?c.message:c))}};let i=e&&setTimeout(()=>{i=null,o(new It(`timeout ${e} of ms exceeded`,It.ETIMEDOUT))},e);const a=()=>{t&&(i&&clearTimeout(i),i=null,t.forEach(u=>{u.unsubscribe?u.unsubscribe(o):u.removeEventListener("abort",o)}),t=null)};t.forEach(u=>u.addEventListener("abort",o));const{signal:l}=s;return l.unsubscribe=()=>pe.asap(a),l}},eNe=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let s=0,r;for(;s<n;)r=s+e,yield t.slice(s,r),s=r},tNe=async function*(t,e){for await(const n of nNe(t))yield*eNe(n,e)},nNe=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:s}=await e.read();if(n)break;yield s}}finally{await e.cancel()}},dR=(t,e,n,s)=>{const r=tNe(t,e);let o=0,i,a=l=>{i||(i=!0,s&&s(l))};return new ReadableStream({async pull(l){try{const{done:u,value:c}=await r.next();if(u){a(),l.close();return}let d=c.byteLength;if(n){let h=o+=d;n(h)}l.enqueue(new Uint8Array(c))}catch(u){throw a(u),u}},cancel(l){return a(l),r.return()}},{highWaterMark:2})},R1=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",mB=R1&&typeof ReadableStream=="function",sNe=R1&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),gB=(t,...e)=>{try{return!!t(...e)}catch{return!1}},rNe=mB&&gB(()=>{let t=!1;const e=new Request(ur.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),hR=64*1024,JS=mB&&gB(()=>pe.isReadableStream(new Response("").body)),Wx={stream:JS&&(t=>t.body)};R1&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Wx[e]&&(Wx[e]=pe.isFunction(t[e])?n=>n[e]():(n,s)=>{throw new It(`Response type '${e}' is not supported`,It.ERR_NOT_SUPPORT,s)})})})(new Response);const oNe=async t=>{if(t==null)return 0;if(pe.isBlob(t))return t.size;if(pe.isSpecCompliantForm(t))return(await new Request(ur.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(pe.isArrayBufferView(t)||pe.isArrayBuffer(t))return t.byteLength;if(pe.isURLSearchParams(t)&&(t=t+""),pe.isString(t))return(await sNe(t)).byteLength},iNe=async(t,e)=>{const n=pe.toFiniteNumber(t.getContentLength());return n??oNe(e)},aNe=R1&&(async t=>{let{url:e,method:n,data:s,signal:r,cancelToken:o,timeout:i,onDownloadProgress:a,onUploadProgress:l,responseType:u,headers:c,withCredentials:d="same-origin",fetchOptions:h}=fB(t);u=u?(u+"").toLowerCase():"text";let p=Z$e([r,o&&o.toAbortSignal()],i),f;const m=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let g;try{if(l&&rNe&&n!=="get"&&n!=="head"&&(g=await iNe(c,s))!==0){let S=new Request(e,{method:"POST",body:s,duplex:"half"}),C;if(pe.isFormData(s)&&(C=S.headers.get("content-type"))&&c.setContentType(C),S.body){const[I,T]=lR(g,Ux(uR(l)));s=dR(S.body,hR,I,T)}}pe.isString(d)||(d=d?"include":"omit");const y="credentials"in Request.prototype;f=new Request(e,{...h,signal:p,method:n.toUpperCase(),headers:c.normalize().toJSON(),body:s,duplex:"half",credentials:y?d:void 0});let x=await fetch(f);const v=JS&&(u==="stream"||u==="response");if(JS&&(a||v&&m)){const S={};["status","statusText","headers"].forEach(R=>{S[R]=x[R]});const C=pe.toFiniteNumber(x.headers.get("content-length")),[I,T]=a&&lR(C,Ux(uR(a),!0))||[];x=new Response(dR(x.body,hR,I,()=>{T&&T(),m&&m()}),S)}u=u||"text";let b=await Wx[pe.findKey(Wx,u)||"text"](x,t);return!v&&m&&m(),await new Promise((S,C)=>{hB(S,C,{data:b,headers:Kr.from(x.headers),status:x.status,statusText:x.statusText,config:t,request:f})})}catch(y){throw m&&m(),y&&y.name==="TypeError"&&/fetch/i.test(y.message)?Object.assign(new It("Network Error",It.ERR_NETWORK,t,f),{cause:y.cause||y}):It.from(y,y&&y.code,t,f)}}),ZS={http:S$e,xhr:J$e,fetch:aNe};pe.forEach(ZS,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const pR=t=>`- ${t}`,lNe=t=>pe.isFunction(t)||t===null||t===!1,yB={getAdapter:t=>{t=pe.isArray(t)?t:[t];const{length:e}=t;let n,s;const r={};for(let o=0;o<e;o++){n=t[o];let i;if(s=n,!lNe(n)&&(s=ZS[(i=String(n)).toLowerCase()],s===void 0))throw new It(`Unknown adapter '${i}'`);if(s)break;r[i||"#"+o]=s}if(!s){const o=Object.entries(r).map(([a,l])=>`adapter ${a} `+(l===!1?"is not supported by the environment":"is not available in the build"));let i=e?o.length>1?`since :
`+o.map(pR).join(`
`):" "+pR(o[0]):"as no adapter specified";throw new It("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return s},adapters:ZS};function Yv(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new ep(null,t)}function fR(t){return Yv(t),t.headers=Kr.from(t.headers),t.data=Xv.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),yB.getAdapter(t.adapter||gg.adapter)(t).then(function(s){return Yv(t),s.data=Xv.call(t,t.transformResponse,s),s.headers=Kr.from(s.headers),s},function(s){return dB(s)||(Yv(t),s&&s.response&&(s.response.data=Xv.call(t,t.transformResponse,s.response),s.response.headers=Kr.from(s.response.headers))),Promise.reject(s)})}const xB="1.7.9",D1={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{D1[t]=function(s){return typeof s===t||"a"+(e<1?"n ":" ")+t}});const mR={};D1.transitional=function(e,n,s){function r(o,i){return"[Axios v"+xB+"] Transitional option '"+o+"'"+i+(s?". "+s:"")}return(o,i,a)=>{if(e===!1)throw new It(r(i," has been removed"+(n?" in "+n:"")),It.ERR_DEPRECATED);return n&&!mR[i]&&(mR[i]=!0,console.warn(r(i," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(o,i,a):!0}};D1.spelling=function(e){return(n,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function uNe(t,e,n){if(typeof t!="object")throw new It("options must be an object",It.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let r=s.length;for(;r-- >0;){const o=s[r],i=e[o];if(i){const a=t[o],l=a===void 0||i(a,o,t);if(l!==!0)throw new It("option "+o+" must be "+l,It.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new It("Unknown option "+o,It.ERR_BAD_OPTION)}}const Ey={assertOptions:uNe,validators:D1},ji=Ey.validators;class Fu{constructor(e){this.defaults=e,this.interceptors={request:new iR,response:new iR}}async request(e,n){try{return await this._request(e,n)}catch(s){if(s instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const o=r.stack?r.stack.replace(/^.+\n/,""):"";try{s.stack?o&&!String(s.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+o):s.stack=o}catch{}}throw s}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=nc(this.defaults,n);const{transitional:s,paramsSerializer:r,headers:o}=n;s!==void 0&&Ey.assertOptions(s,{silentJSONParsing:ji.transitional(ji.boolean),forcedJSONParsing:ji.transitional(ji.boolean),clarifyTimeoutError:ji.transitional(ji.boolean)},!1),r!=null&&(pe.isFunction(r)?n.paramsSerializer={serialize:r}:Ey.assertOptions(r,{encode:ji.function,serialize:ji.function},!0)),Ey.assertOptions(n,{baseUrl:ji.spelling("baseURL"),withXsrfToken:ji.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let i=o&&pe.merge(o.common,o[n.method]);o&&pe.forEach(["delete","get","head","post","put","patch","common"],f=>{delete o[f]}),n.headers=Kr.concat(i,o);const a=[];let l=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(n)===!1||(l=l&&m.synchronous,a.unshift(m.fulfilled,m.rejected))});const u=[];this.interceptors.response.forEach(function(m){u.push(m.fulfilled,m.rejected)});let c,d=0,h;if(!l){const f=[fR.bind(this),void 0];for(f.unshift.apply(f,a),f.push.apply(f,u),h=f.length,c=Promise.resolve(n);d<h;)c=c.then(f[d++],f[d++]);return c}h=a.length;let p=n;for(d=0;d<h;){const f=a[d++],m=a[d++];try{p=f(p)}catch(g){m.call(this,g);break}}try{c=fR.call(this,p)}catch(f){return Promise.reject(f)}for(d=0,h=u.length;d<h;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=nc(this.defaults,e);const n=pB(e.baseURL,e.url);return lB(n,e.params,e.paramsSerializer)}}pe.forEach(["delete","get","head","options"],function(e){Fu.prototype[e]=function(n,s){return this.request(nc(s||{},{method:e,url:n,data:(s||{}).data}))}});pe.forEach(["post","put","patch"],function(e){function n(s){return function(o,i,a){return this.request(nc(a||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:i}))}}Fu.prototype[e]=n(),Fu.prototype[e+"Form"]=n(!0)});class vI{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(o){n=o});const s=this;this.promise.then(r=>{if(!s._listeners)return;let o=s._listeners.length;for(;o-- >0;)s._listeners[o](r);s._listeners=null}),this.promise.then=r=>{let o;const i=new Promise(a=>{s.subscribe(a),o=a}).then(r);return i.cancel=function(){s.unsubscribe(o)},i},e(function(o,i,a){s.reason||(s.reason=new ep(o,i,a),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=s=>{e.abort(s)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new vI(function(r){e=r}),cancel:e}}}function cNe(t){return function(n){return t.apply(null,n)}}function dNe(t){return pe.isObject(t)&&t.isAxiosError===!0}const eC={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(eC).forEach(([t,e])=>{eC[e]=t});function wB(t){const e=new Fu(t),n=YM(Fu.prototype.request,e);return pe.extend(n,Fu.prototype,e,{allOwnKeys:!0}),pe.extend(n,e,null,{allOwnKeys:!0}),n.create=function(r){return wB(nc(t,r))},n}const Kn=wB(gg);Kn.Axios=Fu;Kn.CanceledError=ep;Kn.CancelToken=vI;Kn.isCancel=dB;Kn.VERSION=xB;Kn.toFormData=E1;Kn.AxiosError=It;Kn.Cancel=Kn.CanceledError;Kn.all=function(e){return Promise.all(e)};Kn.spread=cNe;Kn.isAxiosError=dNe;Kn.mergeConfig=nc;Kn.AxiosHeaders=Kr;Kn.formToJSON=t=>cB(pe.isHTMLForm(t)?new FormData(t):t);Kn.getAdapter=yB.getAdapter;Kn.HttpStatusCode=eC;Kn.default=Kn;const hNe=()=>{const t=ns(),{exercise:e}=CW(),n=X.useRef(null),[s,r]=X.useState(0),[o,i]=X.useState("Get into position to start");let a=0;const l={"Push-up":"/assets/push-up.mp4",Squat:"/assets/squat-animation.mp4","Jumping-Jack":"/assets/jumping-jack.mp4",Crunch:"/assets/crunch.mp4",Lunge:"/assets/lunge.mp4"};X.useEffect(()=>{(async()=>{await kG();const x=await _Ie(ia.MoveNet,{modelType:FIe.modelType.SINGLEPOSE_THUNDER}),v=async()=>{if(n.current&&n.current.video.readyState===4){const b=n.current.video,S=await x.estimatePoses(b);if(S.length>0){const C=S[0].keypoints;u(C)}}requestAnimationFrame(v)};v()})()},[]);const u=y=>{switch(e){case"Squat":c(y);break;case"Push-up":d(y);break;case"Jumping-Jack":h(y);break;case"Crunch":p(y);break;case"Lunge":f(y);break;default:console.log("Unknown exercise")}},c=y=>{const x=y.find(C=>C.name==="left_hip"),v=y.find(C=>C.name==="left_knee"),b=y.find(C=>C.name==="right_hip"),S=y.find(C=>C.name==="right_knee");if(x&&v&&b&&S){const C=m(x,v),I=m(b,S);C<100&&I<100?a===0&&(i("Squatting... Keep going!"),a=1):C>150&&I>150&&a===1&&(r(T=>T+1),i("Great squat! Stand tall."),a=0)}},d=y=>{const x=y.find(b=>b.name==="left_elbow"),v=y.find(b=>b.name==="right_elbow");if(x&&v){const b=(x.y+v.y)/2;b>300&&a===0?(i("Lowering... Keep going!"),a=1):b<200&&a===1&&(r(S=>S+1),i("Great push-up!"),a=0)}},h=y=>{const x=y.find(b=>b.name==="left_wrist"),v=y.find(b=>b.name==="right_wrist");x&&v&&(x.y<100&&v.y<100&&a===0?(i("Jumping up!"),a=1):x.y>200&&v.y>200&&a===1&&(r(b=>b+1),i("Good Jumping Jack!"),a=0))},p=y=>{const x=y.find(b=>b.name==="nose"),v=y.find(b=>b.name==="left_knee");x&&v&&(x.y>v.y-30&&a===0?(i("Crunching..."),a=1):x.y<v.y-100&&a===1&&(r(b=>b+1),i("Great crunch!"),a=0))},f=y=>{const x=y.find(b=>b.name==="left_knee"),v=y.find(b=>b.name==="right_knee");x&&v&&(x.y<v.y&&a===0?(i("Lunging..."),a=1):x.y>v.y&&a===1&&(r(b=>b+1),i("Good Lunge!"),a=0))},m=(y,x)=>{const v=x.x-y.x,b=x.y-y.y,S=Math.atan2(b,v)*(180/Math.PI);return Math.abs(S)},g=async()=>{try{const y=localStorage.getItem("token");if(!y){alert("User not logged in.");return}const v={Squat:"squats","Push-up":"pushups","Jumping-Jack":"jumpingJacks",Crunch:"crunches",Lunge:"lunges"}[e];if(!v){alert("Invalid exercise type.");return}const b={exercise:v,reps:s,challengeCompleted:!0};await Kn.post("http://localhost:3000/api/exercises",b,{headers:{Authorization:`Bearer ${y}`}}),alert("Exercise data saved!"),t("/leaderboard")}catch(y){console.error("Error saving data:",y)}};return E.jsxs("div",{className:"w-screen h-screen flex flex-col bg-[#30093f] text-white font-dm-sans",children:[E.jsx(Ai,{}),E.jsxs("div",{className:"flex flex-1 w-full",children:[E.jsx(_i,{}),E.jsxs("div",{className:"flex-1 flex flex-col md:flex-row justify-center items-center gap-6 p-4",children:[E.jsx("div",{className:"w-full md:w-1/2 flex justify-center items-center",children:E.jsxs("video",{className:"w-full max-w-[90%] md:max-w-[80%] h-auto rounded-lg shadow-lg",autoPlay:!0,loop:!0,muted:!0,children:[E.jsx("source",{src:l[e]||"/assets/default.mp4",type:"video/mp4"}),"Your browser does not support the video tag."]})}),E.jsxs("div",{className:"w-full md:w-1/2 flex flex-col justify-center items-center text-center",children:[E.jsxs("h5",{className:"text-3xl md:text-4xl font-bold mb-4",children:[e," Tracker"]}),E.jsxs("div",{className:"bg-[#4f1d5f] shadow-lg rounded-lg p-2 w-full max-w-[90%] md:max-w-[80%] text-center flex flex-col",children:[E.jsx(OIe,{ref:n,className:"w-full h-full object-cover"}),E.jsx("h6",{className:"mt-4 text-2xl",children:o}),E.jsxs("p",{className:"text-xl mt-2",children:["Reps Completed: ",s]})]}),E.jsx("button",{onClick:g,className:"mt-6 px-8 py-3 text-xl bg-[#9c1b3f] text-white font-semibold rounded-lg",children:"Save Data"})]})]})]})]})},pNe=()=>{const[t,e]=X.useState([]),[n,s]=X.useState([]),[r,o]=X.useState("Select Food"),[i,a]=X.useState(""),[l,u]=X.useState([]),[c,d]=X.useState(!0),[h,p]=X.useState(0),[f,m]=X.useState(0),[g,y]=X.useState(""),[x,v]=X.useState(0),[b,S]=X.useState(""),[C,I]=X.useState(0),[T,R]=X.useState(0),[_,P]=X.useState(0),[z,O]=X.useState(0),[V,H]=X.useState(0),[Q,oe]=X.useState(0),[j,ee]=X.useState(0),[ie,le]=X.useState(0),[fe,ge]=X.useState(0),[xe,we]=X.useState(0),[Ie,_e]=X.useState(0),[qe,Ze]=X.useState(0),[dt,Ge]=X.useState(!1),[bt,ut]=X.useState([]),[wt,Nt]=X.useState(!0),[Lt,qt]=X.useState([]),[W,ae]=X.useState(""),ue=async()=>{try{const Ne=localStorage.getItem("refreshtoken");let zt=await fetch("http://localhost:3000/refresh-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshtoken:Ne})});if(zt.ok){const pn=await zt.json();localStorage.setItem("token",pn.token),console.log(localStorage.getItem("token")),console.log("Token Refreshed")}else localStorage.removeItem("token"),console.log("Login failed"),alert("Session Expired"),Tt("/signin")}catch(Ne){console.log("Error occured : ",Ne)}};X.useEffect(()=>{const Ne=async()=>{try{const Cn=localStorage.getItem("token"),Ds=await fetch("http://localhost:3000/get-data ",{headers:{Authorization:`Bearer ${Cn}`}}),ws=await Ds.json();Ds.ok?(s($o=>({...$o,...ws})),S(ws.mode),console.log("User data:",ws),ae(ws.name)):(alert("Token expired"),Tt("/signin"))}catch(Cn){console.log(`Error in fetchData: ${Cn}`)}},zt=async()=>{try{const Cn=localStorage.getItem("token"),Ds=await fetch("http://localhost:3000/getfood ",{headers:{Authorization:`Bearer ${Cn}`}}),ws=await Ds.json();Ds.ok?(e(ws),qt($o=>[...$o,...ws]),u(ws)):console.log("Problem while fetching food data")}catch(Cn){console.log(`Error in fetchFood: ${Cn}`)}};(async()=>{await Ne(),await zt(),Nt(!1)})()},[]),X.useEffect(()=>{const Ne=setInterval(()=>{(async()=>{try{const pn=localStorage.getItem("token"),Cn=await fetch("https://mern-fitness-app-production-e9fe.up.railway.app/getdata",{headers:{Authorization:`Bearer ${pn}`}});Cn.ok?console.log("Token is Valid"):Cn.status===403?ue():(alert("Token expired"),Tt("/signin"))}catch(pn){console.log(`Error in fetchData: ${pn}`)}})()},6e4);return()=>clearInterval(Ne)},[]),X.useEffect(()=>{if(console.log(b),b==="Moderate Musclegain"){const Ne=qe+400;I(Ne)}if(b==="Fast Musclegain"){const Ne=qe+750;I(Ne)}if(b==="Moderate fatloss"){const Ne=qe-500;I(Ne)}if(b==="Fast fatloss"){const Ne=qe-800;I(Math.round(Ne))}},[b,qe]),X.useEffect(()=>{const Ne=C*.3/9;P(Ne)},[C]),X.useEffect(()=>{const Ne=T*4,zt=_*9,pn=C-(zt+Ne);O(pn/4)},[T,_,C]),X.useEffect(()=>{console.log(Math.round(C)),console.log(qe)},[C]),X.useEffect(()=>{ae(n.name)},[n]),X.useEffect(()=>{g==="male"&&H(900*3.33),g==="female"&&H(700*3.33)},[g]),X.useEffect(()=>{g==="male"&&oe(1.2),g==="female"&&oe(1.1)},[g]),X.useEffect(()=>{g==="male"&&ee(90),g==="female"&&ee(75)},[g]),X.useEffect(()=>{v(n==null?void 0:n.date),(n==null?void 0:n.weightScale)==="Kgs"?p((n==null?void 0:n.weight)*2.20462):p(n==null?void 0:n.weight),(n==null?void 0:n.lengthScale)==="ft"?m((n==null?void 0:n.height)*30.48):m(n==null?void 0:n.height),y(n==null?void 0:n.gender)},[n]),X.useEffect(()=>{const Ne=h*.73;R(Ne),console.log(T)},[h]);const ve=()=>{const Ne=new Date(x);return new Date().getFullYear()-Ne.getFullYear()};ve(),X.useEffect(()=>{ve()<19&&le(75),ve()>18&&(g==="male"&&le(120),g==="female"&&le(90))},[ve()]),X.useEffect(()=>{ve()<19&&(g==="male"&&ge(11),g==="female"&&ge(15)),ve()>18&&ve()<51&&(g==="male"&&ge(8),g==="female"&&ge(18)),ve()>50&&ge(8)},[ve(),g]),X.useEffect(()=>{ve()<19&&(g==="male"&&_e(410),g==="female"&&_e(360)),ve()>18&&ve()<31&&(g==="male"&&_e(400),g==="female"&&_e(310)),ve()>=31&&(g==="male"&&_e(420),g==="female"&&_e(320))},[ve(),g]),X.useEffect(()=>{ve()<19&&we(1300),ve()>18&&ve()<51&&we(1e3),ve()>50&&(g==="male"&&we(1e3),g==="female"&&we(1200))},[ve(),g]),X.useEffect(()=>{if(console.log(g),g==="male"){const Ne=88.362+6.24*h+12.7*f-5.677*ve();Ze(Ne),console.log(Ne)}else{const Ne=447.593+4.35*h+4.7*f-4.33*ve();Ze(Ne)}},[g,h,f,x]);const Ce=()=>{d(!c),console.log(c),a(""),e(l)},be=Ne=>{if(a(Ne),Ne!==""){const zt=t.filter(pn=>Object.values(pn).join("").toLowerCase().includes(Ne.toLowerCase()));e(zt)}else e(l)},Oe=()=>{Ge(!0)},at=()=>{Ge(!1)},Tt=ns();X.useEffect(()=>{console.log("Updated selectfoodArray:",bt)},[bt]);const[vt,Jt]=X.useState(!1),Qs=()=>{Jt(!vt)};X.useEffect(()=>{if(vt){const Ne=document.getElementById("big-box");Ne.scrollTop=0}},[vt]);const[Ts,Js]=X.useState(""),[Zs,Es]=X.useState([]),[to,bo]=X.useState(0),[Rr,ga]=X.useState([]),Mi=Ne=>{console.log(`Index = ${Ne}`),console.log(Lt);const zt=t[Ne];if(zt){const pn={...zt,quantity:Ts};ga(Cn=>[...Cn,pn]),Es(Cn=>{const Ds=[...Cn,pn];return console.log("Updated foodArray: ",Ds),Ds}),Js(""),console.log("New Food Added: ",pn)}};X.useEffect(()=>{console.log("newfood state: ",Rr)},[Rr]);const[So,ei]=X.useState(!0);X.useEffect(()=>{(async()=>{let zt=await fetch("https://mern-fitness-app-production-e9fe.up.railway.app/store",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(zt.ok){const pn=await zt.json();ga(pn),ei(!1),console.log(pn)}})()},[]),X.useEffect(()=>{if(So)return;(async()=>{await fetch("https://mern-fitness-app-production-e9fe.up.railway.app/store",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({array:Rr})})})()},[Rr]),X.useEffect(()=>{console.log(Rr);let Ne=0,zt=0,pn=0,Cn=0,Ds=0,ws=0,$o=0,Xa=0,ii=0,eu=0,tu=0,nu=0;Rr.forEach(As=>{const Zt=As.quantity;Ne+=Math.round((As.calories||0)*Zt),zt+=Math.round((As.proteins||0)*Zt),pn+=Math.round((As.fats||0)*Zt),Cn+=Math.round((As.carbohydrates||0)*Zt),Ds+=Math.round((As.vA||0)*Zt),ws+=(As.vB||0)*Zt;const rs=ws.toFixed(1);$o+=Math.round((As.vC||0)*Zt),Xa+=Math.round((As.vE||0)*Zt),ii+=Math.round((As.vK||0)*Zt),eu+=Math.round((As.iron||0)*Zt),tu+=Math.round((As.calcium||0)*Zt),nu+=Math.round((As.magnesium||0)*Zt),console.log(Ne),Jl(Ne),Zl(zt),ni(pn),ya(Cn),Y(Ds),de(rs),ze($o),He(Xa),Ke(ii),nt(eu),Et(tu),Xt(nu)})},[Rr]);const[ti,Jl]=X.useState(0),[Bi,Zl]=X.useState(0),[Dr,ni]=X.useState(0),[si,ya]=X.useState(0),[Vi,Y]=X.useState(0),[se,de]=X.useState(0),[ye,ze]=X.useState(0),[rt,He]=X.useState(0),[Le,Ke]=X.useState(0),[je,nt]=X.useState(0),[St,Et]=X.useState(0),[hn,Xt]=X.useState(0),_t=Ne=>{console.log(Rr);let zt=0,pn=0,Cn=0,Ds=0,ws=0,$o=0,Xa=0,ii=0,eu=0,tu=0,nu=0,As=0;Ne.forEach(Zt=>{const rs=Zt.quantity;zt+=Math.round((Zt.calories||0)*rs),pn+=Math.round((Zt.proteins||0)*rs),Cn+=Math.round((Zt.fats||0)*rs),Ds+=Math.round((Zt.carbohydrates||0)*rs),ws+=Math.round((Zt.vA||0)*rs),$o+=Math.round((Zt.vB||0)*rs),Xa+=Math.round((Zt.vC||0)*rs),ii+=Math.round((Zt.vE||0)*rs),eu+=Math.round((Zt.vK||0)*rs),tu+=Math.round((Zt.iron||0)*rs),nu+=Math.round((Zt.calcium||0)*rs),As+=Math.round((Zt.magnesium||0)*rs),console.log(zt)}),Jl(zt),Zl(pn),ni(Cn),ya(Ds),Y(ws),de($o),ze(Xa),He(ii),Ke(eu),nt(tu),Et(nu),Xt(As)},ln=Ne=>{const zt=Rr.filter((pn,Cn)=>Cn!==Ne);ga(zt),_t(zt)},[Co,ys]=X.useState(!1),On=()=>{ys(!Co)},[Rs,xa]=X.useState(0);X.useEffect(()=>{console.log(ti);const Ne=ti/C*100;console.log(Ne),xa(Ne)},[C,ti]);const[ri,ko]=X.useState(0);X.useEffect(()=>{const Ne=Bi/T*100;ko(Ne)},[Bi,T]);const[Ui,Vs]=X.useState(0);X.useEffect(()=>{const Ne=Dr/_*100;Vs(Ne),console.log(Ne)},[Dr,_]);const[Ft,nn]=X.useState(0);X.useEffect(()=>{const Ne=si/z*100;nn(Ne)},[si,z]);const[xs,Io]=X.useState(0);X.useEffect(()=>{const Ne=Vi/V*100;Io(Ne)},[Vi,V]);const[Rn,oi]=X.useState(0);X.useEffect(()=>{const Ne=se/Q*100;oi(Ne)},[se,Q]);const[qa,tp]=X.useState(0);X.useEffect(()=>{const Ne=ye/j*100;tp(Ne)},[ye,j]);const[A1,yg]=X.useState(0);X.useEffect(()=>{const Ne=rt/15*100;yg(Ne)},[rt]);const[xg,wg]=X.useState(0);X.useEffect(()=>{const Ne=Le/ie*100;wg(Ne)},[Le,ie]);const[vg,er]=X.useState(0);X.useEffect(()=>{const Ne=je/fe*100;er(Ne)},[je,fe]);const[bg,Sg]=X.useState(0);X.useEffect(()=>{const Ne=St/xe*100;Sg(Ne)},[St,xe]);const[kc,Cg]=X.useState(0);return X.useEffect(()=>{const Ne=hn/Ie*100;Cg(Ne)},[hn,Ie]),E.jsx(E.Fragment,{children:wt?E.jsx("div",{className:"flex items-center justify-center min-h-screen",children:E.jsx("div",{className:"loader bg-[#30093f] w-[100vw] h-[100vh] text-lg text-white font-bold flex justify-center items-center",children:"Loading..."})}):E.jsxs("div",{className:"h-full bg-[#30093f] p-0 m-0 font-dm-sans text-white",children:[E.jsx(Ai,{}),E.jsxs("div",{className:"flex",children:[E.jsx(_i,{}),E.jsx("div",{className:"flex justify-center w-full h-full",children:E.jsxs("div",{className:"w-full max-w-screen h-full overflow-hidden",children:[E.jsx("div",{className:" flex justify-center text-center bg-purple-700",children:E.jsxs("div",{className:" font-semibold text-base",children:[E.jsx("p",{className:"text-[18px]",children:"Welcome "}),E.jsx("span",{className:"text-yellow-400",children:W}),E.jsx("p",{className:"cursor-pointer font-light text-md hover:text-yellow-400",onClick:()=>{Tt("/signup/userdata")},children:"Click here to edit your info"})]})}),E.jsx("div",{className:`h-96 w-96 absolute  bg-[#1f0729] z-20 rounded-lg left-[50%] top-[50%] -translate-x-1/2  -translate-y-1/2 custom-scrollbar overflow-y-scroll  ${dt?"block":"hidden"}`,children:E.jsxs("div",{className:"relativ rounded shadow-md p-4",children:[E.jsx("span",{className:"block text-center font-semibold text-xl",children:"Eat List"}),E.jsx("i",{className:"fa-solid fa-circle-xmark absolute top-2 right-2 text-2xl text-gray-500 cursor-pointer hover:text-red-600",onClick:at}),E.jsx("ul",{className:"mt-4 space-y-2",children:Rr.map((Ne,zt)=>E.jsxs("li",{className:"flex justify-between items-center bg-purple-600 text-white rounded p-3",children:[E.jsx("p",{className:"flex-1 truncate pl-3",children:Ne.name}),E.jsx("span",{className:"ml-4",children:Ne.quantity}),E.jsx("button",{className:"ml-4 bg-red-600 hover:bg-red-800 text-xs text-white px-2 py-1 rounded-full",onClick:()=>ln(zt),children:"Remove"})]},zt))})]})}),E.jsxs("div",{className:"flex flex-col items-center mb-10",children:[E.jsx("div",{className:" h-10 text-md bg-purple-950 p-4 mt-6 rounded-full flex justify-center items-center cursor-pointer hover:bg-purple-900",onClick:Oe,children:"EDIT YOUR EAT LIST"}),E.jsxs("p",{className:"mt-5 font-semibold text-2xl",children:["Your ",E.jsx("span",{className:"text-yellow-400",children:"Nutrition"})," ","Tracker"]}),E.jsx("div",{className:"flex mt-5 w-full justify-center",children:E.jsxs("div",{className:"flex w-full justify-center",children:[E.jsxs("div",{className:"flex relative",children:[E.jsxs("div",{className:"w-56 h-8 max-md:w-32 max-md:text-[9px] mx-1 rounded-full bg-white cursor-pointer text-black text-xs font-semibold flex items-center justify-between p-3",onClick:()=>{Qs(),Ce(),On()},children:[E.jsx("p",{className:"opacity-50",children:r}),E.jsx("i",{className:`fa-solid fa-caret-down ${Co?"-rotate-180":"-rotate-0"}`})]}),E.jsxs("div",{className:`option absolute w-56 max-h-60 bg-[#61177e] z-10 rounded-lg top-8 p-5 overflow-y-scroll block  ${vt?"block":"hidden"}`,id:"big-box",children:[E.jsx("input",{type:"text",placeholder:"Search Food",className:"outline-none border-[2px] rounded-md text-black p-1 text-sm border-transparent hover:border-yellow-400",value:i,onChange:Ne=>{const zt=Ne.target.value;be(zt)}}),E.jsx("ul",{className:"text-sm mt-2",children:t.map((Ne,zt)=>E.jsx("li",{className:"p-2 cursor-pointer hover:bg-[#1f0729] rounded text-xs",onClick:()=>{Qs(),bo(zt),o(Ne.name),On()},children:Ne.name},zt))})]})]}),E.jsx("input",{type:"number",min:"0",placeholder:"Enter Quantity",className:"w-36 max-md:w-24 max-md:text-[9px] p-2  text-center mx-1 h-8 rounded-full bg-white cursor-pointer text-black text-xs font-semibold outline-none",value:Ts,onInput:Ne=>{Js(Ne.target.value),console.log(Ne.target.value)}}),E.jsx("button",{className:"w-36 max-md:w-16 h-8 p-3 mx-1 bg-[#1f0729] rounded-full text-center flex items-center justify-center max-md:w-[50%]tify-center hover:bg-[#6a1888]",onClick:Ne=>{if(Ts===""){Ne.preventDefault();return}Js(""),console.log(to),Mi(to)},children:"Add"})]})}),E.jsx("div",{className:"flex justify-center w-full ",children:E.jsxs("div",{children:[E.jsxs("div",{className:"flex justify-start text-sm mt-5 w-[70vw]",children:[E.jsx("p",{className:"w-[25%] max-md:w-[30%] max-md:text-[11px]",children:"Calories"}),E.jsx("div",{className:"w-[70%] max-md:w-[50%] h-6 rounded-full bg-[#4c1361d0] overflow-hidden",children:E.jsx("div",{className:"h-6 bg-[#8c5792] rounded-full transition-all duration-500 ease-in-out",style:{width:`${Rs}%`}})}),E.jsxs("p",{className:"w-[10%] ml-3 max-md:text-[11px]",children:[ti,"/",Math.round(C)]})]}),E.jsxs("div",{className:"flex justify-start text-sm mt-5 w-[70vw] ",children:[E.jsx("p",{className:"w-[25%] max-md:w-[30%] max-md:text-[11px]",children:"Proteins"}),E.jsx("div",{className:"w-[70%] max-md:w-[50%] h-6 rounded-full bg-[#4c1361d0] overflow-hidden",children:E.jsx("div",{className:"h-6 bg-[#8c5792] rounded-full transition-all duration-500 ease-in-out",style:{width:`${ri}%`}})}),E.jsxs("p",{className:"w-[10%] ml-3 max-md:text-[11px]",children:[Bi,"/",Math.round(T)]})]}),E.jsxs("div",{className:"flex justify-start text-sm mt-5 w-[70vw] ",children:[E.jsx("p",{className:"w-[25%] max-md:w-[30%] max-md:text-[11px]",children:"Fats"}),E.jsx("div",{className:"w-[70%] max-md:w-[50%] h-6 rounded-full bg-[#4c1361d0] overflow-hidden",children:E.jsx("div",{className:"h-6 bg-[#8c5792] rounded-full transition-all duration-500 ease-in-out",style:{width:`${Ui}%`}})}),E.jsxs("p",{className:"w-[10%] ml-3 max-md:text-[11px]",children:[Dr,"/",Math.round(_)]})]}),E.jsxs("div",{className:"flex justify-start text-sm mt-5 w-[70vw] ",children:[E.jsx("p",{className:"w-[25%] max-md:w-[30%] max-md:text-[11px]",children:"Carbohydrates"}),E.jsx("div",{className:"w-[70%] max-md:w-[50%] h-6 rounded-full bg-[#4c1361d0] overflow-hidden",children:E.jsx("div",{className:"h-6 bg-[#8c5792] rounded-full  transition-all duration-500 ease-in-out",style:{width:`${Ft}%`}})}),E.jsxs("p",{className:"w-[10%] ml-3 max-md:text-[11px]",children:[si,"/",Math.round(z)]})]}),E.jsxs("div",{className:"flex justify-start text-sm mt-5 w-[70vw] ",children:[E.jsx("p",{className:"w-[25%] max-md:w-[30%] max-md:text-[11px]",children:"Vitamin A"}),E.jsx("div",{className:"w-[70%] max-md:w-[50%] h-6 rounded-full bg-[#4c1361d0] overflow-hidden",children:E.jsx("div",{className:"h-6 bg-[#8c5792] rounded-full transition-all duration-500 ease-in-out",style:{width:`${xs}%`}})}),E.jsxs("p",{className:"w-[10%] ml-3 max-md:text-[11px]",children:[Vi,"/",V]})]}),E.jsxs("div",{className:"flex justify-start text-sm mt-5 w-[70vw] ",children:[E.jsx("p",{className:"w-[25%] max-md:w-[30%] max-md:text-[11px]",children:"Vitamin B"}),E.jsx("div",{className:"w-[70%] max-md:w-[50%] h-6 rounded-full bg-[#4c1361d0] overflow-hidden",children:E.jsx("div",{className:"h-6 bg-[#8c5792] rounded-full transition-all duration-500 ease-in-out",style:{width:`${Rn}%`}})}),E.jsxs("p",{className:"w-[10%] ml-3 max-md:text-[11px]",children:[se,"/",Q]})]}),E.jsxs("div",{className:"flex justify-start text-sm mt-5 w-[70vw] ",children:[E.jsx("p",{className:"w-[25%] max-md:w-[30%] max-md:text-[11px]",children:"Vitamin C"}),E.jsx("div",{className:"w-[70%] max-md:w-[50%] h-6 rounded-full bg-[#4c1361d0] overflow-hidden",children:E.jsx("div",{className:"h-6 bg-[#8c5792] rounded-full transition-all duration-500 ease-in-out",style:{width:`${qa}%`}})}),E.jsxs("p",{className:"w-[10%] ml-3 max-md:text-[11px]",children:[ye,"/",j]})]}),E.jsxs("div",{className:"flex justify-start text-sm mt-5 w-[70vw] ",children:[E.jsx("p",{className:"w-[25%] max-md:w-[30%] max-md:text-[11px]",children:"Vitamin E"}),E.jsx("div",{className:"w-[70%] max-md:w-[50%] h-6 rounded-full bg-[#4c1361d0] overflow-hidden",children:E.jsx("div",{className:"h-6 bg-[#8c5792] rounded-full transition-all duration-500 ease-in-out",style:{width:`${A1}%`}})}),E.jsxs("p",{className:"w-[10%] ml-3 max-md:text-[11px]",children:[rt,"/15"]})]}),E.jsxs("div",{className:"flex justify-start text-sm mt-5 w-[70vw] ",children:[E.jsx("p",{className:"w-[25%] max-md:w-[30%] max-md:text-[11px]",children:"Vitamin K"}),E.jsx("div",{className:"w-[70%] max-md:w-[50%] h-6 rounded-full bg-[#4c1361d0] overflow-hidden",children:E.jsx("div",{className:"h-6 bg-[#8c5792] rounded-full transition-all duration-500 ease-in-out",style:{width:`${xg}%`}})}),E.jsxs("p",{className:"w-[10%] ml-3 max-md:text-[11px]",children:[Le,"/",ie]})]}),E.jsxs("div",{className:"flex justify-start text-sm mt-5 w-[70vw] ",children:[E.jsx("p",{className:"w-[25%] max-md:w-[30%] max-md:text-[11px]",children:"Iron"}),E.jsx("div",{className:"w-[70%] max-md:w-[50%] h-6 rounded-full bg-[#4c1361d0] overflow-hidden",children:E.jsx("div",{className:" h-6 bg-[#8c5792] rounded-full transition-all duration-500 ease-in-out",style:{width:`${vg}%`}})}),E.jsxs("p",{className:"w-[10%] ml-3 max-md:text-[11px]",children:[je,"/",fe]})]}),E.jsxs("div",{className:"flex justify-start text-sm mt-5 w-[70vw] ",children:[E.jsx("p",{className:"w-[25%] max-md:w-[30%] max-md:text-[11px]",children:"Calcium"}),E.jsx("div",{className:"w-[70%] max-md:w-[50%] h-6 rounded-full bg-[#4c1361d0] overflow-hidden",children:E.jsx("div",{className:"h-6 bg-[#8c5792] rounded-full transition-all duration-500 ease-in-out",style:{width:`${bg}%`}})}),E.jsxs("p",{className:"w-[10%] ml-3 max-md:text-[11px]",children:[St,"/",xe]})]}),E.jsxs("div",{className:"flex justify-start text-sm mt-5 w-[70vw] ",children:[E.jsx("p",{className:"w-[25%] max-md:w-[30%] max-md:text-[11px]",children:"Magnesium"}),E.jsx("div",{className:"w-[70%] max-md:w-[50%] h-6 rounded-full bg-[#4c1361d0] overflow-hidden",children:E.jsx("div",{className:"h-6 bg-[#8c5792] rounded-full transition-all duration-500 ease-in-out",style:{width:`${kc}%`}})}),E.jsxs("p",{className:"w-[10%] ml-3 max-md:text-[11px]",children:[hn,"/400"]})]})]})})]})]})})]})]})})};function va({children:t}){const e=ns(),n=localStorage.getItem("token");return X.useEffect(()=>{n||e("/signin")},[n,e]),t}const fNe=()=>{const t=ns(),[e,n]=X.useState("Squat"),s=()=>{t(`/activity/${e}`)};return E.jsxs("div",{className:"w-screen h-screen flex flex-col bg-[#30093f] text-white font-dm-sans",children:[E.jsx(Ai,{}),E.jsxs("div",{className:"flex flex-1 w-full",children:[E.jsx(_i,{}),E.jsxs("div",{className:"flex-1 flex flex-col justify-center items-center text-center",children:[E.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-6",children:"Choose an Exercise"}),E.jsx("div",{className:"flex flex-col items-center",children:["Squat","Push-up","Jumping-Jack","Crunch","Lunge"].map(r=>E.jsx("div",{className:`text-black w-60 h-12 md:w-72 md:h-12 lg:w-64 lg:h-12 rounded-full flex justify-center items-center 
                  text-lg md:text-xl font-bold cursor-pointer m-3 md:m-4
                  ${e===r?"bg-yellow-400 text-[#30093f]":"bg-white hover:bg-yellow-400 hover:text-[#30093f]"}`,onClick:()=>n(r),children:r},r))}),E.jsx("button",{className:`w-60 h-12 md:w-64 md:h-12 lg:w-56 lg:h-12 bg-blue-500 text-white text-[18px] rounded-full font-bold \r
              hover:bg-yellow-500 hover:text-[#30093f] cursor-pointer mt-6`,onClick:s,children:"Start"}),E.jsx("p",{className:"text-white text-[12px] md:text-[14px] pt-5 opacity-50 w-[60vw] max-md:text-[10px]",children:"Select an exercise and begin tracking your reps in real-time!"})]})]})]})},mNe=()=>{const[t,e]=X.useState([]),n=ns();return X.useEffect(()=>{(async()=>{try{const r=await Kn.get("http://localhost:3000/api/leaderboard");e(r.data)}catch(r){console.error("Error fetching leaderboard:",r)}})()},[]),E.jsxs("div",{className:"w-screen h-screen flex flex-col bg-[#30093f] text-white font-dm-sans",children:[E.jsx(Ai,{}),E.jsxs("div",{className:"flex flex-1 w-full",children:[E.jsx(_i,{}),E.jsxs("div",{className:"flex-1 flex flex-col items-center text-center px-4 sm:px-8 md:px-16",children:[E.jsx("h2",{className:"text-3xl sm:text-4xl font-bold mt-6 text-yellow-400",children:"🏆 Leaderboard"}),E.jsxs("div",{className:"w-full max-w-6xl bg-[#1f0729] rounded-lg p-5 mt-5 overflow-x-auto",children:[E.jsxs("table",{className:"w-full border-collapse hidden sm:table",children:[E.jsx("thead",{children:E.jsxs("tr",{className:"bg-yellow-400 text-[#30093f] font-bold text-lg",children:[E.jsx("th",{className:"border px-4 py-2",children:"Rank"}),E.jsx("th",{className:"border px-4 py-2",children:"User"}),E.jsx("th",{className:"border px-4 py-2",children:"Points"}),E.jsx("th",{className:"border px-4 py-2",children:"Squats"}),E.jsx("th",{className:"border px-4 py-2",children:"Push-ups"}),E.jsx("th",{className:"border px-4 py-2",children:"Jumping Jacks"}),E.jsx("th",{className:"border px-4 py-2",children:"Crunches"}),E.jsx("th",{className:"border px-4 py-2",children:"Lunges"})]})}),E.jsx("tbody",{children:t.length>0?t.map((s,r)=>E.jsxs("tr",{className:"text-center hover:bg-[#380b4f]",children:[E.jsx("td",{className:"border px-4 py-2 font-bold",children:r+1}),E.jsx("td",{className:"border px-4 py-2",children:s.email}),E.jsx("td",{className:"border px-4 py-2 font-bold text-yellow-400",children:s.points||0}),E.jsx("td",{className:"border px-4 py-2",children:s.exercises.squats}),E.jsx("td",{className:"border px-4 py-2",children:s.exercises.pushups}),E.jsx("td",{className:"border px-4 py-2",children:s.exercises.jumpingJacks}),E.jsx("td",{className:"border px-4 py-2",children:s.exercises.crunches}),E.jsx("td",{className:"border px-4 py-2",children:s.exercises.lunges})]},r)):E.jsx("tr",{children:E.jsx("td",{colSpan:"8",className:"text-center text-yellow-400 py-4",children:"No leaderboard data available."})})})]}),E.jsx("div",{className:"w-full grid grid-cols-1 sm:hidden gap-4",children:t.length>0?t.map((s,r)=>E.jsxs("div",{className:"flex flex-col items-center p-4 bg-[#380b4f] rounded-lg hover:bg-[#4a0b6f] transition-all",children:[E.jsx("div",{className:"font-bold text-yellow-400 text-xl",children:r+1}),E.jsx("div",{className:"text-lg",children:s.email}),E.jsx("div",{className:"font-bold text-yellow-400",children:s.points||0}),E.jsxs("div",{children:["Squats: ",s.exercises.squats]}),E.jsxs("div",{children:["Push-ups: ",s.exercises.pushups]}),E.jsxs("div",{children:["Jumping Jacks: ",s.exercises.jumpingJacks]}),E.jsxs("div",{children:["Crunches: ",s.exercises.crunches]}),E.jsxs("div",{children:["Lunges: ",s.exercises.lunges]})]},r)):E.jsx("div",{className:"text-center text-yellow-400 py-4 col-span-8",children:"No leaderboard data available."})})]}),E.jsx("button",{className:`mt-6 px-6 py-3 bg-yellow-400 text-[#30093f] font-bold rounded-lg \r
              hover:bg-yellow-500 transition-all text-lg`,onClick:()=>n("/challenges"),children:"Join a Challenge 🚀"})]})]})]})};function gNe(){const[t,e]=X.useState(0);let n=ns();const s=async()=>{(await fetch("https://mern-fitness-app-production-e9fe.up.railway.app/activity",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({activity:t})})).ok&&console.log("Sent to DB")};return X.useEffect(()=>{t&&(console.log(t),s(),n("/dashboard"))},[t]),E.jsxs("div",{children:[E.jsx(Ai,{}),E.jsxs("div",{className:"flex",children:[E.jsx(_i,{}),E.jsx("div",{className:"w-screen",children:E.jsxs("div",{className:"h-screen bg-[#30093f] p-0 m-0 flex flex-col items-center font-dm-sans",children:[E.jsx("div",{className:"text-3xl text-center mt-[5vh] text-yellow-400 font-dm-sans max-md:text-lg",children:"Select your activity level"}),E.jsxs("div",{className:" h-[70vh] flex flex-col justify-around",children:[E.jsxs("div",{className:"w-96 h-10 bg-[#1f0729] rounded-full text-white text-[20px] flex justify-center items-center relative cursor-pointer hover:text-white hover:bg-yellow-600 max-md:w-64 ",onClick:()=>{e(1.2)},children:["Sedentary",E.jsx("p",{className:" text-[15px] absolute top-11 left-[50%] -translate-x-1/2 text-white max-md:text-[8px]",children:"Little or no workout"})]}),E.jsxs("div",{className:"w-96 h-10 bg-[#1f0729] rounded-full text-white text-[20px] flex justify-center items-center relative cursor-pointer hover:text-white hover:bg-yellow-600 max-md:w-64 ",onClick:()=>{e(1.375)},children:["Lightly Active",E.jsx("p",{className:" text-[15px] absolute top-11 left-[50%] -translate-x-1/2 text-white max-md:text-[8px]",children:"Exercise 1-3 days a week"})]}),E.jsxs("div",{className:"w-96 h-10 bg-[#1f0729] rounded-full text-white text-[20px] flex justify-center items-center relative cursor-pointer hover:text-white hover:bg-yellow-600 max-md:w-64 ",onClick:()=>{e(1.55)},children:["Moderately Active",E.jsx("p",{className:" text-[15px] absolute top-11 left-[50%] -translate-x-1/2 text-white max-md:text-[8px]",children:"Exercise 3-5 days a week"})]}),E.jsxs("div",{className:"w-96 h-10 bg-[#1f0729] rounded-full text-white text-[20px] flex justify-center items-center relative cursor-pointer hover:text-white hover:bg-yellow-600 max-md:w-64 ",onClick:()=>{e(1.725)},children:["Very Active",E.jsx("p",{className:" text-[15px] absolute top-11 left-[50%] -translate-x-1/2 text-white max-md:text-[8px]",children:"Exercise 6-7 days a week"})]}),E.jsxs("div",{className:"w-96 h-10 bg-[#1f0729] rounded-full text-white text-[20px] flex justify-center items-center relative cursor-pointer hover:text-white hover:bg-yellow-600 max-md:w-64 ",onClick:()=>{e(1.9)},children:["Super Active",E.jsx("p",{className:" text-[15px] absolute top-11 left-[50%] -translate-x-1/2 text-white max-md:text-[8px]",children:"For atheletes"})]})]})]})})]})]})}const yNe=[{id:"squats50",title:"50 Squats",reps:50,points:10},{id:"pushups100",title:"100 Push-Ups",reps:100,points:20},{id:"jumpingjacks300",title:"300 Jumping Jacks",reps:3,points:30},{id:"lunges200",title:"200 Lunges",reps:200,points:25},{id:"crunches150",title:"150 Crunches",reps:150,points:15}],xNe=()=>{const t=ns(),[e,n]=X.useState(null);X.useEffect(()=>{const o=JSON.parse(localStorage.getItem("activeChallenge"));o&&n(o)},[]);const s=o=>{n(o),localStorage.setItem("activeChallenge",JSON.stringify(o)),t(`/activity/${o.title.split(" ")[1]}`)},r=()=>{localStorage.removeItem("activeChallenge"),n(null)};return E.jsxs("div",{className:"w-full h-screen flex flex-col bg-[#30093f] text-white font-dm-sans",children:[E.jsx(Ai,{}),E.jsxs("div",{className:"flex flex-1 w-full",children:[E.jsx(_i,{}),E.jsxs("div",{className:"flex-1 flex flex-col items-center text-center",children:[E.jsx("h2",{className:"text-3xl md:text-4xl font-bold mt-6 text-yellow-400",children:"🔥 Fitness Challenges"}),e?E.jsxs("div",{className:"w-3/4 max-w-4xl bg-[#1f0729] rounded-lg p-5 mt-5 text-center",children:[E.jsxs("h3",{className:"text-lg font-bold text-yellow-400",children:["Ongoing Challenge: ",e.title]}),E.jsxs("p",{className:"text-white",children:["Complete ",e.reps," reps!"]}),E.jsx("button",{className:"mt-3 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-700",onClick:r,children:"Cancel Challenge"})]}):E.jsx("div",{className:"w-96 mx-auto bg-[#1f0729] rounded-lg p-5 mt-5 overflow-x-auto",children:yNe.map(o=>E.jsxs("div",{className:`w-80 mx-auto p-4 mb-3 rounded-lg 
                    text-lg font-bold cursor-pointer text-center transition-all
                    ${(e==null?void 0:e.id)===o.id?"bg-yellow-400 text-[#30093f]":"bg-white text-black hover:bg-yellow-400 hover:text-[#30093f]"}`,onClick:()=>s(o),children:[o.title," 🏅 (+",o.points," pts)"]},o.id))})]})]})]})},wNe=()=>{const[t,e]=X.useState(null),n=ns();return X.useEffect(()=>{(async()=>{try{const r=localStorage.getItem("token");if(!r){alert("User not logged in."),n("/login");return}const o=await Kn.get("http://localhost:3000/getdata",{headers:{Authorization:`Bearer ${r}`}});e(o.data)}catch(r){console.error("Error fetching user data:",r),alert("Failed to load profile.")}})()},[n]),console.log(t),t?E.jsxs("div",{className:"w-screen h-screen flex flex-col bg-[#30093f] text-white font-dm-sans",children:[E.jsx(Ai,{}),E.jsxs("div",{className:"flex flex-1 w-full",children:[E.jsx(_i,{}),E.jsxs("div",{className:"flex-1 flex flex-col justify-center items-center text-center",children:[E.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-6",children:"Profile"}),E.jsxs("div",{className:"bg-[#4f1d5f] shadow-lg rounded-lg p-6 w-full max-w-md text-center",children:[E.jsxs("div",{className:"mb-4",children:[E.jsxs("p",{className:"text-xl font-semibold",children:["👤 ",t.name||"Not Provided"]}),E.jsxs("p",{className:"text-lg",children:["📧 ",t.email]}),E.jsxs("p",{className:"text-lg",children:["🚻 Gender: ",t.gender||"Not Provided"]}),E.jsxs("p",{className:"text-lg",children:["🎂 DOB: ",new Date(t.date).toLocaleDateString()||"Not Provided"]})]}),E.jsxs("div",{className:"text-lg space-y-2",children:[E.jsxs("p",{children:["📏 Height: ",t.height?`${t.height} ${t.lengthScale||"cm"}`:"Not Provided"]}),E.jsxs("p",{children:["⚖️ Weight: ",t.weight?`${t.weight} ${t.weightScale||"kg"}`:"Not Provided"]})]}),E.jsx("button",{onClick:()=>n("/activity"),className:"mt-6 px-6 py-2 bg-blue-500 text-white rounded-lg text-lg font-semibold hover:bg-yellow-500 hover:text-[#30093f] transition",children:"Back to Dashboard"})]})]})]})]}):E.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-[#30093f] text-white",children:E.jsx("h2",{className:"text-2xl font-bold",children:"Loading Profile..."})})},vNe=localStorage.getItem("token"),bNe=GW([{path:"/",element:vNe?E.jsx(LW,{to:"/activity"}):E.jsx(aj,{})},{path:"/signin",element:E.jsx(Tj,{})},{path:"/signup/userdata",element:E.jsx(Rj,{})},{path:"/signup",element:E.jsx(Dj,{})},{path:"/goals",element:E.jsx(va,{children:E.jsx(Aj,{})})},{path:"/profile",element:E.jsx(va,{children:E.jsx(wNe,{})})},{path:"/challenges",element:E.jsx(va,{children:E.jsx(xNe,{})})},{path:"/musclegain",element:E.jsx(va,{children:E.jsx(_j,{})})},{path:"/fatloss",element:E.jsx(va,{children:E.jsx(Fj,{})})},{path:"/activity",element:E.jsx(va,{children:E.jsx(fNe,{})})},{path:"/activity/:exercise",element:E.jsx(va,{children:E.jsx(hNe,{})})},{path:"/leaderboard",element:E.jsx(mNe,{})},{path:"/dashboard",element:E.jsx(va,{children:E.jsx(pNe,{})})},{path:"/select",element:E.jsx(va,{children:E.jsx(gNe,{})})}],{future:{v7_startTransition:!0,v7_relativeSplatPath:!0,v7_fetcherPersist:!0,v7_normalizeFormMethod:!0,v7_partialHydration:!0,v7_skipActionErrorRevalidation:!0}});TA(document.getElementById("root")).render(E.jsx(X.StrictMode,{children:E.jsx(ej,{router:bNe})}));
